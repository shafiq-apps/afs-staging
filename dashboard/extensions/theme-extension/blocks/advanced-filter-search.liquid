{% comment %}
  Advanced Filter Search Block
  Main filter and product display block
{% endcomment %}

<div 
  data-afs-container 
  id="afs-container-{{ block.id }}" 
  class="afs-container"
  data-afs-block-settings='{
    "shop": "{{ shop.permanent_domain }}",
    "apiBaseUrl": "{{ block.settings.api_base_url | default: "https://fstaging.digitalcoo.com" }}",
    "container": "{{ block.settings.container_selector | default: "[data-afs-container]" }}",
    "filtersContainer": "{{ block.settings.filters_container_selector | default: ".afs-filters-container" }}",
    "productsContainer": "{{ block.settings.products_container_selector | default: ".afs-products-container" }}"
  }'
>
  {% comment %} Container will be populated by JavaScript {% endcomment %}
  <div class="afs-filters-container"></div>
  <div class="afs-products-container"></div>
</div>

{% comment %}
  Load AFS modules manually (since they're split into multiple files)
  Schema attributes can only load one JS file, so we load modules manually
  Modules must be loaded in the correct order
{% endcomment %}
<script src="{{ 'afs-constants.js' | asset_url }}" defer></script>
<script src="{{ 'afs-utils-core.js' | asset_url }}" defer></script>
<script src="{{ 'afs-logger.js' | asset_url }}" defer></script>
<script src="{{ 'afs-utils.js' | asset_url }}" defer></script>
<script src="{{ 'afs-state.js' | asset_url }}" defer></script>
<script src="{{ 'afs-url.js' | asset_url }}" defer></script>
<script src="{{ 'afs-api.js' | asset_url }}" defer></script>
<script src="{{ 'afs-dom.js' | asset_url }}" defer></script>
<script src="{{ 'afs-filters.js' | asset_url }}" defer></script>
<script src="{{ 'afs-events.js' | asset_url }}" defer></script>
<script src="{{ 'afs-main.js' | asset_url }}" defer></script>

{% comment %} Initialize AFS after modules load {% endcomment %}
{% render 'advanced-filter-search-init', block: block %}

{% schema %}
{
  "name": "Advanced Filter Search",
  "target": "section",
  "javascript": "advanced-filter-search-init.js",
  "stylesheet": "advanced-filter-search.css",
  "settings": [
    {
      "type": "header",
      "content": "API Configuration"
    },
    {
      "type": "text",
      "id": "api_base_url",
      "label": "API Base URL",
      "default": "https://fstaging.digitalcoo.com",
      "info": "The base URL for your API endpoint"
    },
    {
      "type": "text",
      "id": "shop_domain",
      "label": "Shop Domain",
      "default": "{{ shop.permanent_domain }}",
      "info": "Your Shopify shop domain (automatically set)"
    },
    {
      "type": "header",
      "content": "Container Selectors"
    },
    {
      "type": "text",
      "id": "container_selector",
      "label": "Container Selector",
      "default": "[data-afs-container]",
      "info": "CSS selector for the main container"
    },
    {
      "type": "text",
      "id": "filters_container_selector",
      "label": "Filters Container Selector",
      "default": ".afs-filters-container",
      "info": "CSS selector for the filters container"
    },
    {
      "type": "text",
      "id": "products_container_selector",
      "label": "Products Container Selector",
      "default": ".afs-products-container",
      "info": "CSS selector for the products container"
    },
    {
      "type": "header",
      "content": "Pagination"
    },
    {
      "type": "number",
      "id": "page_size",
      "label": "Products Per Page",
      "default": 20,
      "info": "Number of products to display per page"
    }
  ]
}
{% endschema %}

