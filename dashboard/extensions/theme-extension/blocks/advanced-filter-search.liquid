{% comment %}
  Advanced Filter Search Block
  Main filter and product display block
{% endcomment %}

{% comment %}
  Set global shop domain variable from Shopify Liquid
{% endcomment %}
<script>
  window.AFS_SHOP_DOMAIN = "{{ shop.permanent_domain }}";
</script>

{% comment %}
  Inject custom CSS if provided
{% endcomment %}
{% if block.settings.custom_css != blank %}
  <style id="afs-custom-css-{{ block.id }}">
    /* Custom CSS for Advanced Filter Search Block #{{ block.id }} */
    {{ block.settings.custom_css }}
  </style>
{% endif %}

<div 
  data-afs-container 
  id="afs-container-{{ block.id }}" 
  class="afs-container"
  data-afs-block-settings='{
    "apiBaseUrl": "{{ block.settings.api_base_url | default: "https://fstaging.digitalcoo.com" }}"
  }'
>
  {% comment %} Container will be populated by JavaScript {% endcomment %}
  <div class="afs-main-content">
    <div class="afs-filters-container"></div>
    <div class="afs-products-container"></div>
  </div>
</div>

{% comment %}
  Load AFS modules manually (since they're split into multiple files)
  Schema attributes can only load one JS file, so we load modules manually
  Modules must be loaded in the correct order
{% endcomment %}
<script src="{{ 'afs-core.js' | asset_url }}" defer></script>
<script src="{{ 'afs-state.js' | asset_url }}" defer></script>
<script src="{{ 'afs-api.js' | asset_url }}" defer></script>
<script src="{{ 'afs-ui.js' | asset_url }}" defer></script>
<script src="{{ 'afs-main.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Advanced Filter Search",
  "target": "section",
  "javascript": "advanced-filter-search-init.js",
  "stylesheet": "advanced-filter-search.css",
  "settings": [
    {
      "type": "header",
      "content": "API Configuration"
    },
    {
      "type": "text",
      "id": "api_base_url",
      "label": "API Base URL",
      "default": "https://fstaging.digitalcoo.com",
      "info": "The base URL for your API endpoint"
    },
    {
      "type": "header",
      "content": "Custom Styling"
    },
    {
      "type": "paragraph",
      "content": "Add custom CSS to fix style conflicts or customize the appearance for your theme. Use the block ID selector (#afs-container-{block_id}) to target this specific block instance."
    },
    {
      "type": "textarea",
      "id": "custom_css",
      "label": "Custom CSS",
      "default": "",
      "info": "Enter custom CSS rules to fix style conflicts or customize appearance. The block ID is automatically available as #afs-container-{block_id}. You can also use class selectors like .afs-filters-container or .afs-products-grid.",
      "placeholder": "/* Example: Adjust filter width */\n.afs-filters-container {\n  width: 280px;\n  min-width: 250px;\n}\n\n/* Example: Fix product grid layout */\n.afs-products-grid {\n  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n  gap: 20px;\n}\n\n/* Example: Override theme conflicts */\n#afs-container-{block_id} {\n  padding: 0 !important;\n}"
    }
  ]
}
{% endschema %}

