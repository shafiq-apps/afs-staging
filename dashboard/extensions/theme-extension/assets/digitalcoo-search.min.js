"use strict";var H={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'};var B={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24};var w={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",soldOut:"Sold out",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}};var a={debounce:(e,n)=>{let t;return(...r)=>{t!==void 0&&clearTimeout(t),t=setTimeout(()=>e(...r),n)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.selectionType),"multiple")||a.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(n=>String(n).trim()).filter(Boolean):String(e).split(",").map(n=>n.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let n=e.productId||e.id||e.gid;return n&&String(n).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,n,t={})=>{let r=document.createElement(e);return n&&(r.className=n),Object.entries(t).forEach(([i,o])=>r.setAttribute(i,o)),r},txt:(e,n)=>(e.textContent=n,e),clear:e=>{for(;e.firstChild;){let n=e.firstChild;n&&e.removeChild(n)}},frag:(e,n)=>{let t=document.createDocumentFragment();return e.forEach(r=>t.appendChild(n(r))),t},optimizeImageUrl:(e,n={})=>{if(!e||typeof e!="string")return"";let{width:t=500,height:r=t,quality:i=80,format:o="webp",crop:l=null}=n;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let c=new URL(e),u=new URLSearchParams(c.search);return u.delete("width"),u.delete("height"),u.delete("crop"),u.delete("format"),u.delete("quality"),u.set("width",String(t)),u.set("height",String(r)),l&&u.set("crop",l),i!==100&&u.set("quality",String(i)),!c.pathname.toLowerCase().endsWith(".gif")&&o&&u.set("format",o),`${c.origin}${c.pathname}?${u.toString()}`}catch(c){return e}},buildImageSrcset:(e,n=[200,300,500])=>e?n.map(t=>`${a.optimizeImageUrl(e,{width:t,format:"webp",quality:t<=200?75:t<=300?80:85})} ${t}w`).join(", "):"",formatMoney:(e,n,t="")=>{if(isNaN(Number(e)))return"";let r=parseFloat(String(e))/100;if(!n||typeof n!="string")return`${t||""}${r.toFixed(2)}`;let i=r.toFixed(2);return n.includes("{{amount_no_decimals}}")?(i=Math.round(r).toString(),n.replace("{{amount_no_decimals}}",i)):n.includes("{{amount_with_comma_separator}}")?(i=r.toFixed(2).replace(".",","),n.replace("{{amount_with_comma_separator}}",i)):n.includes("{{amount_no_decimals_with_comma_separator}}")?(i=Math.round(r).toString(),n.replace("{{amount_no_decimals_with_comma_separator}}",i)):n.includes("{{amount_with_apostrophe_separator}}")?(i=r.toFixed(2).replace(".","'"),n.replace("{{amount_with_apostrophe_separator}}",i)):n.replace("{{amount}}",i)},equals:(e,n)=>e===n?!0:e==null||n===null||n===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(n)&&(n=n.join(",")),typeof e=="string"&&typeof n=="string"?e.trim().toLowerCase()===n.trim().toLowerCase():typeof e=="number"&&typeof n=="number"||typeof e=="boolean"&&typeof n=="boolean"?e===n:String(e).trim().toLowerCase()===String(n).trim().toLowerCase()),equalsAny:(e,...n)=>e==null?!1:n.some(t=>a.equals(e,t)),isVendorKey:e=>a.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>a.equalsAny(e,"productType","productTypes"),isTagKey:e=>a.equalsAny(e,"tag","tags"),isCollectionKey:e=>a.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>a.equalsAny(e,"priceRange","price"),isBestSelling:e=>a.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>a.equals(e,"Collection"),isPriceRangeOptionType:e=>a.equals(e,"priceRange")};function te(e,n=document,t=5e3){return new Promise((r,i)=>{let o=n.querySelector(e);if(o){r(o);return}let l=setTimeout(()=>{d.disconnect(),i(new Error(`Element ${e} not found within ${t}ms`))},t),d=new MutationObserver((u,m)=>{let h=n.querySelector(e);h&&(m.disconnect(),clearTimeout(l),r(h))}),c=n instanceof Document?n.body:n;d.observe(c,{childList:!0,subtree:!0})})}function ce(e,n=document,t=5e3){return Promise.all(e.map(r=>te(r,n,t)))}function ue(e,n){return Array.from({length:n},(t,r)=>{var o;let i=e.querySelector(`.afs-product-modal__option-value[data-option-index="${r}"].afs-product-modal__option-value--selected`);return(o=i==null?void 0:i.dataset.optionValue)!=null?o:null})}function pe(e,n){return e.filter(t=>n.every((r,i)=>r?i===0?t.option1===r:i===1?t.option2===r:t.option3===r:!0))}function z(e){return e.available!==!1&&e.availableForSale!==!1}function ie(e,n,t,r){return e.variants.some(i=>!(i.available!==!1&&i.availableForSale!==!1)||n===0&&i.option1!==t||n===1&&i.option2!==t||n===2&&i.option3!==t?!1:r.every((l,d)=>d===n||!l?!0:d===0?i.option1===l:d===1?i.option2===l:i.option3===l))}var j=new Map,ye=new Set(["shop","shop_domain","cpid"]),be={buildFilterMetadata:e=>{let n=new Map;return Array.isArray(e)&&e.forEach(t=>{t.handle&&n.set(t.handle,{label:t.label||t.queryKey||t.optionKey||t.handle,queryKey:t.queryKey,optionKey:t.optionKey,optionType:t.optionType})}),n}},s={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:B.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},g={enabled:!0,error:(e,n)=>{g.enabled&&console.error("[AFS]",e,n||"")},warn:(e,n)=>{g.enabled&&console.warn("[AFS]",e,n||"")},info:(e,n)=>{g.enabled&&console.info("[AFS]",e,n||"")},debug:(e,n)=>{g.enabled&&console.debug("[AFS]",e,n||"")},log:(e,...n)=>{g.enabled&&console.log(e,...n)},init:e=>{g.enabled=e!==!1,g.log("%cAdvanced Filter & Search initialized","color: #00c853;font-size: 20px;font-weight: bold;background: #0b1e13;padding: 10px 15px;border-radius: 6px;font-family: Arial, sans-serif;")}},q={parse(){let e=new URL(window.location.href),n={},t,r;return e.searchParams.forEach((i,o)=>{if(!ye.has(o))if(a.isVendorKey(o))n.vendor=a.split(i);else if(a.isProductTypeKey(o))n.productType=a.split(i);else if(a.isTagKey(o))n.tags=a.split(i);else if(a.isCollectionKey(o))n.collections=a.split(i);else if(a.equals(o,"search"))n.search=i;else if(a.equals(o,"priceMin")){let l=Math.round(parseFloat(i));!isNaN(l)&&l>=0&&(t=l)}else if(a.equals(o,"priceMax")){let l=Math.round(parseFloat(i));!isNaN(l)&&l>=0&&(r=l)}else if(a.isPriceRangeKey(o)){let l=i.split("-");if(l.length===2){let d=Math.round(parseFloat(l[0])),c=Math.round(parseFloat(l[1]));!isNaN(d)&&d>=0&&(t=d),!isNaN(c)&&c>=0&&(r=c)}}else if(a.equals(o,"page"))n.page=parseInt(i,10)||1;else if(a.equals(o,"limit"))n.limit=parseInt(i,10)||B.PAGE_SIZE;else if(a.equals(o,"sort")){let l=i.toLowerCase().trim();if(a.isBestSelling(l))n.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[d,c]=l.split("-"),u=a.equalsAny(c,"ascending")?"asc":a.equalsAny(c,"descending")?"desc":"desc";n.sort={field:d,order:u}}else{let[d,c]=i.split(":");n.sort={field:d,order:a.equalsAny(c,"asc")?"asc":"desc"}}}else n[o]=a.split(i),g.debug("Handle filter parsed directly",{handle:o,value:i})}),(t!==void 0||r!==void 0)&&(n.priceRange={min:t,max:r}),n},update(e,n,t){let r=new URL(window.location.href);if(r.search="",g.debug("Updating URL",{filters:e,pagination:n}),e&&!a.empty(e)&&Object.keys(e).forEach(o=>{let l=e[o];if(!a.empty(l))if(Array.isArray(l)&&l.length>0)r.searchParams.set(o,l.join(",")),g.debug("URL param set",{key:o,value:l.join(",")});else if(a.isPriceRangeKey(o)&&l&&typeof l=="object"&&!Array.isArray(l)){let d=l,c=typeof d.min=="number"&&!isNaN(d.min)?Math.round(d.min):void 0,u=typeof d.max=="number"&&!isNaN(d.max)?Math.round(d.max):void 0;if(s.priceRangeHandle){let m=`${c!==void 0?c:""}-${u!==void 0?u:""}`;r.searchParams.set(s.priceRangeHandle,m),g.debug("Price range URL handle param set",{handle:s.priceRangeHandle,value:m})}else c!==void 0&&r.searchParams.set("priceMin",String(c)),u!==void 0&&r.searchParams.set("priceMax",String(u)),g.debug("Price range URL params set",{priceMin:c,priceMax:u})}else a.equals(o,"search")&&typeof l=="string"&&l.trim()&&(r.searchParams.set(o,l.trim()),g.debug("Search URL param set",{key:o,value:l.trim()}))}),n&&n.page>1&&(r.searchParams.set("page",String(n.page)),g.debug("Page URL param set",{page:n.page})),t&&t.field){if(t.field==="best-selling"||t.field==="bestselling")r.searchParams.set("sort","best-selling");else{let o=a.equals(t.order,"asc")?"ascending":"descending";r.searchParams.set("sort",`${t.field}-${o}`)}g.debug("Sort URL param set",{field:t.field,order:t.order})}let i=r.toString();g.info("URL updated",{newUrl:i,oldUrl:window.location.href}),history.pushState({filters:e,pagination:n,sort:t},"",r)}},A={baseURL:"https://fstaging.digitalcoo.com/storefront",__v:"v2.0.1",__id:"01-09-2026",cache:new Map,timestamps:new Map,pending:new Map,key(e,n,t){return`${n.page}-${n.limit}-${t.field}-${t.order}-${JSON.stringify(e)}`},get(e){let n=this.timestamps.get(e);return!n||Date.now()-n>B.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,n){this.cache.set(e,n),this.timestamps.set(e,Date.now())},async fetch(e,n=B.TIMEOUT){let t=new AbortController,r=setTimeout(()=>t.abort(),n);try{g.debug("Fetching",{url:e});let i=await fetch(e,{signal:t.signal});if(clearTimeout(r),!i.ok){let l=await i.text().catch(()=>"");throw new Error(`HTTP ${i.status}: ${i.statusText}${l?" - "+l:""}`)}let o=await i.json();return g.debug("Fetch success",{url:e,hasData:!!o}),o}catch(i){throw clearTimeout(r),i instanceof Error&&i.name==="AbortError"?new Error("Request timeout"):(g.error("Fetch failed",{url:e,error:i instanceof Error?i.message:String(i)}),i)}},shouldSendCpid(){var e;return!!((e=s.selectedCollection)!=null&&e.id)},async products(e,n,t){var c;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!s.shop)throw new Error("Shop not set");let r=this.key(e,n,t),i=this.get(r);if(i)return g.debug("Cache hit",{key:r}),i;if(this.pending.has(r))return g.debug("Request deduplication",{key:r}),this.pending.get(r);let o=new URLSearchParams;if(o.set("shop",s.shop),this.shouldSendCpid()?(o.set("cpid",s.selectedCollection.id),g.debug("cpid sent to products API",{cpid:s.selectedCollection.id,filters:e})):g.debug("cpid not sent to products API",{hasCpid:!!((c=s.selectedCollection)!=null&&c.id),filters:e,reason:"filters present or cpid already in collection filter"}),Object.keys(e).forEach(u=>{let m=e[u];if(!a.empty(m))if(a.isPriceRangeKey(u)&&m&&typeof m=="object"&&!Array.isArray(m)){let h=m,p=typeof h.min=="number"&&!isNaN(h.min)?Math.round(h.min):void 0,v=typeof h.max=="number"&&!isNaN(h.max)?Math.round(h.max):void 0;s.priceRangeHandle?o.set(s.priceRangeHandle,`${p!==void 0?p:""}-${v!==void 0?v:""}`):(p!==void 0&&o.set("priceMin",String(p)),v!==void 0&&o.set("priceMax",String(v)))}else u==="search"&&typeof m=="string"&&m.trim()?o.set(u,m.trim()):Array.isArray(m)&&m.length>0?(o.set(u,m.join(",")),g.debug("Filter sent as direct handle param",{handle:u,value:m.join(",")})):typeof m=="string"&&(o.set(u,m),g.debug("Filter sent as direct handle param",{handle:u,value:m}))}),o.set("page",String(n.page)),o.set("limit",String(n.limit)),t.field)if(a.isBestSelling(t.field))o.set("sort","best-selling");else{let u=a.equals(t.order,"asc")?"ascending":"descending";o.set("sort",`${t.field}-${u}`)}let l=`${this.baseURL}/products?${o}`;g.info("Fetching products",{url:l,shop:s.shop,page:n.page}),S.showLoading("products");let d=this.fetch(l).then(u=>{var h,p;if(!u.success||!u.data)throw g.error("Invalid products response",{response:u}),new Error(`Invalid products response: ${u.message||w.messages.unknownError}`);let m=u.data;return g.info("Products response",{productsCount:((h=m.products)==null?void 0:h.length)||0,total:((p=m.pagination)==null?void 0:p.total)||0,hasFilters:!!m.filters}),this.set(r,m),this.pending.delete(r),m}).catch(u=>{throw this.pending.delete(r),g.error("Products fetch failed",{error:u instanceof Error?u.message:String(u),url:l}),u});return S.showLoading("products"),this.pending.set(r,d),d},async filters(e){var d;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!s.shop)throw new Error("Shop not set");let n=new URLSearchParams;n.set("shop",s.shop),this.shouldSendCpid()?(n.set("cpid",s.selectedCollection.id),g.debug("cpid sent to filters API",{cpid:s.selectedCollection.id,filters:e})):g.debug("cpid not sent to filters API",{hasCpid:!!((d=s.selectedCollection)!=null&&d.id),filters:e,reason:"filters present or cpid already in collection filter"});let t={...e};Object.keys(t).forEach(c=>{let u=t[c];if(!a.empty(u)){if(Array.isArray(u))n.set(c,u.join(","));else if(c==="search"&&typeof u=="string"&&u.trim())n.set("search",u.trim());else if(c==="priceRange"&&u&&typeof u=="object"&&!Array.isArray(u)){let m=u,h=typeof m.min=="number"&&!isNaN(m.min)?m.min:void 0,p=typeof m.max=="number"&&!isNaN(m.max)?m.max:void 0;s.priceRangeHandle?n.set(s.priceRangeHandle,`${h!==void 0?h:""}-${p!==void 0?p:""}`):(h!==void 0&&n.set("priceMin",String(h)),p!==void 0&&n.set("priceMax",String(p)))}}});let r={};n.forEach((c,u)=>{r[u]=c}),g.debug("All params for filters endpoint",{params:r});let i=`${this.baseURL}/filters?${n}`;g.info("Fetching filters",{url:i,shop:s.shop}),S.showLoading("filters");let o=await this.fetch(i);if(!o.success||!o.data)throw g.error("Invalid filters response",{response:o}),new Error(`Invalid filters response: ${o.message||w.messages.unknownError}`);let l=o.data;if(!l||typeof l!="object")throw new Error("Invalid filters response: data is not an object");return l.filters!==void 0&&!Array.isArray(l.filters)&&(g.warn("Filters response contains non-array filters",{filters:l.filters}),l.filters=[]),g.info("Filters response:",{filters:l.filters}),l},setBaseURL(e){this.baseURL=e},buildFiltersFromUrl(e){s.filters={vendor:e.vendor||[],productType:e.productType||[],tags:e.tags||[],collections:e.collections||[],search:e.search||"",priceRange:e.priceRange||null},Object.keys(e).forEach(n=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","cpid"].includes(n)){let t=e[n];Array.isArray(t)?s.filters[n]=t:typeof t=="string"&&(s.filters[n]=[t])}}),se(s.filters)},setPaginationFromUrl(e){e.page?s.pagination.page=e.page:s.fallbackPagination&&s.fallbackPagination.currentPage&&(s.pagination.page=s.fallbackPagination.currentPage)},setSortFromUrl(e){if(e.sort){let n=typeof e.sort=="object"?e.sort.field:e.sort;if(typeof n=="string"){let t=n.toLowerCase().trim();if(t==="best-selling"||t==="bestselling")s.sort={field:"best-selling",order:"asc"};else if(t.includes("-")){let[r,i]=t.split("-"),o=a.equalsAny(i,"ascending")?"asc":a.equalsAny(i,"descending")?"desc":"desc";s.sort={field:r,order:o}}else{let[r,i]=n.split(":");s.sort={field:r,order:i||"desc"}}}else typeof e.sort=="object"&&e.sort.field&&(s.sort={field:e.sort.field,order:e.sort.order||"desc"})}else s.sort={field:"best-selling",order:"asc"}}},S={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(e,n,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Container selector cannot be empty. Provide a valid selector or ensure [data-afs-container] exists in the DOM.");if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error(`Container not found. Selector: "${e}". Please ensure the container element exists in the DOM.`);this.container.setAttribute("data-afs-container","true");let r=this.container.querySelector(".afs-main-content")||a.el("div","afs-main-content");r.parentNode||this.container.appendChild(r),this.filtersContainer=n&&n.trim()!==""&&document.querySelector(n)||null,this.filtersContainer||(this.filtersContainer=a.el("div","afs-filters-container")),!this.filtersContainer.parentNode&&r&&r.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=a.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":w.buttons.closeFilters}),this.mobileFilterClose.innerHTML=w.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=a.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",r.parentNode?r.parentNode.insertBefore(this.mobileFilterBackdrop,r):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=t&&t.trim()!==""&&document.querySelector(t)||null,this.productsContainer||(this.productsContainer=a.el("div","afs-products-container")),!this.productsContainer.parentNode&&r&&r.appendChild(this.productsContainer),this.productsInfo=a.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=a.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":w.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${w.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=a.el("div","afs-sort-container");let i=a.el("label","afs-sort-label",{for:"afs-sort-label"});i.textContent=w.labels.sortBy,this.sortSelect=a.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${w.sortOptions.bestSelling}</option>
        <option value="title-ascending">${w.sortOptions.titleAsc}</option>
        <option value="title-descending">${w.sortOptions.titleDesc}</option>
        <option value="price-ascending">${w.sortOptions.priceAsc}</option>
        <option value="price-descending">${w.sortOptions.priceDesc}</option>
        <option value="created-ascending">${w.sortOptions.createdAsc}</option>
        <option value="created-descending">${w.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(i),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=a.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},attachEvents(){if(!S.container)return;S.container.addEventListener("click",t=>{var c,u,m,h,p,v;let r=t.target,i=(c=r.closest("[data-afs-action]"))==null?void 0:c.dataset.afsAction,o=r.closest(".afs-filter-item"),l=r instanceof HTMLInputElement&&(r.type==="checkbox"||r.type==="radio")?r:o==null?void 0:o.querySelector(".afs-filter-item__checkbox"),d=r.closest(".afs-pagination__button");if(i==="clear-all")s.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(u=s.selectedCollection)!=null&&u.id&&g.debug("Clear All: keeping server-managed cpid (not exposed to UI)"),s.pagination.page=1,q.update(s.filters,s.pagination,s.sort),S.scrollToProducts(),S.showLoading(),R.apply();else if(i==="toggle-filters"||i==="close-filters")S.toggleMobileFilters();else if(r.closest(".afs-applied-filter-chip__remove")){let b=r.closest(".afs-applied-filter-chip"),T=b==null?void 0:b.querySelector(".afs-applied-filter-chip__remove"),y=T==null?void 0:T.getAttribute("data-afs-filter-key"),C=T==null?void 0:T.getAttribute("data-afs-filter-value");if(!y)return;if(a.equals(y,"cpid")){(m=s.selectedCollection)!=null&&m.id&&(s.selectedCollection.id=null,g.debug("cpid removed, cleared selectedCollection")),q.update(s.filters,s.pagination,s.sort),S.scrollToProducts(),S.showLoading(),R.apply();return}if(a.equals(y,"search")){s.filters.search="",s.pagination.page=1,q.update(s.filters,s.pagination,s.sort),S.scrollToProducts(),S.showLoading(),R.apply();return}if(a.isPriceRangeKey(y)){s.filters.priceRange=null,s.pagination.page=1,q.update(s.filters,s.pagination,s.sort),S.scrollToProducts(),S.showLoading(),R.apply();return}C&&R.toggle(y,C)}else if(l&&o){t.preventDefault(),t.stopPropagation();let b=o.getAttribute("data-afs-filter-handle")||((h=o.parentElement)==null?void 0:h.getAttribute("data-afs-filter-handle")),T=o.getAttribute("data-afs-filter-value"),y=o.getAttribute("data-afs-filter-multiselect")||((p=o.parentElement)==null?void 0:p.getAttribute("data-afs-filter-multiselect"));if(!b||!T){g.warn("Invalid filter item clicked",{handle:b,value:T});return}g.debug("Filter toggle",{handle:b,value:T,currentChecked:l.checked}),(y==="0"||y==="false")&&(s.filters[b]=[]),R.toggle(b,T)}else if(d&&!d.disabled){let b=parseInt(d.getAttribute("data-afs-page")||"0",10);if(b&&b>0){if(s.usingFallback){let y=q.parse().page||s.pagination.page||1;s.pagination.page=b}else s.pagination.page=b;q.update(s.filters,s.pagination,s.sort),S.scrollToProducts(),S.showLoading(),R.applyProductsOnly()}}else if(r.closest(".afs-filter-group__clear")){t.preventDefault(),t.stopPropagation();let b=r.closest(".afs-filter-group__clear");if(!b)return;let T=b.getAttribute("data-afs-filter-handle");if(!T)return;let y=s.filterMetadata.get(T),C=a.isCollectionOptionType(y==null?void 0:y.optionType)||a.isCollectionKey(T);if(s.filters[T]){if(C&&((v=s.selectedCollection)!=null&&v.id)){let E=s.filters[T],_=s.selectedCollection.id;Array.isArray(E)&&E.some(x=>String(x)===String(_))&&(s.selectedCollection.id=null,g.debug("Collection filter cleared (contained cpid), cleared cpid",{handle:T,cpid:_}))}delete s.filters[T],g.debug("Filter cleared",{handle:T,isCollectionFilter:C}),q.update(s.filters,s.pagination,s.sort),S.scrollToProducts(),S.showLoading(),R.apply()}}else if(r.closest(".afs-filter-group__toggle")){t.preventDefault(),t.stopPropagation();let b=r.closest(".afs-filter-group");if(!b)return;let y=!(b.getAttribute("data-afs-collapsed")==="true");b.setAttribute("data-afs-collapsed",y?"true":"false");let C=b.getAttribute("data-afs-filter-key");if(C)try{let P=j.get(C)||{};P.collapsed=y,P.lastUpdated=Date.now(),j.set(C,P);try{let x=`afs_filter_state_${b.getAttribute("data-afs-filter-handle")}`;sessionStorage.setItem(x,JSON.stringify({collapsed:y}))}catch(x){g.debug("Could not persist to sessionStorage",{error:x instanceof Error?x.message:String(x)})}}catch(P){g.error("Failed to persist filter state",{stateKey:C,error:P instanceof Error?P.message:String(P)})}let E=b.querySelector(".afs-filter-group__toggle");E&&E.setAttribute("aria-expanded",y?"false":"true");let _=b.querySelector(".afs-filter-group__icon");_&&(_.innerHTML=y?H.rightArrow||"":H.downArrow||""),g.debug("Filter group toggled",{collapsed:y,stateKey:C})}else if(r.closest(".afs-product-card__quick-add")){t.preventDefault(),t.stopPropagation();let b=r.closest(".afs-product-card__quick-add");if(!b||b.disabled)return;let T=b.getAttribute("data-product-handle"),y=b.getAttribute("data-product-id");T&&ge.add(T,y)}else if(r.closest(".afs-product-card__quick-view")){t.preventDefault(),t.stopPropagation();let b=r.closest(".afs-product-card__quick-view");if(!b)return;let T=b.getAttribute("data-product-handle");T&&_e(T)}}),S.container.addEventListener("input",t=>{var i;let r=t.target;if(r.classList.contains("afs-filter-group__search-input")){let l=r.value.toLowerCase(),d=(i=r.closest(".afs-filter-group"))==null?void 0:i.querySelector(".afs-filter-group__items");d!=null&&d._items&&d.querySelectorAll(".afs-filter-item").forEach((c,u)=>{var h;let m=(h=d._items)==null?void 0:h[u];if(m){let p=a.str(typeof m=="string"?m:m.label||m.value||"").toLowerCase();c.style.display=!l||p.includes(l)?"":"none"}})}});let e=t=>{let r=t.value;if(!r)return;g.info("Sort dropdown changed",{sortValue:r,currentSort:s.sort});let i;if(r==="best-selling"||r==="bestselling")i={field:"best-selling",order:"asc"};else if(r.includes("-")){let[o,l]=r.split("-");i={field:o,order:l==="ascending"?"asc":"desc"}}else{let[o,l]=r.split(":");i={field:o,order:l||"desc"}}s.sort=i,s.pagination.page=1,q.update(s.filters,s.pagination,s.sort),g.info("Calling applyProductsOnly after sort change",{sort:s.sort}),S.scrollToProducts(),S.showLoading(),R.applyProductsOnly()},n=null;S.container.addEventListener("focus",t=>{let r=t.target;r.classList.contains("afs-sort-select")&&(n=r.value)},!0),S.container.addEventListener("change",t=>{let r=t.target;if(r.classList.contains("afs-sort-select")){let i=r;e(i),n=i.value}}),S.container.addEventListener("blur",t=>{let r=t.target;if(r.classList.contains("afs-sort-select")){let i=r,o=i.value;o&&o!==n&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{let l;if(a.isBestSelling(s.sort.field))l="best-selling";else{let d=a.equals(s.sort.order,"asc")?"ascending":"descending";l=`${s.sort.field}-${d}`}o!==l&&e(i)})}),n=o}},!0),window.addEventListener("popstate",()=>{let t=q.parse(),r=JSON.stringify(s.filters),i=s.pagination.page,o=JSON.stringify(s.sort);s.filters={vendor:t.vendor||[],productType:t.productType||[],tags:t.tags||[],collections:t.collections||[],search:t.search||"",priceRange:t.priceRange||null},Object.keys(t).forEach(p=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort"].includes(p)){let v=t[p];Array.isArray(v)?s.filters[p]=v:typeof v=="string"&&(s.filters[p]=[v])}});let l=s.priceRangeHandle?s.filters[s.priceRangeHandle]:null;if(s.priceRangeHandle&&Array.isArray(l)&&l.length>0){let v=String(l[0]||"").split("-");if(v.length===2){let b=v[0].trim()?parseInt(v[0],10):void 0,T=v[1].trim()?parseInt(v[1],10):void 0,y=typeof b=="number"&&!isNaN(b)&&b>=0,C=typeof T=="number"&&!isNaN(T)&&T>=0;(y||C)&&(s.filters.priceRange={min:y?b:void 0,max:C?T:void 0},delete s.filters[s.priceRangeHandle])}}let d=t.page||s.pagination.page;if(d!==i&&(s.pagination.page=d),t.sort){let p=typeof t.sort=="object"?t.sort.field:t.sort;if(typeof p=="string"){let v=p.toLowerCase().trim();if(v==="best-selling"||v==="bestselling")s.sort={field:"best-selling",order:"asc"};else if(v.includes("-")){let[b,T]=v.split("-"),y=a.equalsAny(T,"ascending")?"asc":a.equalsAny(T,"descending")?"desc":"desc";s.sort={field:b,order:y}}else{let[b,T]=p.split(":");s.sort={field:b,order:T||"desc"}}}else typeof t.sort=="object"&&t.sort.field&&(s.sort={field:t.sort.field,order:t.sort.order||"desc"})}else s.sort={field:"best-selling",order:"asc"};let c=JSON.stringify(s.filters),u=JSON.stringify(s.sort);!(r!==c)&&(u!==o||d!==i)?R.applyProductsOnly():R.apply()})},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",g.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),g.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let n=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),n&&window.scrollTo(0,parseInt(n||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let n=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${n}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}g.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton(),j.clear(),this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(r=>{let i=r.getAttribute("data-afs-filter-key");if(i){let o=r.querySelector(".afs-filter-group__search-input"),l=r.getAttribute("data-afs-collapsed")==="true",d=(o==null?void 0:o.value)||"",c=j.get(i);j.set(i,{...c,collapsed:l,search:d,lastUpdated:Date.now()})}}),a.clear(this.filtersContainer);let n=e.filter(r=>r?a.isPriceRangeOptionType(r.optionType)?r.range&&typeof r.range.min=="number"&&typeof r.range.max=="number"&&r.range.max>r.range.min:r.values&&r.values.length>0:!1);if(g.debug("Rendering filters",{total:e.length,valid:n.length,filtersWithSearchable:n.filter(r=>r.searchable).length,filtersWithCollapsed:n.filter(r=>r.collapsed).length}),n.length===0){g.warn("No valid filters to render");return}let t=document.createDocumentFragment();n.forEach(r=>{var E;if(a.isPriceRangeOptionType(r.optionType)){let _=this.createPriceRangeGroup(r,j);_&&t.appendChild(_);return}let i;if(r.optionType||r.optionKey){if(i=r.handle,!i){g.error("Option filter missing handle",{filter:r});return}}else if(i=r.queryKey||r.key,!i){g.warn("Standard filter missing queryKey/key",{filter:r});return}g.debug("Filter group handle determined",{handle:i,filterHandle:r.handle,queryKey:r.queryKey,key:r.key,label:r.label,type:r.optionType,optionType:r.optionType,optionKey:r.optionKey,isOptionFilter:!!(r.optionType||r.optionKey)});let o=a.el("div","afs-filter-group",{"data-afs-filter-type":r.optionType||""});o.setAttribute("data-afs-filter-handle",i);let l=i;o.setAttribute("data-afs-filter-key",l);let d=j.get(l),c=(d==null?void 0:d.collapsed)!==void 0?d.collapsed:r.collapsed===!0||r.collapsed==="true"||r.collapsed===1;o.setAttribute("data-afs-collapsed",c?"true":"false"),g.debug("Filter group created",{handle:i,label:r.label,collapsed:c,searchable:r.searchable,showCount:r.showCount,valuesCount:((E=r.values)==null?void 0:E.length)||0});let u=a.el("div","afs-filter-group__header"),m=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":c?"false":"true",title:r.tooltipContent||`Toggle ${r.label||i} filter`}),h=a.el("span","afs-filter-group__icon");h.innerHTML=c?H.rightArrow||"":H.downArrow||"",m.appendChild(h),m.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),r.label||r.optionType||"")),u.appendChild(m);let p=s.filters[i];if(p&&(Array.isArray(p)?p.length>0:typeof p=="object"&&!Array.isArray(p)?Object.keys(p).length>0:!!p)){let _=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${w.buttons.clear} ${r.label||i} filters`,"data-afs-filter-handle":i});_.textContent=w.buttons.clear,_.title=`${w.buttons.clear} ${r.label||i} filters`,u.appendChild(_)}o.appendChild(u);let b=a.el("div","afs-filter-group__content");if(r.searchable===!0||typeof r.searchable=="string"&&r.searchable.toLowerCase()==="true"){let _=a.el("div","afs-filter-group__search"),P=a.el("input","afs-filter-group__search-input",{type:"text",placeholder:r.searchPlaceholder||"Search...","aria-label":`${w.labels.search}${r.label||i}`,name:`afs-search-${i}`});d!=null&&d.search&&(P.value=d.search),_.appendChild(P),b.appendChild(_),g.debug("Search input added",{handle:i,label:r.label,searchable:r.searchable})}let y=a.el("div","afs-filter-group__items",{"data-afs-filter-handle":i,"data-afs-filter-multiselect":a.isMultiSelect(r)?"1":"0","data-afs-filter-display-type":a.toLowerCase(r.displayType||"CHECKBOX")});y._items=r.values;let C=document.createDocumentFragment();r.values&&r.values.forEach((_,P)=>{let x=this.createFilterItem(i,_,r,P);x&&C.appendChild(x)}),y.appendChild(C),b.appendChild(y),o.appendChild(b),t.appendChild(o)}),t.children.length>0?(this.filtersContainer.appendChild(t),this.showFilters(),g.debug("Filters rendered",{count:t.children.length})):(g.warn("No filter groups created"),this.hideFilters())},createFilterItem(e,n,t,r){var v;let i=a.str(typeof n=="string"?n:n.value||n.key||n.name||"");if(!i||i==="[object Object]")return null;let o=typeof n=="string"?n:n.label||n.value||i;if((a.isCollectionOptionType(t==null?void 0:t.optionType)||a.isCollectionKey(e))&&s.collections&&Array.isArray(s.collections)){if((v=s.selectedCollection)!=null&&v.id&&String(i)===String(s.selectedCollection.id))return null;let b=s.collections.find(T=>{let y=String(T.id||T.gid||T.collectionId||"");return y&&String(y)===String(i)});if(b)o=b.title||b.label||b.name||o;else return null}let c=(s.filters[e]||[]).includes(i),u=a.inputDisplayType(t),m=(u==="radio"?e:e+"-"+i.replace(/\s+/g,"-").toLowerCase())+"_"+(r+1),h=a.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":i,for:m});c&&h.classList.add("afs-filter-item--active");let p=a.el("input","afs-filter-item__checkbox",{type:u});return p.checked=c,p.setAttribute("data-afs-filter-value",i),p.setAttribute("name",m),p.setAttribute("id",m),h.appendChild(p),h.appendChild(a.txt(a.el("span","afs-filter-item__label"),o)),t!=null&&t.showCount&&typeof n=="object"&&n.count&&h.appendChild(a.txt(a.el("span","afs-filter-item__count"),`(${n.count})`)),h},createPriceRangeGroup(e,n=null){var ee;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return g.warn("Invalid price range filter",{filter:e}),null;let t=Math.round(e.range.min),r=Math.round(e.range.max),i=s.filters.priceRange||{min:t,max:r},o=Math.round(Math.max(t,Math.min(r,i.min||t))),l=Math.round(Math.max(t,Math.min(r,i.max||r))),d=a.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),c=n==null?void 0:n.get(e.key||"priceRange"),u=(ee=c==null?void 0:c.collapsed)!=null?ee:e.collapsed===!0;d.setAttribute("data-afs-collapsed",u?"true":"false");let m=a.el("div","afs-filter-group__header"),h=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":u?"false":"true"}),p=a.el("span","afs-filter-group__icon");if(p.innerHTML=u?H.rightArrow||"":H.downArrow||"",h.appendChild(p),h.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),m.appendChild(h),s.filters.priceRange&&(s.filters.priceRange.min!==t||s.filters.priceRange.max!==r)){let k=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${w.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});k.textContent=w.buttons.clear,k.title=`${w.buttons.clear} ${e.label} filter`,m.appendChild(k)}d.appendChild(m);let b=a.el("div","afs-filter-group__content"),T=a.el("div","afs-price-range-container"),y=a.el("div","afs-price-range-track"),C=a.el("div","afs-price-range-active");y.appendChild(C);let E=a.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(t),max:String(r),value:String(o),step:"1"});E.setAttribute("data-afs-range-type","min");let _=a.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(t),max:String(r),value:String(l),step:"1"});_.setAttribute("data-afs-range-type","max"),y.appendChild(E),y.appendChild(_),T.appendChild(y);let P=a.el("div","afs-price-range-values"),x=a.el("span","afs-price-range-value afs-price-range-value--min"),U=a.el("span","afs-price-range-value afs-price-range-value--max"),K=k=>`$${parseFloat(String(k)).toFixed(0)}`;x.textContent=K(o),U.textContent=K(l),P.appendChild(x),P.appendChild(a.txt(a.el("span","afs-price-range-separator")," - ")),P.appendChild(U),T.appendChild(P);let Y=()=>{let k=Math.round(parseFloat(E.value)),L=Math.round(parseFloat(_.value)),$=r-t,I=(k-t)/$*100,N=(r-L)/$*100;C.style.left=`${I}%`,C.style.right=`${N}%`,x.textContent=K(k),U.textContent=K(L)},O=()=>{let k=Math.round(parseFloat(E.value)),L=Math.round(parseFloat(_.value));k>L&&(E.value=String(L),_.value=String(k)),Y()};return E.addEventListener("input",()=>{O(),R.updatePriceRange(Math.round(parseFloat(E.value)),Math.round(parseFloat(_.value)))}),_.addEventListener("input",()=>{O(),R.updatePriceRange(Math.round(parseFloat(E.value)),Math.round(parseFloat(_.value)))}),Y(),b.appendChild(T),d.appendChild(b),d},renderProducts(e){if(!this.productsGrid)return;let n=this.productsGrid.querySelectorAll(".afs-skeleton-card");n.length>0&&n.forEach(o=>o.remove());let t=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(o=>{let l=o.getAttribute("data-afs-product-id");l&&t.set(l,o)});let r=new Set(e.map(o=>a.id(o)).filter(o=>o!==null)),i=document.createDocumentFragment();e.forEach(o=>{let l=a.id(o);if(!l)return;let d=t.get(l);if(d){let c=d.querySelector(".afs-product-card__title");c&&c.textContent!==o.title&&(c.textContent=o.title||"");let u=d.querySelector(".afs-product-card__price");if(u){let m=parseFloat(String(o.minPrice||0))*100,h=parseFloat(String(o.maxPrice||0))*100,p=a.formatMoney(m,s.moneyFormat||"{{amount}}",s.currency||""),v=m===h?p:`${w.labels.price}from ${p}`;u.textContent!==v&&(u.textContent=v)}}else{let c=this.createProduct(o);c&&i.appendChild(c)}}),t.forEach((o,l)=>{r.has(l)||o.remove()}),i.children.length>0&&this.productsGrid.appendChild(i)},createProduct(e){var r,i;let n=a.el("div","afs-product-card",{"data-afs-product-id":a.id(e)||""});if(e.imageUrl||e.featuredImage){let o=a.el("div","afs-product-card__image"),l=a.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),d=((r=e.featuredImage)==null?void 0:r.url)||((i=e.featuredImage)==null?void 0:i.urlFallback)||e.imageUrl||"";if(d){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let p=[];e.featuredImage.urlSmall&&p.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&p.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&p.push(`${e.featuredImage.urlLarge} 500w`),p.length>0&&(l.setAttribute("srcset",p.join(", ")),l.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),l.src=e.featuredImage.url||e.featuredImage.urlFallback||d}else{let p=a.optimizeImageUrl(d,{width:300,format:"webp",quality:80}),v=a.buildImageSrcset(d,[200,300,500]);v&&(l.setAttribute("srcset",v),l.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),l.src=p||d}l.onerror=function(){var v;let p=((v=e.featuredImage)==null?void 0:v.urlFallback)||d;if(p&&this.src!==p)this.src=p;else if(this.src.includes("_webp.")){let b=d.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");b!==this.src?this.src=b:this.style.display="none"}else this.style.display="none"}}o.appendChild(l);let c=a.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":a.id(e)||"","aria-label":w.buttons.quickAddToCart,type:"button"}),u=a.el("span","afs-product-card__quick-add-icon");u.innerHTML=H.plus,c.appendChild(u);let m=a.el("span","afs-product-card__quick-add-text");m.textContent=w.buttons.quickAdd,c.appendChild(m),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(p=>p.availableForSale))&&(c.disabled=!0,c.classList.add("afs-product-card__quick-add--disabled"),c.setAttribute("aria-label",w.labels.productUnavailable));let h=we(e);h&&o.appendChild(h),n.appendChild(o)}let t=a.el("a","afs-product-card__info",{href:`/products/${e.handle}`});if(t){t.appendChild(a.txt(a.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&t.appendChild(a.txt(a.el("div","afs-product-card__vendor"),e.vendor));let o=parseFloat(String(e.minPrice||0))*100,l=parseFloat(String(e.maxPrice||0))*100,d=a.formatMoney(o,s.moneyFormat||"{{amount}}",s.currency||""),c=o===l?d:`from ${d}`;t.appendChild(a.txt(a.el("div","afs-product-card__price"),c)),n.appendChild(t)}return n},updateFilterState(e,n,t){if(!this.filtersContainer){g.warn("Cannot update filter state: filtersContainer not found");return}let r=c=>String(c).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),i=r(n),l=`.afs-filter-item[data-afs-filter-handle="${r(e)}"][data-afs-filter-value="${i}"]`,d=this.filtersContainer.querySelector(l);if(d){let c=d.querySelector(".afs-filter-item__checkbox");c?(c.checked=t,g.debug("Checkbox state updated",{handle:e,value:n,active:t})):g.warn("Checkbox not found in filter item",{handle:e,value:n}),d.classList.toggle("afs-filter-item--active",t)}else g.warn("Filter item not found for state update",{handle:e,value:n,active:t,selector:l})},renderInfo(e,n){if(!this.productsInfo)return;let t=this.sortContainer,r=this.productsInfo.querySelector(".afs-products-info__results");r&&r.remove();let i;if(n===0)i=a.txt(a.el("div","afs-products-info__results"),w.messages.noProductsFound);else if(n===1)i=a.txt(a.el("div","afs-products-info__results"),w.messages.oneProductFound);else{let o=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,n);i=a.txt(a.el("div","afs-products-info__results"),`${w.messages.showingProducts} ${o}-${l} of ${n} ${w.messages.productsFound}`)}t&&t.parentNode?this.productsInfo.insertBefore(i,t):(this.productsInfo.appendChild(i),t&&!t.parentNode&&this.productsInfo.appendChild(t))},renderPagination(e){var l;if(!this.productsGrid||!e)return;let n=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(n&&n.remove(),e.totalPages<=1)return;let t=a.el("div","afs-pagination"),r=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${w.buttons.previous} ${w.messages.pageOf.toLowerCase()}`});r.textContent=w.buttons.previous,r.disabled=e.page<=1,t.appendChild(r);let i=a.el("span","afs-pagination__info");i.textContent=`${w.messages.pageOf} ${e.page} of ${e.totalPages}`,t.appendChild(i);let o=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${w.buttons.next} ${w.messages.pageOf.toLowerCase()}`});o.textContent=w.buttons.next,o.disabled=e.page>=e.totalPages,t.appendChild(o),this.productsContainer&&this.productsContainer.appendChild(t)},renderApplied(e){if(!this.container)return;let n=this.container.querySelector(".afs-applied-filters");n&&n.remove();let t=[];if(Object.keys(e).forEach(d=>{let c=e[d];if(a.equals(d,"search")&&c&&typeof c=="string"&&c.trim())t.push({handle:d,label:`${w.labels.search}${c}`,value:c});else if(a.isPriceRangeKey(d)&&c&&typeof c=="object"&&!Array.isArray(c)){let u=c,m=typeof u.min=="number"&&!isNaN(u.min),h=typeof u.max=="number"&&!isNaN(u.max);if(m&&h){let p=Math.round(u.min),v=Math.round(u.max);t.push({handle:d,label:`${w.labels.price}$${p} - $${v}`,value:"__clear__"})}else if(m){let p=Math.round(u.min);t.push({handle:d,label:`${w.labels.price}$${p}+`,value:"__clear__"})}else if(h){let p=Math.round(u.max);t.push({handle:d,label:`${w.labels.price}Up to $${p}`,value:"__clear__"})}}else Array.isArray(c)&&c.length>0&&c.forEach(u=>{let m=s.filterMetadata.get(d),h=(m==null?void 0:m.label)||d,p=u;if((a.isCollectionOptionType(m==null?void 0:m.optionType)||a.isCollectionKey(d))&&s.collections&&Array.isArray(s.collections)){let b=s.collections.find(T=>{let y=String(T.id||T.gid||T.collectionId||"");return y&&String(y)===String(u)});b&&(p=b.title||b.label||b.name||u)}t.push({handle:d,label:`${h}: ${p}`,value:u})})}),t.length===0)return;let r=a.el("div","afs-applied-filters"),i=a.el("div","afs-applied-filters__header");i.appendChild(a.txt(a.el("div","afs-applied-filters__label"),w.labels.appliedFilters)),r.appendChild(i);let o=a.el("div","afs-applied-filters__list");t.forEach(d=>{let c=a.el("div","afs-applied-filter-chip");c.appendChild(a.txt(a.el("span","afs-applied-filter-chip__label"),d.label));let u=a.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":d.handle,"data-afs-filter-value":d.value,"aria-label":`${w.buttons.clear} filter`,type:"button"});u.innerHTML=H.close,c.appendChild(u),o.appendChild(c)});let l=a.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});l.textContent=w.buttons.clearAll,o.appendChild(l),r.appendChild(o),this.container.insertBefore(r,this.container.firstChild)},scrollToProducts(){s.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),g.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),g.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),g.debug("Scrolled to products info")))},showLoading(e="both"){(e==="products"||e==="both")&&this.showProductsSkeleton(),(e==="filters"||e==="both")&&this.showFiltersSkeleton()},hideLoading(e="both"){var n;(e==="products"||e==="both")&&(Array.isArray(this.loading)?(this.loading.forEach(t=>{t.parentNode&&t.remove()}),this.loading=null):(n=this.loading)!=null&&n.parentNode&&(this.loading.remove(),this.loading=null)),(e==="filters"||e==="both")&&this.hideFiltersSkeleton()},showProductsSkeleton(){var r;if(!this.productsGrid)return;a.clear(this.productsGrid);let e=((r=s.pagination)==null?void 0:r.limit)||B.PAGE_SIZE||24,n=Math.max(e,24),t=[];for(let i=0;i<n;i++){let o=a.el("div","afs-skeleton-card");o.innerHTML=`
				<div class="afs-skeleton-card__image">&#8203;</div>
				<div class="afs-skeleton-card__info">
					<div class="afs-skeleton-card__title">&#8203;</div>
					<div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
					<div class="afs-skeleton-card__price">&#8203;</div>
				</div>
			`,t.push(o)}t.forEach(i=>this.productsGrid.appendChild(i)),this.loading=t},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let n=a.el("div","afs-filters-skeleton");for(let t=0;t<4;t++){let r=a.el("div","afs-skeleton-filter-group");r.innerHTML=`
				<div class="afs-skeleton-filter-group__header">
					<div class="afs-skeleton-filter-group__title">&#8203;</div>
				</div>
				<div class="afs-skeleton-filter-group__content">
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
				</div>
			`,n.appendChild(r)}this.filtersContainer.appendChild(n)},hideFiltersSkeleton(){var n;let e=(n=this.filtersContainer)==null?void 0:n.querySelector(".afs-filters-skeleton");e&&e.remove()},hideProductsSkeleton(){var n;let e=(n=this.filtersContainer)==null?void 0:n.querySelector(".afs-filters-skeleton");e&&e.remove()},showError(e){var r;if(!this.productsContainer&&(this.productsContainer=((r=this.container)==null?void 0:r.querySelector(".afs-products-container"))||null,!this.productsContainer&&this.container)){let i=this.container.querySelector(".afs-main-content");i&&(this.productsContainer=a.el("div","afs-products-container"),i.appendChild(this.productsContainer))}if(!this.productsContainer){g.error("Cannot show error: productsContainer not found",{message:e}),console.error("[AFS Error]",e);return}if(this.hideLoading(),s.fallbackProducts&&s.fallbackProducts.length>0){g.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:s.fallbackProducts.length}),s.products=s.fallbackProducts,s.pagination={page:1,limit:B.PAGE_SIZE,total:s.fallbackProducts.length,totalPages:Math.ceil(s.fallbackProducts.length/B.PAGE_SIZE)},this.renderProducts(s.products),this.renderInfo(s.pagination,s.pagination.total),this.renderPagination(s.pagination);return}let n=this.productsContainer.querySelector(".afs-error-message");n&&n.remove();let t=a.el("div","afs-error-message");t.textContent=e||w.messages.failedToLoad,this.productsGrid?(a.clear(this.productsGrid),this.productsGrid.appendChild(t)):this.productsContainer.appendChild(t),g.error("Error displayed",{message:e})},setSortSelectValue(){if(S.sortSelect){if(a.isBestSelling(s.sort.field))S.sortSelect.value="best-selling";else{let e=a.equals(s.sort.order,"asc")?"ascending":"descending";S.sortSelect.value=`${s.sort.field}-${e}`}g.debug("Sort select value updated programmatically",{value:S.sortSelect.value,sort:s.sort})}}},le={getPagination(){let n=q.parse().page||s.fallbackPagination.currentPage||1,t=s.fallbackPagination.totalPages||1,r=s.fallbackPagination.totalProducts||s.fallbackProducts.length||0;return{page:n,limit:B.PAGE_SIZE,total:r,totalPages:t}},reloadPage(e,n,t){let r=new URL(window.location.href);if(r.search="",t&&t.field)if(t.field==="best-selling"||t.field==="bestselling")r.searchParams.set("sort","best-selling");else{let i=a.equals(t.order,"asc")?"ascending":"descending";r.searchParams.set("sort",`${t.field}-${i}`)}n&&n.page&&r.searchParams.set("page",String(n.page)),Object.keys(e||{}).forEach(i=>{let o=e[i];if(!a.empty(o))if(Array.isArray(o)&&o.length>0)r.searchParams.set(i,o.join(","));else if(a.isPriceRangeKey(i)&&o&&typeof o=="object"&&!Array.isArray(o)){let l=o,d=typeof l.min=="number"&&!isNaN(l.min)?Math.round(l.min):void 0,c=typeof l.max=="number"&&!isNaN(l.max)?Math.round(l.max):void 0;s.priceRangeHandle?r.searchParams.set(s.priceRangeHandle,`${d!==void 0?d:""}-${c!==void 0?c:""}`):(d!==void 0&&r.searchParams.set("priceMin",String(d)),c!==void 0&&r.searchParams.set("priceMax",String(c)))}else a.equals(i,"search")&&typeof o=="string"&&o.trim()&&r.searchParams.set(i,o.trim())}),g.info("Reloading page for fallback mode",{url:r.toString(),sort:t,pagination:n}),window.location.href=r.toString()}},se=e=>{var t;if(!((t=s.selectedCollection)!=null&&t.id))return;Object.keys(e||{}).some(r=>{let i=e[r];if(a.empty(i)||a.equalsAny(r,"page","limit","sort","size"))return!1;if(a.isPriceRangeKey(r)){if(!i||typeof i!="object"||Array.isArray(i))return!1;let o=i,l=typeof o.min=="number"&&!isNaN(o.min),d=typeof o.max=="number"&&!isNaN(o.max);if(!l&&!d)return!1}return!(a.equals(r,"search")&&(!i||typeof i!="string"||!i.trim()))})&&g.debug("Filters present, keeping cpid (server-managed)",{filters:e})};function ve(e){if(S.hideLoading(),g.error("Load failed",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,shop:s.shop,apiBaseURL:A.baseURL}),s.fallbackProducts&&s.fallbackProducts.length>0){if(g.warn("Initial load failed, using fallback products from Liquid",{error:e instanceof Error?e.message:String(e),fallbackCount:s.fallbackProducts.length}),s.usingFallback=!0,s.products=s.fallbackProducts,s.pagination=le.getPagination(),s.availableFilters=[],S.hideFilters(),S.sortSelect)if(a.isBestSelling(s.sort.field))S.sortSelect.value="best-selling";else{let n=a.equals(s.sort.order,"asc")?"ascending":"descending";S.sortSelect.value=`${s.sort.field}-${n}`}S.renderProducts(s.products),S.renderInfo(s.pagination,s.pagination.total),S.renderPagination(s.pagination),S.renderApplied(s.filters)}else S.showError(`${w.messages.failedToLoad}: ${e instanceof Error?e.message:w.messages.unknownError}. ${w.messages.checkConsole}`)}var J={process:e=>{var t,r,i;g.info("Products loaded",{count:((t=e.products)==null?void 0:t.length)||0,total:((r=e.pagination)==null?void 0:r.total)||0}),!(e.products&&Array.isArray(e.products)&&e.products.length>0)&&s.fallbackProducts&&s.fallbackProducts.length>0?(g.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((i=e.products)==null?void 0:i.length)||0,fallbackCount:s.fallbackProducts.length}),s.usingFallback=!0,s.products=s.fallbackProducts,s.pagination=le.getPagination(),s.availableFilters=[],S.hideFilters(),S.hideLoading("products")):(s.usingFallback=!1,s.products=e.products||[],s.pagination=e.pagination||s.pagination,S.showFilters(),S.renderProducts(s.products)),J.updateUI()},updateUI:()=>{S.renderInfo(s.pagination,s.pagination.total||0),S.renderPagination(s.pagination),S.renderApplied(s.filters),S.setSortSelectValue()}},R={process:e=>{s.availableFilters=e.filters||[];try{s.filterMetadata=be.buildFilterMetadata(s.availableFilters)}catch(r){}let n=s.availableFilters.find(r=>a.isPriceRangeOptionType(r.optionType));s.priceRangeHandle=(n==null?void 0:n.handle)||s.priceRangeHandle||null,g.info("Filters set from URL",{filters:s.filters});let t=s.priceRangeHandle?s.filters[s.priceRangeHandle]:null;if(s.priceRangeHandle&&Array.isArray(t)&&t.length>0){let i=String(t[0]||"").split("-");if(i.length===2){let o=i[0].trim()?parseInt(i[0],10):void 0,l=i[1].trim()?parseInt(i[1],10):void 0,d=typeof o=="number"&&!isNaN(o)&&o>=0,c=typeof l=="number"&&!isNaN(l)&&l>=0;(d||c)&&(s.filters.priceRange={min:d?o:void 0,max:c?l:void 0},delete s.filters[s.priceRangeHandle])}}S.renderFilters(s.availableFilters),g.info("Filters rendered",{count:s.availableFilters.length}),J.updateUI(),S.hideLoading("filters")},toggle(e,n){var c,u;let t=a.str(n);if(!t||!e){g.warn("Invalid filter toggle",{handle:e,value:n});return}let r=s.filters[e]||[],i=r.includes(t),o=i?r.filter(m=>m!==t):[...r,t],l=s.filterMetadata.get(e);if(((l==null?void 0:l.optionType)==="Collection"||e==="collections")&&((c=s.selectedCollection)!=null&&c.id)){let m=s.selectedCollection.id;i&&String(t)===String(m)?(s.selectedCollection.id=null,g.debug("Collection filter unchecked (was cpid), cleared cpid",{handle:e,value:t,cpid:m})):o.some(h=>String(h)===String(m))||(s.selectedCollection.id=null,g.debug("Collection filter toggled, cpid no longer in values, cleared cpid",{handle:e,value:t,filterValues:o,wasCpid:String(t)===String(m),originalCpid:m}))}if(o.length===0?delete s.filters[e]:s.filters[e]=o,se(s.filters),s.pagination.page=1,g.debug("Filter toggled",{handle:e,value:t,wasActive:i,isActive:!i,filterValues:o}),q.update(s.filters,s.pagination,s.sort),S.updateFilterState(e,t,!i),S.scrollToProducts(),S.showLoading(),window.innerWidth<=768&&((u=S.filtersContainer)!=null&&u.classList.contains("afs-filters-container--open"))){S.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let m=document.body.style.top;m&&window.scrollTo(0,parseInt(m||"0",10)*-1)}this.apply()},updatePriceRange(e,n){if(e=Math.round(e),n=Math.round(n),typeof e!="number"||typeof n!="number"||e<0||n<e){g.warn("Invalid price range",{min:e,max:n});return}let t=s.availableFilters.find(r=>a.isPriceRangeOptionType(r.optionType)||a.equals(r.optionKey,"priceRange"));if(t&&t.range){let r=Math.round(t.range.min),i=Math.round(t.range.max);e===r&&n===i?s.filters.priceRange=null:s.filters.priceRange={min:e,max:n}}else s.filters.priceRange={min:e,max:n};se(s.filters),s.pagination.page=1,g.debug("Price range updated",{min:e,max:n,priceRange:s.filters.priceRange}),q.update(s.filters,s.pagination,s.sort),S.scrollToProducts(),S.showLoading("products"),this.apply()},applyProductsOnly:a.debounce(async()=>{if(g.info("applyProductsOnly called",{filters:s.filters,pagination:s.pagination,sort:s.sort,usingFallback:s.usingFallback}),s.usingFallback){g.info("In fallback mode, reloading page with new parameters"),le.reloadPage(s.filters,s.pagination,s.sort);return}S.scrollToProducts(),A.products(s.filters,s.pagination,s.sort).then(J.process)},B.DEBOUNCE),apply:a.debounce(async()=>{S.scrollToProducts(),A.products(s.filters,s.pagination,s.sort).then(J.process),A.filters(s.filters).then(R.process)},B.DEBOUNCE)},ge={async add(e,n){try{let t=`/products/${e}.json`,r=await fetch(t);if(!r.ok)throw new Error(w.messages.failedToLoadProduct);let o=(await r.json()).product;if(!o||!o.variants||o.variants.length===0)throw new Error("Product has no variants");let l=o.variants.find(d=>d.available)||o.variants[0];await this.addVariant(Number(l.id),1)}catch(t){g.error("Quick add failed",{error:t instanceof Error?t.message:String(t),handle:e}),S.showError("Failed to add product to cart. Please try again.")}},async addFromForm(e,n){var t,r;try{let i=new FormData(e),o=i.get("id"),l=parseInt(((t=i.get("quantity"))==null?void 0:t.toString())||"1",10);if(o)await this.addVariant(Number(o),l);else{let d=[];for(let v=1;v<=3;v++){let b=i.get(`option${v}`);b&&d.push(b.toString())}let c=`/products/${n}.json`,p=(r=(await(await fetch(c)).json()).product.variants)==null?void 0:r.find(v=>v.options?v.options.length===d.length&&v.options.every((b,T)=>b===d[T]):!1);if(p)await this.addVariant(Number(p.id),l);else throw new Error("Variant not found")}}catch(i){g.error("Add from form failed",{error:i instanceof Error?i.message:String(i)}),S.showError("Failed to add product to cart. Please try again.")}},async addVariant(e,n){try{let t=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:n})});if(!t.ok){let r=await t.json();throw new Error(r.description||w.messages.failedToAddToCart)}await t.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(t){throw g.error("Add variant failed",{error:t instanceof Error?t.message:String(t),variantId:e}),t}},showSuccess(){let e=document.querySelector(".afs-quick-add-success");e||(e=a.el("div","afs-quick-add-success"),document.body.appendChild(e)),e.textContent=w.messages.addedToCart,e.classList.add("afs-quick-add-success--show");let n=()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",n)},t=setTimeout(()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",n)},3e3);e.addEventListener("animationend",()=>{clearTimeout(t),n()},{once:!0})}},fe={init(e={}){var n,t,r,i;try{if(g.init(e.debug),g.info("Initializing AFS",e),e.apiBaseUrl&&(A.setBaseURL(e.apiBaseUrl),g.info("API base URL set",{url:A.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");s.shop=e.shop,s.collections=e.collections||[],s.selectedCollection={id:(t=(n=e.selectedCollection)==null?void 0:n.id)!=null?t:null,sortBy:(i=(r=e.selectedCollection)==null?void 0:r.sortBy)!=null?i:null},s.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.moneyFormat&&(s.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(s.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(s.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(s.fallbackProducts=e.fallbackProducts,g.info("Fallback products loaded from Liquid",{count:s.fallbackProducts.length})),e.fallbackPagination&&(s.fallbackPagination=e.fallbackPagination,g.info("Fallback pagination loaded from Liquid",{currentPage:s.fallbackPagination.currentPage,totalPages:s.fallbackPagination.totalPages,totalProducts:s.fallbackPagination.totalProducts})),e.priceRangeHandle!==void 0&&(s.priceRangeHandle=e.priceRangeHandle),g.info("Shop set",{shop:s.shop}),g.info("Collections set",{collections:s.collections});let o=e.containerSelector||e.container||"[data-afs-container]",l=e.filtersSelector||e.filtersContainer,d=e.productsSelector||e.productsContainer;S.init(o,l,d),g.info("DOM initialized"),S.showLoading(),S.attachEvents(),g.info("DOM events attached"),this.load()}catch(o){throw g.error("Initialization failed",{error:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0,config:e}),S.container&&S.showError(`Initialization failed: ${o instanceof Error?o.message:String(o)}`),o}},async load(){S.showLoading();try{let e=q.parse();g.debug("Parsed URL params on load",{urlParams:e}),A.buildFiltersFromUrl(e),A.setPaginationFromUrl(e),A.setSortFromUrl(e),g.info("Loading products & filters...",{shop:s.shop,filters:s.filters}),A.products(s.filters,s.pagination,s.sort).then(J.process),A.filters(s.filters).then(R.process)}catch(e){ve(e)}},Logger:g},ae=class{constructor(n,t={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.currentZoom=2;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let r=typeof n=="string"?document.querySelector(n):n;if(!r)throw console.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=r,this.options={thumbnailsPosition:t.thumbnailsPosition||"left",enableKeyboard:t.enableKeyboard!==!1,enableAutoHeight:t.enableAutoHeight!==!1,maxHeight:t.maxHeight||null,animationDuration:t.animationDuration||300,enableMagnifier:t.enableMagnifier!==!1,magnifierZoom:t.magnifierZoom||3,...t},this.magnifierEnabled=this.options.enableMagnifier,this.currentZoom=this.options.magnifierZoom||3,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){console.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){console.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let n=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(n),this.images.length===0){console.error("AFSSlider: No images found");return}let t=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(t),this.thumbnails.length===0&&console.warn("AFSSlider: No thumbnails found, continuing without thumbnails"),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(r){console.error("AFSSlider: Error building slider structure",r);return}try{this.setupEvents()}catch(r){console.error("AFSSlider: Error setting up events",r)}if(this.magnifierEnabled&&!this.isTouchDevice)try{setTimeout(()=>{this.setupPanZoom()},0)}catch(r){console.error("AFSSlider: Error setting up pan-zoom",r)}if(this.isTouchDevice)try{this.setupPinchZoom()}catch(r){console.error("AFSSlider: Error setting up pinch-zoom",r)}try{this.goToSlide(0)}catch(r){console.error("AFSSlider: Error showing first slide",r)}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let r=document.createElement("div");r.className="afs-slider__viewport",this.images.forEach(i=>{r.appendChild(i)}),this.mainContainer.appendChild(r),this.magnifierEnabled&&!this.isTouchDevice&&this.createZoomControls(r)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let r=document.createElement("button");r.type="button",r.className="afs-slider__prev",r.setAttribute("aria-label","Previous image"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(r)}if(!this.mainContainer.querySelector(".afs-slider__next")){let r=document.createElement("button");r.type="button",r.className="afs-slider__next",r.setAttribute("aria-label","Next image"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(r)}if(this.thumbnails.length===0&&this.thumbnailContainer){let r=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(r)}this.thumbnails.forEach((r,i)=>{var l;let o=r.cloneNode(!0);(l=r.parentNode)==null||l.replaceChild(o,r),this.thumbnails[i]=o,o.addEventListener("click",()=>{this.goToSlide(i)})});let n=this.mainContainer.querySelector(".afs-slider__prev"),t=this.mainContainer.querySelector(".afs-slider__next");n&&n.addEventListener("click",()=>this.prevSlide()),t&&t.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=n=>{if(!this.isInitialized)return;let t=this.container.getBoundingClientRect();if(!(t.width===0||t.height===0))switch(n.key){case"ArrowLeft":n.preventDefault(),this.prevSlide();break;case"ArrowRight":n.preventDefault(),this.nextSlide();break;case"Escape":let r=this.images[this.currentIndex];r&&(r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200));break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let n=0,t=0,r=!1,i=this.mainContainer.querySelector(".afs-slider__viewport");i&&(i.addEventListener("touchstart",o=>{n=o.touches[0].clientX,t=o.touches[0].clientY,r=!0},{passive:!0}),i.addEventListener("touchmove",o=>{r&&o.preventDefault()},{passive:!1}),i.addEventListener("touchend",o=>{if(!r)return;r=!1;let l=o.changedTouches[0].clientX,d=o.changedTouches[0].clientY,c=n-l,u=t-d;Math.abs(c)>Math.abs(u)&&Math.abs(c)>50&&(c>0?this.nextSlide():this.prevSlide())},{passive:!0}))}createZoomControls(n){let t=document.createElement("div");t.className="afs-slider__zoom-controls";let r=document.createElement("input");r.type="range",r.className="afs-slider__zoom-slider",r.setAttribute("min","2"),r.setAttribute("max","5"),r.setAttribute("step","1"),r.setAttribute("value",String(this.currentZoom)),r.setAttribute("aria-label","Zoom level"),r.setAttribute("aria-valuemin","2"),r.setAttribute("aria-valuemax","5"),r.addEventListener("input",i=>{i.stopPropagation();let o=Number(i.target.value);this.setZoomLevel(o)}),r.addEventListener("mousedown",i=>{i.stopPropagation()}),t.appendChild(r),n.appendChild(t)}setZoomLevel(n){var i;this.currentZoom=n;let t=(i=this.mainContainer)==null?void 0:i.querySelector(".afs-slider__viewport");if(t){let o=t.querySelector(".afs-slider__zoom-slider");o&&(o.value=String(n),o.setAttribute("aria-valuenow",String(n)))}let r=this.images[this._currentIndex];r&&r.classList.contains("afs-slider__image--zoomed")&&(r.style.transform="scale(1) translate(0, 0)",setTimeout(()=>{},50))}setupPanZoom(){if(!this.mainContainer)return;let n=this.mainContainer.querySelector(".afs-slider__viewport");if(!n){console.warn("AFSSlider: Viewport not found for pan-zoom, skipping zoom setup");return}n.classList.add("afs-slider__viewport--zoomable"),n.addEventListener("mousemove",t=>{let r=this.images[this._currentIndex];if(!r)return;let i=n.getBoundingClientRect(),o=t.clientX-i.left,l=t.clientY-i.top,d=o/i.width,c=l/i.height,u=this.currentZoom,m=-d*(r.offsetWidth*u-i.width),h=-c*(r.offsetHeight*u-i.height);r.style.transform=`
		scale(${u})
		translate(${m/u}px, ${h/u}px)
	  `,r.classList.add("afs-slider__image--zoomed")}),n.addEventListener("mouseenter",()=>{let t=this.images[this._currentIndex];t&&t.classList.add("afs-slider__image--zoomed")}),n.addEventListener("mouseleave",()=>{let t=this.images[this._currentIndex];t&&(t.style.transform="scale(1) translate(0, 0)",t.classList.remove("afs-slider__image--zoomed"),t.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{t.classList.remove("afs-slider__image--zoom-reset")},200))})}setupPinchZoom(){if(!this.mainContainer||!this.isTouchDevice)return;let n=this.mainContainer.querySelector(".afs-slider__viewport");if(!n)return;let t=0,r=1,i=0,o=null;n.addEventListener("touchstart",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1];t=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY);let u=this.images[this._currentIndex];if(u){let h=(u.style.transform||"").match(/scale\(([\d.]+)\)/);r=h?parseFloat(h[1]):1}}else if(l.touches.length===1){let d=Date.now();if(d-i<300){l.preventDefault(),o&&clearTimeout(o);let c=this.images[this._currentIndex];if(c){let m=(c.style.transform||"").match(/scale\(([\d.]+)\)/),h=m?parseFloat(m[1]):1;if(h>1)c.style.transform="scale(1) translate(0, 0)",h=1;else{let p=n.getBoundingClientRect(),v=l.touches[0],b=v.clientX-p.left,T=v.clientY-p.top,y=2.5;c.style.transform=`scale(${y}) translate(${(p.width/2-b)/y}px, ${(p.height/2-T)/y}px)`,h=y}}}else i=d}},{passive:!1}),n.addEventListener("touchmove",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1],u=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY),m=Math.max(1,Math.min(4,r*(u/t))),h=this.images[this._currentIndex];if(h){let p=n.getBoundingClientRect(),v=(d.clientX+c.clientX)/2-p.left,b=(d.clientY+c.clientY)/2-p.top,T=(p.width/2-v)/m,y=(p.height/2-b)/m;h.style.transform=`scale(${m}) translate(${T}px, ${y}px)`}}},{passive:!1}),n.addEventListener("touchend",()=>{t=0})}goToSlide(n){if(n<0||n>=this.images.length)return;this._currentIndex=n,this.images.forEach((r,i)=>{i===n?r.classList.add("afs-slider__image--active"):r.classList.remove("afs-slider__image--active")});let t=this.images[this._currentIndex];t&&(t.classList.remove("afs-slider__image--zoomed"),t.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{t.classList.remove("afs-slider__image--zoom-reset")},200)),this.thumbnails.forEach((r,i)=>{r.classList.toggle("afs-slider__thumbnail--active",i===n)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:n,total:this.images.length}}))}prevSlide(){let n=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(n)}nextSlide(){let n=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(n)}adjustHeight(){let n=this.images[this._currentIndex];n&&(n.complete?this.setHeight(n):n.addEventListener("load",()=>{this.setHeight(n)},{once:!0}))}setHeight(n){if(!this.mainContainer)return;let t=this.mainContainer.querySelector(".afs-slider__viewport");if(!t)return;if(this.options.maxHeight){t.style.height=`${this.options.maxHeight}px`,t.style.minHeight=`${this.options.maxHeight}px`,t.style.maxHeight=`${this.options.maxHeight}px`;return}let r=n.naturalHeight||n.offsetHeight,i=n.naturalWidth||n.offsetWidth,o=this.mainContainer.offsetWidth,l=r/i,d=o*l;t.style.height=`${d}px`,t.style.minHeight=`${d}px`}updateVariantImage(n,t,r){var m;if(!n||!t||!Array.isArray(t)||t.length===0)return!1;let i=n.id;if(r&&Array.isArray(r)){if(n.featured_image&&typeof n.featured_image=="object"&&n.featured_image.variant_ids){let h=n.featured_image.position;if(h!=null){let p=h-1;if(p>=0&&p<this.images.length&&p<t.length)return this._currentIndex!==p&&this.goToSlide(p),!0}}for(let h of r)if(h.featured_image&&typeof h.featured_image=="object"&&h.featured_image.variant_ids&&h.featured_image.variant_ids.includes(Number(i))){let p=h.featured_image.position;if(p!=null){let v=p-1;if(v>=0&&v<this.images.length&&v<t.length)return this._currentIndex!==v&&this.goToSlide(v),!0}}}let o=null,l=null;if(n.featured_image&&(typeof n.featured_image=="object"?(o=n.featured_image.src||n.featured_image.url||null,l=(m=n.featured_image.position)!=null?m:null):typeof n.featured_image=="string"&&(o=n.featured_image)),o||(typeof n.image=="string"?o=n.image:n.image&&typeof n.image=="object"?o=n.image.url||n.image.src||null:n.imageUrl?o=n.imageUrl:n.featuredImage&&typeof n.featuredImage=="object"&&(o=n.featuredImage.url||n.featuredImage.src||null)),!o)return!1;let d=h=>h?(typeof h=="string"?h:(h==null?void 0:h.url)||(h==null?void 0:h.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",c=d(o);if(l!=null){let h=l-1;if(h>=0&&h<this.images.length&&h<t.length)return this._currentIndex!==h&&this.goToSlide(h),!0}let u=t.findIndex(h=>{let p=d(h);return p===c||p.includes(c)||c.includes(p)});if(u===-1){let h=c.split("/").pop();u=t.findIndex(p=>d(p).split("/").pop()===h)}return u!==-1&&u<this.images.length?(this._currentIndex!==u&&this.goToSlide(u),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(n=>{n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200)}),this.isInitialized=!1}};async function Te(e,n){var l,d,c,u,m,h,p,v,b,T;let t=a.el("dialog","afs-product-modal",{id:n}),r=((d=(l=w)==null?void 0:l.labels)==null?void 0:d.loadingProduct)||"Loading product...";t.innerHTML=`
	  <div class="afs-product-modal__container">
		<div class="afs-product-modal__close-container">
		  <button class="afs-product-modal__close" type="button">${H.close}</button>
		</div>
		<div class="afs-product-modal__content">
		  <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
			${r}
		  </div>
		</div>
	  </div>
	`;let o=`${G.Shopify&&G.Shopify.routes&&G.Shopify.routes.root||"/"}products/${e}.js`;try{let y=await fetch(o);if(!y.ok){let L=await y.text().catch(()=>""),$=`Failed to load product: HTTP ${y.status} ${y.statusText}${L?" - "+L.substring(0,100):""}`;throw g.error("Product fetch failed",{status:y.status,statusText:y.statusText,url:o,errorText:L}),new Error($)}let C=await y.json();if(!C.variants||!Array.isArray(C.variants))throw new Error("Invalid product data structure");let E=C.variants.find(L=>z(L))||C.variants[0],_=E?E.id:null,P=()=>{if(!C.variants||C.variants.length===0)return"";if(C.variants.length===1){let I=C.variants[0].title;if(I&&a.equals(I,"Default Title"))return""}if(!C.options||C.options.length===0)return"";let L='<div class="afs-product-modal__variant-selector">';return C.options.forEach(($,I)=>{var Q;L+='<div class="afs-product-modal__option-group">',L+=`<label class="afs-product-modal__option-label">${$.name}</label>`,L+='<div class="afs-product-modal__option-values">';let N=[...new Set(C.variants.map(M=>I===0?M.option1:I===1?M.option2:M.option3).filter(Boolean))],X=Array.from({length:((Q=C.options)==null?void 0:Q.length)||0},(M,D)=>D===I||!E?null:D===0?E.option1||null:D===1?E.option2||null:E.option3||null);N.forEach(M=>{if(!M)return;let D=ie(C,I,M,X),W=E&&(I===0&&E.option1===M||I===1&&E.option2===M||I===2&&E.option3===M),ne=C.variants.find(re=>I===0?re.option1===M:I===1?re.option2===M:re.option3===M);L+=`<button 
			  class="afs-product-modal__option-value ${W?"afs-product-modal__option-value--selected":""} ${D?"":"afs-product-modal__option-value--unavailable"}"
			  data-option-index="${I}"
			  data-option-value="${M}"
			  data-variant-id="${ne?ne.id:""}"
			  ${D?"":"disabled"}
			  type="button"
			>${M}</button>`}),L+="</div></div>"}),L+="</div>",L},U=(()=>{if(!C.images||C.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let L='<div class="afs-slider__thumbnails">';C.images.forEach((I,N)=>{let X=N===0?"afs-slider__thumbnail--active":"",Q=a.optimizeImageUrl(I,{width:100,height:100,crop:"center",format:"webp",quality:75}),D=[80,100,120].map(W=>`${a.optimizeImageUrl(I,{width:W,height:W,crop:"center",format:"webp",quality:75})} ${W}w`).join(", ");L+=`
			<div class="afs-slider__thumbnail ${X}" data-slide-index="${N}">
			  <img 
				src="${Q}" 
				srcset="${D}"
				sizes="100px"
				alt="${C.title} - Thumbnail ${N+1}" 
				loading="lazy"
				width="100"
				height="100"
			  />
			</div>
		  `}),L+="</div>";let $='<div class="afs-slider__main">';return C.images.forEach((I,N)=>{let X=a.optimizeImageUrl(I,{width:800,height:800,format:"webp",quality:85}),M=[400,600,800,1e3,1200].map(D=>`${a.optimizeImageUrl(I,{width:D,height:D,format:"webp",quality:D<=600?80:85})} ${D}w`).join(", ");$+=`
			<img 
			  class="afs-slider__image" 
			  src="${X}" 
			  srcset="${M}"
			  sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
			  alt="${C.title} - Image ${N+1}" 
			  loading="${N===0?"eager":"lazy"}"
			/>
		  `}),$+="</div>",{thumbnails:L,mainImages:$}})(),K=P(),Y=L=>a.formatMoney(L,s.moneyFormat||"{{amount}}",s.currency||""),O=C.variants.find(L=>L.id===_)||E,ee=Y(O.price),k=O.compare_at_price&&O.compare_at_price>O.price?`<span class="afs-product-modal__compare-price">${Y(O.compare_at_price)}</span>`:"";t.innerHTML=`
		<div class="afs-product-modal__container">
		  <div class="afs-product-modal__close-container">
			<button class="afs-product-modal__close" type="button">${H.close}</button>
		  </div>
		  <div class="afs-product-modal__content">
			<div class="afs-product-modal__layout">
			  <div class="afs-product-modal__media">
				<div class="afs-slider" id="${n}-slider">
				  ${U.mainImages}
				  ${U.thumbnails}
				</div>
			  </div>
			  <div class="afs-product-modal__details">
				<div class="afs-product-modal__header">
				  <div>
					<span class="afs-product-modal__vendor">${C.vendor||""}</span>
				  </div>
				  <h1 class="afs-product-modal__title">${C.title||""}</h1>
				  <div class="afs-product-modal__price-container">
					<span class="afs-product-modal__price">${ee}</span>
					${k}
				  </div>
				</div>
				${K}
				<div class="afs-product-modal__buttons">
				  <div class="afs-product-modal__add-to-cart">
					<div class="afs-product-modal__incrementor">
					  <button class="afs-product-modal__decrease" type="button">${H.minus}</button>
					  <span class="afs-product-modal__count" id="${n}-count">1</span>
					  <button class="afs-product-modal__increase" type="button">${H.plus}</button>
					</div>
					<button
					  class="afs-product-modal__add-button"
					  id="${n}-add-button"
					  data-variant-id="${_}"
					  ${z(O)?"":"disabled"}
					  type="button"
					>
					  ${z(O)?((h=(m=w)==null?void 0:m.buttons)==null?void 0:h.addToCart)||"Add to cart":((u=(c=w)==null?void 0:c.buttons)==null?void 0:u.soldOut)||"Sold out"}
					</button>
				  </div>
				  <button
					class="afs-product-modal__buy-button"
					id="${n}-buy-button"
					data-variant-id="${_}"
					${z(O)?"":"disabled"}
					type="button"
				  >
					${((v=(p=w)==null?void 0:p.buttons)==null?void 0:v.buyNow)||"Buy it now"}
				  </button>
				</div>
				<div class="afs-product-modal__description">
				  <span class="afs-product-modal__description-text">
					${C.description||""}
				  </span>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  `,t._productData=C,t._currentVariantId=_||void 0,(async()=>{try{let L=await te(`#${n}-slider`,t,3e3),$=await ce(Array.from({length:10},(I,N)=>`.afs-slider__image:nth-child(${N+1})`),L,2e3).catch(()=>Array.from(L.querySelectorAll(".afs-slider__image")));await te(".afs-slider__thumbnails",L,1e3).catch(()=>{g.warn("Thumbnails container not found, slider will continue without thumbnails",{modalId:n})}),$.length>0?t._slider=new ae(L,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}):g.warn("No images found for slider",{modalId:n})}catch(L){console.log("error",L),g.error("Failed to initialize slider",{error:L instanceof Error?L.message:String(L),modalId:n})}})(),Se(t,n,C,Y)}catch(y){let C=y instanceof Error?y.message:String(y),E=y instanceof Error?{message:C,stack:y.stack}:{message:C};g.error("Failed to load product for modal",{error:E,handle:e,productUrl:o,responseStatus:y instanceof Error&&"status"in y?y.status:void 0});let _=((T=(b=w)==null?void 0:b.messages)==null?void 0:T.failedToLoadProductModal)||"Failed to load product. Please try again.";t.innerHTML=`
		<div class="afs-product-modal__container">
		  <div class="afs-product-modal__close-container">
			<button class="afs-product-modal__close" type="button">${H.close}</button>
		  </div>
		  <div class="afs-product-modal__content">
			<div style="padding: 2rem; text-align: center;">
			  <p>${_}</p>
			  ${g.enabled?`<p style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">Error: ${C}</p>`:""}
			</div>
		  </div>
		</div>
	  `,Ce(t)}return t}function Se(e,n,t,r){let i=e.querySelector(".afs-product-modal__close"),o=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};i&&i.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),o()}),e.addEventListener("cancel",p=>{p.preventDefault(),o()}),e.addEventListener("click",p=>{p.target===e&&o()});let l=e.querySelector(".afs-product-modal__decrease"),d=e.querySelector(".afs-product-modal__increase"),c=e.querySelector(`#${n}-count`);l&&c&&l.addEventListener("click",()=>{let p=parseInt(c.textContent||"1",10)||1;p>1&&(c.textContent=String(p-1))}),d&&c&&d.addEventListener("click",()=>{let p=parseInt(c.textContent||"1",10)||1;c.textContent=String(p+1)}),e.querySelectorAll(".afs-product-modal__option-value").forEach(p=>{p.addEventListener("click",()=>{if(p.disabled)return;let v=Number(p.dataset.optionIndex),b=p.dataset.optionValue,T=ue(e,t.options.length);T[v]=b,e.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${v}"]`).forEach(_=>_.classList.remove("afs-product-modal__option-value--selected")),p.classList.add("afs-product-modal__option-value--selected"),e.querySelectorAll(".afs-product-modal__option-value").forEach(_=>{let P=Number(_.dataset.optionIndex),x=_.dataset.optionValue,U=ie(t,P,x,T);_.disabled=!U,_.classList.toggle("afs-product-modal__option-value--unavailable",!U)});let y=pe(t.variants,T),E=y.find(_=>z(_))||y[0];if(E)if(e._slider)oe(e,n,E,r);else{let _=(P=0)=>{e._slider?oe(e,n,E,r):P<20?setTimeout(()=>_(P+1),100):(g.warn("Slider not ready for variant update",{modalId:n}),oe(e,n,E,r))};_()}else g.warn("No matching variant found for selected options",{selected:T.filter(Boolean),matchesCount:y.length})})});let m=e.querySelector(`#${n}-add-button`);m&&c&&m.addEventListener("click",async()=>{var b,T;if(m.disabled)return;let p=parseInt(c.textContent||"1",10)||1,v=m.dataset.variantId;try{await ge.addVariant(parseInt(v||"0",10),p),o()}catch(y){g.error("Failed to add to cart from modal",{error:y instanceof Error?y.message:String(y)}),S.showError(((T=(b=w)==null?void 0:b.messages)==null?void 0:T.failedToAddToCart)||"Failed to add product to cart. Please try again.")}});let h=e.querySelector(`#${n}-buy-button`);h&&c&&h.addEventListener("click",async()=>{var b,T;if(h.disabled)return;let p=parseInt(c.textContent||"1",10)||1,v=h.dataset.variantId;try{let y=G.Shopify&&G.Shopify.routes&&G.Shopify.routes.root||"/";window.location.href=`${y}cart/${v}:${p}?checkout`}catch(y){g.error("Failed to buy now",{error:y instanceof Error?y.message:String(y)}),S.showError(((T=(b=w)==null?void 0:b.messages)==null?void 0:T.failedToProceedToCheckout)||"Failed to proceed to checkout. Please try again.")}})}function oe(e,n,t,r){var c,u,m,h;e._currentVariantId=t.id;let i=e.querySelector(".afs-product-modal__price-container");if(i){let p=r(t.price),v=t.compare_at_price&&t.compare_at_price>t.price?`<span class="afs-product-modal__compare-price">${r(t.compare_at_price)}</span>`:"";i.innerHTML=`
        <span class="afs-product-modal__price">${p}</span>
        ${v}
      `}let o=e.querySelector(`#${n}-add-button`);if(o){let p=z(t);o.dataset.variantId=String(t.id),o.disabled=!p,o.innerHTML=p?((h=(m=w)==null?void 0:m.buttons)==null?void 0:h.addToCart)||"Add to cart":((u=(c=w)==null?void 0:c.buttons)==null?void 0:u.soldOut)||"Sold out"}let l=e.querySelector(`#${n}-buy-button`);if(l){let p=z(t);l.dataset.variantId=String(t.id),l.disabled=!p}let d=e._productData;if(d&&d.images&&d.variants){if(!e._slider){g.debug("Slider not ready, skipping image update",{variantId:t.id});return}let p=t.id,v=null;if(t.featured_image&&typeof t.featured_image=="object"&&t.featured_image.variant_ids){let y=t.featured_image.position;if(y!=null){let C=y-1;C>=0&&C<d.images.length&&(e._slider.currentIndex||0)!==C&&(v=C)}}else for(let y of d.variants)if(y.featured_image&&typeof y.featured_image=="object"&&y.featured_image.variant_ids&&y.featured_image.variant_ids.includes(Number(p))){let C=y.featured_image.position;if(C!=null){let E=C-1;if(E>=0&&E<d.images.length&&(e._slider.currentIndex||0)!==E){v=E;break}}}if(v!==null&&e._slider.goToSlide){e._slider.goToSlide(v);return}if(e._slider.updateVariantImage&&d.images&&e._slider.updateVariantImage(t,d.images,d.variants))return;let b=null,T=null;if(t.featured_image&&(typeof t.featured_image=="object"?(b=t.featured_image.src||t.featured_image.url||null,T=t.featured_image.position||null):typeof t.featured_image=="string"&&(b=t.featured_image)),b||(b=(typeof t.image=="string"?t.image:null)||t.imageUrl||t.image&&typeof t.image=="object"&&(t.image.url||t.image.src)||null||t.featuredImage&&typeof t.featuredImage=="object"&&(t.featuredImage.url||t.featuredImage.src)||null),b&&d.images&&e._slider.goToSlide){let y=_=>_?(typeof _=="string"?_:_&&typeof _=="object"&&(_.url||_.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(T!=null){let _=T-1;if(_>=0&&_<d.images.length){e._slider.goToSlide(_);return}}let C=y(b),E=d.images.findIndex(_=>{let P=y(_);return P===C||P.includes(C)||C.includes(P)});if(E!==-1)e._slider.goToSlide(E);else{let _=C.split("/").pop();if(_){let P=d.images.findIndex(x=>y(x).split("/").pop()===_);P!==-1&&e._slider.goToSlide&&e._slider.goToSlide(P)}}}}}function Ce(e){let n=e.querySelector(".afs-product-modal__close"),t=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};n&&n.addEventListener("click",t),e.addEventListener("cancel",t),e.addEventListener("click",r=>{r.target===e&&t()})}function we(e){var i,o;if(!e.handle)return null;let n=((o=(i=w)==null?void 0:i.buttons)==null?void 0:o.quickView)||"Quick view",t=a.el("button","afs-product-card__quick-view",{"data-product-handle":e.handle,"data-product-id":String(e.id||e.productId||e.gid||""),"aria-label":n,type:"button"}),r=a.el("span","afs-product-card__quick-view-icon");return r.innerHTML=H.eye,t.appendChild(r),t}function _e(e){if(!e)return;let n=`product-modal-${e}`,t=document.getElementById(n);(async()=>{t||(t=await Te(e,n),document.body.appendChild(t)),t.showModal?(document.body.style.overflow="hidden",t.showModal()):(document.body.style.overflow="hidden",t.style.display="block");let i=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};t.addEventListener("close",i,{once:!0});let o=new MutationObserver(()=>{t&&!t.open&&!t.hasAttribute("open")&&(i(),o.disconnect())});t&&o.observe(t,{attributes:!0,attributeFilter:["open"]})})().catch(i=>{var d,c;let o=i instanceof Error?i.message:String(i);g.error("Failed to open product modal",{error:o,handle:e,stack:i instanceof Error?i.stack:void 0});let l=((c=(d=w)==null?void 0:d.messages)==null?void 0:c.failedToLoadProductModal)||"Failed to load product. Please try again.";S&&typeof S.showError=="function"?S.showError(l):alert(l)})}var G=window;typeof window!="undefined"?(G.AFS=fe,G.AFS_API=A):typeof global!="undefined"&&(global.AFS=fe);var de={apiBaseUrl:"http://localhost:3554/storefront",shop:"",searchInputSelector:'input[name="q"], input[name="search"], input[type="search"][name*="q"], input[type="search"][name*="search"], .search__input, form[action*="/search"] input[type="search"], form[action*="/search"] input[name*="q"]',minQueryLength:2,debounceMs:300,maxSuggestions:5,maxProducts:6,showSuggestions:!0,showProducts:!0,enableKeyboardNav:!0},f={config:de,activeInput:null,dropdown:null,container:null,currentQuery:"",isOpen:!1,selectedIndex:-1,searchResults:null,isLoading:!1,abortController:null,replacedInputs:new Set,inputContainers:new Map},F={createContainer(e){let n=a.el("div","afs-search-container");n.style.position="absolute",n.style.display="block";let t=e.getBoundingClientRect(),r=t.width,i=280,o=r<i?i:r,l=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft;return n.style.top=`${t.bottom+l}px`,n.style.left=`${t.left+d}px`,n.style.width=`${o}px`,n.style.minWidth=`${i}px`,n.style.zIndex="999999",n},createDropdown(){let e=a.el("div","afs-search-dropdown");return e.setAttribute("role","listbox"),e.setAttribute("aria-label","Search results"),e},setupInputContainer(e){if(f.inputContainers.has(e)){let i=f.inputContainers.get(e);return this.updateContainerPosition(e,i),i}let n=this.createContainer(e);document.body.appendChild(n);let t=this.createDropdown();return n.appendChild(t),f.inputContainers.set(e,n),new ResizeObserver(()=>{this.updateContainerPosition(e,n),f.isOpen&&f.activeInput===e&&this.positionDropdown(e)}).observe(e),n},updateContainerPosition(e,n){let t=e.getBoundingClientRect(),r=t.width,i=280,o=r<i?i:r,l=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft;n.style.top=`${t.bottom+l}px`,n.style.left=`${t.left+d}px`,n.style.width=`${o}px`,n.style.minWidth=`${i}px`},createSuggestionItem(e,n){let t=a.el("div","afs-search-dropdown__suggestion",{role:"option","data-index":String(n),tabindex:"-1"}),r=a.el("span","afs-search-dropdown__suggestion-icon");r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>';let i=a.el("span","afs-search-dropdown__suggestion-text");return i.textContent=e,t.appendChild(r),t.appendChild(i),t},createProductItem(e,n){var o,l;let t=a.el("a","afs-search-dropdown__product",{href:`/products/${e.handle||""}`,role:"option","data-index":String(n),tabindex:"-1"});if(e.imageUrl||e.featuredImage){let d=a.el("div","afs-search-dropdown__product-image"),c=a.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async"}),u=((o=e.featuredImage)==null?void 0:o.url)||((l=e.featuredImage)==null?void 0:l.urlFallback)||e.imageUrl||"";u&&(c.src=u),d.appendChild(c),t.appendChild(d)}let r=a.el("div","afs-search-dropdown__product-info"),i=a.el("div","afs-search-dropdown__product-title");if(i.textContent=e.title||"",r.appendChild(i),e.vendor){let d=a.el("div","afs-search-dropdown__product-vendor");d.textContent=e.vendor,r.appendChild(d)}if(e.minPrice!==void 0){let d=a.el("div","afs-search-dropdown__product-price"),c=parseFloat(String(e.minPrice||0))*100,u=parseFloat(String(e.maxPrice||0))*100,m=a.formatMoney(c,s.moneyFormat||"{{amount}}",s.currency||""),h=c===u?m:`from ${m}`;d.textContent=h,r.appendChild(d)}return t.appendChild(r),t},createDidYouMeanItem(e){let n=a.el("div","afs-search-dropdown__did-you-mean",{role:"option","data-type":"did-you-mean",tabindex:"-1"}),t=a.el("span","afs-search-dropdown__did-you-mean-text");return t.innerHTML=`Did you mean <strong>${e}</strong>?`,n.appendChild(t),n},createEmptyState(e){let n=a.el("div","afs-search-dropdown__empty",{role:"option"});return n.textContent=e,n},createLoadingState(){let e=a.el("div","afs-search-dropdown__loading",{role:"option"});return e.innerHTML=`
			<div class="afs-search-dropdown__loading-spinner"></div>
			<span>${w.labels.loading}</span>
		`,e},renderDropdown(e,n){var i;if(!f.dropdown)return;if(f.dropdown.innerHTML="",f.selectedIndex=-1,f.isLoading){f.dropdown.appendChild(this.createLoadingState());return}if(!e)return;let t=document.createDocumentFragment(),r=0;if(e.didYouMean&&e.zeroResults){let o=this.createDidYouMeanItem(e.didYouMean);o.setAttribute("data-index",String(r)),t.appendChild(o),r++}if(f.config.showSuggestions&&e.suggestions&&e.suggestions.length>0){let o=a.el("div","afs-search-dropdown__header");o.textContent="Suggestions",t.appendChild(o),e.suggestions.slice(0,f.config.maxSuggestions).forEach(l=>{let d=this.createSuggestionItem(l,r);t.appendChild(d),r++})}if(f.config.showProducts&&e.products&&e.products.length>0){let o=a.el("div","afs-search-dropdown__header");if(o.textContent=`Products (${((i=e.pagination)==null?void 0:i.total)||e.products.length})`,t.appendChild(o),e.products.slice(0,f.config.maxProducts).forEach(l=>{let d=this.createProductItem(l,r);t.appendChild(d),r++}),e.pagination&&e.pagination.total>f.config.maxProducts){let l=a.el("a","afs-search-dropdown__view-all",{href:`/search?q=${encodeURIComponent(n)}`,role:"option"});l.textContent=`View all ${e.pagination.total} results`,l.setAttribute("data-index",String(r)),t.appendChild(l),r++}}e.zeroResults&&(!e.suggestions||e.suggestions.length===0)&&(!e.products||e.products.length===0)&&t.appendChild(this.createEmptyState("No products found. Try adjusting your search terms.")),f.dropdown.appendChild(t)},positionDropdown(e){!f.dropdown||!f.container||(this.updateContainerPosition(e,f.container),f.dropdown.style.position="absolute",f.dropdown.style.top="100%",f.dropdown.style.left="0",f.dropdown.style.width="100%",f.dropdown.style.maxHeight="400px",f.dropdown.style.overflowY="auto",f.dropdown.style.zIndex="999999",f.dropdown.style.marginTop="4px")},showDropdown(){!f.dropdown||!f.activeInput||(f.container||(f.container=this.setupInputContainer(f.activeInput),f.dropdown=f.container.querySelector(".afs-search-dropdown"),f.dropdown||(f.dropdown=this.createDropdown(),f.container.appendChild(f.dropdown))),f.isOpen=!0,f.dropdown.classList.add("afs-search-dropdown--visible"),f.dropdown.setAttribute("aria-expanded","true"),this.positionDropdown(f.activeInput))},hideDropdown(){f.dropdown&&(f.isOpen=!1,f.selectedIndex=-1,f.dropdown.classList.remove("afs-search-dropdown--visible"),f.dropdown.setAttribute("aria-expanded","false"))},highlightItem(e){if(!f.dropdown)return;f.dropdown.querySelectorAll('[role="option"][data-index]').forEach((t,r)=>{r===e?(t.classList.add("afs-search-dropdown__item--selected"),t.scrollIntoView({block:"nearest",behavior:"smooth"})):t.classList.remove("afs-search-dropdown__item--selected")}),f.selectedIndex=e},getSelectedItem(){return!f.dropdown||f.selectedIndex<0?null:f.dropdown.querySelectorAll('[role="option"][data-index]')[f.selectedIndex]||null}},Ee={async search(e){let n=f.config.shop,t=f.config.apiBaseUrl;if(!n&&s.shop&&(n=s.shop),!t&&A.baseURL&&(t=A.baseURL),!n||!t)return g.error("Search API: shop or apiBaseUrl not configured",{hasShop:!!n,hasApiBaseUrl:!!t,stateShop:s.shop,apiBaseURL:A.baseURL}),null;f.abortController&&f.abortController.abort(),f.abortController=new AbortController;let r=new URLSearchParams;r.set("shop",n),r.set("q",e),r.set("suggestions","true"),r.set("autocomplete","true"),r.set("limit",String(f.config.maxProducts));let i=`${t}/search?${r}`;try{f.isLoading=!0,F.renderDropdown(null,e);let o=await fetch(i,{signal:f.abortController.signal,headers:{Accept:"application/json"}});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);let l=await o.json();return!l.success||!l.data?(g.error("Invalid search response",{data:l}),null):l.data}catch(o){return o.name==="AbortError"?(g.debug("Search request aborted"),null):(g.error("Search API error",{error:o.message,query:e}),null)}finally{f.isLoading=!1}}},V={debouncedSearch:a.debounce(async e=>{if(e.length<f.config.minQueryLength){f.searchResults=null,F.hideDropdown();return}f.activeInput&&!f.inputContainers.has(f.activeInput)&&Z.replaceInput(f.activeInput),f.currentQuery=e;let n=await Ee.search(e);f.searchResults=n,n!==null?(F.renderDropdown(n,e),F.showDropdown()):F.hideDropdown()},de.debounceMs),handleInput(e){let n=e.target,t=n.value.trim();f.activeInput=n,V.debouncedSearch(t)},handleFocus(e){let n=e.target;f.activeInput=n,f.inputContainers.has(n)?(f.container=f.inputContainers.get(n),f.dropdown=f.container.querySelector(".afs-search-dropdown")):Z.replaceInput(n),n.value.trim().length>=f.config.minQueryLength&&f.searchResults&&(F.renderDropdown(f.searchResults,n.value.trim()),F.showDropdown())},handleBlur(e){setTimeout(()=>{var n,t;!((n=f.dropdown)!=null&&n.matches(":hover"))&&!((t=f.activeInput)!=null&&t.matches(":focus"))&&F.hideDropdown()},200)},handleKeyDown(e){var r,i,o,l;if(!f.isOpen||!f.dropdown)return;let t=f.dropdown.querySelectorAll('[role="option"][data-index]').length;switch(e.key){case"ArrowDown":e.preventDefault(),f.selectedIndex=Math.min(f.selectedIndex+1,t-1),F.highlightItem(f.selectedIndex);break;case"ArrowUp":e.preventDefault(),f.selectedIndex=Math.max(f.selectedIndex-1,-1),f.selectedIndex>=0?F.highlightItem(f.selectedIndex):(r=f.activeInput)==null||r.focus();break;case"Enter":e.preventDefault();let d=F.getSelectedItem();if(d)if(d.tagName==="A")window.location.href=d.href;else if(d.getAttribute("data-type")==="did-you-mean"){let c=(i=f.searchResults)==null?void 0:i.didYouMean;c&&f.activeInput&&(f.activeInput.value=c,V.debouncedSearch(c))}else{let c=(o=d.querySelector(".afs-search-dropdown__suggestion-text"))==null?void 0:o.textContent;c&&f.activeInput&&(f.activeInput.value=c,V.debouncedSearch(c))}else if(f.activeInput){let c=f.activeInput.value.trim();c&&(window.location.href=`/search?q=${encodeURIComponent(c)}`)}break;case"Escape":e.preventDefault(),F.hideDropdown(),(l=f.activeInput)==null||l.blur();break}},handleClick(e){var r,i;let t=e.target.closest('[role="option"]');if(t&&t.tagName!=="A")if(e.preventDefault(),t.getAttribute("data-type")==="did-you-mean"){let o=(r=f.searchResults)==null?void 0:r.didYouMean;o&&f.activeInput&&(f.activeInput.value=o,V.debouncedSearch(o))}else{let o=(i=t.querySelector(".afs-search-dropdown__suggestion-text"))==null?void 0:i.textContent;o&&f.activeInput&&(f.activeInput.value=o,V.debouncedSearch(o))}}},Z={replaceInput(e){if(f.replacedInputs.has(e))return;let n=F.setupInputContainer(e);f.container=n;let t=n.querySelector(".afs-search-dropdown");t||(t=F.createDropdown(),n.appendChild(t)),f.dropdown=t,t.addEventListener("click",V.handleClick);let r=e.closest("form");r&&r.addEventListener("submit",i=>{i.preventDefault();let o=e.value.trim();o&&(window.location.href=`/search?q=${encodeURIComponent(o)}`)}),e.addEventListener("input",V.handleInput),e.addEventListener("focus",V.handleFocus),e.addEventListener("blur",V.handleBlur),e.addEventListener("keydown",V.handleKeyDown),e.setAttribute("data-afs-search","true"),f.replacedInputs.add(e)},isFilterSectionInput(e){return!!(e.classList.contains("afs-filter-group__search-input")||e.closest("[data-afs-container]")||e.closest(".afs-filter-group")||e.name&&e.name.startsWith("afs-search-"))},isShopifySearchInput(e){if(e.name==="q"||e.name==="search")return!0;let n=e.closest("form");if(n){let t=n.getAttribute("action");if(t&&(t.includes("/search")||t.includes("search"))&&(e.type==="search"||e.type==="text"||!e.type))return!0}return!!(e.classList.contains("search__input")||e.hasAttribute("data-search-input"))},findAndReplaceInputs(){document.querySelectorAll(f.config.searchInputSelector).forEach(n=>{if(!f.replacedInputs.has(n)){if(this.isFilterSectionInput(n)){g.debug("Skipping filter section input",{name:n.name,class:n.className});return}this.isShopifySearchInput(n)&&(g.debug("Processing Shopify search input",{name:n.name,type:n.type}),this.replaceInput(n))}})},init(e={}){f.config={...de,...e},!f.config.shop&&s.shop&&(f.config.shop=s.shop),!f.config.apiBaseUrl&&A.baseURL&&(f.config.apiBaseUrl=A.baseURL),this.findAndReplaceInputs(),new MutationObserver(()=>{this.findAndReplaceInputs()}).observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("click",i=>{var o;if(f.isOpen&&f.container){let l=i.target;!f.container.contains(l)&&!((o=f.activeInput)!=null&&o.contains(l))&&F.hideDropdown()}});let t,r=()=>{f.activeInput&&f.container&&(F.updateContainerPosition(f.activeInput,f.container),f.isOpen&&F.positionDropdown(f.activeInput))};window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(r,10)},!0),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(r,10)}),g.info("Search module initialized",{config:f.config})}};if(typeof window!="undefined"){let e=window;e.AFSSearch={init:Z.init.bind(Z)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Z.init()}):Z.init();
