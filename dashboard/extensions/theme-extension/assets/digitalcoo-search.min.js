"use strict";function Q(e){if(h.hideLoading(),u.error("Load failed",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,shop:i.shop,apiBaseURL:L.baseURL}),i.fallbackProducts&&i.fallbackProducts.length>0){if(u.warn("Initial load failed, using fallback products from Liquid",{error:e instanceof Error?e.message:String(e),fallbackCount:i.fallbackProducts.length}),i.usingFallback=!0,i.products=i.fallbackProducts,i.pagination=B.getPagination(),i.availableFilters=[],h.hideFilters(),h.sortSelect)if(a.isBestSelling(i.sort.field))h.sortSelect.value="best-selling";else{let n=a.equals(i.sort.order,"asc")?"ascending":"descending";h.sortSelect.value=`${i.sort.field}-${n}`}h.renderProducts(i.products),h.renderInfo(i.pagination,i.pagination.total),h.renderPagination(i.pagination),h.renderApplied(i.filters)}else h.showError(`${C.messages.failedToLoad}: ${e instanceof Error?e.message:C.messages.unknownError}. ${C.messages.checkConsole}`)}var k={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24},N=new Map,D={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'},ne=new Set(["shop","shop_domain","cpid"]),C={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",soldOut:"Sold out",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}},a={debounce:(e,n)=>{let t;return(...r)=>{t!==void 0&&clearTimeout(t),t=setTimeout(()=>e(...r),n)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.selectionType),"multiple")||a.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(n=>String(n).trim()).filter(Boolean):String(e).split(",").map(n=>n.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let n=e.productId||e.id||e.gid;return n&&String(n).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,n,t={})=>{let r=document.createElement(e);return n&&(r.className=n),Object.entries(t).forEach(([o,s])=>r.setAttribute(o,s)),r},txt:(e,n)=>(e.textContent=n,e),clear:e=>{for(;e.firstChild;){let n=e.firstChild;n&&e.removeChild(n)}},frag:(e,n)=>{let t=document.createDocumentFragment();return e.forEach(r=>t.appendChild(n(r))),t},optimizeImageUrl:(e,n={})=>{if(!e||typeof e!="string")return"";let{width:t=500,height:r=t,quality:o=80,format:s="webp",crop:l=null}=n;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let p=new URL(e),f=new URLSearchParams(p.search);return f.delete("width"),f.delete("height"),f.delete("crop"),f.delete("format"),f.delete("quality"),f.set("width",String(t)),f.set("height",String(r)),l&&f.set("crop",l),o!==100&&f.set("quality",String(o)),!p.pathname.toLowerCase().endsWith(".gif")&&s&&f.set("format",s),`${p.origin}${p.pathname}?${f.toString()}`}catch(p){return e}},buildImageSrcset:(e,n=[200,300,500])=>e?n.map(t=>`${a.optimizeImageUrl(e,{width:t,format:"webp",quality:t<=200?75:t<=300?80:85})} ${t}w`).join(", "):"",formatMoney:(e,n,t="")=>{if(isNaN(Number(e)))return"";let r=parseFloat(String(e))/100;if(!n||typeof n!="string")return`${t||""}${r.toFixed(2)}`;let o=r.toFixed(2);return n.includes("{{amount_no_decimals}}")?(o=Math.round(r).toString(),n.replace("{{amount_no_decimals}}",o)):n.includes("{{amount_with_comma_separator}}")?(o=r.toFixed(2).replace(".",","),n.replace("{{amount_with_comma_separator}}",o)):n.includes("{{amount_no_decimals_with_comma_separator}}")?(o=Math.round(r).toString(),n.replace("{{amount_no_decimals_with_comma_separator}}",o)):n.includes("{{amount_with_apostrophe_separator}}")?(o=r.toFixed(2).replace(".","'"),n.replace("{{amount_with_apostrophe_separator}}",o)):n.replace("{{amount}}",o)},equals:(e,n)=>e===n?!0:e==null||n===null||n===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(n)&&(n=n.join(",")),typeof e=="string"&&typeof n=="string"?e.trim().toLowerCase()===n.trim().toLowerCase():typeof e=="number"&&typeof n=="number"||typeof e=="boolean"&&typeof n=="boolean"?e===n:String(e).trim().toLowerCase()===String(n).trim().toLowerCase()),equalsAny:(e,...n)=>e==null?!1:n.some(t=>a.equals(e,t)),isVendorKey:e=>a.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>a.equalsAny(e,"productType","productTypes"),isTagKey:e=>a.equalsAny(e,"tag","tags"),isCollectionKey:e=>a.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>a.equalsAny(e,"priceRange","price"),isBestSelling:e=>a.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>a.equals(e,"Collection"),isPriceRangeOptionType:e=>a.equals(e,"priceRange")},re={buildFilterMetadata:e=>{let n=new Map;return Array.isArray(e)&&e.forEach(t=>{t.handle&&n.set(t.handle,{label:t.label||t.queryKey||t.optionKey||t.handle,queryKey:t.queryKey,optionKey:t.optionKey,optionType:t.optionType})}),n}},i={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:k.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},u={enabled:!0,error:(e,n)=>{u.enabled&&console.error("[AFS]",e,n||"")},warn:(e,n)=>{u.enabled&&console.warn("[AFS]",e,n||"")},info:(e,n)=>{u.enabled&&console.info("[AFS]",e,n||"")},debug:(e,n)=>{u.enabled&&console.debug("[AFS]",e,n||"")},log:(e,...n)=>{u.enabled&&console.log(e,...n)},init:e=>{u.enabled=e!==!1,u.log("%cAdvanced Filter & Search initialized","color: #00c853;font-size: 20px;font-weight: bold;background: #0b1e13;padding: 10px 15px;border-radius: 6px;font-family: Arial, sans-serif;")}},F={parse(){let e=new URL(window.location.href),n={},t,r;return e.searchParams.forEach((o,s)=>{if(!ne.has(s))if(a.isVendorKey(s))n.vendor=a.split(o);else if(a.isProductTypeKey(s))n.productType=a.split(o);else if(a.isTagKey(s))n.tags=a.split(o);else if(a.isCollectionKey(s))n.collections=a.split(o);else if(a.equals(s,"search"))n.search=o;else if(a.equals(s,"priceMin")){let l=Math.round(parseFloat(o));!isNaN(l)&&l>=0&&(t=l)}else if(a.equals(s,"priceMax")){let l=Math.round(parseFloat(o));!isNaN(l)&&l>=0&&(r=l)}else if(a.isPriceRangeKey(s)){let l=o.split("-");if(l.length===2){let d=Math.round(parseFloat(l[0])),p=Math.round(parseFloat(l[1]));!isNaN(d)&&d>=0&&(t=d),!isNaN(p)&&p>=0&&(r=p)}}else if(a.equals(s,"page"))n.page=parseInt(o,10)||1;else if(a.equals(s,"limit"))n.limit=parseInt(o,10)||k.PAGE_SIZE;else if(a.equals(s,"sort")){let l=o.toLowerCase().trim();if(a.isBestSelling(l))n.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[d,p]=l.split("-"),f=a.equalsAny(p,"ascending")?"asc":a.equalsAny(p,"descending")?"desc":"desc";n.sort={field:d,order:f}}else{let[d,p]=o.split(":");n.sort={field:d,order:a.equalsAny(p,"asc")?"asc":"desc"}}}else n[s]=a.split(o),u.debug("Handle filter parsed directly",{handle:s,value:o})}),(t!==void 0||r!==void 0)&&(n.priceRange={min:t,max:r}),n},update(e,n,t){let r=new URL(window.location.href);if(r.search="",u.debug("Updating URL",{filters:e,pagination:n}),e&&!a.empty(e)&&Object.keys(e).forEach(s=>{let l=e[s];if(!a.empty(l))if(Array.isArray(l)&&l.length>0)r.searchParams.set(s,l.join(",")),u.debug("URL param set",{key:s,value:l.join(",")});else if(a.isPriceRangeKey(s)&&l&&typeof l=="object"&&!Array.isArray(l)){let d=l,p=typeof d.min=="number"&&!isNaN(d.min)?Math.round(d.min):void 0,f=typeof d.max=="number"&&!isNaN(d.max)?Math.round(d.max):void 0;if(i.priceRangeHandle){let g=`${p!==void 0?p:""}-${f!==void 0?f:""}`;r.searchParams.set(i.priceRangeHandle,g),u.debug("Price range URL handle param set",{handle:i.priceRangeHandle,value:g})}else p!==void 0&&r.searchParams.set("priceMin",String(p)),f!==void 0&&r.searchParams.set("priceMax",String(f)),u.debug("Price range URL params set",{priceMin:p,priceMax:f})}else a.equals(s,"search")&&typeof l=="string"&&l.trim()&&(r.searchParams.set(s,l.trim()),u.debug("Search URL param set",{key:s,value:l.trim()}))}),n&&n.page>1&&(r.searchParams.set("page",String(n.page)),u.debug("Page URL param set",{page:n.page})),t&&t.field){if(t.field==="best-selling"||t.field==="bestselling")r.searchParams.set("sort","best-selling");else{let s=a.equals(t.order,"asc")?"ascending":"descending";r.searchParams.set("sort",`${t.field}-${s}`)}u.debug("Sort URL param set",{field:t.field,order:t.order})}let o=r.toString();u.info("URL updated",{newUrl:o,oldUrl:window.location.href}),history.pushState({filters:e,pagination:n,sort:t},"",r)}},L={baseURL:"https://fstaging.digitalcoo.com/storefront",__v:"v2.0.1",__id:"01-09-2026",cache:new Map,timestamps:new Map,pending:new Map,key(e,n,t){return`${n.page}-${n.limit}-${t.field}-${t.order}-${JSON.stringify(e)}`},get(e){let n=this.timestamps.get(e);return!n||Date.now()-n>k.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,n){this.cache.set(e,n),this.timestamps.set(e,Date.now())},async fetch(e,n=k.TIMEOUT){let t=new AbortController,r=setTimeout(()=>t.abort(),n);try{u.debug("Fetching",{url:e});let o=await fetch(e,{signal:t.signal});if(clearTimeout(r),!o.ok){let l=await o.text().catch(()=>"");throw new Error(`HTTP ${o.status}: ${o.statusText}${l?" - "+l:""}`)}let s=await o.json();return u.debug("Fetch success",{url:e,hasData:!!s}),s}catch(o){throw clearTimeout(r),o instanceof Error&&o.name==="AbortError"?new Error("Request timeout"):(u.error("Fetch failed",{url:e,error:o instanceof Error?o.message:String(o)}),o)}},shouldSendCpid(){var e;return!!((e=i.selectedCollection)!=null&&e.id)},async products(e,n,t){var p;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!i.shop)throw new Error("Shop not set");let r=this.key(e,n,t),o=this.get(r);if(o)return u.debug("Cache hit",{key:r}),o;if(this.pending.has(r))return u.debug("Request deduplication",{key:r}),this.pending.get(r);let s=new URLSearchParams;if(s.set("shop",i.shop),this.shouldSendCpid()?(s.set("cpid",i.selectedCollection.id),u.debug("cpid sent to products API",{cpid:i.selectedCollection.id,filters:e})):u.debug("cpid not sent to products API",{hasCpid:!!((p=i.selectedCollection)!=null&&p.id),filters:e,reason:"filters present or cpid already in collection filter"}),Object.keys(e).forEach(f=>{let g=e[f];if(!a.empty(g))if(a.isPriceRangeKey(f)&&g&&typeof g=="object"&&!Array.isArray(g)){let T=g,m=typeof T.min=="number"&&!isNaN(T.min)?Math.round(T.min):void 0,b=typeof T.max=="number"&&!isNaN(T.max)?Math.round(T.max):void 0;i.priceRangeHandle?s.set(i.priceRangeHandle,`${m!==void 0?m:""}-${b!==void 0?b:""}`):(m!==void 0&&s.set("priceMin",String(m)),b!==void 0&&s.set("priceMax",String(b)))}else f==="search"&&typeof g=="string"&&g.trim()?s.set(f,g.trim()):Array.isArray(g)&&g.length>0?(s.set(f,g.join(",")),u.debug("Filter sent as direct handle param",{handle:f,value:g.join(",")})):typeof g=="string"&&(s.set(f,g),u.debug("Filter sent as direct handle param",{handle:f,value:g}))}),s.set("page",String(n.page)),s.set("limit",String(n.limit)),t.field)if(a.isBestSelling(t.field))s.set("sort","best-selling");else{let f=a.equals(t.order,"asc")?"ascending":"descending";s.set("sort",`${t.field}-${f}`)}let l=`${this.baseURL}/products?${s}`;u.info("Fetching products",{url:l,shop:i.shop,page:n.page}),h.showLoading("products");let d=this.fetch(l).then(f=>{var T,m;if(!f.success||!f.data)throw u.error("Invalid products response",{response:f}),new Error(`Invalid products response: ${f.message||C.messages.unknownError}`);let g=f.data;return u.info("Products response",{productsCount:((T=g.products)==null?void 0:T.length)||0,total:((m=g.pagination)==null?void 0:m.total)||0,hasFilters:!!g.filters}),this.set(r,g),this.pending.delete(r),g}).catch(f=>{throw this.pending.delete(r),u.error("Products fetch failed",{error:f instanceof Error?f.message:String(f),url:l}),f});return h.showLoading("products"),this.pending.set(r,d),d},async filters(e){var d;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!i.shop)throw new Error("Shop not set");let n=new URLSearchParams;n.set("shop",i.shop),this.shouldSendCpid()?(n.set("cpid",i.selectedCollection.id),u.debug("cpid sent to filters API",{cpid:i.selectedCollection.id,filters:e})):u.debug("cpid not sent to filters API",{hasCpid:!!((d=i.selectedCollection)!=null&&d.id),filters:e,reason:"filters present or cpid already in collection filter"});let t={...e};Object.keys(t).forEach(p=>{let f=t[p];if(!a.empty(f)){if(Array.isArray(f))n.set(p,f.join(","));else if(p==="search"&&typeof f=="string"&&f.trim())n.set("search",f.trim());else if(p==="priceRange"&&f&&typeof f=="object"&&!Array.isArray(f)){let g=f,T=typeof g.min=="number"&&!isNaN(g.min)?g.min:void 0,m=typeof g.max=="number"&&!isNaN(g.max)?g.max:void 0;i.priceRangeHandle?n.set(i.priceRangeHandle,`${T!==void 0?T:""}-${m!==void 0?m:""}`):(T!==void 0&&n.set("priceMin",String(T)),m!==void 0&&n.set("priceMax",String(m)))}}});let r={};n.forEach((p,f)=>{r[f]=p}),u.debug("All params for filters endpoint",{params:r});let o=`${this.baseURL}/filters?${n}`;u.info("Fetching filters",{url:o,shop:i.shop}),h.showLoading("filters");let s=await this.fetch(o);if(!s.success||!s.data)throw u.error("Invalid filters response",{response:s}),new Error(`Invalid filters response: ${s.message||C.messages.unknownError}`);let l=s.data;if(!l||typeof l!="object")throw new Error("Invalid filters response: data is not an object");return l.filters!==void 0&&!Array.isArray(l.filters)&&(u.warn("Filters response contains non-array filters",{filters:l.filters}),l.filters=[]),u.info("Filters response:",{filters:l.filters}),l},setBaseURL(e){this.baseURL=e},buildFiltersFromUrl(e){i.filters={vendor:e.vendor||[],productType:e.productType||[],tags:e.tags||[],collections:e.collections||[],search:e.search||"",priceRange:e.priceRange||null},Object.keys(e).forEach(n=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","cpid"].includes(n)){let t=e[n];Array.isArray(t)?i.filters[n]=t:typeof t=="string"&&(i.filters[n]=[t])}}),G(i.filters)},setPaginationFromUrl(e){e.page?i.pagination.page=e.page:i.fallbackPagination&&i.fallbackPagination.currentPage&&(i.pagination.page=i.fallbackPagination.currentPage)},setSortFromUrl(e){if(e.sort){let n=typeof e.sort=="object"?e.sort.field:e.sort;if(typeof n=="string"){let t=n.toLowerCase().trim();if(t==="best-selling"||t==="bestselling")i.sort={field:"best-selling",order:"asc"};else if(t.includes("-")){let[r,o]=t.split("-"),s=a.equalsAny(o,"ascending")?"asc":a.equalsAny(o,"descending")?"desc":"desc";i.sort={field:r,order:s}}else{let[r,o]=n.split(":");i.sort={field:r,order:o||"desc"}}}else typeof e.sort=="object"&&e.sort.field&&(i.sort={field:e.sort.field,order:e.sort.order||"desc"})}else i.sort={field:"best-selling",order:"asc"}}},h={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(e,n,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Container selector cannot be empty. Provide a valid selector or ensure [data-afs-container] exists in the DOM.");if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error(`Container not found. Selector: "${e}". Please ensure the container element exists in the DOM.`);this.container.setAttribute("data-afs-container","true");let r=this.container.querySelector(".afs-main-content")||a.el("div","afs-main-content");r.parentNode||this.container.appendChild(r),this.filtersContainer=n&&n.trim()!==""&&document.querySelector(n)||null,this.filtersContainer||(this.filtersContainer=a.el("div","afs-filters-container")),!this.filtersContainer.parentNode&&r&&r.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=a.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":C.buttons.closeFilters}),this.mobileFilterClose.innerHTML=C.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=a.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",r.parentNode?r.parentNode.insertBefore(this.mobileFilterBackdrop,r):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=t&&t.trim()!==""&&document.querySelector(t)||null,this.productsContainer||(this.productsContainer=a.el("div","afs-products-container")),!this.productsContainer.parentNode&&r&&r.appendChild(this.productsContainer),this.productsInfo=a.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=a.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":C.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${C.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=a.el("div","afs-sort-container");let o=a.el("label","afs-sort-label",{for:"afs-sort-label"});o.textContent=C.labels.sortBy,this.sortSelect=a.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${C.sortOptions.bestSelling}</option>
        <option value="title-ascending">${C.sortOptions.titleAsc}</option>
        <option value="title-descending">${C.sortOptions.titleDesc}</option>
        <option value="price-ascending">${C.sortOptions.priceAsc}</option>
        <option value="price-descending">${C.sortOptions.priceDesc}</option>
        <option value="created-ascending">${C.sortOptions.createdAsc}</option>
        <option value="created-descending">${C.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(o),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=a.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},attachEvents(){if(!h.container)return;h.container.addEventListener("click",t=>{var p,f,g,T,m,b,w;let r=t.target,o=(p=r.closest("[data-afs-action]"))==null?void 0:p.dataset.afsAction,s=r.closest(".afs-filter-item"),l=r instanceof HTMLInputElement&&(r.type==="checkbox"||r.type==="radio")?r:s==null?void 0:s.querySelector(".afs-filter-item__checkbox"),d=r.closest(".afs-pagination__button");if(o==="clear-all")i.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(f=i.selectedCollection)!=null&&f.id&&u.debug("Clear All: keeping server-managed cpid (not exposed to UI)"),i.pagination.page=1,F.update(i.filters,i.pagination,i.sort),h.scrollToProducts(),h.showLoading(),M.apply();else if(o==="toggle-filters"||o==="close-filters")h.toggleMobileFilters();else if(r.closest(".afs-applied-filter-chip__remove")){let y=r.closest(".afs-applied-filter-chip"),S=y==null?void 0:y.querySelector(".afs-applied-filter-chip__remove"),v=S==null?void 0:S.getAttribute("data-afs-filter-key"),E=S==null?void 0:S.getAttribute("data-afs-filter-value");if(!v)return;if(a.equals(v,"cpid")){(g=i.selectedCollection)!=null&&g.id&&(i.selectedCollection.id=null,u.debug("cpid removed, cleared selectedCollection")),F.update(i.filters,i.pagination,i.sort),h.scrollToProducts(),h.showLoading(),M.apply();return}if(a.equals(v,"search")){i.filters.search="",i.pagination.page=1,F.update(i.filters,i.pagination,i.sort),h.scrollToProducts(),h.showLoading(),M.apply();return}if(a.isPriceRangeKey(v)){i.filters.priceRange=null,i.pagination.page=1,F.update(i.filters,i.pagination,i.sort),h.scrollToProducts(),h.showLoading(),M.apply();return}E&&M.toggle(v,E)}else if(l&&s){t.preventDefault(),t.stopPropagation();let y=s.getAttribute("data-afs-filter-handle")||((T=s.parentElement)==null?void 0:T.getAttribute("data-afs-filter-handle")),S=s.getAttribute("data-afs-filter-value"),v=s.getAttribute("data-afs-filter-multiselect")||((m=s.parentElement)==null?void 0:m.getAttribute("data-afs-filter-multiselect"));if(!y||!S){u.warn("Invalid filter item clicked",{handle:y,value:S});return}u.debug("Filter toggle",{handle:y,value:S,currentChecked:l.checked}),(v==="0"||v==="false")&&(i.filters[y]=[]),M.toggle(y,S)}else if(d&&!d.disabled){let y=parseInt(d.getAttribute("data-afs-page")||"0",10);if(y&&y>0){if(i.usingFallback){let v=F.parse().page||i.pagination.page||1;i.pagination.page=y}else i.pagination.page=y;F.update(i.filters,i.pagination,i.sort),h.scrollToProducts(),h.showLoading(),M.applyProductsOnly()}}else if(r.closest(".afs-filter-group__clear")){t.preventDefault(),t.stopPropagation();let y=r.closest(".afs-filter-group__clear");if(!y)return;let S=y.getAttribute("data-afs-filter-handle");if(!S)return;let v=i.filterMetadata.get(S),E=a.isCollectionOptionType(v==null?void 0:v.optionType)||a.isCollectionKey(S);if(i.filters[S]){if(E&&((b=i.selectedCollection)!=null&&b.id)){let P=i.filters[S],I=i.selectedCollection.id;Array.isArray(P)&&P.some(_=>String(_)===String(I))&&(i.selectedCollection.id=null,u.debug("Collection filter cleared (contained cpid), cleared cpid",{handle:S,cpid:I}))}delete i.filters[S],u.debug("Filter cleared",{handle:S,isCollectionFilter:E}),F.update(i.filters,i.pagination,i.sort),h.scrollToProducts(),h.showLoading(),M.apply()}}else if(r.closest(".afs-filter-group__toggle")){t.preventDefault(),t.stopPropagation();let y=r.closest(".afs-filter-group");if(!y)return;let v=!(y.getAttribute("data-afs-collapsed")==="true");y.setAttribute("data-afs-collapsed",v?"true":"false");let E=y.getAttribute("data-afs-filter-key");if(E)try{let x=N.get(E)||{};x.collapsed=v,x.lastUpdated=Date.now(),N.set(E,x);try{let _=`afs_filter_state_${y.getAttribute("data-afs-filter-handle")}`;sessionStorage.setItem(_,JSON.stringify({collapsed:v}))}catch(_){u.debug("Could not persist to sessionStorage",{error:_ instanceof Error?_.message:String(_)})}}catch(x){u.error("Failed to persist filter state",{stateKey:E,error:x instanceof Error?x.message:String(x)})}let P=y.querySelector(".afs-filter-group__toggle");P&&P.setAttribute("aria-expanded",v?"false":"true");let I=y.querySelector(".afs-filter-group__icon");I&&(I.innerHTML=v?D.rightArrow||"":D.downArrow||""),u.debug("Filter group toggled",{collapsed:v,stateKey:E})}else if(r.closest(".afs-product-card__quick-add")){t.preventDefault(),t.stopPropagation();let y=r.closest(".afs-product-card__quick-add");if(!y||y.disabled)return;let S=y.getAttribute("data-product-handle"),v=y.getAttribute("data-product-id");S&&ie.add(S,v)}else if(r.closest(".afs-product-card__quick-view")){t.preventDefault(),t.stopPropagation();let y=r.closest(".afs-product-card__quick-view");if(!y)return;let S=y.getAttribute("data-product-handle");if(S){let v=window;(w=v.AFSQuickView)!=null&&w.handleQuickViewClick?v.AFSQuickView.handleQuickViewClick(S):u.error("AFSQuickView module not loaded")}}}),h.container.addEventListener("input",t=>{var o;let r=t.target;if(r.classList.contains("afs-filter-group__search-input")){let l=r.value.toLowerCase(),d=(o=r.closest(".afs-filter-group"))==null?void 0:o.querySelector(".afs-filter-group__items");d!=null&&d._items&&d.querySelectorAll(".afs-filter-item").forEach((p,f)=>{var T;let g=(T=d._items)==null?void 0:T[f];if(g){let m=a.str(typeof g=="string"?g:g.label||g.value||"").toLowerCase();p.style.display=!l||m.includes(l)?"":"none"}})}});let e=t=>{let r=t.value;if(!r)return;u.info("Sort dropdown changed",{sortValue:r,currentSort:i.sort});let o;if(r==="best-selling"||r==="bestselling")o={field:"best-selling",order:"asc"};else if(r.includes("-")){let[s,l]=r.split("-");o={field:s,order:l==="ascending"?"asc":"desc"}}else{let[s,l]=r.split(":");o={field:s,order:l||"desc"}}i.sort=o,i.pagination.page=1,F.update(i.filters,i.pagination,i.sort),u.info("Calling applyProductsOnly after sort change",{sort:i.sort}),h.scrollToProducts(),h.showLoading(),M.applyProductsOnly()},n=null;h.container.addEventListener("focus",t=>{let r=t.target;r.classList.contains("afs-sort-select")&&(n=r.value)},!0),h.container.addEventListener("change",t=>{let r=t.target;if(r.classList.contains("afs-sort-select")){let o=r;e(o),n=o.value}}),h.container.addEventListener("blur",t=>{let r=t.target;if(r.classList.contains("afs-sort-select")){let o=r,s=o.value;s&&s!==n&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{let l;if(a.isBestSelling(i.sort.field))l="best-selling";else{let d=a.equals(i.sort.order,"asc")?"ascending":"descending";l=`${i.sort.field}-${d}`}s!==l&&e(o)})}),n=s}},!0),window.addEventListener("popstate",()=>{let t=F.parse(),r=JSON.stringify(i.filters),o=i.pagination.page,s=JSON.stringify(i.sort);i.filters={vendor:t.vendor||[],productType:t.productType||[],tags:t.tags||[],collections:t.collections||[],search:t.search||"",priceRange:t.priceRange||null},Object.keys(t).forEach(m=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort"].includes(m)){let b=t[m];Array.isArray(b)?i.filters[m]=b:typeof b=="string"&&(i.filters[m]=[b])}});let l=i.priceRangeHandle?i.filters[i.priceRangeHandle]:null;if(i.priceRangeHandle&&Array.isArray(l)&&l.length>0){let b=String(l[0]||"").split("-");if(b.length===2){let w=b[0].trim()?parseInt(b[0],10):void 0,y=b[1].trim()?parseInt(b[1],10):void 0,S=typeof w=="number"&&!isNaN(w)&&w>=0,v=typeof y=="number"&&!isNaN(y)&&y>=0;(S||v)&&(i.filters.priceRange={min:S?w:void 0,max:v?y:void 0},delete i.filters[i.priceRangeHandle])}}let d=t.page||i.pagination.page;if(d!==o&&(i.pagination.page=d),t.sort){let m=typeof t.sort=="object"?t.sort.field:t.sort;if(typeof m=="string"){let b=m.toLowerCase().trim();if(b==="best-selling"||b==="bestselling")i.sort={field:"best-selling",order:"asc"};else if(b.includes("-")){let[w,y]=b.split("-"),S=a.equalsAny(y,"ascending")?"asc":a.equalsAny(y,"descending")?"desc":"desc";i.sort={field:w,order:S}}else{let[w,y]=m.split(":");i.sort={field:w,order:y||"desc"}}}else typeof t.sort=="object"&&t.sort.field&&(i.sort={field:t.sort.field,order:t.sort.order||"desc"})}else i.sort={field:"best-selling",order:"asc"};let p=JSON.stringify(i.filters),f=JSON.stringify(i.sort);!(r!==p)&&(f!==s||d!==o)?M.applyProductsOnly():M.apply()})},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",u.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),u.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let n=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),n&&window.scrollTo(0,parseInt(n||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let n=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${n}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}u.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton(),N.clear(),this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(r=>{let o=r.getAttribute("data-afs-filter-key");if(o){let s=r.querySelector(".afs-filter-group__search-input"),l=r.getAttribute("data-afs-collapsed")==="true",d=(s==null?void 0:s.value)||"",p=N.get(o);N.set(o,{...p,collapsed:l,search:d,lastUpdated:Date.now()})}}),a.clear(this.filtersContainer);let n=e.filter(r=>r?a.isPriceRangeOptionType(r.optionType)?r.range&&typeof r.range.min=="number"&&typeof r.range.max=="number"&&r.range.max>r.range.min:r.values&&r.values.length>0:!1);if(u.debug("Rendering filters",{total:e.length,valid:n.length,filtersWithSearchable:n.filter(r=>r.searchable).length,filtersWithCollapsed:n.filter(r=>r.collapsed).length}),n.length===0){u.warn("No valid filters to render");return}let t=document.createDocumentFragment();n.forEach(r=>{var E;if(a.isPriceRangeOptionType(r.optionType)){let P=this.createPriceRangeGroup(r,N);P&&t.appendChild(P);return}let o;if(r.optionType||r.optionKey){if(o=r.handle,!o){u.error("Option filter missing handle",{filter:r});return}}else if(o=r.queryKey||r.key,!o){u.warn("Standard filter missing queryKey/key",{filter:r});return}u.debug("Filter group handle determined",{handle:o,filterHandle:r.handle,queryKey:r.queryKey,key:r.key,label:r.label,type:r.optionType,optionType:r.optionType,optionKey:r.optionKey,isOptionFilter:!!(r.optionType||r.optionKey)});let s=a.el("div","afs-filter-group",{"data-afs-filter-type":r.optionType||""});s.setAttribute("data-afs-filter-handle",o);let l=o;s.setAttribute("data-afs-filter-key",l);let d=N.get(l),p=(d==null?void 0:d.collapsed)!==void 0?d.collapsed:r.collapsed===!0||r.collapsed==="true"||r.collapsed===1;s.setAttribute("data-afs-collapsed",p?"true":"false"),u.debug("Filter group created",{handle:o,label:r.label,collapsed:p,searchable:r.searchable,showCount:r.showCount,valuesCount:((E=r.values)==null?void 0:E.length)||0});let f=a.el("div","afs-filter-group__header"),g=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":p?"false":"true",title:r.tooltipContent||`Toggle ${r.label||o} filter`}),T=a.el("span","afs-filter-group__icon");T.innerHTML=p?D.rightArrow||"":D.downArrow||"",g.appendChild(T),g.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),r.label||r.optionType||"")),f.appendChild(g);let m=i.filters[o];if(m&&(Array.isArray(m)?m.length>0:typeof m=="object"&&!Array.isArray(m)?Object.keys(m).length>0:!!m)){let P=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${C.buttons.clear} ${r.label||o} filters`,"data-afs-filter-handle":o});P.textContent=C.buttons.clear,P.title=`${C.buttons.clear} ${r.label||o} filters`,f.appendChild(P)}s.appendChild(f);let w=a.el("div","afs-filter-group__content");if(r.searchable===!0||typeof r.searchable=="string"&&r.searchable.toLowerCase()==="true"){let P=a.el("div","afs-filter-group__search"),I=a.el("input","afs-filter-group__search-input",{type:"text",placeholder:r.searchPlaceholder||"Search...","aria-label":`${C.labels.search}${r.label||o}`,name:`afs-search-${o}`});d!=null&&d.search&&(I.value=d.search),P.appendChild(I),w.appendChild(P),u.debug("Search input added",{handle:o,label:r.label,searchable:r.searchable})}let S=a.el("div","afs-filter-group__items",{"data-afs-filter-handle":o,"data-afs-filter-multiselect":a.isMultiSelect(r)?"1":"0","data-afs-filter-display-type":a.toLowerCase(r.displayType||"CHECKBOX")});S._items=r.values;let v=document.createDocumentFragment();r.values&&r.values.forEach((P,I)=>{let x=this.createFilterItem(o,P,r,I);x&&v.appendChild(x)}),S.appendChild(v),w.appendChild(S),s.appendChild(w),t.appendChild(s)}),t.children.length>0?(this.filtersContainer.appendChild(t),this.showFilters(),u.debug("Filters rendered",{count:t.children.length})):(u.warn("No filter groups created"),this.hideFilters())},createFilterItem(e,n,t,r){var b;let o=a.str(typeof n=="string"?n:n.value||n.key||n.name||"");if(!o||o==="[object Object]")return null;let s=typeof n=="string"?n:n.label||n.value||o;if((a.isCollectionOptionType(t==null?void 0:t.optionType)||a.isCollectionKey(e))&&i.collections&&Array.isArray(i.collections)){if((b=i.selectedCollection)!=null&&b.id&&String(o)===String(i.selectedCollection.id))return null;let w=i.collections.find(y=>{let S=String(y.id||y.gid||y.collectionId||"");return S&&String(S)===String(o)});if(w)s=w.title||w.label||w.name||s;else return null}let p=(i.filters[e]||[]).includes(o),f=a.inputDisplayType(t),g=(f==="radio"?e:e+"-"+o.replace(/\s+/g,"-").toLowerCase())+"_"+(r+1),T=a.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":o,for:g});p&&T.classList.add("afs-filter-item--active");let m=a.el("input","afs-filter-item__checkbox",{type:f});return m.checked=p,m.setAttribute("data-afs-filter-value",o),m.setAttribute("name",g),m.setAttribute("id",g),T.appendChild(m),T.appendChild(a.txt(a.el("span","afs-filter-item__label"),s)),t!=null&&t.showCount&&typeof n=="object"&&n.count&&T.appendChild(a.txt(a.el("span","afs-filter-item__count"),`(${n.count})`)),T},createPriceRangeGroup(e,n=null){var W;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return u.warn("Invalid price range filter",{filter:e}),null;let t=Math.round(e.range.min),r=Math.round(e.range.max),o=i.filters.priceRange||{min:t,max:r},s=Math.round(Math.max(t,Math.min(r,o.min||t))),l=Math.round(Math.max(t,Math.min(r,o.max||r))),d=a.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),p=n==null?void 0:n.get(e.key||"priceRange"),f=(W=p==null?void 0:p.collapsed)!=null?W:e.collapsed===!0;d.setAttribute("data-afs-collapsed",f?"true":"false");let g=a.el("div","afs-filter-group__header"),T=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":f?"false":"true"}),m=a.el("span","afs-filter-group__icon");if(m.innerHTML=f?D.rightArrow||"":D.downArrow||"",T.appendChild(m),T.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),g.appendChild(T),i.filters.priceRange&&(i.filters.priceRange.min!==t||i.filters.priceRange.max!==r)){let R=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${C.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});R.textContent=C.buttons.clear,R.title=`${C.buttons.clear} ${e.label} filter`,g.appendChild(R)}d.appendChild(g);let w=a.el("div","afs-filter-group__content"),y=a.el("div","afs-price-range-container"),S=a.el("div","afs-price-range-track"),v=a.el("div","afs-price-range-active");S.appendChild(v);let E=a.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(t),max:String(r),value:String(s),step:"1"});E.setAttribute("data-afs-range-type","min");let P=a.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(t),max:String(r),value:String(l),step:"1"});P.setAttribute("data-afs-range-type","max"),S.appendChild(E),S.appendChild(P),y.appendChild(S);let I=a.el("div","afs-price-range-values"),x=a.el("span","afs-price-range-value afs-price-range-value--min"),_=a.el("span","afs-price-range-value afs-price-range-value--max"),U=R=>`$${parseFloat(String(R)).toFixed(0)}`;x.textContent=U(s),_.textContent=U(l),I.appendChild(x),I.appendChild(a.txt(a.el("span","afs-price-range-separator")," - ")),I.appendChild(_),y.appendChild(I);let j=()=>{let R=Math.round(parseFloat(E.value)),O=Math.round(parseFloat(P.value)),K=r-t,J=(R-t)/K*100,X=(r-O)/K*100;v.style.left=`${J}%`,v.style.right=`${X}%`,x.textContent=U(R),_.textContent=U(O)},z=()=>{let R=Math.round(parseFloat(E.value)),O=Math.round(parseFloat(P.value));R>O&&(E.value=String(O),P.value=String(R)),j()};return E.addEventListener("input",()=>{z(),M.updatePriceRange(Math.round(parseFloat(E.value)),Math.round(parseFloat(P.value)))}),P.addEventListener("input",()=>{z(),M.updatePriceRange(Math.round(parseFloat(E.value)),Math.round(parseFloat(P.value)))}),j(),w.appendChild(y),d.appendChild(w),d},renderProducts(e){if(!this.productsGrid)return;let n=this.productsGrid.querySelectorAll(".afs-skeleton-card");n.length>0&&n.forEach(s=>s.remove());let t=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(s=>{let l=s.getAttribute("data-afs-product-id");l&&t.set(l,s)});let r=new Set(e.map(s=>a.id(s)).filter(s=>s!==null)),o=document.createDocumentFragment();e.forEach(s=>{let l=a.id(s);if(!l)return;let d=t.get(l);if(d){let p=d.querySelector(".afs-product-card__title");p&&p.textContent!==s.title&&(p.textContent=s.title||"");let f=d.querySelector(".afs-product-card__price");if(f){let g=parseFloat(String(s.minPrice||0))*100,T=parseFloat(String(s.maxPrice||0))*100,m=a.formatMoney(g,i.moneyFormat||"{{amount}}",i.currency||""),b=g===T?m:`${C.labels.price}from ${m}`;f.textContent!==b&&(f.textContent=b)}}else{let p=this.createProduct(s);p&&o.appendChild(p)}}),t.forEach((s,l)=>{r.has(l)||s.remove()}),o.children.length>0&&this.productsGrid.appendChild(o)},createProduct(e){var r,o,s;let n=a.el("div","afs-product-card",{"data-afs-product-id":a.id(e)||""});if(e.imageUrl||e.featuredImage){let l=a.el("div","afs-product-card__image"),d=a.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),p=((r=e.featuredImage)==null?void 0:r.url)||((o=e.featuredImage)==null?void 0:o.urlFallback)||e.imageUrl||"";if(p){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let b=[];e.featuredImage.urlSmall&&b.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&b.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&b.push(`${e.featuredImage.urlLarge} 500w`),b.length>0&&(d.setAttribute("srcset",b.join(", ")),d.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),d.src=e.featuredImage.url||e.featuredImage.urlFallback||p}else{let b=a.optimizeImageUrl(p,{width:300,format:"webp",quality:80}),w=a.buildImageSrcset(p,[200,300,500]);w&&(d.setAttribute("srcset",w),d.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),d.src=b||p}d.onerror=function(){var w;let b=((w=e.featuredImage)==null?void 0:w.urlFallback)||p;if(b&&this.src!==b)this.src=b;else if(this.src.includes("_webp.")){let y=p.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");y!==this.src?this.src=y:this.style.display="none"}else this.style.display="none"}}l.appendChild(d);let f=a.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":a.id(e)||"","aria-label":C.buttons.quickAddToCart,type:"button"}),g=a.el("span","afs-product-card__quick-add-icon");g.innerHTML=D.plus,f.appendChild(g);let T=a.el("span","afs-product-card__quick-add-text");T.textContent=C.buttons.quickAdd,f.appendChild(T),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(b=>b.availableForSale))&&(f.disabled=!0,f.classList.add("afs-product-card__quick-add--disabled"),f.setAttribute("aria-label",C.labels.productUnavailable));let m=window;if((s=m.AFSQuickView)!=null&&s.createQuickViewButton){let b=m.AFSQuickView.createQuickViewButton(e);b&&l.appendChild(b)}n.appendChild(l)}let t=a.el("a","afs-product-card__info",{href:`/products/${e.handle}`});if(t){t.appendChild(a.txt(a.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&t.appendChild(a.txt(a.el("div","afs-product-card__vendor"),e.vendor));let l=parseFloat(String(e.minPrice||0))*100,d=parseFloat(String(e.maxPrice||0))*100,p=a.formatMoney(l,i.moneyFormat||"{{amount}}",i.currency||""),f=l===d?p:`from ${p}`;t.appendChild(a.txt(a.el("div","afs-product-card__price"),f)),n.appendChild(t)}return n},updateFilterState(e,n,t){if(!this.filtersContainer){u.warn("Cannot update filter state: filtersContainer not found");return}let r=p=>String(p).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),o=r(n),l=`.afs-filter-item[data-afs-filter-handle="${r(e)}"][data-afs-filter-value="${o}"]`,d=this.filtersContainer.querySelector(l);if(d){let p=d.querySelector(".afs-filter-item__checkbox");p?(p.checked=t,u.debug("Checkbox state updated",{handle:e,value:n,active:t})):u.warn("Checkbox not found in filter item",{handle:e,value:n}),d.classList.toggle("afs-filter-item--active",t)}else u.warn("Filter item not found for state update",{handle:e,value:n,active:t,selector:l})},renderInfo(e,n){if(!this.productsInfo)return;let t=this.sortContainer,r=this.productsInfo.querySelector(".afs-products-info__results");r&&r.remove();let o;if(n===0)o=a.txt(a.el("div","afs-products-info__results"),C.messages.noProductsFound);else if(n===1)o=a.txt(a.el("div","afs-products-info__results"),C.messages.oneProductFound);else{let s=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,n);o=a.txt(a.el("div","afs-products-info__results"),`${C.messages.showingProducts} ${s}-${l} of ${n} ${C.messages.productsFound}`)}t&&t.parentNode?this.productsInfo.insertBefore(o,t):(this.productsInfo.appendChild(o),t&&!t.parentNode&&this.productsInfo.appendChild(t))},renderPagination(e){var l;if(!this.productsGrid||!e)return;let n=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(n&&n.remove(),e.totalPages<=1)return;let t=a.el("div","afs-pagination"),r=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${C.buttons.previous} ${C.messages.pageOf.toLowerCase()}`});r.textContent=C.buttons.previous,r.disabled=e.page<=1,t.appendChild(r);let o=a.el("span","afs-pagination__info");o.textContent=`${C.messages.pageOf} ${e.page} of ${e.totalPages}`,t.appendChild(o);let s=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${C.buttons.next} ${C.messages.pageOf.toLowerCase()}`});s.textContent=C.buttons.next,s.disabled=e.page>=e.totalPages,t.appendChild(s),this.productsContainer&&this.productsContainer.appendChild(t)},renderApplied(e){if(!this.container)return;let n=this.container.querySelector(".afs-applied-filters");n&&n.remove();let t=[];if(Object.keys(e).forEach(d=>{let p=e[d];if(a.equals(d,"search")&&p&&typeof p=="string"&&p.trim())t.push({handle:d,label:`${C.labels.search}${p}`,value:p});else if(a.isPriceRangeKey(d)&&p&&typeof p=="object"&&!Array.isArray(p)){let f=p,g=typeof f.min=="number"&&!isNaN(f.min),T=typeof f.max=="number"&&!isNaN(f.max);if(g&&T){let m=Math.round(f.min),b=Math.round(f.max);t.push({handle:d,label:`${C.labels.price}$${m} - $${b}`,value:"__clear__"})}else if(g){let m=Math.round(f.min);t.push({handle:d,label:`${C.labels.price}$${m}+`,value:"__clear__"})}else if(T){let m=Math.round(f.max);t.push({handle:d,label:`${C.labels.price}Up to $${m}`,value:"__clear__"})}}else Array.isArray(p)&&p.length>0&&p.forEach(f=>{let g=i.filterMetadata.get(d),T=(g==null?void 0:g.label)||d,m=f;if((a.isCollectionOptionType(g==null?void 0:g.optionType)||a.isCollectionKey(d))&&i.collections&&Array.isArray(i.collections)){let w=i.collections.find(y=>{let S=String(y.id||y.gid||y.collectionId||"");return S&&String(S)===String(f)});w&&(m=w.title||w.label||w.name||f)}t.push({handle:d,label:`${T}: ${m}`,value:f})})}),t.length===0)return;let r=a.el("div","afs-applied-filters"),o=a.el("div","afs-applied-filters__header");o.appendChild(a.txt(a.el("div","afs-applied-filters__label"),C.labels.appliedFilters)),r.appendChild(o);let s=a.el("div","afs-applied-filters__list");t.forEach(d=>{let p=a.el("div","afs-applied-filter-chip");p.appendChild(a.txt(a.el("span","afs-applied-filter-chip__label"),d.label));let f=a.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":d.handle,"data-afs-filter-value":d.value,"aria-label":`${C.buttons.clear} filter`,type:"button"});f.innerHTML=D.close,p.appendChild(f),s.appendChild(p)});let l=a.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});l.textContent=C.buttons.clearAll,s.appendChild(l),r.appendChild(s),this.container.insertBefore(r,this.container.firstChild)},scrollToProducts(){i.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products info")))},showLoading(e="both"){(e==="products"||e==="both")&&this.showProductsSkeleton(),(e==="filters"||e==="both")&&this.showFiltersSkeleton()},hideLoading(e="both"){var n;(e==="products"||e==="both")&&(Array.isArray(this.loading)?(this.loading.forEach(t=>{t.parentNode&&t.remove()}),this.loading=null):(n=this.loading)!=null&&n.parentNode&&(this.loading.remove(),this.loading=null)),(e==="filters"||e==="both")&&this.hideFiltersSkeleton()},showProductsSkeleton(){var r;if(!this.productsGrid)return;a.clear(this.productsGrid);let e=((r=i.pagination)==null?void 0:r.limit)||k.PAGE_SIZE||24,n=Math.max(e,24),t=[];for(let o=0;o<n;o++){let s=a.el("div","afs-skeleton-card");s.innerHTML=`
				<div class="afs-skeleton-card__image">&#8203;</div>
				<div class="afs-skeleton-card__info">
					<div class="afs-skeleton-card__title">&#8203;</div>
					<div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
					<div class="afs-skeleton-card__price">&#8203;</div>
				</div>
			`,t.push(s)}t.forEach(o=>this.productsGrid.appendChild(o)),this.loading=t},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let n=a.el("div","afs-filters-skeleton");for(let t=0;t<4;t++){let r=a.el("div","afs-skeleton-filter-group");r.innerHTML=`
				<div class="afs-skeleton-filter-group__header">
					<div class="afs-skeleton-filter-group__title">&#8203;</div>
				</div>
				<div class="afs-skeleton-filter-group__content">
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
				</div>
			`,n.appendChild(r)}this.filtersContainer.appendChild(n)},hideFiltersSkeleton(){var n;let e=(n=this.filtersContainer)==null?void 0:n.querySelector(".afs-filters-skeleton");e&&e.remove()},hideProductsSkeleton(){var n;let e=(n=this.filtersContainer)==null?void 0:n.querySelector(".afs-filters-skeleton");e&&e.remove()},showError(e){var r;if(!this.productsContainer&&(this.productsContainer=((r=this.container)==null?void 0:r.querySelector(".afs-products-container"))||null,!this.productsContainer&&this.container)){let o=this.container.querySelector(".afs-main-content");o&&(this.productsContainer=a.el("div","afs-products-container"),o.appendChild(this.productsContainer))}if(!this.productsContainer){u.error("Cannot show error: productsContainer not found",{message:e}),console.error("[AFS Error]",e);return}if(this.hideLoading(),i.fallbackProducts&&i.fallbackProducts.length>0){u.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:i.fallbackProducts.length}),i.products=i.fallbackProducts,i.pagination={page:1,limit:k.PAGE_SIZE,total:i.fallbackProducts.length,totalPages:Math.ceil(i.fallbackProducts.length/k.PAGE_SIZE)},this.renderProducts(i.products),this.renderInfo(i.pagination,i.pagination.total),this.renderPagination(i.pagination);return}let n=this.productsContainer.querySelector(".afs-error-message");n&&n.remove();let t=a.el("div","afs-error-message");t.textContent=e||C.messages.failedToLoad,this.productsGrid?(a.clear(this.productsGrid),this.productsGrid.appendChild(t)):this.productsContainer.appendChild(t),u.error("Error displayed",{message:e})},setSortSelectValue(){if(h.sortSelect){if(a.isBestSelling(i.sort.field))h.sortSelect.value="best-selling";else{let e=a.equals(i.sort.order,"asc")?"ascending":"descending";h.sortSelect.value=`${i.sort.field}-${e}`}u.debug("Sort select value updated programmatically",{value:h.sortSelect.value,sort:i.sort})}}},B={getPagination(){let n=F.parse().page||i.fallbackPagination.currentPage||1,t=i.fallbackPagination.totalPages||1,r=i.fallbackPagination.totalProducts||i.fallbackProducts.length||0;return{page:n,limit:k.PAGE_SIZE,total:r,totalPages:t}},reloadPage(e,n,t){let r=new URL(window.location.href);if(r.search="",t&&t.field)if(t.field==="best-selling"||t.field==="bestselling")r.searchParams.set("sort","best-selling");else{let o=a.equals(t.order,"asc")?"ascending":"descending";r.searchParams.set("sort",`${t.field}-${o}`)}n&&n.page&&r.searchParams.set("page",String(n.page)),Object.keys(e||{}).forEach(o=>{let s=e[o];if(!a.empty(s))if(Array.isArray(s)&&s.length>0)r.searchParams.set(o,s.join(","));else if(a.isPriceRangeKey(o)&&s&&typeof s=="object"&&!Array.isArray(s)){let l=s,d=typeof l.min=="number"&&!isNaN(l.min)?Math.round(l.min):void 0,p=typeof l.max=="number"&&!isNaN(l.max)?Math.round(l.max):void 0;i.priceRangeHandle?r.searchParams.set(i.priceRangeHandle,`${d!==void 0?d:""}-${p!==void 0?p:""}`):(d!==void 0&&r.searchParams.set("priceMin",String(d)),p!==void 0&&r.searchParams.set("priceMax",String(p)))}else a.equals(o,"search")&&typeof s=="string"&&s.trim()&&r.searchParams.set(o,s.trim())}),u.info("Reloading page for fallback mode",{url:r.toString(),sort:t,pagination:n}),window.location.href=r.toString()}},G=e=>{var t;if(!((t=i.selectedCollection)!=null&&t.id))return;Object.keys(e||{}).some(r=>{let o=e[r];if(a.empty(o)||a.equalsAny(r,"page","limit","sort","size"))return!1;if(a.isPriceRangeKey(r)){if(!o||typeof o!="object"||Array.isArray(o))return!1;let s=o,l=typeof s.min=="number"&&!isNaN(s.min),d=typeof s.max=="number"&&!isNaN(s.max);if(!l&&!d)return!1}return!(a.equals(r,"search")&&(!o||typeof o!="string"||!o.trim()))})&&u.debug("Filters present, keeping cpid (server-managed)",{filters:e})},q={process:e=>{var t,r,o;u.info("Products loaded",{count:((t=e.products)==null?void 0:t.length)||0,total:((r=e.pagination)==null?void 0:r.total)||0}),!(e.products&&Array.isArray(e.products)&&e.products.length>0)&&i.fallbackProducts&&i.fallbackProducts.length>0?(u.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((o=e.products)==null?void 0:o.length)||0,fallbackCount:i.fallbackProducts.length}),i.usingFallback=!0,i.products=i.fallbackProducts,i.pagination=B.getPagination(),i.availableFilters=[],h.hideFilters(),h.hideLoading("products")):(i.usingFallback=!1,i.products=e.products||[],i.pagination=e.pagination||i.pagination,h.showFilters(),h.renderProducts(i.products)),q.updateUI()},updateUI:()=>{h.renderInfo(i.pagination,i.pagination.total||0),h.renderPagination(i.pagination),h.renderApplied(i.filters),h.setSortSelectValue()}},M={process:e=>{i.availableFilters=e.filters||[];try{i.filterMetadata=re.buildFilterMetadata(i.availableFilters)}catch(r){}let n=i.availableFilters.find(r=>a.isPriceRangeOptionType(r.optionType));i.priceRangeHandle=(n==null?void 0:n.handle)||i.priceRangeHandle||null,u.info("Filters set from URL",{filters:i.filters});let t=i.priceRangeHandle?i.filters[i.priceRangeHandle]:null;if(i.priceRangeHandle&&Array.isArray(t)&&t.length>0){let o=String(t[0]||"").split("-");if(o.length===2){let s=o[0].trim()?parseInt(o[0],10):void 0,l=o[1].trim()?parseInt(o[1],10):void 0,d=typeof s=="number"&&!isNaN(s)&&s>=0,p=typeof l=="number"&&!isNaN(l)&&l>=0;(d||p)&&(i.filters.priceRange={min:d?s:void 0,max:p?l:void 0},delete i.filters[i.priceRangeHandle])}}h.renderFilters(i.availableFilters),u.info("Filters rendered",{count:i.availableFilters.length}),q.updateUI(),h.hideLoading("filters")},toggle(e,n){var p,f;let t=a.str(n);if(!t||!e){u.warn("Invalid filter toggle",{handle:e,value:n});return}let r=i.filters[e]||[],o=r.includes(t),s=o?r.filter(g=>g!==t):[...r,t],l=i.filterMetadata.get(e);if(((l==null?void 0:l.optionType)==="Collection"||e==="collections")&&((p=i.selectedCollection)!=null&&p.id)){let g=i.selectedCollection.id;o&&String(t)===String(g)?(i.selectedCollection.id=null,u.debug("Collection filter unchecked (was cpid), cleared cpid",{handle:e,value:t,cpid:g})):s.some(T=>String(T)===String(g))||(i.selectedCollection.id=null,u.debug("Collection filter toggled, cpid no longer in values, cleared cpid",{handle:e,value:t,filterValues:s,wasCpid:String(t)===String(g),originalCpid:g}))}if(s.length===0?delete i.filters[e]:i.filters[e]=s,G(i.filters),i.pagination.page=1,u.debug("Filter toggled",{handle:e,value:t,wasActive:o,isActive:!o,filterValues:s}),F.update(i.filters,i.pagination,i.sort),h.updateFilterState(e,t,!o),h.scrollToProducts(),h.showLoading(),window.innerWidth<=768&&((f=h.filtersContainer)!=null&&f.classList.contains("afs-filters-container--open"))){h.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let g=document.body.style.top;g&&window.scrollTo(0,parseInt(g||"0",10)*-1)}this.apply()},updatePriceRange(e,n){if(e=Math.round(e),n=Math.round(n),typeof e!="number"||typeof n!="number"||e<0||n<e){u.warn("Invalid price range",{min:e,max:n});return}let t=i.availableFilters.find(r=>a.isPriceRangeOptionType(r.optionType)||a.equals(r.optionKey,"priceRange"));if(t&&t.range){let r=Math.round(t.range.min),o=Math.round(t.range.max);e===r&&n===o?i.filters.priceRange=null:i.filters.priceRange={min:e,max:n}}else i.filters.priceRange={min:e,max:n};G(i.filters),i.pagination.page=1,u.debug("Price range updated",{min:e,max:n,priceRange:i.filters.priceRange}),F.update(i.filters,i.pagination,i.sort),h.scrollToProducts(),h.showLoading("products"),this.apply()},applyProductsOnly:a.debounce(async()=>{if(u.info("applyProductsOnly called",{filters:i.filters,pagination:i.pagination,sort:i.sort,usingFallback:i.usingFallback}),i.usingFallback){u.info("In fallback mode, reloading page with new parameters"),B.reloadPage(i.filters,i.pagination,i.sort);return}h.scrollToProducts(),L.products(i.filters,i.pagination,i.sort).then(q.process)},k.DEBOUNCE),apply:a.debounce(async()=>{h.scrollToProducts(),L.products(i.filters,i.pagination,i.sort).then(q.process),L.filters(i.filters).then(M.process)},k.DEBOUNCE)},ie={async add(e,n){try{let t=`/products/${e}.json`,r=await fetch(t);if(!r.ok)throw new Error(C.messages.failedToLoadProduct);let s=(await r.json()).product;if(!s||!s.variants||s.variants.length===0)throw new Error("Product has no variants");let l=s.variants.find(d=>d.available)||s.variants[0];await this.addVariant(Number(l.id),1)}catch(t){u.error("Quick add failed",{error:t instanceof Error?t.message:String(t),handle:e}),h.showError("Failed to add product to cart. Please try again.")}},async addFromForm(e,n){var t,r;try{let o=new FormData(e),s=o.get("id"),l=parseInt(((t=o.get("quantity"))==null?void 0:t.toString())||"1",10);if(s)await this.addVariant(Number(s),l);else{let d=[];for(let b=1;b<=3;b++){let w=o.get(`option${b}`);w&&d.push(w.toString())}let p=`/products/${n}.json`,m=(r=(await(await fetch(p)).json()).product.variants)==null?void 0:r.find(b=>b.options?b.options.length===d.length&&b.options.every((w,y)=>w===d[y]):!1);if(m)await this.addVariant(Number(m.id),l);else throw new Error("Variant not found")}}catch(o){u.error("Add from form failed",{error:o instanceof Error?o.message:String(o)}),h.showError("Failed to add product to cart. Please try again.")}},async addVariant(e,n){try{let t=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:n})});if(!t.ok){let r=await t.json();throw new Error(r.description||C.messages.failedToAddToCart)}await t.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(t){throw u.error("Add variant failed",{error:t instanceof Error?t.message:String(t),variantId:e}),t}},showSuccess(){let e=document.querySelector(".afs-quick-add-success");e||(e=a.el("div","afs-quick-add-success"),document.body.appendChild(e)),e.textContent=C.messages.addedToCart,e.classList.add("afs-quick-add-success--show");let n=()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",n)},t=setTimeout(()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",n)},3e3);e.addEventListener("animationend",()=>{clearTimeout(t),n()},{once:!0})}},Y={init(e={}){var n,t,r,o;try{if(u.init(e.debug),u.info("Initializing AFS",e),e.apiBaseUrl&&(L.setBaseURL(e.apiBaseUrl),u.info("API base URL set",{url:L.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");i.shop=e.shop,i.collections=e.collections||[],i.selectedCollection={id:(t=(n=e.selectedCollection)==null?void 0:n.id)!=null?t:null,sortBy:(o=(r=e.selectedCollection)==null?void 0:r.sortBy)!=null?o:null},i.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.moneyFormat&&(i.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(i.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(i.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(i.fallbackProducts=e.fallbackProducts,u.info("Fallback products loaded from Liquid",{count:i.fallbackProducts.length})),e.fallbackPagination&&(i.fallbackPagination=e.fallbackPagination,u.info("Fallback pagination loaded from Liquid",{currentPage:i.fallbackPagination.currentPage,totalPages:i.fallbackPagination.totalPages,totalProducts:i.fallbackPagination.totalProducts})),e.priceRangeHandle!==void 0&&(i.priceRangeHandle=e.priceRangeHandle),u.info("Shop set",{shop:i.shop}),u.info("Collections set",{collections:i.collections});let s=e.containerSelector||e.container||"[data-afs-container]",l=e.filtersSelector||e.filtersContainer,d=e.productsSelector||e.productsContainer;h.init(s,l,d),u.info("DOM initialized"),h.showLoading(),h.attachEvents(),u.info("DOM events attached"),this.load()}catch(s){throw u.error("Initialization failed",{error:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,config:e}),h.container&&h.showError(`Initialization failed: ${s instanceof Error?s.message:String(s)}`),s}},async load(){h.showLoading();try{let e=F.parse();u.debug("Parsed URL params on load",{urlParams:e}),L.buildFiltersFromUrl(e),L.setPaginationFromUrl(e),L.setSortFromUrl(e),u.info("Loading products & filters...",{shop:i.shop,filters:i.filters}),L.products(i.filters,i.pagination,i.sort).then(q.process),L.filters(i.filters).then(M.process)}catch(e){Q(e)}},Logger:u},Z=window;typeof window!="undefined"?(Z.AFS=Y,Z.AFS_API=L):typeof global!="undefined"&&(global.AFS=Y);var V={apiBaseUrl:"http://localhost:3554/storefront",shop:"",searchInputSelector:'input[name="q"], input[name="search"], input[type="search"][name*="q"], input[type="search"][name*="search"], .search__input, form[action*="/search"] input[type="search"], form[action*="/search"] input[name*="q"]',minQueryLength:2,debounceMs:300,maxSuggestions:5,maxProducts:6,showSuggestions:!0,showProducts:!0,enableKeyboardNav:!0},c={config:V,activeInput:null,dropdown:null,container:null,currentQuery:"",isOpen:!1,selectedIndex:-1,searchResults:null,isLoading:!1,abortController:null,replacedInputs:new Set,inputContainers:new Map},A={createContainer(e){let n=a.el("div","afs-search-container");n.style.position="absolute",n.style.display="block";let t=e.getBoundingClientRect(),r=t.width,o=280,s=r<o?o:r,l=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft;return n.style.top=`${t.bottom+l}px`,n.style.left=`${t.left+d}px`,n.style.width=`${s}px`,n.style.minWidth=`${o}px`,n.style.zIndex="999999",n},createDropdown(){let e=a.el("div","afs-search-dropdown");return e.setAttribute("role","listbox"),e.setAttribute("aria-label","Search results"),e},setupInputContainer(e){if(c.inputContainers.has(e)){let o=c.inputContainers.get(e);return this.updateContainerPosition(e,o),o}let n=this.createContainer(e);document.body.appendChild(n);let t=this.createDropdown();return n.appendChild(t),c.inputContainers.set(e,n),new ResizeObserver(()=>{this.updateContainerPosition(e,n),c.isOpen&&c.activeInput===e&&this.positionDropdown(e)}).observe(e),n},updateContainerPosition(e,n){let t=e.getBoundingClientRect(),r=t.width,o=280,s=r<o?o:r,l=window.pageYOffset||document.documentElement.scrollTop,d=window.pageXOffset||document.documentElement.scrollLeft;n.style.top=`${t.bottom+l}px`,n.style.left=`${t.left+d}px`,n.style.width=`${s}px`,n.style.minWidth=`${o}px`},createSuggestionItem(e,n){let t=a.el("div","afs-search-dropdown__suggestion",{role:"option","data-index":String(n),tabindex:"-1"}),r=a.el("span","afs-search-dropdown__suggestion-icon");r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>';let o=a.el("span","afs-search-dropdown__suggestion-text");return o.textContent=e,t.appendChild(r),t.appendChild(o),t},createProductItem(e,n){var s,l;let t=a.el("a","afs-search-dropdown__product",{href:`/products/${e.handle||""}`,role:"option","data-index":String(n),tabindex:"-1"});if(e.imageUrl||e.featuredImage){let d=a.el("div","afs-search-dropdown__product-image"),p=a.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async"}),f=((s=e.featuredImage)==null?void 0:s.url)||((l=e.featuredImage)==null?void 0:l.urlFallback)||e.imageUrl||"";f&&(p.src=f),d.appendChild(p),t.appendChild(d)}let r=a.el("div","afs-search-dropdown__product-info"),o=a.el("div","afs-search-dropdown__product-title");if(o.textContent=e.title||"",r.appendChild(o),e.vendor){let d=a.el("div","afs-search-dropdown__product-vendor");d.textContent=e.vendor,r.appendChild(d)}if(e.minPrice!==void 0){let d=a.el("div","afs-search-dropdown__product-price"),p=parseFloat(String(e.minPrice||0))*100,f=parseFloat(String(e.maxPrice||0))*100,g=a.formatMoney(p,i.moneyFormat||"{{amount}}",i.currency||""),T=p===f?g:`from ${g}`;d.textContent=T,r.appendChild(d)}return t.appendChild(r),t},createDidYouMeanItem(e){let n=a.el("div","afs-search-dropdown__did-you-mean",{role:"option","data-type":"did-you-mean",tabindex:"-1"}),t=a.el("span","afs-search-dropdown__did-you-mean-text");return t.innerHTML=`Did you mean <strong>${e}</strong>?`,n.appendChild(t),n},createEmptyState(e){let n=a.el("div","afs-search-dropdown__empty",{role:"option"});return n.textContent=e,n},createLoadingState(){let e=a.el("div","afs-search-dropdown__loading",{role:"option"});return e.innerHTML=`
			<div class="afs-search-dropdown__loading-spinner"></div>
			<span>${C.labels.loading}</span>
		`,e},renderDropdown(e,n){var o;if(!c.dropdown)return;if(c.dropdown.innerHTML="",c.selectedIndex=-1,c.isLoading){c.dropdown.appendChild(this.createLoadingState());return}if(!e)return;let t=document.createDocumentFragment(),r=0;if(e.didYouMean&&e.zeroResults){let s=this.createDidYouMeanItem(e.didYouMean);s.setAttribute("data-index",String(r)),t.appendChild(s),r++}if(c.config.showSuggestions&&e.suggestions&&e.suggestions.length>0){let s=a.el("div","afs-search-dropdown__header");s.textContent="Suggestions",t.appendChild(s),e.suggestions.slice(0,c.config.maxSuggestions).forEach(l=>{let d=this.createSuggestionItem(l,r);t.appendChild(d),r++})}if(c.config.showProducts&&e.products&&e.products.length>0){let s=a.el("div","afs-search-dropdown__header");if(s.textContent=`Products (${((o=e.pagination)==null?void 0:o.total)||e.products.length})`,t.appendChild(s),e.products.slice(0,c.config.maxProducts).forEach(l=>{let d=this.createProductItem(l,r);t.appendChild(d),r++}),e.pagination&&e.pagination.total>c.config.maxProducts){let l=a.el("a","afs-search-dropdown__view-all",{href:`/search?q=${encodeURIComponent(n)}`,role:"option"});l.textContent=`View all ${e.pagination.total} results`,l.setAttribute("data-index",String(r)),t.appendChild(l),r++}}e.zeroResults&&(!e.suggestions||e.suggestions.length===0)&&(!e.products||e.products.length===0)&&t.appendChild(this.createEmptyState("No products found. Try adjusting your search terms.")),c.dropdown.appendChild(t)},positionDropdown(e){!c.dropdown||!c.container||(this.updateContainerPosition(e,c.container),c.dropdown.style.position="absolute",c.dropdown.style.top="100%",c.dropdown.style.left="0",c.dropdown.style.width="100%",c.dropdown.style.maxHeight="400px",c.dropdown.style.overflowY="auto",c.dropdown.style.zIndex="999999",c.dropdown.style.marginTop="4px")},showDropdown(){!c.dropdown||!c.activeInput||(c.container||(c.container=this.setupInputContainer(c.activeInput),c.dropdown=c.container.querySelector(".afs-search-dropdown"),c.dropdown||(c.dropdown=this.createDropdown(),c.container.appendChild(c.dropdown))),c.isOpen=!0,c.dropdown.classList.add("afs-search-dropdown--visible"),c.dropdown.setAttribute("aria-expanded","true"),this.positionDropdown(c.activeInput))},hideDropdown(){c.dropdown&&(c.isOpen=!1,c.selectedIndex=-1,c.dropdown.classList.remove("afs-search-dropdown--visible"),c.dropdown.setAttribute("aria-expanded","false"))},highlightItem(e){if(!c.dropdown)return;c.dropdown.querySelectorAll('[role="option"][data-index]').forEach((t,r)=>{r===e?(t.classList.add("afs-search-dropdown__item--selected"),t.scrollIntoView({block:"nearest",behavior:"smooth"})):t.classList.remove("afs-search-dropdown__item--selected")}),c.selectedIndex=e},getSelectedItem(){return!c.dropdown||c.selectedIndex<0?null:c.dropdown.querySelectorAll('[role="option"][data-index]')[c.selectedIndex]||null}},oe={async search(e){let n=c.config.shop,t=c.config.apiBaseUrl;if(!n&&i.shop&&(n=i.shop),!t&&L.baseURL&&(t=L.baseURL),!n||!t)return u.error("Search API: shop or apiBaseUrl not configured",{hasShop:!!n,hasApiBaseUrl:!!t,stateShop:i.shop,apiBaseURL:L.baseURL}),null;c.abortController&&c.abortController.abort(),c.abortController=new AbortController;let r=new URLSearchParams;r.set("shop",n),r.set("q",e),r.set("suggestions","true"),r.set("autocomplete","true"),r.set("limit",String(c.config.maxProducts));let o=`${t}/search?${r}`;try{c.isLoading=!0,A.renderDropdown(null,e);let s=await fetch(o,{signal:c.abortController.signal,headers:{Accept:"application/json"}});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);let l=await s.json();return!l.success||!l.data?(u.error("Invalid search response",{data:l}),null):l.data}catch(s){return s.name==="AbortError"?(u.debug("Search request aborted"),null):(u.error("Search API error",{error:s.message,query:e}),null)}finally{c.isLoading=!1}}},H={debouncedSearch:a.debounce(async e=>{if(e.length<c.config.minQueryLength){c.searchResults=null,A.hideDropdown();return}c.activeInput&&!c.inputContainers.has(c.activeInput)&&$.replaceInput(c.activeInput),c.currentQuery=e;let n=await oe.search(e);c.searchResults=n,n!==null?(A.renderDropdown(n,e),A.showDropdown()):A.hideDropdown()},V.debounceMs),handleInput(e){let n=e.target,t=n.value.trim();c.activeInput=n,H.debouncedSearch(t)},handleFocus(e){let n=e.target;c.activeInput=n,c.inputContainers.has(n)?(c.container=c.inputContainers.get(n),c.dropdown=c.container.querySelector(".afs-search-dropdown")):$.replaceInput(n),n.value.trim().length>=c.config.minQueryLength&&c.searchResults&&(A.renderDropdown(c.searchResults,n.value.trim()),A.showDropdown())},handleBlur(e){setTimeout(()=>{var n,t;!((n=c.dropdown)!=null&&n.matches(":hover"))&&!((t=c.activeInput)!=null&&t.matches(":focus"))&&A.hideDropdown()},200)},handleKeyDown(e){var r,o,s,l;if(!c.isOpen||!c.dropdown)return;let t=c.dropdown.querySelectorAll('[role="option"][data-index]').length;switch(e.key){case"ArrowDown":e.preventDefault(),c.selectedIndex=Math.min(c.selectedIndex+1,t-1),A.highlightItem(c.selectedIndex);break;case"ArrowUp":e.preventDefault(),c.selectedIndex=Math.max(c.selectedIndex-1,-1),c.selectedIndex>=0?A.highlightItem(c.selectedIndex):(r=c.activeInput)==null||r.focus();break;case"Enter":e.preventDefault();let d=A.getSelectedItem();if(d)if(d.tagName==="A")window.location.href=d.href;else if(d.getAttribute("data-type")==="did-you-mean"){let p=(o=c.searchResults)==null?void 0:o.didYouMean;p&&c.activeInput&&(c.activeInput.value=p,H.debouncedSearch(p))}else{let p=(s=d.querySelector(".afs-search-dropdown__suggestion-text"))==null?void 0:s.textContent;p&&c.activeInput&&(c.activeInput.value=p,H.debouncedSearch(p))}else if(c.activeInput){let p=c.activeInput.value.trim();p&&(window.location.href=`/search?q=${encodeURIComponent(p)}`)}break;case"Escape":e.preventDefault(),A.hideDropdown(),(l=c.activeInput)==null||l.blur();break}},handleClick(e){var r,o;let t=e.target.closest('[role="option"]');if(t&&t.tagName!=="A")if(e.preventDefault(),t.getAttribute("data-type")==="did-you-mean"){let s=(r=c.searchResults)==null?void 0:r.didYouMean;s&&c.activeInput&&(c.activeInput.value=s,H.debouncedSearch(s))}else{let s=(o=t.querySelector(".afs-search-dropdown__suggestion-text"))==null?void 0:o.textContent;s&&c.activeInput&&(c.activeInput.value=s,H.debouncedSearch(s))}}},$={replaceInput(e){if(c.replacedInputs.has(e))return;let n=A.setupInputContainer(e);c.container=n;let t=n.querySelector(".afs-search-dropdown");t||(t=A.createDropdown(),n.appendChild(t)),c.dropdown=t,t.addEventListener("click",H.handleClick);let r=e.closest("form");r&&r.addEventListener("submit",o=>{o.preventDefault();let s=e.value.trim();s&&(window.location.href=`/search?q=${encodeURIComponent(s)}`)}),e.addEventListener("input",H.handleInput),e.addEventListener("focus",H.handleFocus),e.addEventListener("blur",H.handleBlur),e.addEventListener("keydown",H.handleKeyDown),e.setAttribute("data-afs-search","true"),c.replacedInputs.add(e)},isFilterSectionInput(e){return!!(e.classList.contains("afs-filter-group__search-input")||e.closest("[data-afs-container]")||e.closest(".afs-filter-group")||e.name&&e.name.startsWith("afs-search-"))},isShopifySearchInput(e){if(e.name==="q"||e.name==="search")return!0;let n=e.closest("form");if(n){let t=n.getAttribute("action");if(t&&(t.includes("/search")||t.includes("search"))&&(e.type==="search"||e.type==="text"||!e.type))return!0}return!!(e.classList.contains("search__input")||e.hasAttribute("data-search-input"))},findAndReplaceInputs(){document.querySelectorAll(c.config.searchInputSelector).forEach(n=>{if(!c.replacedInputs.has(n)){if(this.isFilterSectionInput(n)){u.debug("Skipping filter section input",{name:n.name,class:n.className});return}this.isShopifySearchInput(n)&&(u.debug("Processing Shopify search input",{name:n.name,type:n.type}),this.replaceInput(n))}})},init(e={}){c.config={...V,...e},!c.config.shop&&i.shop&&(c.config.shop=i.shop),!c.config.apiBaseUrl&&L.baseURL&&(c.config.apiBaseUrl=L.baseURL),this.findAndReplaceInputs(),new MutationObserver(()=>{this.findAndReplaceInputs()}).observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("click",o=>{var s;if(c.isOpen&&c.container){let l=o.target;!c.container.contains(l)&&!((s=c.activeInput)!=null&&s.contains(l))&&A.hideDropdown()}});let t,r=()=>{c.activeInput&&c.container&&(A.updateContainerPosition(c.activeInput,c.container),c.isOpen&&A.positionDropdown(c.activeInput))};window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(r,10)},!0),window.addEventListener("resize",()=>{clearTimeout(t),t=setTimeout(r,10)}),u.info("Search module initialized",{config:c.config})}};if(typeof window!="undefined"){let e=window;e.AFSSearch={init:$.init.bind($)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{$.init()}):$.init();
