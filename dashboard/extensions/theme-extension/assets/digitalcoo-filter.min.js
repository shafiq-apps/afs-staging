"use strict";var R={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'};var O={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24};var E={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",soldOut:"Sold out",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}};var a={debounce:(e,n)=>{let r;return(...t)=>{r!==void 0&&clearTimeout(r),r=setTimeout(()=>e(...t),n)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.selectionType),"multiple")||a.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(n=>String(n).trim()).filter(Boolean):String(e).split(",").map(n=>n.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let n=e.productId||e.id||e.gid;return n&&String(n).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,n,r={})=>{let t=document.createElement(e);return n&&(t.className=n),Object.entries(r).forEach(([i,o])=>t.setAttribute(i,o)),t},getAttrVal:(e,n)=>e==null?void 0:e.getAttribute(n),txt:(e,n)=>(e.textContent=n,e),clear:e=>{for(;e.firstChild;){let n=e.firstChild;n&&e.removeChild(n)}},frag:(e,n)=>{let r=document.createDocumentFragment();return e.forEach(t=>r.appendChild(n(t))),r},optimizeImageUrl:(e,n={})=>{if(!e||typeof e!="string")return"";let{width:r=500,height:t=r,quality:i=80,format:o="webp",crop:l=null}=n;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let d=new URL(e),p=new URLSearchParams(d.search);return p.delete("width"),p.delete("height"),p.delete("crop"),p.delete("format"),p.delete("quality"),p.set("width",String(r)),p.set("height",String(t)),l&&p.set("crop",l),i!==100&&p.set("quality",String(i)),!d.pathname.toLowerCase().endsWith(".gif")&&o&&p.set("format",o),`${d.origin}${d.pathname}?${p.toString()}`}catch(d){return e}},buildImageSrcset:(e,n=[200,300,500])=>e?n.map(r=>`${a.optimizeImageUrl(e,{width:r,format:"webp",quality:r<=200?75:r<=300?80:85})} ${r}w`).join(", "):"",formatMoney:(e,n,r="")=>{if(isNaN(Number(e)))return"";let t=parseFloat(String(e))/100;if(!n||typeof n!="string")return`${r||""}${t.toFixed(2)}`;let i=t.toFixed(2);return n.includes("{{amount_no_decimals}}")?(i=Math.round(t).toString(),n.replace("{{amount_no_decimals}}",i)):n.includes("{{amount_with_comma_separator}}")?(i=t.toFixed(2).replace(".",","),n.replace("{{amount_with_comma_separator}}",i)):n.includes("{{amount_no_decimals_with_comma_separator}}")?(i=Math.round(t).toString(),n.replace("{{amount_no_decimals_with_comma_separator}}",i)):n.includes("{{amount_with_apostrophe_separator}}")?(i=t.toFixed(2).replace(".","'"),n.replace("{{amount_with_apostrophe_separator}}",i)):n.replace("{{amount}}",i)},equals:(e,n)=>e===n?!0:e==null||n===null||n===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(n)&&(n=n.join(",")),typeof e=="string"&&typeof n=="string"?e.trim().toLowerCase()===n.trim().toLowerCase():typeof e=="number"&&typeof n=="number"||typeof e=="boolean"&&typeof n=="boolean"?e===n:String(e).trim().toLowerCase()===String(n).trim().toLowerCase()),equalsAny:(e,...n)=>e==null?!1:n.some(r=>a.equals(e,r)),isVendorKey:e=>a.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>a.equalsAny(e,"productType","productTypes"),isTagKey:e=>a.equalsAny(e,"tag","tags"),isCollectionKey:e=>a.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>a.equalsAny(e,"priceRange","price"),isBestSelling:e=>a.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>a.equals(e,"Collection"),isPriceRangeOptionType:e=>a.equals(e,"priceRange")};function ee(e,n=document,r=5e3){return new Promise((t,i)=>{let o=n.querySelector(e);if(o){t(o);return}let l=setTimeout(()=>{c.disconnect(),i(new Error(`Element ${e} not found within ${r}ms`))},r),c=new MutationObserver((p,h)=>{let f=n.querySelector(e);f&&(h.disconnect(),clearTimeout(l),t(f))}),d=n instanceof Document?n.body:n;c.observe(d,{childList:!0,subtree:!0})})}function ae(e,n=document,r=5e3){return Promise.all(e.map(t=>ee(t,n,r)))}function le(e,n){return Array.from({length:n},(r,t)=>{var o;let i=e.querySelector(`.afs-product-modal__option-value[data-option-index="${t}"].afs-product-modal__option-value--selected`);return(o=i==null?void 0:i.dataset.optionValue)!=null?o:null})}function ce(e,n){return e.filter(r=>n.every((t,i)=>t?i===0?r.option1===t:i===1?r.option2===t:r.option3===t:!0))}function j(e){return e.available!==!1&&e.availableForSale!==!1}function ie(e,n,r,t){return e.variants.some(i=>!(i.available!==!1&&i.availableForSale!==!1)||n===0&&i.option1!==r||n===1&&i.option2!==r||n===2&&i.option3!==r?!1:t.every((l,c)=>c===n||!l?!0:c===0?i.option1===l:c===1?i.option2===l:i.option3===l))}var u={enabled:!0,error:(e,n)=>{u.enabled&&console.error("[AFS]",e,n||"")},warn:(e,n)=>{u.enabled&&console.warn("[AFS]",e,n||"")},info:(e,n)=>{u.enabled&&console.info("[AFS]",e,n||"")},debug:(e,n)=>{u.enabled&&console.debug("[AFS]",e,n||"")},log:(e,...n)=>{u.enabled&&console.log(e,...n)},init:e=>{u.enabled=e!==!1,u.log("%cAdvanced Filter & Search initialized","color: #00c853;font-size: 20px;font-weight: bold;background: #0b1e13;padding: 10px 15px;border-radius: 6px;font-family: Arial, sans-serif;")}};function de(){let e=navigator.userAgent||navigator.vendor||window.opera||"",n=window.innerWidth,r="ontouchstart"in window||navigator.maxTouchPoints>0,i=/iPad/i.test(e)||navigator.platform==="MacIntel"&&r||/Tablet/i.test(e)||/Android/i.test(e)&&!/Mobile/i.test(e)||r&&n>=768&&n<=1024,o=!i&&(/Mobi|iPhone|Android/i.test(e)||r&&n<768);return{type:o?"mobile":i?"tablet":"desktop",isMobile:o,isTablet:i,isDesktop:!o&&!i}}var U=new Map,me=new Set(["shop","shop_domain","cpid"]),A=e=>typeof e!="number"||isNaN(e)?0:parseFloat(e.toFixed(2)),he={buildFilterMetadata:e=>{let n=new Map;return Array.isArray(e)&&e.forEach(r=>{r.handle&&n.set(r.handle,{label:r.label||r.queryKey||r.optionKey||r.handle,queryKey:r.queryKey,optionKey:r.optionKey,optionType:r.optionType})}),n}},s={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:O.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},H={parse(){let e=new URL(window.location.href),n={},r,t;return e.searchParams.forEach((i,o)=>{if(!me.has(o))if(a.isVendorKey(o))n.vendor=a.split(i);else if(a.isProductTypeKey(o))n.productType=a.split(i);else if(a.isTagKey(o))n.tags=a.split(i);else if(a.isCollectionKey(o))n.collections=a.split(i);else if(a.equals(o,"search"))n.search=i;else if(a.equals(o,"q"))n.search=i;else if(a.equals(o,"priceMin")){let l=A(parseFloat(i));!isNaN(l)&&l>=0&&(r=l)}else if(a.equals(o,"priceMax")){let l=A(parseFloat(i));!isNaN(l)&&l>=0&&(t=l)}else if(a.isPriceRangeKey(o)){let l=i.split("-");if(l.length===2){let c=A(parseFloat(l[0])),d=A(parseFloat(l[1]));!isNaN(c)&&c>=0&&(r=c),!isNaN(d)&&d>=0&&(t=d)}}else if(a.equals(o,"page"))n.page=parseInt(i,10)||1;else if(a.equals(o,"limit"))n.limit=parseInt(i,10)||O.PAGE_SIZE;else if(a.equals(o,"sort")){let l=i.toLowerCase().trim();if(a.isBestSelling(l))n.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[c,d]=l.split("-"),p=a.equalsAny(d,"ascending")?"asc":a.equalsAny(d,"descending")?"desc":"desc";n.sort={field:c,order:p}}else{let[c,d]=i.split(":");n.sort={field:c,order:a.equalsAny(d,"asc")?"asc":"desc"}}}else n[o]=a.split(i),u.debug("Handle filter parsed directly",{handle:o,value:i})}),(r!==void 0||t!==void 0)&&(n.priceRange={min:r,max:t}),n},update(e,n,r){let t=new URL(window.location.href);if(t.search="",u.debug("Updating URL",{filters:e,pagination:n}),e&&!a.empty(e)&&Object.keys(e).forEach(o=>{var c;let l=e[o];if(!a.empty(l)){if(Array.isArray(l)&&l.length>0)t.searchParams.set(o,l.join(",")),u.debug("URL param set",{key:o,value:l.join(",")});else if(a.isPriceRangeKey(o)&&l&&typeof l=="object"&&!Array.isArray(l)){let d=l,p=typeof d.min=="number"&&!isNaN(d.min)?A(d.min):void 0,h=typeof d.max=="number"&&!isNaN(d.max)?A(d.max):void 0;if(s.priceRangeHandle){let f=`${p!==void 0?p:""}-${h!==void 0?h:""}`;t.searchParams.set(s.priceRangeHandle,f),u.debug("Price range URL handle param set",{handle:s.priceRangeHandle,value:f})}else p!==void 0&&t.searchParams.set("priceMin",String(p)),h!==void 0&&t.searchParams.set("priceMax",String(h)),u.debug("Price range URL params set",{priceMin:p,priceMax:h})}else if(a.equals(o,"search")&&typeof l=="string"&&l.trim()){let d=((c=window.AFS_Config)==null?void 0:c.isSearchTemplate)||!1,p=d?"q":"search";t.searchParams.set(p,l.trim()),u.debug("Search URL param set",{key:p,value:l.trim(),isSearchTemplate:d})}}}),n&&n.page>1&&(t.searchParams.set("page",String(n.page)),u.debug("Page URL param set",{page:n.page})),r&&r.field){if(r.field==="best-selling"||r.field==="bestselling")t.searchParams.set("sort","best-selling");else{let o=a.equals(r.order,"asc")?"ascending":"descending";t.searchParams.set("sort",`${r.field}-${o}`)}u.debug("Sort URL param set",{field:r.field,order:r.order})}let i=t.toString();u.info("URL updated",{newUrl:i,oldUrl:window.location.href}),history.pushState({filters:e,pagination:n,sort:r},"",t)}},V={baseURL:"https://fstaging.digitalcoo.com/storefront",__v:"2.0.0",__id:"01-23-2026",cache:new Map,timestamps:new Map,pending:new Map,key(e,n,r){let t=n&&typeof n=="object"&&typeof n.page=="number"?n.page:1,i=n&&typeof n=="object"&&typeof n.limit=="number"?n.limit:O.PAGE_SIZE||24,o=r&&typeof r=="object"&&r.field?r.field:"best-selling",l=r&&typeof r=="object"&&r.order?r.order:"asc";return`${t}-${i}-${o}-${l}-${JSON.stringify(e)}`},get(e){let n=this.timestamps.get(e);return!n||Date.now()-n>O.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,n){this.cache.set(e,n),this.timestamps.set(e,Date.now())},async fetch(e,n=O.TIMEOUT){let r=new AbortController,t=setTimeout(()=>r.abort(),n);try{u.debug("Fetching",{url:e});let i=await fetch(e,{signal:r.signal});if(clearTimeout(t),!i.ok){let l=await i.text().catch(()=>"");throw new Error(`HTTP ${i.status}: ${i.statusText}${l?" - "+l:""}`)}let o=await i.json();return u.debug("Fetch success",{url:e,hasData:!!o}),o}catch(i){throw clearTimeout(t),i instanceof Error&&i.name==="AbortError"?new Error("Request timeout"):(u.error("Fetch failed",{url:e,error:i instanceof Error?i.message:String(i)}),i)}},async products(e,n,r){var h,f,g,T,C,y,m;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!s.shop)throw new Error("Shop not set");let t=n&&typeof n=="object"?n:{page:((h=s.pagination)==null?void 0:h.page)||1,limit:((f=s.pagination)==null?void 0:f.limit)||O.PAGE_SIZE||24,total:((g=s.pagination)==null?void 0:g.total)||0,totalPages:((T=s.pagination)==null?void 0:T.totalPages)||0},i=r&&typeof r=="object"?r:{field:((C=s.sort)==null?void 0:C.field)||"best-selling",order:((y=s.sort)==null?void 0:y.order)||"asc"},o=this.key(e,t,i),l=this.get(o);if(l)return u.debug("Cache hit",{key:o}),l;if(this.pending.has(o))return u.debug("Request deduplication",{key:o}),this.pending.get(o);let c=new URLSearchParams;if(c.set("shop",s.shop),(m=s.selectedCollection)!=null&&m.id?(c.set("cpid",s.selectedCollection.id),u.debug("cpid sent to products API",{cpid:s.selectedCollection.id,filters:e})):u.warn("cpid not available in selectedCollection",{selectedCollection:s.selectedCollection}),Object.keys(e).forEach(b=>{let S=e[b];if(!a.empty(S))if(a.isPriceRangeKey(b)&&S&&typeof S=="object"&&!Array.isArray(S)){let v=S,w=typeof v.min=="number"&&!isNaN(v.min)?A(v.min):void 0,x=typeof v.max=="number"&&!isNaN(v.max)?A(v.max):void 0;s.priceRangeHandle?c.set(s.priceRangeHandle,`${w!==void 0?w:""}-${x!==void 0?x:""}`):(w!==void 0&&c.set("priceMin",String(w)),x!==void 0&&c.set("priceMax",String(x)))}else b==="search"&&typeof S=="string"&&S.trim()?c.set(b,S.trim()):Array.isArray(S)&&S.length>0?(c.set(b,S.join(",")),u.debug("Filter sent as direct handle param",{handle:b,value:S.join(",")})):typeof S=="string"&&(c.set(b,S),u.debug("Filter sent as direct handle param",{handle:b,value:S}))}),c.set("page",String(t.page)),c.set("limit",String(t.limit)),i.field)if(a.isBestSelling(i.field))c.set("sort","best-selling");else{let b=a.equals(i.order,"asc")?"ascending":"descending";c.set("sort",`${i.field}-${b}`)}let d=`${this.baseURL}/products?${c}`;u.info("Fetching products",{url:d,shop:s.shop,page:t.page}),_.showProductsSkeleton();let p=this.fetch(d).then(b=>{var v,w;if(!b.success||!b.data)throw u.error("Invalid products response",{response:b}),new Error(`Invalid products response: ${b.message||E.messages.unknownError}`);let S=b.data;return u.info("Products response",{productsCount:((v=S.products)==null?void 0:v.length)||0,total:((w=S.pagination)==null?void 0:w.total)||0,hasFilters:!!S.filters}),this.set(o,S),this.pending.delete(o),S}).catch(b=>{throw this.pending.delete(o),u.error("Products fetch failed",{error:b instanceof Error?b.message:String(b),url:d}),b});return _.showProductsSkeleton(),this.pending.set(o,p),p},async filters(e){var c;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!s.shop)throw new Error("Shop not set");let n=new URLSearchParams;n.set("shop",s.shop),(c=s.selectedCollection)!=null&&c.id?(n.set("cpid",s.selectedCollection.id),u.debug("cpid sent to filters API",{cpid:s.selectedCollection.id,filters:e})):u.warn("cpid not available in selectedCollection",{selectedCollection:s.selectedCollection});let r={...e};Object.keys(r).forEach(d=>{let p=r[d];if(!a.empty(p)){if(Array.isArray(p))n.set(d,p.join(","));else if(d==="search"&&typeof p=="string"&&p.trim())n.set("search",p.trim());else if(d==="priceRange"&&p&&typeof p=="object"&&!Array.isArray(p)){let h=p,f=typeof h.min=="number"&&!isNaN(h.min)?h.min:void 0,g=typeof h.max=="number"&&!isNaN(h.max)?h.max:void 0;s.priceRangeHandle?n.set(s.priceRangeHandle,`${f!==void 0?f:""}-${g!==void 0?g:""}`):(f!==void 0&&n.set("priceMin",String(f)),g!==void 0&&n.set("priceMax",String(g)))}}});let t={};n.forEach((d,p)=>{t[p]=d}),u.debug("All params for filters endpoint",{params:t});let i=`${this.baseURL}/filters?${n}`;u.info("Fetching filters",{url:i,shop:s.shop}),_.showLoading();let o=await this.fetch(i);if(!o.success||!o.data)throw u.error("Invalid filters response",{response:o}),new Error(`Invalid filters response: ${o.message||E.messages.unknownError}`);let l=o.data;if(!l||typeof l!="object")throw new Error("Invalid filters response: data is not an object");return l.filters!==void 0&&!Array.isArray(l.filters)&&(u.warn("Filters response contains non-array filters",{filters:l.filters}),l.filters=[]),u.info("Filters response:",{filters:l.filters}),l},setBaseURL(e){this.baseURL=e},buildFiltersFromUrl(e){let n=e.search||e.q||"";s.filters={vendor:e.vendor||[],productType:e.productType||[],tags:e.tags||[],collections:e.collections||[],search:n,priceRange:e.priceRange||null},Object.keys(e).forEach(r=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","cpid"].includes(r)){let t=e[r];Array.isArray(t)?s.filters[r]=t:typeof t=="string"&&(s.filters[r]=[t])}})},setPaginationFromUrl(e){e.page?s.pagination.page=e.page:s.fallbackPagination&&s.fallbackPagination.currentPage&&(s.pagination.page=s.fallbackPagination.currentPage)},setSortFromUrl(e){if(e.sort){let n=typeof e.sort=="object"?e.sort.field:e.sort;if(typeof n=="string"){let r=n.toLowerCase().trim();if(r==="best-selling"||r==="bestselling")s.sort={field:"best-selling",order:"asc"};else if(r.includes("-")){let[t,i]=r.split("-"),o=a.equalsAny(i,"ascending")?"asc":a.equalsAny(i,"descending")?"desc":"desc";s.sort={field:t,order:o}}else{let[t,i]=n.split(":");s.sort={field:t,order:i||"desc"}}}else typeof e.sort=="object"&&e.sort.field&&(s.sort={field:e.sort.field,order:e.sort.order||"desc"})}else s.sort={field:"best-selling",order:"asc"}}},_={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,mobileResultsButton:null,init(e,n,r){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Container selector cannot be empty. Provide a valid selector or ensure [data-afs-container] exists in the DOM.");if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error(`Container not found. Selector: "${e}". Please ensure the container element exists in the DOM.`);this.container.setAttribute("data-afs-container","true"),this.initSearchBar();let t=this.container.querySelector(".afs-main-content")||a.el("div","afs-main-content");t.parentNode||this.container.appendChild(t),this.filtersContainer=n&&n.trim()!==""&&document.querySelector(n)||null,this.filtersContainer||(this.filtersContainer=a.el("div","afs-filters-container"));let i=this.container.querySelector("[data-afs-search-bar]");i&&(i.parentNode&&i.parentNode.removeChild(i),this.container&&!i.parentNode&&this.container.insertBefore(i,this.container.firstChild)),!this.filtersContainer.parentNode&&t&&t.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=a.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",t.parentNode?t.parentNode.insertBefore(this.mobileFilterBackdrop,t):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=r&&r.trim()!==""&&document.querySelector(r)||null,this.productsContainer||(this.productsContainer=a.el("div","afs-products-container")),!this.productsContainer.parentNode&&t&&t.appendChild(this.productsContainer),this.productsInfo=a.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=a.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":E.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${E.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=a.el("div","afs-sort-container");let o=a.el("label","afs-sort-label",{for:"afs-sort-label"});o.textContent=E.labels.sortBy,this.sortSelect=a.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${E.sortOptions.bestSelling}</option>
        <option value="title-ascending">${E.sortOptions.titleAsc}</option>
        <option value="title-descending">${E.sortOptions.titleDesc}</option>
        <option value="price-ascending">${E.sortOptions.priceAsc}</option>
        <option value="price-descending">${E.sortOptions.priceDesc}</option>
        <option value="created-ascending">${E.sortOptions.createdAsc}</option>
        <option value="created-descending">${E.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(o),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=a.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},initSearchBar(){var d;if(!this.container)return;let e=this.container.querySelector("[data-afs-search-bar]");if(!e)return;let n=e.querySelector("[data-afs-search-input]"),r=e.querySelector("[data-afs-search-form]");if(!n||!r)return;e.style.display="";let t=H.parse(),i=t.q||t.search||"";i&&(n.value=String(i)),r.addEventListener("submit",p=>{p.preventDefault();let h=n.value.trim();h&&(s.filters.search=h,s.pagination.page=1,H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.apply())});let o=(d=window.AFS_Config)!=null&&d.isSearchTemplate?400:O.DEBOUNCE,l=null;n.addEventListener("input",()=>{l&&clearTimeout(l),l=setTimeout(()=>{let p=n.value.trim();s.filters.search=p,s.pagination.page=1,H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.apply()},o)});let c=()=>{let p=H.parse(),h=String(p.q||p.search||"");n.value!==h&&(n.value=h)};window.addEventListener("popstate",c),n._syncSearchInput=c,u.debug("Search bar initialized",{hasInput:!!n,hasForm:!!r})},attachEvents(){if(!_.container)return;_.container.addEventListener("click",r=>{var d,p,h,f,g,T,C;let t=r.target,i=(d=t.closest("[data-afs-action]"))==null?void 0:d.dataset.afsAction,o=t.closest(".afs-filter-item"),l=t instanceof HTMLInputElement&&(t.type==="checkbox"||t.type==="radio")?t:o==null?void 0:o.querySelector(".afs-filter-item__checkbox"),c=t.closest(".afs-pagination__button");if(i==="clear-all")s.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(p=s.selectedCollection)!=null&&p.id&&u.debug("Clear All: keeping server-managed cpid (not exposed to UI)"),s.pagination.page=1,H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.apply();else if(i==="toggle-filters"||i==="close-filters")_.toggleMobileFilters();else if(t.closest(".afs-applied-filter-chip__remove")){let y=t.closest(".afs-applied-filter-chip"),m=y==null?void 0:y.querySelector(".afs-applied-filter-chip__remove"),b=m==null?void 0:m.getAttribute("data-afs-filter-key"),S=m==null?void 0:m.getAttribute("data-afs-filter-value");if(!b)return;if(a.equals(b,"cpid")){(h=s.selectedCollection)!=null&&h.id&&u.debug("cpid removed, cleared selectedCollection"),H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.apply();return}if(a.equals(b,"search")){s.filters.search="",s.pagination.page=1,H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.apply();return}if(a.isPriceRangeKey(b)){s.filters.priceRange=null,s.pagination.page=1,H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.apply();return}S&&k.toggle(b,S)}else if(l&&o){r.preventDefault(),r.stopPropagation();let y=o.getAttribute("data-afs-filter-handle")||((f=o.parentElement)==null?void 0:f.getAttribute("data-afs-filter-handle")),m=o.getAttribute("data-afs-filter-value"),b=o.getAttribute("data-afs-filter-multiselect")||((g=o.parentElement)==null?void 0:g.getAttribute("data-afs-filter-multiselect"));if(!y||!m){u.warn("Invalid filter item clicked",{handle:y,value:m});return}u.debug("Filter toggle",{handle:y,value:m,currentChecked:l.checked}),(b==="0"||b==="false")&&(s.filters[y]=[]),k.toggle(y,m)}else if(c&&!c.disabled){let y=parseInt(c.getAttribute("data-afs-page")||"0",10);if(y&&y>0){if(s.usingFallback){let b=H.parse().page||s.pagination.page||1;s.pagination.page=y}else s.pagination.page=y;H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.applyProductsOnly()}}else if(t.closest(".afs-filter-group__clear")){r.preventDefault(),r.stopPropagation();let y=t.closest(".afs-filter-group__clear");if(!y)return;let m=y.getAttribute("data-afs-filter-handle");if(!m)return;let b=s.filterMetadata.get(m),S=a.isCollectionOptionType(b==null?void 0:b.optionType)||a.isCollectionKey(m);s.filters[m]&&(delete s.filters[m],u.debug("Filter cleared",{handle:m,isCollectionFilter:S}),H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),k.apply())}else if(t.closest(".afs-filter-group__toggle")){r.preventDefault(),r.stopPropagation();let y=t.closest(".afs-filter-group");if(!y)return;let b=!(y.getAttribute("data-afs-collapsed")==="true");y.setAttribute("data-afs-collapsed",b?"true":"false");let S=y.getAttribute("data-afs-filter-key");if(S)try{let L=U.get(S)||{};L.collapsed=b,L.lastUpdated=Date.now(),U.set(S,L);try{let M=`afs_filter_state_${y.getAttribute("data-afs-filter-handle")}`;sessionStorage.setItem(M,JSON.stringify({collapsed:b}))}catch(M){u.debug("Could not persist to sessionStorage",{error:M instanceof Error?M.message:String(M)})}}catch(L){u.error("Failed to persist filter state",{stateKey:S,error:L instanceof Error?L.message:String(L)})}let v=y.querySelector(".afs-filter-group__toggle");v&&v.setAttribute("aria-expanded",b?"false":"true");let w=y.querySelector(".afs-filter-group__icon");if(w&&(w.innerHTML=b?R.rightArrow||"":R.downArrow||""),((T=this.container)==null?void 0:T.getAttribute("data-afs-layout"))==="top"&&!b){let L=(C=this.filtersContainer)==null?void 0:C.querySelectorAll(".afs-filter-group");L==null||L.forEach(M=>{if(M!==y&&M.getAttribute("data-afs-collapsed")==="false"){M.setAttribute("data-afs-collapsed","true");let $=M.querySelector(".afs-filter-group__toggle"),K=M.querySelector(".afs-filter-group__icon");$&&$.setAttribute("aria-expanded","false"),K&&(K.innerHTML=R.rightArrow||"");let q=M.getAttribute("data-afs-filter-key");if(q){let Z=U.get(q)||{};Z.collapsed=!0,U.set(q,Z)}}})}u.debug("Filter group toggled",{collapsed:b,stateKey:S})}else if(t.closest(".afs-product-card__quick-add")){r.preventDefault(),r.stopPropagation();let y=t.closest(".afs-product-card__quick-add");if(!y||y.disabled)return;let m=y.getAttribute("data-product-handle"),b=y.getAttribute("data-product-id");m&&pe.add(m,b)}else if(t.closest(".afs-product-card__quick-view")){r.preventDefault(),r.stopPropagation();let y=t.closest(".afs-product-card__quick-view");if(!y)return;let m=y.getAttribute("data-product-handle");m&&Te(m)}}),_.container.addEventListener("input",r=>{var i;let t=r.target;if(t.classList.contains("afs-filter-group__search-input")){let l=t.value.toLowerCase(),c=(i=t.closest(".afs-filter-group"))==null?void 0:i.querySelector(".afs-filter-group__items");c!=null&&c._items&&c.querySelectorAll(".afs-filter-item").forEach((d,p)=>{var f;let h=(f=c._items)==null?void 0:f[p];if(h){let g=a.str(typeof h=="string"?h:h.label||h.value||"").toLowerCase();d.style.display=!l||g.includes(l)?"":"none"}})}}),document.addEventListener("click",r=>{var l,c;if(!(((l=this.container)==null?void 0:l.getAttribute("data-afs-layout"))==="top")||r.target.closest(".afs-filter-group"))return;let o=(c=this.filtersContainer)==null?void 0:c.querySelectorAll('.afs-filter-group[data-afs-collapsed="false"]');o==null||o.forEach(d=>{d.setAttribute("data-afs-collapsed","true");let p=d.querySelector(".afs-filter-group__toggle"),h=d.querySelector(".afs-filter-group__icon");p&&p.setAttribute("aria-expanded","false"),h&&(h.innerHTML=R.rightArrow||"");let f=d.getAttribute("data-afs-filter-key");if(f){let g=U.get(f)||{};g.collapsed=!0,U.set(f,g)}})});let e=r=>{let t=r.value;if(!t)return;u.info("Sort dropdown changed",{sortValue:t,currentSort:s.sort});let i;if(t==="best-selling"||t==="bestselling")i={field:"best-selling",order:"asc"};else if(t.includes("-")){let[o,l]=t.split("-");i={field:o,order:l==="ascending"?"asc":"desc"}}else{let[o,l]=t.split(":");i={field:o,order:l||"desc"}}s.sort=i,s.pagination.page=1,H.update(s.filters,s.pagination,s.sort),u.info("Calling applyProductsOnly after sort change",{sort:s.sort}),_.scrollToProducts(),_.showProductsSkeleton(),k.applyProductsOnly()},n=null;_.container.addEventListener("focus",r=>{let t=r.target;t.classList.contains("afs-sort-select")&&(n=t.value)},!0),_.container.addEventListener("change",r=>{let t=r.target;if(t.classList.contains("afs-sort-select")){let i=t;e(i),n=i.value}}),_.container.addEventListener("blur",r=>{let t=r.target;if(t.classList.contains("afs-sort-select")){let i=t,o=i.value;o&&o!==n&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{let l;if(a.isBestSelling(s.sort.field))l="best-selling";else{let c=a.equals(s.sort.order,"asc")?"ascending":"descending";l=`${s.sort.field}-${c}`}o!==l&&e(i)})}),n=o}},!0),window.addEventListener("popstate",()=>{var C;let r=(C=_.container)==null?void 0:C.querySelector("[data-afs-search-input]");r&&r._syncSearchInput&&r._syncSearchInput();let t=H.parse(),i=JSON.stringify(s.filters),o=s.pagination.page,l=JSON.stringify(s.sort),c=String(t.search||t.q||"");s.filters={vendor:t.vendor||[],productType:t.productType||[],tags:t.tags||[],collections:t.collections||[],search:c,priceRange:t.priceRange||null},Object.keys(t).forEach(y=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort"].includes(y)){let m=t[y];Array.isArray(m)?s.filters[y]=m:typeof m=="string"&&(s.filters[y]=[m])}});let d=s.priceRangeHandle?s.filters[s.priceRangeHandle]:null;if(s.priceRangeHandle&&Array.isArray(d)&&d.length>0){let m=String(d[0]||"").split("-");if(m.length===2){let b=m[0].trim()?parseInt(m[0],10):void 0,S=m[1].trim()?parseInt(m[1],10):void 0,v=typeof b=="number"&&!isNaN(b)&&b>=0,w=typeof S=="number"&&!isNaN(S)&&S>=0;(v||w)&&(s.filters.priceRange={min:v?b:void 0,max:w?S:void 0},delete s.filters[s.priceRangeHandle])}}let p=t.page||s.pagination.page;if(p!==o&&(s.pagination.page=p),t.sort){let y=typeof t.sort=="object"?t.sort.field:t.sort;if(typeof y=="string"){let m=y.toLowerCase().trim();if(m==="best-selling"||m==="bestselling")s.sort={field:"best-selling",order:"asc"};else if(m.includes("-")){let[b,S]=m.split("-"),v=a.equalsAny(S,"ascending")?"asc":a.equalsAny(S,"descending")?"desc":"desc";s.sort={field:b,order:v}}else{let[b,S]=y.split(":");s.sort={field:b,order:S||"desc"}}}else typeof t.sort=="object"&&t.sort.field&&(s.sort={field:t.sort.field,order:t.sort.order||"desc"})}else s.sort={field:"best-selling",order:"asc"};let h=JSON.stringify(s.filters),f=JSON.stringify(s.sort);!(i!==h)&&(f!==l||p!==o)?k.applyProductsOnly():k.apply()})},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",this.mobileFilterClose&&this.mobileFilterClose.parentNode&&(this.mobileFilterClose.remove(),this.mobileFilterClose=null),u.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),u.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),window.innerWidth<=767&&this.mobileResultsButton&&s.pagination.total>0&&this.mobileResultsButton.classList.add("afs-mobile-results-button--visible"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let n=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),n&&window.scrollTo(0,parseInt(n||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileResultsButton&&this.mobileResultsButton.classList.remove("afs-mobile-results-button--visible"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block",this.mobileFilterBackdrop.offsetHeight);let n=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${n}px`,document.body.style.width="100%",document.body.style.maxWidth="100vw",document.body.style.height="100%",document.body.style.overflow="hidden"}u.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton(),U.clear(),this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(t=>{let i=t.getAttribute("data-afs-filter-key");if(i){let o=t.querySelector(".afs-filter-group__search-input"),l=t.getAttribute("data-afs-collapsed")==="true",c=(o==null?void 0:o.value)||"",d=U.get(i);U.set(i,{...d,collapsed:l,search:c,lastUpdated:Date.now()})}}),a.clear(this.filtersContainer);let n=e.filter(t=>t?a.isPriceRangeOptionType(t.optionType)?t.range&&typeof t.range.min=="number"&&typeof t.range.max=="number"&&t.range.max>t.range.min:t.values&&t.values.length>0:!1);if(u.debug("Rendering filters",{total:e.length,valid:n.length,filtersWithSearchable:n.filter(t=>t.searchable).length,filtersWithCollapsed:n.filter(t=>t.collapsed).length}),n.length===0){u.warn("No valid filters to render"),this.mobileFilterClose&&this.mobileFilterClose.parentNode&&(this.mobileFilterClose.remove(),this.mobileFilterClose=null);return}this.mobileFilterClose||(this.mobileFilterClose=a.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":E.buttons.closeFilters||"Close filters"}),this.mobileFilterClose.style.display="none");let r=document.createDocumentFragment();n.forEach(t=>{var w,x;if(a.isPriceRangeOptionType(t.optionType)){let L=this.createPriceRangeGroup(t,U);L&&r.appendChild(L);return}let i;if(t.optionType||t.optionKey){if(i=t.handle,!i){u.error("Option filter missing handle",{filter:t});return}}else if(i=t.queryKey||t.key,!i){u.warn("Standard filter missing queryKey/key",{filter:t});return}u.debug("Filter group handle determined",{handle:i,filterHandle:t.handle,queryKey:t.queryKey,key:t.key,label:t.label,type:t.optionType,optionType:t.optionType,optionKey:t.optionKey,isOptionFilter:!!(t.optionType||t.optionKey)});let o=a.el("div","afs-filter-group",{"data-afs-filter-type":t.optionType||""});o.setAttribute("data-afs-filter-handle",i);let l=i;o.setAttribute("data-afs-filter-key",l);let c=U.get(l),d=((w=this.container)==null?void 0:w.getAttribute("data-afs-layout"))==="top",p=d?!0:t.collapsed===!0||t.collapsed==="true"||t.collapsed===1,h=d?!0:(c==null?void 0:c.collapsed)!==void 0?c.collapsed:p;o.setAttribute("data-afs-collapsed",h?"true":"false"),u.debug("Filter group created",{handle:i,label:t.label,collapsed:h,searchable:t.searchable,showCount:t.showCount,valuesCount:((x=t.values)==null?void 0:x.length)||0});let f=a.el("div","afs-filter-group__header"),g=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":h?"false":"true",title:t.tooltipContent||`Toggle ${t.label||i} filter`}),T=a.el("span","afs-filter-group__icon");T.innerHTML=h?R.rightArrow||"":R.downArrow||"",g.appendChild(T),g.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),t.label||t.optionType||"")),f.appendChild(g);let C=s.filters[i];if(C&&(Array.isArray(C)?C.length>0:typeof C=="object"&&!Array.isArray(C)?Object.keys(C).length>0:!!C)){let L=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${E.buttons.clear} ${t.label||i} filters`,"data-afs-filter-handle":i});L.textContent=E.buttons.clear,L.title=`${E.buttons.clear} ${t.label||i} filters`,f.appendChild(L)}o.appendChild(f);let m=a.el("div","afs-filter-group__content");if(t.searchable===!0||typeof t.searchable=="string"&&t.searchable.toLowerCase()==="true"){let L=a.el("div","afs-filter-group__search"),M=a.el("input","afs-filter-group__search-input",{type:"text",placeholder:t.searchPlaceholder||"Search...","aria-label":`${E.labels.search}${t.label||i}`,name:`afs-search-${i}`});c!=null&&c.search&&(M.value=c.search),L.appendChild(M),m.appendChild(L),u.debug("Search input added",{handle:i,label:t.label,searchable:t.searchable})}let S=a.el("div","afs-filter-group__items",{"data-afs-filter-handle":i,"data-afs-filter-multiselect":a.isMultiSelect(t)?"1":"0","data-afs-filter-display-type":a.toLowerCase(t.displayType||"CHECKBOX")});S._items=t.values;let v=document.createDocumentFragment();t.values&&t.values.forEach((L,M)=>{let $=this.createFilterItem(i,L,t,M);$&&v.appendChild($)}),S.appendChild(v),m.appendChild(S),o.appendChild(m),r.appendChild(o)}),r.children.length>0?(this.filtersContainer.appendChild(r),this.mobileFilterClose&&(this.mobileFilterClose.parentNode&&this.mobileFilterClose.parentNode!==this.filtersContainer&&this.mobileFilterClose.parentNode.removeChild(this.mobileFilterClose),this.mobileFilterClose.parentNode||this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild)),this.showFilters(),u.debug("Filters rendered",{count:r.children.length})):(u.warn("No filter groups created"),this.mobileFilterClose&&this.mobileFilterClose.parentNode&&(this.mobileFilterClose.remove(),this.mobileFilterClose=null),this.hideFilters())},createFilterItem(e,n,r,t){var T;let i=a.str(typeof n=="string"?n:n.value||n.key||n.name||"");if(!i||i==="[object Object]")return null;let o=typeof n=="string"?n:n.label||n.value||i;if((a.isCollectionOptionType(r==null?void 0:r.optionType)||a.isCollectionKey(e))&&s.collections&&Array.isArray(s.collections)){if((T=s.selectedCollection)!=null&&T.id&&String(i)===String(s.selectedCollection.id))return null;let C=s.collections.find(y=>{let m=String(y.id||y.gid||y.collectionId||"");return m&&String(m)===String(i)});if(C)o=C.title||C.label||C.name||o;else return null}let d=(s.filters[e]||[]).includes(i),p=a.inputDisplayType(r),h=(p==="radio"?e:e+"-"+i.replace(/\s+/g,"-").toLowerCase())+"_"+(t+1),f=a.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":i,for:h});d&&f.classList.add("afs-filter-item--active");let g=a.el("input","afs-filter-item__checkbox",{type:p});return g.checked=d,g.setAttribute("data-afs-filter-value",i),g.setAttribute("name",h),g.setAttribute("id",h),f.appendChild(g),f.appendChild(a.txt(a.el("span","afs-filter-item__label"),o)),r!=null&&r.showCount&&typeof n=="object"&&n.count&&f.appendChild(a.txt(a.el("span","afs-filter-item__count"),`(${n.count})`)),f},createPriceRangeGroup(e,n=null){var q,Z;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return u.warn("Invalid price range filter",{filter:e}),null;let r=A(e.range.min),t=A(e.range.max),i=s.filters.priceRange||{min:r,max:t},o=A(Math.max(r,Math.min(t,typeof i.min=="number"?i.min:r))),l=A(Math.max(r,Math.min(t,typeof i.max=="number"?i.max:t))),c=a.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),d=n==null?void 0:n.get(e.key||"priceRange"),h=((q=this.container)==null?void 0:q.getAttribute("data-afs-layout"))==="top"?!0:(Z=d==null?void 0:d.collapsed)!=null?Z:e.collapsed===!0;c.setAttribute("data-afs-collapsed",h?"true":"false");let f=a.el("div","afs-filter-group__header"),g=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":h?"false":"true"}),T=a.el("span","afs-filter-group__icon");if(T.innerHTML=h?R.rightArrow||"":R.downArrow||"",g.appendChild(T),g.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),f.appendChild(g),s.filters.priceRange&&(typeof s.filters.priceRange.min=="number"&&s.filters.priceRange.min!==r||typeof s.filters.priceRange.max=="number"&&s.filters.priceRange.max!==t)){let N=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${E.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});N.textContent=E.buttons.clear,N.title=`${E.buttons.clear} ${e.label} filter`,f.appendChild(N)}c.appendChild(f);let y=a.el("div","afs-filter-group__content"),m=a.el("div","afs-price-range-container"),b=a.el("div","afs-price-range-track"),S=a.el("div","afs-price-range-active");b.appendChild(S);let v=a.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(r),max:String(t),value:String(o),step:"1"});v.setAttribute("data-afs-range-type","min");let w=a.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(r),max:String(t),value:String(l),step:"1"});w.setAttribute("data-afs-range-type","max"),b.appendChild(v),b.appendChild(w),m.appendChild(b);let x=a.el("div","afs-price-range-values"),L=a.txt(a.el("span","afs-price-range-value afs-price-range-value--min"),a.formatMoney(o*100,s.moneyFormat||"{{amount}}",s.currency||"")),M=a.txt(a.el("span","afs-price-range-value afs-price-range-value--max"),a.formatMoney(l*100,s.moneyFormat||"{{amount}}",s.currency||""));x.appendChild(L),x.appendChild(a.txt(a.el("span","afs-price-range-separator")," - ")),x.appendChild(M),m.appendChild(x);let $=()=>{let N=A(parseFloat(v.value)),z=A(parseFloat(w.value)),P=t-r,D=(N-r)/P*100,F=(t-z)/P*100;S.style.left=`${D}%`,S.style.right=`${F}%`,L.textContent=a.formatMoney(N*100,s.moneyFormat||"{{amount}}",s.currency||""),M.textContent=a.formatMoney(z*100,s.moneyFormat||"{{amount}}",s.currency||"")},K=()=>{let N=A(parseFloat(v.value)),z=A(parseFloat(w.value));N>z&&(v.value=String(z),w.value=String(N)),$()};return v.addEventListener("input",()=>{K();let N=A(parseFloat(v.value)),z=A(parseFloat(w.value));k.updatePriceRange(N,z)}),w.addEventListener("input",()=>{K();let N=A(parseFloat(v.value)),z=A(parseFloat(w.value));k.updatePriceRange(N,z)}),$(),y.appendChild(m),c.appendChild(y),c},renderProducts(e){if(!this.productsGrid)return;let n=this.productsGrid.querySelectorAll(".afs-skeleton-card");n.length>0&&n.forEach(o=>o.remove());let r=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(o=>{let l=o.getAttribute("data-afs-product-id");l&&r.set(l,o)});let t=new Set(e.map(o=>a.id(o)).filter(o=>o!==null)),i=document.createDocumentFragment();e.forEach(o=>{let l=a.id(o);if(!l)return;let c=r.get(l);if(c){let d=c.querySelector(".afs-product-card__title");d&&d.textContent!==o.title&&(d.textContent=o.title||"");let p=c.querySelector(".afs-product-card__price");if(p){let h=parseFloat(String(o.minPrice||0))*100,f=parseFloat(String(o.maxPrice||0))*100,g=a.formatMoney(h,s.moneyFormat||"{{amount}}",s.currency||""),T=h===f?g:`${E.labels.price}from ${g}`;p.textContent!==T&&(p.textContent=T)}}else{let d=this.createProduct(o);d&&i.appendChild(d)}}),r.forEach((o,l)=>{t.has(l)||o.remove()}),i.children.length>0&&this.productsGrid.appendChild(i)},createProduct(e){let n=a.el("div","afs-product-card",{"data-afs-product-id":a.id(e)||""});if(e.imageUrl||e.featuredImage){let t=a.el("div","afs-product-card__image"),i=a.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),o=e.imageUrl||"",l=null,c=e.imagesUrls;if(c&&Array.isArray(c)&&c.length>1&&(l=c[1],u.debug("Second image found for hover",{secondImageUrl:l,totalImages:c.length})),o){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let T=[];e.featuredImage.urlSmall&&T.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&T.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&T.push(`${e.featuredImage.urlLarge} 500w`),T.length>0&&(i.setAttribute("srcset",T.join(", ")),i.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),i.src=e.featuredImage.url||e.featuredImage.urlFallback||o}else{let T=a.optimizeImageUrl(o,{width:300,format:"webp",quality:80}),C=a.buildImageSrcset(o,[200,300,500]);C&&(i.setAttribute("srcset",C),i.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),i.src=T||o}i.setAttribute("data-original-src",i.src),i.onerror=function(){var C;let T=((C=e.featuredImage)==null?void 0:C.urlFallback)||o;if(T&&this.src!==T)this.src=T,this.setAttribute("data-original-src",T);else if(this.src.includes("_webp.")){let y=o.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");y!==this.src?(this.src=y,this.setAttribute("data-original-src",y)):this.style.display="none"}else this.style.display="none"}}if(t.appendChild(i),l){let T=l,C=new Image;C.src=T;let y=i.src||o,m=()=>{let b=i.src;b&&b!==T&&(y=b)};i.complete?m():i.addEventListener("load",m,{once:!0}),t.addEventListener("mouseenter",()=>{m();let b=()=>{i.style.opacity="0",setTimeout(()=>{i.src=T,i.style.opacity="1"},150)};if(C.complete)b();else{let S=()=>{b()};C.complete?b():(C.addEventListener("load",S,{once:!0}),C.addEventListener("error",()=>{u.debug("Hover image failed to load",{url:l,hoverImageUrl:T})},{once:!0}))}}),t.addEventListener("mouseleave",()=>{i.style.opacity="0",setTimeout(()=>{i.src=y,i.style.opacity="1"},150)})}if(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(T=>T.availableForSale)){let T=a.el("div","afs-product-card__badge",{class:"afs-product-card__badge--sold-out"});T.textContent=E.buttons.soldOut||"Sold out",t.appendChild(T)}let p=a.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":a.id(e)||"","aria-label":E.buttons.quickAddToCart,type:"button"}),h=a.el("span","afs-product-card__quick-add-icon");h.innerHTML=R.plus,p.appendChild(h);let f=a.el("span","afs-product-card__quick-add-text");f.textContent=E.buttons.quickAdd,p.appendChild(f),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(T=>T.availableForSale))&&(p.disabled=!0,p.classList.add("afs-product-card__quick-add--disabled"),p.setAttribute("aria-label",E.labels.productUnavailable));let g=ve(e);g&&t.appendChild(g),n.appendChild(t)}let r=a.el("a","afs-product-card__info",{href:`/products/${e.handle}`});if(r){r.appendChild(a.txt(a.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&r.appendChild(a.txt(a.el("div","afs-product-card__vendor"),e.vendor));let t=parseFloat(String(e.minPrice||0))*100,i=parseFloat(String(e.maxPrice||0))*100,o=a.formatMoney(t,s.moneyFormat||"{{amount}}",s.currency||""),l=t===i?o:`from ${o}`;r.appendChild(a.txt(a.el("div","afs-product-card__price"),l)),n.appendChild(r)}return n},updateFilterState(e,n,r){if(!this.filtersContainer){u.warn("Cannot update filter state: filtersContainer not found");return}let t=d=>String(d).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),i=t(n),l=`.afs-filter-item[data-afs-filter-handle="${t(e)}"][data-afs-filter-value="${i}"]`,c=this.filtersContainer.querySelector(l);if(c){let d=c.querySelector(".afs-filter-item__checkbox");d?(d.checked=r,u.debug("Checkbox state updated",{handle:e,value:n,active:r})):u.warn("Checkbox not found in filter item",{handle:e,value:n}),c.classList.toggle("afs-filter-item--active",r)}else u.warn("Filter item not found for state update",{handle:e,value:n,active:r,selector:l})},renderInfo(e,n){if(!this.productsInfo)return;let r=this.sortContainer,t=this.productsInfo.querySelector(".afs-products-info__results");t&&t.remove();let i;if(n===0)i=a.txt(a.el("div","afs-products-info__results"),E.messages.noProductsFound);else if(n===1)i=a.txt(a.el("div","afs-products-info__results"),E.messages.oneProductFound);else{let o=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,n);i=a.txt(a.el("div","afs-products-info__results"),`${E.messages.showingProducts} ${o}-${l} of ${n} ${E.messages.productsFound}`)}r&&r.parentNode?this.productsInfo.insertBefore(i,r):(this.productsInfo.appendChild(i),r&&!r.parentNode&&this.productsInfo.appendChild(r)),this.updateMobileResultsButton(n)},updateMobileResultsButton(e){if(!this.container)return;if(!(window.innerWidth<=767)){this.mobileResultsButton&&this.mobileResultsButton.classList.remove("afs-mobile-results-button--visible");return}if(!this.mobileResultsButton){this.mobileResultsButton=a.el("div","afs-mobile-results-button");let t=a.el("button","afs-mobile-results-button-inner",{type:"button","aria-label":"View results"});this.mobileResultsButton.appendChild(t),this.container.parentNode?this.container.parentNode.appendChild(this.mobileResultsButton):document.body.appendChild(this.mobileResultsButton),t.addEventListener("click",()=>{this.productsGrid&&this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"})});let i=null;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=window.setTimeout(()=>{let o=window.innerWidth<=767;!o&&this.mobileResultsButton?this.mobileResultsButton.classList.remove("afs-mobile-results-button--visible"):o&&e>0&&this.mobileResultsButton&&!document.body.classList.contains("afs-filters-open")&&this.mobileResultsButton.classList.add("afs-mobile-results-button--visible")},150)})}let r=this.mobileResultsButton.querySelector(".afs-mobile-results-button-inner");r&&(e===0?r.textContent=E.messages.noProductsFound||"No products found":e===1?r.textContent=`See ${e} result`:r.textContent=`See ${e} results`),e>0?requestAnimationFrame(()=>{this.mobileResultsButton&&(document.body.classList.contains("afs-filters-open")?this.mobileResultsButton.classList.remove("afs-mobile-results-button--visible"):this.mobileResultsButton.classList.add("afs-mobile-results-button--visible"))}):this.mobileResultsButton&&this.mobileResultsButton.classList.remove("afs-mobile-results-button--visible")},renderPagination(e){var l;if(!this.productsGrid||!e)return;let n=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(n&&n.remove(),e.totalPages<=1)return;let r=a.el("div","afs-pagination"),t=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${E.buttons.previous} ${E.messages.pageOf.toLowerCase()}`});t.textContent=E.buttons.previous,t.disabled=e.page<=1,r.appendChild(t);let i=a.el("span","afs-pagination__info");i.textContent=`${E.messages.pageOf} ${e.page} of ${e.totalPages}`,r.appendChild(i);let o=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${E.buttons.next} ${E.messages.pageOf.toLowerCase()}`});o.textContent=E.buttons.next,o.disabled=e.page>=e.totalPages,r.appendChild(o),this.productsContainer&&this.productsContainer.appendChild(r)},renderApplied(e){if(!this.container)return;let n=this.container.querySelector(".afs-applied-filters");n&&n.remove();let r=this.container.querySelector("[data-afs-search-bar]"),t=[];if(Object.keys(e).forEach(d=>{let p=e[d];if(!a.equals(d,"cpid"))if(a.equals(d,"search")&&p&&typeof p=="string"&&p.trim())t.push({handle:d,label:`${E.labels.search}${p}`,value:p});else if(a.isPriceRangeKey(d)&&p&&typeof p=="object"&&!Array.isArray(p)){let h=p,f=typeof h.min=="number"&&!isNaN(h.min),g=typeof h.max=="number"&&!isNaN(h.max);if(f&&g){let T=A(h.min),C=A(h.max);t.push({handle:d,label:`${E.labels.price}$${T} - $${C}`,value:"__clear__"})}else if(f){let T=A(h.min);t.push({handle:d,label:`${E.labels.price}$${T}+`,value:"__clear__"})}else if(g){let T=A(h.max);t.push({handle:d,label:`${E.labels.price}Up to $${T}`,value:"__clear__"})}}else Array.isArray(p)&&p.length>0&&p.forEach(h=>{let f=s.filterMetadata.get(d),g=(f==null?void 0:f.label)||d,T=h;if((a.isCollectionOptionType(f==null?void 0:f.optionType)||a.isCollectionKey(d))&&s.collections&&Array.isArray(s.collections)){let y=s.collections.find(m=>{let b=String(m.id||m.gid||m.collectionId||"");return b&&String(b)===String(h)});y&&(T=y.title||y.label||y.name||h)}t.push({handle:d,label:`${g}: ${T}`,value:h})})}),t.length===0)return;let i=a.el("div","afs-applied-filters"),o=a.el("div","afs-applied-filters__header");o.appendChild(a.txt(a.el("div","afs-applied-filters__label"),E.labels.appliedFilters)),i.appendChild(o);let l=a.el("div","afs-applied-filters__list");t.forEach(d=>{let p=a.el("div","afs-applied-filter-chip");p.appendChild(a.txt(a.el("span","afs-applied-filter-chip__label"),d.label));let h=a.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":d.handle,"data-afs-filter-value":d.value,"aria-label":`${E.buttons.clear} filter`,type:"button"});h.innerHTML=R.close,p.appendChild(h),l.appendChild(p)});let c=a.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});c.textContent=E.buttons.clearAll,l.appendChild(c),i.appendChild(l),r&&r.nextSibling?this.container.insertBefore(i,r.nextSibling):r?r.insertAdjacentElement("afterend",i):this.container.insertBefore(i,this.container.firstChild)},scrollToProducts(){if(s.scrollToProductsOnFilter===!1)return;let e=this.productsContainer||this.productsGrid||this.productsInfo;if(!e)return;let n=e.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight;n.top>=0&&n.top<=r||(e.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products section"))},showLoading(){this.showProductsSkeleton(),this.showFiltersSkeleton()},hideLoading(){var e;try{Array.isArray(this.loading)?(this.loading.forEach(n=>{n.parentNode&&n.remove()}),this.loading=null):(e=this.loading)!=null&&e.parentNode&&(this.loading.remove(),this.loading=null)}catch(n){}this.hideFiltersSkeleton()},showProductsSkeleton(){var t;if(!this.productsGrid)return;a.clear(this.productsGrid);let e=((t=s.pagination)==null?void 0:t.limit)||O.PAGE_SIZE||24,n=Math.max(e,24),r=[];for(let i=0;i<n;i++){let o=a.el("div","afs-skeleton-card");o.innerHTML=`
				<div class="afs-skeleton-card__image">&#8203;</div>
				<div class="afs-skeleton-card__info">
					<div class="afs-skeleton-card__title">&#8203;</div>
					<div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
					<div class="afs-skeleton-card__price">&#8203;</div>
				</div>
			`,r.push(o)}r.forEach(i=>this.productsGrid.appendChild(i)),this.loading=r},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let n=a.el("div","afs-filters-skeleton");for(let r=0;r<4;r++){let t=a.el("div","afs-skeleton-filter-group");t.innerHTML=`
				<div class="afs-skeleton-filter-group__header">
					<div class="afs-skeleton-filter-group__title">&#8203;</div>
				</div>
				<div class="afs-skeleton-filter-group__content">
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
				</div>
			`,n.appendChild(t)}this.filtersContainer.appendChild(n)},hideFiltersSkeleton(){var n;let e=(n=this.filtersContainer)==null?void 0:n.querySelector(".afs-filters-skeleton");e&&e.remove()},hideProductsSkeleton(){var n;let e=(n=this.filtersContainer)==null?void 0:n.querySelector(".afs-filters-skeleton");e&&e.remove()},showError(e){var i,o;if(!this.productsContainer&&(this.productsContainer=((i=this.container)==null?void 0:i.querySelector(".afs-products-container"))||null,!this.productsContainer&&this.container)){let l=this.container.querySelector(".afs-main-content");l&&(this.productsContainer=a.el("div","afs-products-container"),l.appendChild(this.productsContainer))}if(!this.productsContainer){u.error("Cannot show error: productsContainer not found",{message:e});return}this.hideLoading();let n=(o=s.fallbackProducts.length)!=null?o:0;if(s.fallbackProducts&&n>0){u.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:n}),s.products=s.fallbackProducts,s.pagination=te.getPagination(),this.renderProducts(s.products),s.pagination&&(this.renderInfo(s.pagination,s.pagination.total),this.renderPagination(s.pagination));return}let r=this.productsContainer.querySelector(".afs-error-message");r&&r.remove();let t=a.el("div","afs-error-message");t.textContent=e||E.messages.failedToLoad,this.productsGrid?(a.clear(this.productsGrid),this.productsGrid.appendChild(t)):this.productsContainer.appendChild(t),u.error("Error displayed",{message:e})},setSortSelectValue(){if(_.sortSelect){if(a.isBestSelling(s.sort.field))_.sortSelect.value="best-selling";else{let e=a.equals(s.sort.order,"asc")?"ascending":"descending";_.sortSelect.value=`${s.sort.field}-${e}`}u.debug("Sort select value updated programmatically",{value:_.sortSelect.value,sort:s.sort})}}},te={getPagination(){let n=H.parse().page||s.fallbackPagination.currentPage||1,r=s.fallbackPagination.totalPages||1,t=s.fallbackPagination.totalProducts||s.fallbackProducts.length||0;return{page:n,limit:O.PAGE_SIZE,total:t,totalPages:r}},reloadPage(e,n,r){let t=new URL(window.location.href);if(t.search="",r&&r.field)if(r.field==="best-selling"||r.field==="bestselling")t.searchParams.set("sort","best-selling");else{let i=a.equals(r.order,"asc")?"ascending":"descending";t.searchParams.set("sort",`${r.field}-${i}`)}n&&n.page&&t.searchParams.set("page",String(n.page)),Object.keys(e||{}).forEach(i=>{let o=e[i];if(!a.empty(o))if(Array.isArray(o)&&o.length>0)t.searchParams.set(i,o.join(","));else if(a.isPriceRangeKey(i)&&o&&typeof o=="object"&&!Array.isArray(o)){let l=o,c=typeof l.min=="number"&&!isNaN(l.min)?A(l.min):void 0,d=typeof l.max=="number"&&!isNaN(l.max)?A(l.max):void 0;s.priceRangeHandle?t.searchParams.set(s.priceRangeHandle,`${c!==void 0?c:""}-${d!==void 0?d:""}`):(c!==void 0&&t.searchParams.set("priceMin",String(c)),d!==void 0&&t.searchParams.set("priceMax",String(d)))}else a.equals(i,"search")&&typeof o=="string"&&o.trim()&&t.searchParams.set(i,o.trim())}),u.info("Reloading page for fallback mode",{url:t.toString(),sort:r,pagination:n}),window.location.href=t.toString()}};function Q(e){if(_.hideLoading(),u.error("Load failed",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,shop:s.shop,apiBaseURL:V.baseURL}),s.fallbackProducts&&s.fallbackProducts.length>0){if(u.warn("Initial load failed, using fallback products from Liquid",{error:e instanceof Error?e.message:String(e),fallbackCount:s.fallbackProducts.length}),s.usingFallback=!0,s.products=s.fallbackProducts,s.pagination=te.getPagination(),s.availableFilters=[],_.hideFilters(),_.sortSelect)if(a.isBestSelling(s.sort.field))_.sortSelect.value="best-selling";else{let n=a.equals(s.sort.order,"asc")?"ascending":"descending";_.sortSelect.value=`${s.sort.field}-${n}`}_.renderProducts(s.products),_.renderInfo(s.pagination,s.pagination.total),_.renderPagination(s.pagination),_.renderApplied(s.filters)}else _.showError(`${E.messages.failedToLoad}: ${e instanceof Error?e.message:E.messages.unknownError}. ${E.messages.checkConsole}`)}var J={process:e=>{var r,t,i;u.info("Products loaded",{count:((r=e.products)==null?void 0:r.length)||0,total:((t=e.pagination)==null?void 0:t.total)||0}),!(e.products&&Array.isArray(e.products)&&e.products.length>0)&&s.fallbackProducts&&s.fallbackProducts.length>0?(u.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((i=e.products)==null?void 0:i.length)||0,fallbackCount:s.fallbackProducts.length}),s.usingFallback=!0,s.products=s.fallbackProducts,s.pagination=te.getPagination(),s.availableFilters=[],_.hideFilters(),_.hideProductsSkeleton()):(s.usingFallback=!1,s.products=e.products||[],s.pagination=e.pagination||s.pagination,_.showFilters(),_.renderProducts(s.products)),J.updateUI()},updateUI:()=>{_.renderInfo(s.pagination,s.pagination.total||0),_.renderPagination(s.pagination),_.renderApplied(s.filters),_.setSortSelectValue()}},k={process:e=>{try{s.availableFilters=e.filters||[];try{s.filterMetadata=he.buildFilterMetadata(s.availableFilters)}catch(t){}let n=s.availableFilters.find(t=>a.isPriceRangeOptionType(t.optionType));s.priceRangeHandle=(n==null?void 0:n.handle)||s.priceRangeHandle||null,u.info("Filters set from URL",{filters:s.filters});let r=s.priceRangeHandle?s.filters[s.priceRangeHandle]:null;if(s.priceRangeHandle&&Array.isArray(r)&&r.length>0)try{let i=String(r[0]||"").split("-");if(i.length===2){let o=i[0].trim()?parseInt(i[0],10):void 0,l=i[1].trim()?parseInt(i[1],10):void 0,c=typeof o=="number"&&!isNaN(o)&&o>=0,d=typeof l=="number"&&!isNaN(l)&&l>=0;(c||d)&&(s.filters.priceRange={min:c?o:void 0,max:d?l:void 0},delete s.filters[s.priceRangeHandle])}}catch(t){}_.renderFilters(s.availableFilters),u.info("Filters rendered",{count:s.availableFilters.length})}catch(n){u.error("PROCESS FILTER ERROR",{error:n instanceof Error?n.message:String(n)})}finally{J.updateUI(),_.hideFiltersSkeleton()}},toggle(e,n){var l;let r=a.str(n);if(!r||!e){u.warn("Invalid filter toggle",{handle:e,value:n});return}let t=s.filters[e]||[],i=t.includes(r),o=i?t.filter(c=>c!==r):[...t,r];if(o.length===0?delete s.filters[e]:s.filters[e]=o,s.pagination.page=1,u.debug("Filter toggled",{handle:e,value:r,wasActive:i,isActive:!i,filterValues:o}),H.update(s.filters,s.pagination,s.sort),_.updateFilterState(e,r,!i),_.scrollToProducts(),_.showProductsSkeleton(),window.innerWidth<=768&&((l=_.filtersContainer)!=null&&l.classList.contains("afs-filters-container--open"))){_.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),_.mobileFilterBackdrop&&(_.mobileFilterBackdrop.style.display="none"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top");let c=document.body.style.top;c&&window.scrollTo(0,parseInt(c||"0",10)*-1),window.innerWidth<=767&&_.mobileResultsButton&&s.pagination.total>0&&_.mobileResultsButton.classList.add("afs-mobile-results-button--visible")}this.apply()},updatePriceRange(e,n){if(e=A(e),n=A(n),typeof e!="number"||typeof n!="number"||e<0||n<e){u.warn("Invalid price range",{min:e,max:n});return}let r=s.availableFilters.find(t=>a.isPriceRangeOptionType(t.optionType)||a.equals(t.optionKey,"priceRange"));if(r&&r.range){let t=A(r.range.min),i=A(r.range.max);e===t&&n===i?s.filters.priceRange=null:s.filters.priceRange={min:e,max:n}}else s.filters.priceRange={min:e,max:n};s.pagination.page=1,u.debug("Price range updated",{min:e,max:n,priceRange:s.filters.priceRange}),H.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showProductsSkeleton(),this.apply()},applyProductsOnly:a.debounce(async()=>{if(u.info("applyProductsOnly called",{filters:s.filters,pagination:s.pagination,sort:s.sort,usingFallback:s.usingFallback}),s.usingFallback){u.info("In fallback mode, reloading page with new parameters"),te.reloadPage(s.filters,s.pagination,s.sort);return}_.scrollToProducts(),V.products(s.filters,s.pagination,s.sort).then(J.process)},O.DEBOUNCE),apply:a.debounce(async()=>{_.scrollToProducts(),V.products(s.filters,s.pagination,s.sort).then(J.process).catch(Q).finally(()=>{_.hideProductsSkeleton()}),V.filters(s.filters).then(k.process).catch(Q).finally(()=>{_.hideFiltersSkeleton()})},O.DEBOUNCE)},pe={async add(e,n){try{let r=`/products/${e}.json`,t=await fetch(r);if(!t.ok)throw new Error(E.messages.failedToLoadProduct);let o=(await t.json()).product;if(!o||!o.variants||o.variants.length===0)throw new Error("Product has no variants");let l=o.variants.find(c=>c.available)||o.variants[0];await this.addVariant(Number(l.id),1)}catch(r){u.error("Quick add failed",{error:r instanceof Error?r.message:String(r),handle:e}),_.showError("Failed to add product to cart. Please try again.")}},async addFromForm(e,n){var r,t;try{let i=new FormData(e),o=i.get("id"),l=parseInt(((r=i.get("quantity"))==null?void 0:r.toString())||"1",10);if(o)await this.addVariant(Number(o),l);else{let c=[];for(let T=1;T<=3;T++){let C=i.get(`option${T}`);C&&c.push(C.toString())}let d=`/products/${n}.json`,g=(t=(await(await fetch(d)).json()).product.variants)==null?void 0:t.find(T=>T.options?T.options.length===c.length&&T.options.every((C,y)=>C===c[y]):!1);if(g)await this.addVariant(Number(g.id),l);else throw new Error("Variant not found")}}catch(i){u.error("Add from form failed",{error:i instanceof Error?i.message:String(i)}),_.showError("Failed to add product to cart. Please try again.")}},async addVariant(e,n){try{let r=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:n})});if(!r.ok){let t=await r.json();throw new Error(t.description||E.messages.failedToAddToCart)}await r.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(r){throw u.error("Add variant failed",{error:r instanceof Error?r.message:String(r),variantId:e}),r}},showSuccess(){let e=document.querySelector(".afs-cart-toast");if(!e){e=a.el("div","afs-cart-toast");let r=a.el("div","afs-cart-toast__content"),t=a.el("div","afs-cart-toast__icon");t.innerHTML=`
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
				</svg>
			`;let i=a.el("div","afs-cart-toast__message");i.textContent=E.messages.addedToCart||"Product added to cart!";let o=a.el("button","afs-cart-toast__close");o.setAttribute("type","button"),o.setAttribute("aria-label","Close"),o.innerHTML=`
				<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
				</svg>
			`,r.appendChild(t),r.appendChild(i),e.appendChild(r),e.appendChild(o),document.body.appendChild(e),o.addEventListener("click",()=>{e==null||e.classList.remove("afs-cart-toast--show")})}e.classList.add("afs-cart-toast--show");let n=setTimeout(()=>{e==null||e.classList.remove("afs-cart-toast--show")},4e3);e._timeoutId=n}},ue={init(e={}){var n,r,t,i;try{if(u.init(e.debug),u.info("Initializing AFS",e),e.apiBaseUrl&&(V.setBaseURL(e.apiBaseUrl),u.info("API base URL set",{url:V.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");if(s.shop=e.shop,s.collections=e.collections||[],s.selectedCollection={id:(r=(n=e.selectedCollection)==null?void 0:n.id)!=null?r:null,sortBy:(i=(t=e.selectedCollection)==null?void 0:t.sortBy)!=null?i:null},s.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.isSearchTemplate&&(window.AFS_Config={isSearchTemplate:!0}),e.initialSearchQuery){let d=H.parse();!d.search&&!d.q&&(s.filters.search=e.initialSearchQuery)}e.moneyFormat&&(s.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(s.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(s.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(s.fallbackProducts=e.fallbackProducts,u.info("Fallback products loaded from Liquid",{count:s.fallbackProducts.length})),e.fallbackPagination&&(s.fallbackPagination=e.fallbackPagination,u.info("Fallback pagination loaded from Liquid",{currentPage:s.fallbackPagination.currentPage,totalPages:s.fallbackPagination.totalPages,totalProducts:s.fallbackPagination.totalProducts})),e.priceRangeHandle!==void 0&&(s.priceRangeHandle=e.priceRangeHandle),u.info("Shop set",{shop:s.shop}),u.info("Collections set",{collections:s.collections});let o=e.containerSelector||e.container||"[data-afs-container]",l=e.filtersSelector||e.filtersContainer,c=e.productsSelector||e.productsContainer;_.init(o,l,c),u.info("DOM initialized"),_.showLoading(),_.attachEvents(),u.info("DOM events attached"),this.load()}catch(o){throw u.error("Initialization failed",{error:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0,config:e}),_.container&&_.showError(`Initialization failed: ${o instanceof Error?o.message:String(o)}`),o}},async load(){_.showLoading();try{let e=H.parse();u.debug("Parsed URL params on load",{urlParams:e}),V.buildFiltersFromUrl(e),V.setPaginationFromUrl(e),V.setSortFromUrl(e),u.info("Loading products & filters...",{shop:s.shop,filters:s.filters}),V.filters(s.filters).then(k.process).catch(Q).finally(()=>{_.hideFiltersSkeleton()}),V.products(s.filters,s.pagination,s.sort).then(J.process).catch(Q).finally(()=>{_.hideFiltersSkeleton()})}catch(e){Q(e)}},Logger:u,detectDevice:de},oe=class{constructor(n,r={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.currentZoom=2;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let t=typeof n=="string"?document.querySelector(n):n;if(!t)throw u.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=t,this.options={thumbnailsPosition:r.thumbnailsPosition||"left",enableKeyboard:r.enableKeyboard!==!1,enableAutoHeight:r.enableAutoHeight!==!1,maxHeight:r.maxHeight||null,animationDuration:r.animationDuration||300,enableMagnifier:r.enableMagnifier!==!1,magnifierZoom:r.magnifierZoom||3,...r},this.magnifierEnabled=this.options.enableMagnifier,this.currentZoom=this.options.magnifierZoom||3,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){u.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){u.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let n=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(n),this.images.length===0){u.error("AFSSlider: No images found");return}let r=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(r),this.thumbnails.length===0&&u.warn("AFSSlider: No thumbnails found, continuing without thumbnails"),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(t){u.error("AFSSlider: Error building slider structure",{error:t instanceof Error?t.message:String(t)});return}try{this.setupEvents()}catch(t){u.error("AFSSlider: Error setting up events",{error:t instanceof Error?t.message:String(t)})}if(this.magnifierEnabled&&!this.isTouchDevice)try{setTimeout(()=>{this.setupPanZoom()},0)}catch(t){u.error("AFSSlider: Error setting up pan-zoom",{error:t instanceof Error?t.message:String(t)})}if(this.isTouchDevice)try{this.setupPinchZoom()}catch(t){u.error("AFSSlider: Error setting up pinch-zoom",{error:t instanceof Error?t.message:String(t)})}try{this.goToSlide(0)}catch(t){u.error("AFSSlider: Error showing first slide",{error:t instanceof Error?t.message:String(t)})}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let t=document.createElement("div");t.className="afs-slider__viewport",this.images.forEach(i=>{t.appendChild(i)}),this.mainContainer.appendChild(t),this.magnifierEnabled&&!this.isTouchDevice&&this.createZoomControls(t)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let t=document.createElement("button");t.type="button",t.className="afs-slider__prev",t.setAttribute("aria-label","Previous image"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(t)}if(!this.mainContainer.querySelector(".afs-slider__next")){let t=document.createElement("button");t.type="button",t.className="afs-slider__next",t.setAttribute("aria-label","Next image"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(t)}if(this.thumbnails.length===0&&this.thumbnailContainer){let t=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(t)}this.thumbnails.forEach((t,i)=>{var l;let o=t.cloneNode(!0);(l=t.parentNode)==null||l.replaceChild(o,t),this.thumbnails[i]=o,o.addEventListener("click",()=>{this.goToSlide(i)})});let n=this.mainContainer.querySelector(".afs-slider__prev"),r=this.mainContainer.querySelector(".afs-slider__next");n&&n.addEventListener("click",()=>this.prevSlide()),r&&r.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=n=>{if(!this.isInitialized)return;let r=this.container.getBoundingClientRect();if(!(r.width===0||r.height===0))switch(n.key){case"ArrowLeft":n.preventDefault(),this.prevSlide();break;case"ArrowRight":n.preventDefault(),this.nextSlide();break;case"Escape":let t=this.images[this.currentIndex];t&&(t.classList.remove("afs-slider__image--zoomed"),t.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{t.classList.remove("afs-slider__image--zoom-reset")},200));break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let n=0,r=0,t=!1,i=this.mainContainer.querySelector(".afs-slider__viewport");i&&(i.addEventListener("touchstart",o=>{n=o.touches[0].clientX,r=o.touches[0].clientY,t=!0},{passive:!0}),i.addEventListener("touchmove",o=>{t&&o.preventDefault()},{passive:!1}),i.addEventListener("touchend",o=>{if(!t)return;t=!1;let l=o.changedTouches[0].clientX,c=o.changedTouches[0].clientY,d=n-l,p=r-c;Math.abs(d)>Math.abs(p)&&Math.abs(d)>50&&(d>0?this.nextSlide():this.prevSlide())},{passive:!0}))}createZoomControls(n){let r=document.createElement("div");r.className="afs-slider__zoom-controls";let t=document.createElement("input");t.type="range",t.className="afs-slider__zoom-slider",t.setAttribute("min","2"),t.setAttribute("max","5"),t.setAttribute("step","1"),t.setAttribute("value",String(this.currentZoom)),t.setAttribute("aria-label","Zoom level"),t.setAttribute("aria-valuemin","2"),t.setAttribute("aria-valuemax","5"),t.addEventListener("input",i=>{i.stopPropagation();let o=Number(i.target.value);this.setZoomLevel(o)}),t.addEventListener("mousedown",i=>{i.stopPropagation()}),r.appendChild(t),n.appendChild(r)}setZoomLevel(n){var i;this.currentZoom=n;let r=(i=this.mainContainer)==null?void 0:i.querySelector(".afs-slider__viewport");if(r){let o=r.querySelector(".afs-slider__zoom-slider");o&&(o.value=String(n),o.setAttribute("aria-valuenow",String(n)))}let t=this.images[this._currentIndex];t&&t.classList.contains("afs-slider__image--zoomed")&&(t.style.transform="scale(1) translate(0, 0)",setTimeout(()=>{},50))}setupPanZoom(){if(!this.mainContainer)return;let n=this.mainContainer.querySelector(".afs-slider__viewport");if(!n){u.warn("AFSSlider: Viewport not found for pan-zoom, skipping zoom setup");return}n.classList.add("afs-slider__viewport--zoomable"),n.addEventListener("mousemove",r=>{let t=this.images[this._currentIndex];if(!t)return;let i=n.getBoundingClientRect(),o=r.clientX-i.left,l=r.clientY-i.top,c=o/i.width,d=l/i.height,p=this.currentZoom,h=-c*(t.offsetWidth*p-i.width),f=-d*(t.offsetHeight*p-i.height);t.style.transform=`
		scale(${p})
		translate(${h/p}px, ${f/p}px)
	  `,t.classList.add("afs-slider__image--zoomed")}),n.addEventListener("mouseenter",()=>{let r=this.images[this._currentIndex];r&&r.classList.add("afs-slider__image--zoomed")}),n.addEventListener("mouseleave",()=>{let r=this.images[this._currentIndex];r&&(r.style.transform="scale(1) translate(0, 0)",r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200))})}setupPinchZoom(){if(!this.mainContainer||!this.isTouchDevice)return;let n=this.mainContainer.querySelector(".afs-slider__viewport");if(!n)return;let r=0,t=1,i=0,o=null;n.addEventListener("touchstart",l=>{if(l.touches.length===2){l.preventDefault();let c=l.touches[0],d=l.touches[1];r=Math.hypot(d.clientX-c.clientX,d.clientY-c.clientY);let p=this.images[this._currentIndex];if(p){let f=(p.style.transform||"").match(/scale\(([\d.]+)\)/);t=f?parseFloat(f[1]):1}}else if(l.touches.length===1){let c=Date.now();if(c-i<300){l.preventDefault(),o&&clearTimeout(o);let d=this.images[this._currentIndex];if(d){let h=(d.style.transform||"").match(/scale\(([\d.]+)\)/),f=h?parseFloat(h[1]):1;if(f>1)d.style.transform="scale(1) translate(0, 0)",f=1;else{let g=n.getBoundingClientRect(),T=l.touches[0],C=T.clientX-g.left,y=T.clientY-g.top,m=2.5;d.style.transform=`scale(${m}) translate(${(g.width/2-C)/m}px, ${(g.height/2-y)/m}px)`,f=m}}}else i=c}},{passive:!1}),n.addEventListener("touchmove",l=>{if(l.touches.length===2){l.preventDefault();let c=l.touches[0],d=l.touches[1],p=Math.hypot(d.clientX-c.clientX,d.clientY-c.clientY),h=Math.max(1,Math.min(4,t*(p/r))),f=this.images[this._currentIndex];if(f){let g=n.getBoundingClientRect(),T=(c.clientX+d.clientX)/2-g.left,C=(c.clientY+d.clientY)/2-g.top,y=(g.width/2-T)/h,m=(g.height/2-C)/h;f.style.transform=`scale(${h}) translate(${y}px, ${m}px)`}}},{passive:!1}),n.addEventListener("touchend",()=>{r=0})}goToSlide(n){if(n<0||n>=this.images.length)return;this._currentIndex=n,this.images.forEach((t,i)=>{i===n?t.classList.add("afs-slider__image--active"):t.classList.remove("afs-slider__image--active")});let r=this.images[this._currentIndex];r&&(r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200)),this.thumbnails.forEach((t,i)=>{t.classList.toggle("afs-slider__thumbnail--active",i===n)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:n,total:this.images.length}}))}prevSlide(){let n=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(n)}nextSlide(){let n=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(n)}adjustHeight(){let n=this.images[this._currentIndex];n&&(n.complete?this.setHeight(n):n.addEventListener("load",()=>{this.setHeight(n)},{once:!0}))}setHeight(n){if(!this.mainContainer)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r)return;if(this.options.maxHeight){r.style.height=`${this.options.maxHeight}px`,r.style.minHeight=`${this.options.maxHeight}px`,r.style.maxHeight=`${this.options.maxHeight}px`;return}let t=n.naturalHeight||n.offsetHeight,i=n.naturalWidth||n.offsetWidth,o=this.mainContainer.offsetWidth,l=t/i,c=o*l;r.style.height=`${c}px`,r.style.minHeight=`${c}px`}updateVariantImage(n,r,t){var h;if(!n||!r||!Array.isArray(r)||r.length===0)return!1;let i=n.id;if(t&&Array.isArray(t)){if(n.featured_image&&typeof n.featured_image=="object"&&n.featured_image.variant_ids){let f=n.featured_image.position;if(f!=null){let g=f-1;if(g>=0&&g<this.images.length&&g<r.length)return this._currentIndex!==g&&this.goToSlide(g),!0}}for(let f of t)if(f.featured_image&&typeof f.featured_image=="object"&&f.featured_image.variant_ids&&f.featured_image.variant_ids.includes(Number(i))){let g=f.featured_image.position;if(g!=null){let T=g-1;if(T>=0&&T<this.images.length&&T<r.length)return this._currentIndex!==T&&this.goToSlide(T),!0}}}let o=null,l=null;if(n.featured_image&&(typeof n.featured_image=="object"?(o=n.featured_image.src||n.featured_image.url||null,l=(h=n.featured_image.position)!=null?h:null):typeof n.featured_image=="string"&&(o=n.featured_image)),o||(typeof n.image=="string"?o=n.image:n.image&&typeof n.image=="object"?o=n.image.url||n.image.src||null:n.imageUrl?o=n.imageUrl:n.featuredImage&&typeof n.featuredImage=="object"&&(o=n.featuredImage.url||n.featuredImage.src||null)),!o)return!1;let c=f=>f?(typeof f=="string"?f:(f==null?void 0:f.url)||(f==null?void 0:f.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",d=c(o);if(l!=null){let f=l-1;if(f>=0&&f<this.images.length&&f<r.length)return this._currentIndex!==f&&this.goToSlide(f),!0}let p=r.findIndex(f=>{let g=c(f);return g===d||g.includes(d)||d.includes(g)});if(p===-1){let f=d.split("/").pop();p=r.findIndex(g=>c(g).split("/").pop()===f)}return p!==-1&&p<this.images.length?(this._currentIndex!==p&&this.goToSlide(p),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(n=>{n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200)}),this.isInitialized=!1}};async function ye(e,n){var l,c,d,p,h,f,g,T,C,y,m,b;let r=a.el("dialog","afs-product-modal",{id:n}),t=((c=(l=E)==null?void 0:l.labels)==null?void 0:c.loadingProduct)||"Loading product...";r.innerHTML=`
	  <div class="afs-product-modal__container">
		<div class="afs-product-modal__close-container">
		  <button class="afs-product-modal__close" type="button">${R.close}</button>
		</div>
		<div class="afs-product-modal__content">
		  <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
			${t}
		  </div>
		</div>
	  </div>
	`;let o=`${((p=(d=window==null?void 0:window.Shopify)==null?void 0:d.routes)==null?void 0:p.root)||"/"}products/${e}.js`;try{let S=await fetch(o);if(!S.ok){let P=await S.text().catch(()=>""),D=`Failed to load product: HTTP ${S.status} ${S.statusText}${P?" - "+P.substring(0,100):""}`;throw u.error("Product fetch failed",{status:S.status,statusText:S.statusText,url:o,errorText:P}),new Error(D)}let v=await S.json();if(!v.variants||!Array.isArray(v.variants))throw new Error("Invalid product data structure");let w=v.variants.find(P=>j(P))||v.variants[0],x=w?w.id:null,L=()=>{if(!v.variants||v.variants.length===0)return"";if(v.variants.length===1){let F=v.variants[0].title;if(F&&a.equals(F,"Default Title"))return""}if(!v.options||v.options.length===0)return"";let P='<div class="afs-product-modal__variant-selector">';return v.options.forEach((D,F)=>{var X;P+='<div class="afs-product-modal__option-group">',P+=`<label class="afs-product-modal__option-label">${D.name}</label>`,P+='<div class="afs-product-modal__option-values">';let G=[...new Set(v.variants.map(I=>F===0?I.option1:F===1?I.option2:I.option3).filter(Boolean))],Y=Array.from({length:((X=v.options)==null?void 0:X.length)||0},(I,B)=>B===F||!w?null:B===0?w.option1||null:B===1?w.option2||null:w.option3||null);G.forEach(I=>{if(!I)return;let B=ie(v,F,I,Y),W=w&&(F===0&&w.option1===I||F===1&&w.option2===I||F===2&&w.option3===I),re=v.variants.find(ne=>F===0?ne.option1===I:F===1?ne.option2===I:ne.option3===I);P+=`<button 
			  class="afs-product-modal__option-value ${W?"afs-product-modal__option-value--selected":""} ${B?"":"afs-product-modal__option-value--unavailable"}"
			  data-option-index="${F}"
			  data-option-value="${I}"
			  data-variant-id="${re?re.id:""}"
			  ${B?"":"disabled"}
			  type="button"
			>${I}</button>`}),P+="</div></div>"}),P+="</div>",P},$=(()=>{if(!v.images||v.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let P='<div class="afs-slider__thumbnails">';v.images.forEach((F,G)=>{let Y=G===0?"afs-slider__thumbnail--active":"",X=a.optimizeImageUrl(F,{width:100,height:100,crop:"center",format:"webp",quality:75}),B=[80,100,120].map(W=>`${a.optimizeImageUrl(F,{width:W,height:W,crop:"center",format:"webp",quality:75})} ${W}w`).join(", ");P+=`
			<div class="afs-slider__thumbnail ${Y}" data-slide-index="${G}">
			  <img 
				src="${X}" 
				srcset="${B}"
				sizes="100px"
				alt="${v.title} - Thumbnail ${G+1}" 
				loading="lazy"
				width="100"
				height="100"
			  />
			</div>
		  `}),P+="</div>";let D='<div class="afs-slider__main">';return v.images.forEach((F,G)=>{let Y=a.optimizeImageUrl(F,{width:800,height:800,format:"webp",quality:85}),I=[400,600,800,1e3,1200].map(B=>`${a.optimizeImageUrl(F,{width:B,height:B,format:"webp",quality:B<=600?80:85})} ${B}w`).join(", ");D+=`
			<img 
			  class="afs-slider__image" 
			  src="${Y}" 
			  srcset="${I}"
			  sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
			  alt="${v.title} - Image ${G+1}" 
			  loading="${G===0?"eager":"lazy"}"
			/>
		  `}),D+="</div>",{thumbnails:P,mainImages:D}})(),K=L(),q=v.variants.find(P=>P.id===x)||w,Z=a.formatMoney(q.price,s.moneyFormat),N=q.compare_at_price&&q.compare_at_price>q.price?`<span class="afs-product-modal__compare-price">${a.formatMoney(q.compare_at_price,s.moneyFormat)}</span>`:"";r.innerHTML=`
		<div class="afs-product-modal__container">
		  <div class="afs-product-modal__close-container">
			<button class="afs-product-modal__close" type="button">${R.close}</button>
		  </div>
		  <div class="afs-product-modal__content">
			<div class="afs-product-modal__layout">
			  <div class="afs-product-modal__media">
				<div class="afs-slider" id="${n}-slider">
				  ${$.mainImages}
				  ${$.thumbnails}
				</div>
			  </div>
			  <div class="afs-product-modal__details">
				<div class="afs-product-modal__header">
				  <div>
					<span class="afs-product-modal__vendor">${v.vendor||""}</span>
				  </div>
				  <h1 class="afs-product-modal__title">${v.title||""}</h1>
				  <div class="afs-product-modal__price-container">
					<span class="afs-product-modal__price">${Z}</span>
					${N}
				  </div>
				</div>
				${K}
				<div class="afs-product-modal__buttons">
				  <div class="afs-product-modal__add-to-cart">
					<div class="afs-product-modal__incrementor">
					  <button class="afs-product-modal__decrease" type="button">${R.minus}</button>
					  <span class="afs-product-modal__count" id="${n}-count">1</span>
					  <button class="afs-product-modal__increase" type="button">${R.plus}</button>
					</div>
					<button
					  class="afs-product-modal__add-button"
					  id="${n}-add-button"
					  data-variant-id="${x}"
					  ${j(q)?"":"disabled"}
					  type="button"
					>
					  ${j(q)?((T=(g=E)==null?void 0:g.buttons)==null?void 0:T.addToCart)||"Add to cart":((f=(h=E)==null?void 0:h.buttons)==null?void 0:f.soldOut)||"Sold out"}
					</button>
				  </div>
				  <button
					class="afs-product-modal__buy-button"
					id="${n}-buy-button"
					data-variant-id="${x}"
					${j(q)?"":"disabled"}
					type="button"
				  >
					${((y=(C=E)==null?void 0:C.buttons)==null?void 0:y.buyNow)||"Buy it now"}
				  </button>
				</div>
				<div class="afs-product-modal__description">
				  <span class="afs-product-modal__description-text">
					${v.description||""}
				  </span>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  `,r._productData=v,r._currentVariantId=x||void 0,(async()=>{try{let P=await ee(`#${n}-slider`,r,3e3),D=await ae(Array.from({length:10},(F,G)=>`.afs-slider__image:nth-child(${G+1})`),P,2e3).catch(()=>Array.from(P.querySelectorAll(".afs-slider__image")));await ee(".afs-slider__thumbnails",P,1e3).catch(()=>{u.warn("Thumbnails container not found, slider will continue without thumbnails",{modalId:n})}),D.length>0?r._slider=new oe(P,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}):u.warn("No images found for slider",{modalId:n})}catch(P){u.error("Failed to initialize slider",{error:P instanceof Error?P.message:String(P),modalId:n})}})(),be(r,n,v,P=>{let D=typeof P=="string"?parseFloat(P):P;return a.formatMoney(D,s.moneyFormat||"{{amount}}",s.currency||"")})}catch(S){let v=S instanceof Error?S.message:String(S),w=S instanceof Error?{message:v,stack:S.stack}:{message:v};u.error("Failed to load product for modal",{error:w,handle:e,productUrl:o,responseStatus:S instanceof Error&&"status"in S?S.status:void 0});let x=((b=(m=E)==null?void 0:m.messages)==null?void 0:b.failedToLoadProductModal)||"Failed to load product. Please try again.";r.innerHTML=`
		<div class="afs-product-modal__container">
		  <div class="afs-product-modal__close-container">
			<button class="afs-product-modal__close" type="button">${R.close}</button>
		  </div>
		  <div class="afs-product-modal__content">
			<div style="padding: 2rem; text-align: center;">
			  <p>${x}</p>
			  ${u.enabled?`<p style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">Error: ${v}</p>`:""}
			</div>
		  </div>
		</div>
	  `;let L=r.querySelector(".afs-product-modal__close"),M=()=>{r._slider&&typeof r._slider.destroy=="function"&&(r._slider.destroy(),r._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),r.close?r.close():r.style.display="none"};L&&L.addEventListener("click",$=>{$.preventDefault(),$.stopPropagation(),M()}),r.addEventListener("cancel",M),r.addEventListener("click",$=>{$.target===r&&M()})}return r}function be(e,n,r,t){let i=e.querySelector(".afs-product-modal__close"),o=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};i&&i.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),o()}),e.addEventListener("cancel",g=>{g.preventDefault(),o()}),e.addEventListener("click",g=>{g.target===e&&o()});let l=e.querySelector(".afs-product-modal__decrease"),c=e.querySelector(".afs-product-modal__increase"),d=e.querySelector(`#${n}-count`);l&&d&&l.addEventListener("click",()=>{let g=parseInt(d.textContent||"1",10)||1;g>1&&(d.textContent=String(g-1))}),c&&d&&c.addEventListener("click",()=>{let g=parseInt(d.textContent||"1",10)||1;d.textContent=String(g+1)}),e.querySelectorAll(".afs-product-modal__option-value").forEach(g=>{g.addEventListener("click",()=>{if(g.disabled)return;let T=Number(g.dataset.optionIndex),C=g.dataset.optionValue,y=le(e,r.options.length);y[T]=C,e.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${T}"]`).forEach(v=>v.classList.remove("afs-product-modal__option-value--selected")),g.classList.add("afs-product-modal__option-value--selected"),e.querySelectorAll(".afs-product-modal__option-value").forEach(v=>{let w=Number(v.dataset.optionIndex),x=v.dataset.optionValue,L=ie(r,w,x,y);v.disabled=!L,v.classList.toggle("afs-product-modal__option-value--unavailable",!L)});let m=ce(r.variants,y),S=m.find(v=>j(v))||m[0];if(S)if(e._slider)se(e,n,S,t);else{let v=(w=0)=>{e._slider?se(e,n,S,t):w<20?setTimeout(()=>v(w+1),100):(u.warn("Slider not ready for variant update",{modalId:n}),se(e,n,S,t))};v()}else u.warn("No matching variant found for selected options",{selected:y.filter(Boolean),matchesCount:m.length})})});let h=e.querySelector(`#${n}-add-button`);h&&d&&h.addEventListener("click",async()=>{var C,y;if(h.disabled)return;let g=parseInt(d.textContent||"1",10)||1,T=h.dataset.variantId;try{await pe.addVariant(parseInt(T||"0",10),g),o()}catch(m){u.error("Failed to add to cart from modal",{error:m instanceof Error?m.message:String(m)}),_.showError(((y=(C=E)==null?void 0:C.messages)==null?void 0:y.failedToAddToCart)||"Failed to add product to cart. Please try again.")}});let f=e.querySelector(`#${n}-buy-button`);f&&d&&f.addEventListener("click",async()=>{var C,y,m,b;if(f.disabled)return;let g=parseInt(d.textContent||"1",10)||1,T=f.dataset.variantId;try{let S=((y=(C=window==null?void 0:window.Shopify)==null?void 0:C.routes)==null?void 0:y.root)||"/";window.location.href=`${S}cart/${T}:${g}?checkout`}catch(S){u.error("Failed to buy now",{error:S instanceof Error?S.message:String(S)}),_.showError(((b=(m=E)==null?void 0:m.messages)==null?void 0:b.failedToProceedToCheckout)||"Failed to proceed to checkout. Please try again.")}})}function se(e,n,r,t){var d,p,h,f;e._currentVariantId=r.id;let i=e.querySelector(".afs-product-modal__price-container");if(i){let g=t(r.price),T=r.compare_at_price&&r.compare_at_price>r.price?`<span class="afs-product-modal__compare-price">${t(r.compare_at_price)}</span>`:"";i.innerHTML=`
        <span class="afs-product-modal__price">${g}</span>
        ${T}
      `}let o=e.querySelector(`#${n}-add-button`);if(o){let g=j(r);o.dataset.variantId=String(r.id),o.disabled=!g,o.innerHTML=g?((f=(h=E)==null?void 0:h.buttons)==null?void 0:f.addToCart)||"Add to cart":((p=(d=E)==null?void 0:d.buttons)==null?void 0:p.soldOut)||"Sold out"}let l=e.querySelector(`#${n}-buy-button`);if(l){let g=j(r);l.dataset.variantId=String(r.id),l.disabled=!g}let c=e._productData;if(c&&c.images&&c.variants){if(!e._slider){u.debug("Slider not ready, skipping image update",{variantId:r.id});return}let g=r.id,T=null;if(r.featured_image&&typeof r.featured_image=="object"&&r.featured_image.variant_ids){let m=r.featured_image.position;if(m!=null){let b=m-1;b>=0&&b<c.images.length&&(e._slider.currentIndex||0)!==b&&(T=b)}}else for(let m of c.variants)if(m.featured_image&&typeof m.featured_image=="object"&&m.featured_image.variant_ids&&m.featured_image.variant_ids.includes(Number(g))){let b=m.featured_image.position;if(b!=null){let S=b-1;if(S>=0&&S<c.images.length&&(e._slider.currentIndex||0)!==S){T=S;break}}}if(T!==null&&e._slider.goToSlide){e._slider.goToSlide(T);return}if(e._slider.updateVariantImage&&c.images&&e._slider.updateVariantImage(r,c.images,c.variants))return;let C=null,y=null;if(r.featured_image&&(typeof r.featured_image=="object"?(C=r.featured_image.src||r.featured_image.url||null,y=r.featured_image.position||null):typeof r.featured_image=="string"&&(C=r.featured_image)),C||(C=(typeof r.image=="string"?r.image:null)||r.imageUrl||r.image&&typeof r.image=="object"&&(r.image.url||r.image.src)||null||r.featuredImage&&typeof r.featuredImage=="object"&&(r.featuredImage.url||r.featuredImage.src)||null),C&&c.images&&e._slider.goToSlide){let m=v=>v?(typeof v=="string"?v:v&&typeof v=="object"&&(v.url||v.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(y!=null){let v=y-1;if(v>=0&&v<c.images.length){e._slider.goToSlide(v);return}}let b=m(C),S=c.images.findIndex(v=>{let w=m(v);return w===b||w.includes(b)||b.includes(w)});if(S!==-1)e._slider.goToSlide(S);else{let v=b.split("/").pop();if(v){let w=c.images.findIndex(x=>m(x).split("/").pop()===v);w!==-1&&e._slider.goToSlide&&e._slider.goToSlide(w)}}}}}function ve(e){var i,o;if(!e.handle)return null;let n=((o=(i=E)==null?void 0:i.buttons)==null?void 0:o.quickView)||"Quick view",r=a.el("button","afs-product-card__quick-view",{"data-product-handle":e.handle,"data-product-id":String(e.id||e.productId||e.gid||""),"aria-label":n,type:"button"}),t=a.el("span","afs-product-card__quick-view-icon");return t.innerHTML=R.eye,r.appendChild(t),r}function Te(e){if(!e)return;let n=`product-modal-${e}`,r=document.getElementById(n);(async()=>{r||(r=await ye(e,n),document.body.appendChild(r)),r.showModal?(document.body.style.overflow="hidden",r.showModal()):(document.body.style.overflow="hidden",r.style.display="block");let i=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};r.addEventListener("close",i,{once:!0});let o=new MutationObserver(()=>{r&&!r.open&&!r.hasAttribute("open")&&(i(),o.disconnect())});r&&o.observe(r,{attributes:!0,attributeFilter:["open"]})})().catch(i=>{var c,d;let o=i instanceof Error?i.message:String(i);u.error("Failed to open product modal",{error:o,handle:e,stack:i instanceof Error?i.stack:void 0});let l=((d=(c=E)==null?void 0:c.messages)==null?void 0:d.failedToLoadProductModal)||"Failed to load product. Please try again.";_&&typeof _.showError=="function"?_.showError(l):alert(l)})}typeof window!="undefined"?window.AFS=ue:typeof global!="undefined"&&(global.AFS=ue);
