"use strict";var F={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'};var H={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24};var C={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",soldOut:"Sold out",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}};var o={debounce:(e,r)=>{let n;return(...t)=>{n!==void 0&&clearTimeout(n),n=setTimeout(()=>e(...t),r)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.selectionType),"multiple")||o.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(r=>String(r).trim()).filter(Boolean):String(e).split(",").map(r=>r.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let r=e.productId||e.id||e.gid;return r&&String(r).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,r,n={})=>{let t=document.createElement(e);return r&&(t.className=r),Object.entries(n).forEach(([i,a])=>t.setAttribute(i,a)),t},txt:(e,r)=>(e.textContent=r,e),clear:e=>{for(;e.firstChild;){let r=e.firstChild;r&&e.removeChild(r)}},frag:(e,r)=>{let n=document.createDocumentFragment();return e.forEach(t=>n.appendChild(r(t))),n},optimizeImageUrl:(e,r={})=>{if(!e||typeof e!="string")return"";let{width:n=500,height:t=n,quality:i=80,format:a="webp",crop:l=null}=r;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let c=new URL(e),f=new URLSearchParams(c.search);return f.delete("width"),f.delete("height"),f.delete("crop"),f.delete("format"),f.delete("quality"),f.set("width",String(n)),f.set("height",String(t)),l&&f.set("crop",l),i!==100&&f.set("quality",String(i)),!c.pathname.toLowerCase().endsWith(".gif")&&a&&f.set("format",a),`${c.origin}${c.pathname}?${f.toString()}`}catch(c){return e}},buildImageSrcset:(e,r=[200,300,500])=>e?r.map(n=>`${o.optimizeImageUrl(e,{width:n,format:"webp",quality:n<=200?75:n<=300?80:85})} ${n}w`).join(", "):"",formatMoney:(e,r,n="")=>{if(isNaN(Number(e)))return"";let t=parseFloat(String(e))/100;if(!r||typeof r!="string")return`${n||""}${t.toFixed(2)}`;let i=t.toFixed(2);return r.includes("{{amount_no_decimals}}")?(i=Math.round(t).toString(),r.replace("{{amount_no_decimals}}",i)):r.includes("{{amount_with_comma_separator}}")?(i=t.toFixed(2).replace(".",","),r.replace("{{amount_with_comma_separator}}",i)):r.includes("{{amount_no_decimals_with_comma_separator}}")?(i=Math.round(t).toString(),r.replace("{{amount_no_decimals_with_comma_separator}}",i)):r.includes("{{amount_with_apostrophe_separator}}")?(i=t.toFixed(2).replace(".","'"),r.replace("{{amount_with_apostrophe_separator}}",i)):r.replace("{{amount}}",i)},equals:(e,r)=>e===r?!0:e==null||r===null||r===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(r)&&(r=r.join(",")),typeof e=="string"&&typeof r=="string"?e.trim().toLowerCase()===r.trim().toLowerCase():typeof e=="number"&&typeof r=="number"||typeof e=="boolean"&&typeof r=="boolean"?e===r:String(e).trim().toLowerCase()===String(r).trim().toLowerCase()),equalsAny:(e,...r)=>e==null?!1:r.some(n=>o.equals(e,n)),isVendorKey:e=>o.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>o.equalsAny(e,"productType","productTypes"),isTagKey:e=>o.equalsAny(e,"tag","tags"),isCollectionKey:e=>o.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>o.equalsAny(e,"priceRange","price"),isBestSelling:e=>o.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>o.equals(e,"Collection"),isPriceRangeOptionType:e=>o.equals(e,"priceRange")};function Q(e,r=document,n=5e3){return new Promise((t,i)=>{let a=r.querySelector(e);if(a){t(a);return}let l=setTimeout(()=>{d.disconnect(),i(new Error(`Element ${e} not found within ${n}ms`))},n),d=new MutationObserver((f,b)=>{let m=r.querySelector(e);m&&(b.disconnect(),clearTimeout(l),t(m))}),c=r instanceof Document?r.body:r;d.observe(c,{childList:!0,subtree:!0})})}function se(e,r=document,n=5e3){return Promise.all(e.map(t=>Q(t,r,n)))}function ae(e,r){return Array.from({length:r},(n,t)=>{var a;let i=e.querySelector(`.afs-product-modal__option-value[data-option-index="${t}"].afs-product-modal__option-value--selected`);return(a=i==null?void 0:i.dataset.optionValue)!=null?a:null})}function oe(e,r){return e.filter(n=>r.every((t,i)=>t?i===0?n.option1===t:i===1?n.option2===t:n.option3===t:!0))}function B(e){return e.available!==!1&&e.availableForSale!==!1}function te(e,r,n,t){return e.variants.some(i=>!(i.available!==!1&&i.availableForSale!==!1)||r===0&&i.option1!==n||r===1&&i.option2!==n||r===2&&i.option3!==n?!1:t.every((l,d)=>d===r||!l?!0:d===0?i.option1===l:d===1?i.option2===l:i.option3===l))}var u={enabled:!0,error:(e,r)=>{u.enabled&&console.error("[AFS]",e,r||"")},warn:(e,r)=>{u.enabled&&console.warn("[AFS]",e,r||"")},info:(e,r)=>{u.enabled&&console.info("[AFS]",e,r||"")},debug:(e,r)=>{u.enabled&&console.debug("[AFS]",e,r||"")},log:(e,...r)=>{u.enabled&&console.log(e,...r)},init:e=>{u.enabled=e!==!1,u.log("%cAdvanced Filter & Search initialized","color: #00c853;font-size: 20px;font-weight: bold;background: #0b1e13;padding: 10px 15px;border-radius: 6px;font-family: Arial, sans-serif;")}};var V=new Map,pe=new Set(["shop","shop_domain","cpid"]),fe={buildFilterMetadata:e=>{let r=new Map;return Array.isArray(e)&&e.forEach(n=>{n.handle&&r.set(n.handle,{label:n.label||n.queryKey||n.optionKey||n.handle,queryKey:n.queryKey,optionKey:n.optionKey,optionType:n.optionType})}),r}},s={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:H.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},M={parse(){let e=new URL(window.location.href),r={},n,t;return e.searchParams.forEach((i,a)=>{if(!pe.has(a))if(o.isVendorKey(a))r.vendor=o.split(i);else if(o.isProductTypeKey(a))r.productType=o.split(i);else if(o.isTagKey(a))r.tags=o.split(i);else if(o.isCollectionKey(a))r.collections=o.split(i);else if(o.equals(a,"search"))r.search=i;else if(o.equals(a,"q"))r.search=i;else if(o.equals(a,"priceMin")){let l=Math.round(parseFloat(i));!isNaN(l)&&l>=0&&(n=l)}else if(o.equals(a,"priceMax")){let l=Math.round(parseFloat(i));!isNaN(l)&&l>=0&&(t=l)}else if(o.isPriceRangeKey(a)){let l=i.split("-");if(l.length===2){let d=Math.round(parseFloat(l[0])),c=Math.round(parseFloat(l[1]));!isNaN(d)&&d>=0&&(n=d),!isNaN(c)&&c>=0&&(t=c)}}else if(o.equals(a,"page"))r.page=parseInt(i,10)||1;else if(o.equals(a,"limit"))r.limit=parseInt(i,10)||H.PAGE_SIZE;else if(o.equals(a,"sort")){let l=i.toLowerCase().trim();if(o.isBestSelling(l))r.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[d,c]=l.split("-"),f=o.equalsAny(c,"ascending")?"asc":o.equalsAny(c,"descending")?"desc":"desc";r.sort={field:d,order:f}}else{let[d,c]=i.split(":");r.sort={field:d,order:o.equalsAny(c,"asc")?"asc":"desc"}}}else r[a]=o.split(i),u.debug("Handle filter parsed directly",{handle:a,value:i})}),(n!==void 0||t!==void 0)&&(r.priceRange={min:n,max:t}),r},update(e,r,n){let t=new URL(window.location.href);if(t.search="",u.debug("Updating URL",{filters:e,pagination:r}),e&&!o.empty(e)&&Object.keys(e).forEach(a=>{var d;let l=e[a];if(!o.empty(l)){if(Array.isArray(l)&&l.length>0)t.searchParams.set(a,l.join(",")),u.debug("URL param set",{key:a,value:l.join(",")});else if(o.isPriceRangeKey(a)&&l&&typeof l=="object"&&!Array.isArray(l)){let c=l,f=typeof c.min=="number"&&!isNaN(c.min)?Math.round(c.min):void 0,b=typeof c.max=="number"&&!isNaN(c.max)?Math.round(c.max):void 0;if(s.priceRangeHandle){let m=`${f!==void 0?f:""}-${b!==void 0?b:""}`;t.searchParams.set(s.priceRangeHandle,m),u.debug("Price range URL handle param set",{handle:s.priceRangeHandle,value:m})}else f!==void 0&&t.searchParams.set("priceMin",String(f)),b!==void 0&&t.searchParams.set("priceMax",String(b)),u.debug("Price range URL params set",{priceMin:f,priceMax:b})}else if(o.equals(a,"search")&&typeof l=="string"&&l.trim()){let c=((d=window.AFS_Config)==null?void 0:d.isSearchTemplate)||!1,f=c?"q":"search";t.searchParams.set(f,l.trim()),u.debug("Search URL param set",{key:f,value:l.trim(),isSearchTemplate:c})}}}),r&&r.page>1&&(t.searchParams.set("page",String(r.page)),u.debug("Page URL param set",{page:r.page})),n&&n.field){if(n.field==="best-selling"||n.field==="bestselling")t.searchParams.set("sort","best-selling");else{let a=o.equals(n.order,"asc")?"ascending":"descending";t.searchParams.set("sort",`${n.field}-${a}`)}u.debug("Sort URL param set",{field:n.field,order:n.order})}let i=t.toString();u.info("URL updated",{newUrl:i,oldUrl:window.location.href}),history.pushState({filters:e,pagination:r,sort:n},"",t)}},D={baseURL:"https://fstaging.digitalcoo.com/storefront",__v:"v2.0",__id:"01-13-2026",cache:new Map,timestamps:new Map,pending:new Map,key(e,r,n){let t=r&&typeof r=="object"&&typeof r.page=="number"?r.page:1,i=r&&typeof r=="object"&&typeof r.limit=="number"?r.limit:H.PAGE_SIZE||24,a=n&&typeof n=="object"&&n.field?n.field:"best-selling",l=n&&typeof n=="object"&&n.order?n.order:"asc";return`${t}-${i}-${a}-${l}-${JSON.stringify(e)}`},get(e){let r=this.timestamps.get(e);return!r||Date.now()-r>H.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,r){this.cache.set(e,r),this.timestamps.set(e,Date.now())},async fetch(e,r=H.TIMEOUT){let n=new AbortController,t=setTimeout(()=>n.abort(),r);try{u.debug("Fetching",{url:e});let i=await fetch(e,{signal:n.signal});if(clearTimeout(t),!i.ok){let l=await i.text().catch(()=>"");throw new Error(`HTTP ${i.status}: ${i.statusText}${l?" - "+l:""}`)}let a=await i.json();return u.debug("Fetch success",{url:e,hasData:!!a}),a}catch(i){throw clearTimeout(t),i instanceof Error&&i.name==="AbortError"?new Error("Request timeout"):(u.error("Fetch failed",{url:e,error:i instanceof Error?i.message:String(i)}),i)}},async products(e,r,n){var b,m,g,p,T,v,h;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!s.shop)throw new Error("Shop not set");let t=r&&typeof r=="object"?r:{page:((b=s.pagination)==null?void 0:b.page)||1,limit:((m=s.pagination)==null?void 0:m.limit)||H.PAGE_SIZE||24,total:((g=s.pagination)==null?void 0:g.total)||0,totalPages:((p=s.pagination)==null?void 0:p.totalPages)||0},i=n&&typeof n=="object"?n:{field:((T=s.sort)==null?void 0:T.field)||"best-selling",order:((v=s.sort)==null?void 0:v.order)||"asc"},a=this.key(e,t,i),l=this.get(a);if(l)return u.debug("Cache hit",{key:a}),l;if(this.pending.has(a))return u.debug("Request deduplication",{key:a}),this.pending.get(a);let d=new URLSearchParams;if(d.set("shop",s.shop),(h=s.selectedCollection)!=null&&h.id?(d.set("cpid",s.selectedCollection.id),u.debug("cpid sent to products API",{cpid:s.selectedCollection.id,filters:e})):u.warn("cpid not available in selectedCollection",{selectedCollection:s.selectedCollection}),Object.keys(e).forEach(y=>{let E=e[y];if(!o.empty(E))if(o.isPriceRangeKey(y)&&E&&typeof E=="object"&&!Array.isArray(E)){let S=E,L=typeof S.min=="number"&&!isNaN(S.min)?Math.round(S.min):void 0,I=typeof S.max=="number"&&!isNaN(S.max)?Math.round(S.max):void 0;s.priceRangeHandle?d.set(s.priceRangeHandle,`${L!==void 0?L:""}-${I!==void 0?I:""}`):(L!==void 0&&d.set("priceMin",String(L)),I!==void 0&&d.set("priceMax",String(I)))}else y==="search"&&typeof E=="string"&&E.trim()?d.set(y,E.trim()):Array.isArray(E)&&E.length>0?(d.set(y,E.join(",")),u.debug("Filter sent as direct handle param",{handle:y,value:E.join(",")})):typeof E=="string"&&(d.set(y,E),u.debug("Filter sent as direct handle param",{handle:y,value:E}))}),d.set("page",String(t.page)),d.set("limit",String(t.limit)),i.field)if(o.isBestSelling(i.field))d.set("sort","best-selling");else{let y=o.equals(i.order,"asc")?"ascending":"descending";d.set("sort",`${i.field}-${y}`)}let c=`${this.baseURL}/products?${d}`;u.info("Fetching products",{url:c,shop:s.shop,page:t.page}),_.showLoading("products");let f=this.fetch(c).then(y=>{var S,L;if(!y.success||!y.data)throw u.error("Invalid products response",{response:y}),new Error(`Invalid products response: ${y.message||C.messages.unknownError}`);let E=y.data;return u.info("Products response",{productsCount:((S=E.products)==null?void 0:S.length)||0,total:((L=E.pagination)==null?void 0:L.total)||0,hasFilters:!!E.filters}),this.set(a,E),this.pending.delete(a),E}).catch(y=>{throw this.pending.delete(a),u.error("Products fetch failed",{error:y instanceof Error?y.message:String(y),url:c}),y});return _.showLoading("products"),this.pending.set(a,f),f},async filters(e){var d;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!s.shop)throw new Error("Shop not set");let r=new URLSearchParams;r.set("shop",s.shop),(d=s.selectedCollection)!=null&&d.id?(r.set("cpid",s.selectedCollection.id),u.debug("cpid sent to filters API",{cpid:s.selectedCollection.id,filters:e})):u.warn("cpid not available in selectedCollection",{selectedCollection:s.selectedCollection});let n={...e};Object.keys(n).forEach(c=>{let f=n[c];if(!o.empty(f)){if(Array.isArray(f))r.set(c,f.join(","));else if(c==="search"&&typeof f=="string"&&f.trim())r.set("search",f.trim());else if(c==="priceRange"&&f&&typeof f=="object"&&!Array.isArray(f)){let b=f,m=typeof b.min=="number"&&!isNaN(b.min)?b.min:void 0,g=typeof b.max=="number"&&!isNaN(b.max)?b.max:void 0;s.priceRangeHandle?r.set(s.priceRangeHandle,`${m!==void 0?m:""}-${g!==void 0?g:""}`):(m!==void 0&&r.set("priceMin",String(m)),g!==void 0&&r.set("priceMax",String(g)))}}});let t={};r.forEach((c,f)=>{t[f]=c}),u.debug("All params for filters endpoint",{params:t});let i=`${this.baseURL}/filters?${r}`;u.info("Fetching filters",{url:i,shop:s.shop}),_.showLoading("filters");let a=await this.fetch(i);if(!a.success||!a.data)throw u.error("Invalid filters response",{response:a}),new Error(`Invalid filters response: ${a.message||C.messages.unknownError}`);let l=a.data;if(!l||typeof l!="object")throw new Error("Invalid filters response: data is not an object");return l.filters!==void 0&&!Array.isArray(l.filters)&&(u.warn("Filters response contains non-array filters",{filters:l.filters}),l.filters=[]),u.info("Filters response:",{filters:l.filters}),l},setBaseURL(e){this.baseURL=e},buildFiltersFromUrl(e){let r=e.search||e.q||"";s.filters={vendor:e.vendor||[],productType:e.productType||[],tags:e.tags||[],collections:e.collections||[],search:r,priceRange:e.priceRange||null},Object.keys(e).forEach(n=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","cpid"].includes(n)){let t=e[n];Array.isArray(t)?s.filters[n]=t:typeof t=="string"&&(s.filters[n]=[t])}})},setPaginationFromUrl(e){e.page?s.pagination.page=e.page:s.fallbackPagination&&s.fallbackPagination.currentPage&&(s.pagination.page=s.fallbackPagination.currentPage)},setSortFromUrl(e){if(e.sort){let r=typeof e.sort=="object"?e.sort.field:e.sort;if(typeof r=="string"){let n=r.toLowerCase().trim();if(n==="best-selling"||n==="bestselling")s.sort={field:"best-selling",order:"asc"};else if(n.includes("-")){let[t,i]=n.split("-"),a=o.equalsAny(i,"ascending")?"asc":o.equalsAny(i,"descending")?"desc":"desc";s.sort={field:t,order:a}}else{let[t,i]=r.split(":");s.sort={field:t,order:i||"desc"}}}else typeof e.sort=="object"&&e.sort.field&&(s.sort={field:e.sort.field,order:e.sort.order||"desc"})}else s.sort={field:"best-selling",order:"asc"}}},_={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(e,r,n){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Container selector cannot be empty. Provide a valid selector or ensure [data-afs-container] exists in the DOM.");if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error(`Container not found. Selector: "${e}". Please ensure the container element exists in the DOM.`);this.container.setAttribute("data-afs-container","true"),this.initSearchBar();let t=this.container.querySelector(".afs-main-content")||o.el("div","afs-main-content");t.parentNode||this.container.appendChild(t),this.filtersContainer=r&&r.trim()!==""&&document.querySelector(r)||null,this.filtersContainer||(this.filtersContainer=o.el("div","afs-filters-container"));let i=this.container.querySelector("[data-afs-search-bar]");i&&(i.parentNode&&i.parentNode.removeChild(i),this.container&&!i.parentNode&&this.container.insertBefore(i,this.container.firstChild)),!this.filtersContainer.parentNode&&t&&t.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=o.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":C.buttons.closeFilters}),this.mobileFilterClose.innerHTML=C.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=o.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",t.parentNode?t.parentNode.insertBefore(this.mobileFilterBackdrop,t):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=n&&n.trim()!==""&&document.querySelector(n)||null,this.productsContainer||(this.productsContainer=o.el("div","afs-products-container")),!this.productsContainer.parentNode&&t&&t.appendChild(this.productsContainer),this.productsInfo=o.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=o.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":C.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${C.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=o.el("div","afs-sort-container");let a=o.el("label","afs-sort-label",{for:"afs-sort-label"});a.textContent=C.labels.sortBy,this.sortSelect=o.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${C.sortOptions.bestSelling}</option>
        <option value="title-ascending">${C.sortOptions.titleAsc}</option>
        <option value="title-descending">${C.sortOptions.titleDesc}</option>
        <option value="price-ascending">${C.sortOptions.priceAsc}</option>
        <option value="price-descending">${C.sortOptions.priceDesc}</option>
        <option value="created-ascending">${C.sortOptions.createdAsc}</option>
        <option value="created-descending">${C.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(a),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=o.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},initSearchBar(){if(!this.container)return;let e=this.container.querySelector("[data-afs-search-bar]");if(!e)return;let r=e.querySelector("[data-afs-search-input]"),n=e.querySelector("[data-afs-search-form]");if(!r||!n)return;e.style.display="";let t=M.parse(),i=t.q||t.search||"";i&&(r.value=String(i)),n.addEventListener("submit",d=>{d.preventDefault();let c=r.value.trim();c&&(s.filters.search=c,s.pagination.page=1,M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.apply())});let a=null;r.addEventListener("input",()=>{a&&clearTimeout(a),a=setTimeout(()=>{let d=r.value.trim();s.filters.search=d,s.pagination.page=1,M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.apply()},H.DEBOUNCE)});let l=()=>{let d=M.parse(),c=String(d.q||d.search||"");r.value!==c&&(r.value=c)};window.addEventListener("popstate",l),r._syncSearchInput=l,u.debug("Search bar initialized",{hasInput:!!r,hasForm:!!n})},attachEvents(){if(!_.container)return;_.container.addEventListener("click",n=>{var c,f,b,m,g;let t=n.target,i=(c=t.closest("[data-afs-action]"))==null?void 0:c.dataset.afsAction,a=t.closest(".afs-filter-item"),l=t instanceof HTMLInputElement&&(t.type==="checkbox"||t.type==="radio")?t:a==null?void 0:a.querySelector(".afs-filter-item__checkbox"),d=t.closest(".afs-pagination__button");if(i==="clear-all")s.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(f=s.selectedCollection)!=null&&f.id&&u.debug("Clear All: keeping server-managed cpid (not exposed to UI)"),s.pagination.page=1,M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.apply();else if(i==="toggle-filters"||i==="close-filters")_.toggleMobileFilters();else if(t.closest(".afs-applied-filter-chip__remove")){let p=t.closest(".afs-applied-filter-chip"),T=p==null?void 0:p.querySelector(".afs-applied-filter-chip__remove"),v=T==null?void 0:T.getAttribute("data-afs-filter-key"),h=T==null?void 0:T.getAttribute("data-afs-filter-value");if(!v)return;if(o.equals(v,"cpid")){(b=s.selectedCollection)!=null&&b.id&&u.debug("cpid removed, cleared selectedCollection"),M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.apply();return}if(o.equals(v,"search")){s.filters.search="",s.pagination.page=1,M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.apply();return}if(o.isPriceRangeKey(v)){s.filters.priceRange=null,s.pagination.page=1,M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.apply();return}h&&x.toggle(v,h)}else if(l&&a){n.preventDefault(),n.stopPropagation();let p=a.getAttribute("data-afs-filter-handle")||((m=a.parentElement)==null?void 0:m.getAttribute("data-afs-filter-handle")),T=a.getAttribute("data-afs-filter-value"),v=a.getAttribute("data-afs-filter-multiselect")||((g=a.parentElement)==null?void 0:g.getAttribute("data-afs-filter-multiselect"));if(!p||!T){u.warn("Invalid filter item clicked",{handle:p,value:T});return}u.debug("Filter toggle",{handle:p,value:T,currentChecked:l.checked}),(v==="0"||v==="false")&&(s.filters[p]=[]),x.toggle(p,T)}else if(d&&!d.disabled){let p=parseInt(d.getAttribute("data-afs-page")||"0",10);if(p&&p>0){if(s.usingFallback){let v=M.parse().page||s.pagination.page||1;s.pagination.page=p}else s.pagination.page=p;M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.applyProductsOnly()}}else if(t.closest(".afs-filter-group__clear")){n.preventDefault(),n.stopPropagation();let p=t.closest(".afs-filter-group__clear");if(!p)return;let T=p.getAttribute("data-afs-filter-handle");if(!T)return;let v=s.filterMetadata.get(T),h=o.isCollectionOptionType(v==null?void 0:v.optionType)||o.isCollectionKey(T);s.filters[T]&&(delete s.filters[T],u.debug("Filter cleared",{handle:T,isCollectionFilter:h}),M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),x.apply())}else if(t.closest(".afs-filter-group__toggle")){n.preventDefault(),n.stopPropagation();let p=t.closest(".afs-filter-group");if(!p)return;let v=!(p.getAttribute("data-afs-collapsed")==="true");p.setAttribute("data-afs-collapsed",v?"true":"false");let h=p.getAttribute("data-afs-filter-key");if(h)try{let S=V.get(h)||{};S.collapsed=v,S.lastUpdated=Date.now(),V.set(h,S);try{let L=`afs_filter_state_${p.getAttribute("data-afs-filter-handle")}`;sessionStorage.setItem(L,JSON.stringify({collapsed:v}))}catch(L){u.debug("Could not persist to sessionStorage",{error:L instanceof Error?L.message:String(L)})}}catch(S){u.error("Failed to persist filter state",{stateKey:h,error:S instanceof Error?S.message:String(S)})}let y=p.querySelector(".afs-filter-group__toggle");y&&y.setAttribute("aria-expanded",v?"false":"true");let E=p.querySelector(".afs-filter-group__icon");E&&(E.innerHTML=v?F.rightArrow||"":F.downArrow||""),u.debug("Filter group toggled",{collapsed:v,stateKey:h})}else if(t.closest(".afs-product-card__quick-add")){n.preventDefault(),n.stopPropagation();let p=t.closest(".afs-product-card__quick-add");if(!p||p.disabled)return;let T=p.getAttribute("data-product-handle"),v=p.getAttribute("data-product-id");T&&de.add(T,v)}else if(t.closest(".afs-product-card__quick-view")){n.preventDefault(),n.stopPropagation();let p=t.closest(".afs-product-card__quick-view");if(!p)return;let T=p.getAttribute("data-product-handle");T&&be(T)}}),_.container.addEventListener("input",n=>{var i;let t=n.target;if(t.classList.contains("afs-filter-group__search-input")){let l=t.value.toLowerCase(),d=(i=t.closest(".afs-filter-group"))==null?void 0:i.querySelector(".afs-filter-group__items");d!=null&&d._items&&d.querySelectorAll(".afs-filter-item").forEach((c,f)=>{var m;let b=(m=d._items)==null?void 0:m[f];if(b){let g=o.str(typeof b=="string"?b:b.label||b.value||"").toLowerCase();c.style.display=!l||g.includes(l)?"":"none"}})}});let e=n=>{let t=n.value;if(!t)return;u.info("Sort dropdown changed",{sortValue:t,currentSort:s.sort});let i;if(t==="best-selling"||t==="bestselling")i={field:"best-selling",order:"asc"};else if(t.includes("-")){let[a,l]=t.split("-");i={field:a,order:l==="ascending"?"asc":"desc"}}else{let[a,l]=t.split(":");i={field:a,order:l||"desc"}}s.sort=i,s.pagination.page=1,M.update(s.filters,s.pagination,s.sort),u.info("Calling applyProductsOnly after sort change",{sort:s.sort}),_.scrollToProducts(),_.showLoading("products"),x.applyProductsOnly()},r=null;_.container.addEventListener("focus",n=>{let t=n.target;t.classList.contains("afs-sort-select")&&(r=t.value)},!0),_.container.addEventListener("change",n=>{let t=n.target;if(t.classList.contains("afs-sort-select")){let i=t;e(i),r=i.value}}),_.container.addEventListener("blur",n=>{let t=n.target;if(t.classList.contains("afs-sort-select")){let i=t,a=i.value;a&&a!==r&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{let l;if(o.isBestSelling(s.sort.field))l="best-selling";else{let d=o.equals(s.sort.order,"asc")?"ascending":"descending";l=`${s.sort.field}-${d}`}a!==l&&e(i)})}),r=a}},!0),window.addEventListener("popstate",()=>{var T;let n=(T=_.container)==null?void 0:T.querySelector("[data-afs-search-input]");n&&n._syncSearchInput&&n._syncSearchInput();let t=M.parse(),i=JSON.stringify(s.filters),a=s.pagination.page,l=JSON.stringify(s.sort),d=String(t.search||t.q||"");s.filters={vendor:t.vendor||[],productType:t.productType||[],tags:t.tags||[],collections:t.collections||[],search:d,priceRange:t.priceRange||null},Object.keys(t).forEach(v=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort"].includes(v)){let h=t[v];Array.isArray(h)?s.filters[v]=h:typeof h=="string"&&(s.filters[v]=[h])}});let c=s.priceRangeHandle?s.filters[s.priceRangeHandle]:null;if(s.priceRangeHandle&&Array.isArray(c)&&c.length>0){let h=String(c[0]||"").split("-");if(h.length===2){let y=h[0].trim()?parseInt(h[0],10):void 0,E=h[1].trim()?parseInt(h[1],10):void 0,S=typeof y=="number"&&!isNaN(y)&&y>=0,L=typeof E=="number"&&!isNaN(E)&&E>=0;(S||L)&&(s.filters.priceRange={min:S?y:void 0,max:L?E:void 0},delete s.filters[s.priceRangeHandle])}}let f=t.page||s.pagination.page;if(f!==a&&(s.pagination.page=f),t.sort){let v=typeof t.sort=="object"?t.sort.field:t.sort;if(typeof v=="string"){let h=v.toLowerCase().trim();if(h==="best-selling"||h==="bestselling")s.sort={field:"best-selling",order:"asc"};else if(h.includes("-")){let[y,E]=h.split("-"),S=o.equalsAny(E,"ascending")?"asc":o.equalsAny(E,"descending")?"desc":"desc";s.sort={field:y,order:S}}else{let[y,E]=v.split(":");s.sort={field:y,order:E||"desc"}}}else typeof t.sort=="object"&&t.sort.field&&(s.sort={field:t.sort.field,order:t.sort.order||"desc"})}else s.sort={field:"best-selling",order:"asc"};let b=JSON.stringify(s.filters),m=JSON.stringify(s.sort);!(i!==b)&&(m!==l||f!==a)?x.applyProductsOnly():x.apply()})},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",u.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),u.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let r=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),r&&window.scrollTo(0,parseInt(r||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let r=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${r}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}u.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton(),V.clear(),this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(t=>{let i=t.getAttribute("data-afs-filter-key");if(i){let a=t.querySelector(".afs-filter-group__search-input"),l=t.getAttribute("data-afs-collapsed")==="true",d=(a==null?void 0:a.value)||"",c=V.get(i);V.set(i,{...c,collapsed:l,search:d,lastUpdated:Date.now()})}}),o.clear(this.filtersContainer);let r=e.filter(t=>t?o.isPriceRangeOptionType(t.optionType)?t.range&&typeof t.range.min=="number"&&typeof t.range.max=="number"&&t.range.max>t.range.min:t.values&&t.values.length>0:!1);if(u.debug("Rendering filters",{total:e.length,valid:r.length,filtersWithSearchable:r.filter(t=>t.searchable).length,filtersWithCollapsed:r.filter(t=>t.collapsed).length}),r.length===0){u.warn("No valid filters to render");return}let n=document.createDocumentFragment();r.forEach(t=>{var E;if(o.isPriceRangeOptionType(t.optionType)){let S=this.createPriceRangeGroup(t,V);S&&n.appendChild(S);return}let i;if(t.optionType||t.optionKey){if(i=t.handle,!i){u.error("Option filter missing handle",{filter:t});return}}else if(i=t.queryKey||t.key,!i){u.warn("Standard filter missing queryKey/key",{filter:t});return}u.debug("Filter group handle determined",{handle:i,filterHandle:t.handle,queryKey:t.queryKey,key:t.key,label:t.label,type:t.optionType,optionType:t.optionType,optionKey:t.optionKey,isOptionFilter:!!(t.optionType||t.optionKey)});let a=o.el("div","afs-filter-group",{"data-afs-filter-type":t.optionType||""});a.setAttribute("data-afs-filter-handle",i);let l=i;a.setAttribute("data-afs-filter-key",l);let d=V.get(l),c=(d==null?void 0:d.collapsed)!==void 0?d.collapsed:t.collapsed===!0||t.collapsed==="true"||t.collapsed===1;a.setAttribute("data-afs-collapsed",c?"true":"false"),u.debug("Filter group created",{handle:i,label:t.label,collapsed:c,searchable:t.searchable,showCount:t.showCount,valuesCount:((E=t.values)==null?void 0:E.length)||0});let f=o.el("div","afs-filter-group__header"),b=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":c?"false":"true",title:t.tooltipContent||`Toggle ${t.label||i} filter`}),m=o.el("span","afs-filter-group__icon");m.innerHTML=c?F.rightArrow||"":F.downArrow||"",b.appendChild(m),b.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),t.label||t.optionType||"")),f.appendChild(b);let g=s.filters[i];if(g&&(Array.isArray(g)?g.length>0:typeof g=="object"&&!Array.isArray(g)?Object.keys(g).length>0:!!g)){let S=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${C.buttons.clear} ${t.label||i} filters`,"data-afs-filter-handle":i});S.textContent=C.buttons.clear,S.title=`${C.buttons.clear} ${t.label||i} filters`,f.appendChild(S)}a.appendChild(f);let T=o.el("div","afs-filter-group__content");if(t.searchable===!0||typeof t.searchable=="string"&&t.searchable.toLowerCase()==="true"){let S=o.el("div","afs-filter-group__search"),L=o.el("input","afs-filter-group__search-input",{type:"text",placeholder:t.searchPlaceholder||"Search...","aria-label":`${C.labels.search}${t.label||i}`,name:`afs-search-${i}`});d!=null&&d.search&&(L.value=d.search),S.appendChild(L),T.appendChild(S),u.debug("Search input added",{handle:i,label:t.label,searchable:t.searchable})}let h=o.el("div","afs-filter-group__items",{"data-afs-filter-handle":i,"data-afs-filter-multiselect":o.isMultiSelect(t)?"1":"0","data-afs-filter-display-type":o.toLowerCase(t.displayType||"CHECKBOX")});h._items=t.values;let y=document.createDocumentFragment();t.values&&t.values.forEach((S,L)=>{let I=this.createFilterItem(i,S,t,L);I&&y.appendChild(I)}),h.appendChild(y),T.appendChild(h),a.appendChild(T),n.appendChild(a)}),n.children.length>0?(this.filtersContainer.appendChild(n),this.showFilters(),u.debug("Filters rendered",{count:n.children.length})):(u.warn("No filter groups created"),this.hideFilters())},createFilterItem(e,r,n,t){var p;let i=o.str(typeof r=="string"?r:r.value||r.key||r.name||"");if(!i||i==="[object Object]")return null;let a=typeof r=="string"?r:r.label||r.value||i;if((o.isCollectionOptionType(n==null?void 0:n.optionType)||o.isCollectionKey(e))&&s.collections&&Array.isArray(s.collections)){if((p=s.selectedCollection)!=null&&p.id&&String(i)===String(s.selectedCollection.id))return null;let T=s.collections.find(v=>{let h=String(v.id||v.gid||v.collectionId||"");return h&&String(h)===String(i)});if(T)a=T.title||T.label||T.name||a;else return null}let c=(s.filters[e]||[]).includes(i),f=o.inputDisplayType(n),b=(f==="radio"?e:e+"-"+i.replace(/\s+/g,"-").toLowerCase())+"_"+(t+1),m=o.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":i,for:b});c&&m.classList.add("afs-filter-item--active");let g=o.el("input","afs-filter-item__checkbox",{type:f});return g.checked=c,g.setAttribute("data-afs-filter-value",i),g.setAttribute("name",b),g.setAttribute("id",b),m.appendChild(g),m.appendChild(o.txt(o.el("span","afs-filter-item__label"),a)),n!=null&&n.showCount&&typeof r=="object"&&r.count&&m.appendChild(o.txt(o.el("span","afs-filter-item__count"),`(${r.count})`)),m},createPriceRangeGroup(e,r=null){var X;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return u.warn("Invalid price range filter",{filter:e}),null;let n=Math.round(e.range.min),t=Math.round(e.range.max),i=s.filters.priceRange||{min:n,max:t},a=Math.round(Math.max(n,Math.min(t,i.min||n))),l=Math.round(Math.max(n,Math.min(t,i.max||t))),d=o.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),c=r==null?void 0:r.get(e.key||"priceRange"),f=(X=c==null?void 0:c.collapsed)!=null?X:e.collapsed===!0;d.setAttribute("data-afs-collapsed",f?"true":"false");let b=o.el("div","afs-filter-group__header"),m=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":f?"false":"true"}),g=o.el("span","afs-filter-group__icon");if(g.innerHTML=f?F.rightArrow||"":F.downArrow||"",m.appendChild(g),m.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),b.appendChild(m),s.filters.priceRange&&(s.filters.priceRange.min!==n||s.filters.priceRange.max!==t)){let R=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${C.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});R.textContent=C.buttons.clear,R.title=`${C.buttons.clear} ${e.label} filter`,b.appendChild(R)}d.appendChild(b);let T=o.el("div","afs-filter-group__content"),v=o.el("div","afs-price-range-container"),h=o.el("div","afs-price-range-track"),y=o.el("div","afs-price-range-active");h.appendChild(y);let E=o.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(n),max:String(t),value:String(a),step:"1"});E.setAttribute("data-afs-range-type","min");let S=o.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(n),max:String(t),value:String(l),step:"1"});S.setAttribute("data-afs-range-type","max"),h.appendChild(E),h.appendChild(S),v.appendChild(h);let L=o.el("div","afs-price-range-values"),I=o.el("span","afs-price-range-value afs-price-range-value--min"),O=o.el("span","afs-price-range-value afs-price-range-value--max"),G=R=>`$${parseFloat(String(R)).toFixed(0)}`;I.textContent=G(a),O.textContent=G(l),L.appendChild(I),L.appendChild(o.txt(o.el("span","afs-price-range-separator")," - ")),L.appendChild(O),v.appendChild(L);let z=()=>{let R=Math.round(parseFloat(E.value)),P=Math.round(parseFloat(S.value)),k=t-n,w=(R-n)/k*100,q=(t-P)/k*100;y.style.left=`${w}%`,y.style.right=`${q}%`,I.textContent=G(R),O.textContent=G(P)},N=()=>{let R=Math.round(parseFloat(E.value)),P=Math.round(parseFloat(S.value));R>P&&(E.value=String(P),S.value=String(R)),z()};return E.addEventListener("input",()=>{N(),x.updatePriceRange(Math.round(parseFloat(E.value)),Math.round(parseFloat(S.value)))}),S.addEventListener("input",()=>{N(),x.updatePriceRange(Math.round(parseFloat(E.value)),Math.round(parseFloat(S.value)))}),z(),T.appendChild(v),d.appendChild(T),d},renderProducts(e){if(!this.productsGrid)return;let r=this.productsGrid.querySelectorAll(".afs-skeleton-card");r.length>0&&r.forEach(a=>a.remove());let n=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(a=>{let l=a.getAttribute("data-afs-product-id");l&&n.set(l,a)});let t=new Set(e.map(a=>o.id(a)).filter(a=>a!==null)),i=document.createDocumentFragment();e.forEach(a=>{let l=o.id(a);if(!l)return;let d=n.get(l);if(d){let c=d.querySelector(".afs-product-card__title");c&&c.textContent!==a.title&&(c.textContent=a.title||"");let f=d.querySelector(".afs-product-card__price");if(f){let b=parseFloat(String(a.minPrice||0))*100,m=parseFloat(String(a.maxPrice||0))*100,g=o.formatMoney(b,s.moneyFormat||"{{amount}}",s.currency||""),p=b===m?g:`${C.labels.price}from ${g}`;f.textContent!==p&&(f.textContent=p)}}else{let c=this.createProduct(a);c&&i.appendChild(c)}}),n.forEach((a,l)=>{t.has(l)||a.remove()}),i.children.length>0&&this.productsGrid.appendChild(i)},createProduct(e){let r=o.el("div","afs-product-card",{"data-afs-product-id":o.id(e)||""});if(e.imageUrl||e.featuredImage){let t=o.el("div","afs-product-card__image"),i=o.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),a=e.imageUrl||"",l=null,d=e.imagesUrls;if(d&&Array.isArray(d)&&d.length>1&&(l=d[1],u.debug("Second image found for hover",{secondImageUrl:l,totalImages:d.length})),a){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let p=[];e.featuredImage.urlSmall&&p.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&p.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&p.push(`${e.featuredImage.urlLarge} 500w`),p.length>0&&(i.setAttribute("srcset",p.join(", ")),i.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),i.src=e.featuredImage.url||e.featuredImage.urlFallback||a}else{let p=o.optimizeImageUrl(a,{width:300,format:"webp",quality:80}),T=o.buildImageSrcset(a,[200,300,500]);T&&(i.setAttribute("srcset",T),i.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),i.src=p||a}i.setAttribute("data-original-src",i.src),i.onerror=function(){var T;let p=((T=e.featuredImage)==null?void 0:T.urlFallback)||a;if(p&&this.src!==p)this.src=p,this.setAttribute("data-original-src",p);else if(this.src.includes("_webp.")){let v=a.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");v!==this.src?(this.src=v,this.setAttribute("data-original-src",v)):this.style.display="none"}else this.style.display="none"}}if(t.appendChild(i),l){let p=l,T=new Image;T.src=p;let v=i.src||a,h=()=>{let y=i.src;y&&y!==p&&(v=y)};i.complete?h():i.addEventListener("load",h,{once:!0}),t.addEventListener("mouseenter",()=>{h();let y=()=>{i.style.opacity="0",setTimeout(()=>{i.src=p,i.style.opacity="1"},150)};if(T.complete)y();else{let E=()=>{y()};T.complete?y():(T.addEventListener("load",E,{once:!0}),T.addEventListener("error",()=>{u.debug("Hover image failed to load",{url:l,hoverImageUrl:p})},{once:!0}))}}),t.addEventListener("mouseleave",()=>{i.style.opacity="0",setTimeout(()=>{i.src=v,i.style.opacity="1"},150)})}if(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(p=>p.availableForSale)){let p=o.el("div","afs-product-card__badge",{class:"afs-product-card__badge--sold-out"});p.textContent=C.buttons.soldOut||"Sold out",t.appendChild(p)}let f=o.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":o.id(e)||"","aria-label":C.buttons.quickAddToCart,type:"button"}),b=o.el("span","afs-product-card__quick-add-icon");b.innerHTML=F.plus,f.appendChild(b);let m=o.el("span","afs-product-card__quick-add-text");m.textContent=C.buttons.quickAdd,f.appendChild(m),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(p=>p.availableForSale))&&(f.disabled=!0,f.classList.add("afs-product-card__quick-add--disabled"),f.setAttribute("aria-label",C.labels.productUnavailable));let g=ye(e);g&&t.appendChild(g),r.appendChild(t)}let n=o.el("a","afs-product-card__info",{href:`/products/${e.handle}`});if(n){n.appendChild(o.txt(o.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&n.appendChild(o.txt(o.el("div","afs-product-card__vendor"),e.vendor));let t=parseFloat(String(e.minPrice||0))*100,i=parseFloat(String(e.maxPrice||0))*100,a=o.formatMoney(t,s.moneyFormat||"{{amount}}",s.currency||""),l=t===i?a:`from ${a}`;n.appendChild(o.txt(o.el("div","afs-product-card__price"),l)),r.appendChild(n)}return r},updateFilterState(e,r,n){if(!this.filtersContainer){u.warn("Cannot update filter state: filtersContainer not found");return}let t=c=>String(c).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),i=t(r),l=`.afs-filter-item[data-afs-filter-handle="${t(e)}"][data-afs-filter-value="${i}"]`,d=this.filtersContainer.querySelector(l);if(d){let c=d.querySelector(".afs-filter-item__checkbox");c?(c.checked=n,u.debug("Checkbox state updated",{handle:e,value:r,active:n})):u.warn("Checkbox not found in filter item",{handle:e,value:r}),d.classList.toggle("afs-filter-item--active",n)}else u.warn("Filter item not found for state update",{handle:e,value:r,active:n,selector:l})},renderInfo(e,r){if(!this.productsInfo)return;let n=this.sortContainer,t=this.productsInfo.querySelector(".afs-products-info__results");t&&t.remove();let i;if(r===0)i=o.txt(o.el("div","afs-products-info__results"),C.messages.noProductsFound);else if(r===1)i=o.txt(o.el("div","afs-products-info__results"),C.messages.oneProductFound);else{let a=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,r);i=o.txt(o.el("div","afs-products-info__results"),`${C.messages.showingProducts} ${a}-${l} of ${r} ${C.messages.productsFound}`)}n&&n.parentNode?this.productsInfo.insertBefore(i,n):(this.productsInfo.appendChild(i),n&&!n.parentNode&&this.productsInfo.appendChild(n))},renderPagination(e){var l;if(!this.productsGrid||!e)return;let r=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(r&&r.remove(),e.totalPages<=1)return;let n=o.el("div","afs-pagination"),t=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${C.buttons.previous} ${C.messages.pageOf.toLowerCase()}`});t.textContent=C.buttons.previous,t.disabled=e.page<=1,n.appendChild(t);let i=o.el("span","afs-pagination__info");i.textContent=`${C.messages.pageOf} ${e.page} of ${e.totalPages}`,n.appendChild(i);let a=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${C.buttons.next} ${C.messages.pageOf.toLowerCase()}`});a.textContent=C.buttons.next,a.disabled=e.page>=e.totalPages,n.appendChild(a),this.productsContainer&&this.productsContainer.appendChild(n)},renderApplied(e){if(!this.container)return;let r=this.container.querySelector(".afs-applied-filters");r&&r.remove();let n=this.container.querySelector("[data-afs-search-bar]"),t=[];if(Object.keys(e).forEach(c=>{let f=e[c];if(!o.equals(c,"cpid"))if(o.equals(c,"search")&&f&&typeof f=="string"&&f.trim())t.push({handle:c,label:`${C.labels.search}${f}`,value:f});else if(o.isPriceRangeKey(c)&&f&&typeof f=="object"&&!Array.isArray(f)){let b=f,m=typeof b.min=="number"&&!isNaN(b.min),g=typeof b.max=="number"&&!isNaN(b.max);if(m&&g){let p=Math.round(b.min),T=Math.round(b.max);t.push({handle:c,label:`${C.labels.price}$${p} - $${T}`,value:"__clear__"})}else if(m){let p=Math.round(b.min);t.push({handle:c,label:`${C.labels.price}$${p}+`,value:"__clear__"})}else if(g){let p=Math.round(b.max);t.push({handle:c,label:`${C.labels.price}Up to $${p}`,value:"__clear__"})}}else Array.isArray(f)&&f.length>0&&f.forEach(b=>{let m=s.filterMetadata.get(c),g=(m==null?void 0:m.label)||c,p=b;if((o.isCollectionOptionType(m==null?void 0:m.optionType)||o.isCollectionKey(c))&&s.collections&&Array.isArray(s.collections)){let v=s.collections.find(h=>{let y=String(h.id||h.gid||h.collectionId||"");return y&&String(y)===String(b)});v&&(p=v.title||v.label||v.name||b)}t.push({handle:c,label:`${g}: ${p}`,value:b})})}),t.length===0)return;let i=o.el("div","afs-applied-filters"),a=o.el("div","afs-applied-filters__header");a.appendChild(o.txt(o.el("div","afs-applied-filters__label"),C.labels.appliedFilters)),i.appendChild(a);let l=o.el("div","afs-applied-filters__list");t.forEach(c=>{let f=o.el("div","afs-applied-filter-chip");f.appendChild(o.txt(o.el("span","afs-applied-filter-chip__label"),c.label));let b=o.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":c.handle,"data-afs-filter-value":c.value,"aria-label":`${C.buttons.clear} filter`,type:"button"});b.innerHTML=F.close,f.appendChild(b),l.appendChild(f)});let d=o.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});d.textContent=C.buttons.clearAll,l.appendChild(d),i.appendChild(l),n&&n.nextSibling?this.container.insertBefore(i,n.nextSibling):n?n.insertAdjacentElement("afterend",i):this.container.insertBefore(i,this.container.firstChild)},scrollToProducts(){s.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products info")))},showLoading(e="both"){(e==="products"||e==="both")&&this.showProductsSkeleton(),(e==="filters"||e==="both")&&this.showFiltersSkeleton()},hideLoading(e="both"){var r;(e==="products"||e==="both")&&(Array.isArray(this.loading)?(this.loading.forEach(n=>{n.parentNode&&n.remove()}),this.loading=null):(r=this.loading)!=null&&r.parentNode&&(this.loading.remove(),this.loading=null)),(e==="filters"||e==="both")&&this.hideFiltersSkeleton()},showProductsSkeleton(){var t;if(!this.productsGrid)return;o.clear(this.productsGrid);let e=((t=s.pagination)==null?void 0:t.limit)||H.PAGE_SIZE||24,r=Math.max(e,24),n=[];for(let i=0;i<r;i++){let a=o.el("div","afs-skeleton-card");a.innerHTML=`
				<div class="afs-skeleton-card__image">&#8203;</div>
				<div class="afs-skeleton-card__info">
					<div class="afs-skeleton-card__title">&#8203;</div>
					<div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
					<div class="afs-skeleton-card__price">&#8203;</div>
				</div>
			`,n.push(a)}n.forEach(i=>this.productsGrid.appendChild(i)),this.loading=n},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let r=o.el("div","afs-filters-skeleton");for(let n=0;n<4;n++){let t=o.el("div","afs-skeleton-filter-group");t.innerHTML=`
				<div class="afs-skeleton-filter-group__header">
					<div class="afs-skeleton-filter-group__title">&#8203;</div>
				</div>
				<div class="afs-skeleton-filter-group__content">
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
				</div>
			`,r.appendChild(t)}this.filtersContainer.appendChild(r)},hideFiltersSkeleton(){var r;let e=(r=this.filtersContainer)==null?void 0:r.querySelector(".afs-filters-skeleton");e&&e.remove()},hideProductsSkeleton(){var r;let e=(r=this.filtersContainer)==null?void 0:r.querySelector(".afs-filters-skeleton");e&&e.remove()},showError(e){var t;if(!this.productsContainer&&(this.productsContainer=((t=this.container)==null?void 0:t.querySelector(".afs-products-container"))||null,!this.productsContainer&&this.container)){let i=this.container.querySelector(".afs-main-content");i&&(this.productsContainer=o.el("div","afs-products-container"),i.appendChild(this.productsContainer))}if(!this.productsContainer){u.error("Cannot show error: productsContainer not found",{message:e});return}if(this.hideLoading(),s.fallbackProducts&&s.fallbackProducts.length>0){u.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:s.fallbackProducts.length}),s.products=s.fallbackProducts,s.pagination={page:1,limit:H.PAGE_SIZE,total:s.fallbackProducts.length,totalPages:Math.ceil(s.fallbackProducts.length/H.PAGE_SIZE)},this.renderProducts(s.products),this.renderInfo(s.pagination,s.pagination.total),this.renderPagination(s.pagination);return}let r=this.productsContainer.querySelector(".afs-error-message");r&&r.remove();let n=o.el("div","afs-error-message");n.textContent=e||C.messages.failedToLoad,this.productsGrid?(o.clear(this.productsGrid),this.productsGrid.appendChild(n)):this.productsContainer.appendChild(n),u.error("Error displayed",{message:e})},setSortSelectValue(){if(_.sortSelect){if(o.isBestSelling(s.sort.field))_.sortSelect.value="best-selling";else{let e=o.equals(s.sort.order,"asc")?"ascending":"descending";_.sortSelect.value=`${s.sort.field}-${e}`}u.debug("Sort select value updated programmatically",{value:_.sortSelect.value,sort:s.sort})}}},ie={getPagination(){let r=M.parse().page||s.fallbackPagination.currentPage||1,n=s.fallbackPagination.totalPages||1,t=s.fallbackPagination.totalProducts||s.fallbackProducts.length||0;return{page:r,limit:H.PAGE_SIZE,total:t,totalPages:n}},reloadPage(e,r,n){let t=new URL(window.location.href);if(t.search="",n&&n.field)if(n.field==="best-selling"||n.field==="bestselling")t.searchParams.set("sort","best-selling");else{let i=o.equals(n.order,"asc")?"ascending":"descending";t.searchParams.set("sort",`${n.field}-${i}`)}r&&r.page&&t.searchParams.set("page",String(r.page)),Object.keys(e||{}).forEach(i=>{let a=e[i];if(!o.empty(a))if(Array.isArray(a)&&a.length>0)t.searchParams.set(i,a.join(","));else if(o.isPriceRangeKey(i)&&a&&typeof a=="object"&&!Array.isArray(a)){let l=a,d=typeof l.min=="number"&&!isNaN(l.min)?Math.round(l.min):void 0,c=typeof l.max=="number"&&!isNaN(l.max)?Math.round(l.max):void 0;s.priceRangeHandle?t.searchParams.set(s.priceRangeHandle,`${d!==void 0?d:""}-${c!==void 0?c:""}`):(d!==void 0&&t.searchParams.set("priceMin",String(d)),c!==void 0&&t.searchParams.set("priceMax",String(c)))}else o.equals(i,"search")&&typeof a=="string"&&a.trim()&&t.searchParams.set(i,a.trim())}),u.info("Reloading page for fallback mode",{url:t.toString(),sort:n,pagination:r}),window.location.href=t.toString()}};function Y(e){if(_.hideLoading(),u.error("Load failed",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,shop:s.shop,apiBaseURL:D.baseURL}),s.fallbackProducts&&s.fallbackProducts.length>0){if(u.warn("Initial load failed, using fallback products from Liquid",{error:e instanceof Error?e.message:String(e),fallbackCount:s.fallbackProducts.length}),s.usingFallback=!0,s.products=s.fallbackProducts,s.pagination=ie.getPagination(),s.availableFilters=[],_.hideFilters(),_.sortSelect)if(o.isBestSelling(s.sort.field))_.sortSelect.value="best-selling";else{let r=o.equals(s.sort.order,"asc")?"ascending":"descending";_.sortSelect.value=`${s.sort.field}-${r}`}_.renderProducts(s.products),_.renderInfo(s.pagination,s.pagination.total),_.renderPagination(s.pagination),_.renderApplied(s.filters)}else _.showError(`${C.messages.failedToLoad}: ${e instanceof Error?e.message:C.messages.unknownError}. ${C.messages.checkConsole}`)}var W={process:e=>{var n,t,i;u.info("Products loaded",{count:((n=e.products)==null?void 0:n.length)||0,total:((t=e.pagination)==null?void 0:t.total)||0}),!(e.products&&Array.isArray(e.products)&&e.products.length>0)&&s.fallbackProducts&&s.fallbackProducts.length>0?(u.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((i=e.products)==null?void 0:i.length)||0,fallbackCount:s.fallbackProducts.length}),s.usingFallback=!0,s.products=s.fallbackProducts,s.pagination=ie.getPagination(),s.availableFilters=[],_.hideFilters(),_.hideLoading("products")):(s.usingFallback=!1,s.products=e.products||[],s.pagination=e.pagination||s.pagination,_.showFilters(),_.renderProducts(s.products)),W.updateUI()},updateUI:()=>{_.renderInfo(s.pagination,s.pagination.total||0),_.renderPagination(s.pagination),_.renderApplied(s.filters),_.setSortSelectValue()}},x={process:e=>{debugger;try{s.availableFilters=e.filters||[];try{s.filterMetadata=fe.buildFilterMetadata(s.availableFilters)}catch(t){}let r=s.availableFilters.find(t=>o.isPriceRangeOptionType(t.optionType));s.priceRangeHandle=(r==null?void 0:r.handle)||s.priceRangeHandle||null,u.info("Filters set from URL",{filters:s.filters});let n=s.priceRangeHandle?s.filters[s.priceRangeHandle]:null;if(s.priceRangeHandle&&Array.isArray(n)&&n.length>0)try{let i=String(n[0]||"").split("-");if(i.length===2){let a=i[0].trim()?parseInt(i[0],10):void 0,l=i[1].trim()?parseInt(i[1],10):void 0,d=typeof a=="number"&&!isNaN(a)&&a>=0,c=typeof l=="number"&&!isNaN(l)&&l>=0;(d||c)&&(s.filters.priceRange={min:d?a:void 0,max:c?l:void 0},delete s.filters[s.priceRangeHandle])}}catch(t){}_.renderFilters(s.availableFilters),u.info("Filters rendered",{count:s.availableFilters.length})}catch(r){u.error("PROCESS FILTER ERROR",{error:r instanceof Error?r.message:String(r)})}finally{W.updateUI(),_.hideLoading("filters")}},toggle(e,r){var l;let n=o.str(r);if(!n||!e){u.warn("Invalid filter toggle",{handle:e,value:r});return}let t=s.filters[e]||[],i=t.includes(n),a=i?t.filter(d=>d!==n):[...t,n];if(a.length===0?delete s.filters[e]:s.filters[e]=a,s.pagination.page=1,u.debug("Filter toggled",{handle:e,value:n,wasActive:i,isActive:!i,filterValues:a}),M.update(s.filters,s.pagination,s.sort),_.updateFilterState(e,n,!i),_.scrollToProducts(),_.showLoading("products"),window.innerWidth<=768&&((l=_.filtersContainer)!=null&&l.classList.contains("afs-filters-container--open"))){_.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let d=document.body.style.top;d&&window.scrollTo(0,parseInt(d||"0",10)*-1)}this.apply()},updatePriceRange(e,r){if(e=Math.round(e),r=Math.round(r),typeof e!="number"||typeof r!="number"||e<0||r<e){u.warn("Invalid price range",{min:e,max:r});return}let n=s.availableFilters.find(t=>o.isPriceRangeOptionType(t.optionType)||o.equals(t.optionKey,"priceRange"));if(n&&n.range){let t=Math.round(n.range.min),i=Math.round(n.range.max);e===t&&r===i?s.filters.priceRange=null:s.filters.priceRange={min:e,max:r}}else s.filters.priceRange={min:e,max:r};s.pagination.page=1,u.debug("Price range updated",{min:e,max:r,priceRange:s.filters.priceRange}),M.update(s.filters,s.pagination,s.sort),_.scrollToProducts(),_.showLoading("products"),this.apply()},applyProductsOnly:o.debounce(async()=>{if(u.info("applyProductsOnly called",{filters:s.filters,pagination:s.pagination,sort:s.sort,usingFallback:s.usingFallback}),s.usingFallback){u.info("In fallback mode, reloading page with new parameters"),ie.reloadPage(s.filters,s.pagination,s.sort);return}_.scrollToProducts(),D.products(s.filters,s.pagination,s.sort).then(W.process)},H.DEBOUNCE),apply:o.debounce(async()=>{_.scrollToProducts(),D.products(s.filters,s.pagination,s.sort).then(W.process).catch(Y).finally(()=>{_.hideProductsSkeleton()}),D.filters(s.filters).then(x.process).catch(Y).finally(()=>{_.hideFiltersSkeleton()})},H.DEBOUNCE)},de={async add(e,r){try{let n=`/products/${e}.json`,t=await fetch(n);if(!t.ok)throw new Error(C.messages.failedToLoadProduct);let a=(await t.json()).product;if(!a||!a.variants||a.variants.length===0)throw new Error("Product has no variants");let l=a.variants.find(d=>d.available)||a.variants[0];await this.addVariant(Number(l.id),1)}catch(n){u.error("Quick add failed",{error:n instanceof Error?n.message:String(n),handle:e}),_.showError("Failed to add product to cart. Please try again.")}},async addFromForm(e,r){var n,t;try{let i=new FormData(e),a=i.get("id"),l=parseInt(((n=i.get("quantity"))==null?void 0:n.toString())||"1",10);if(a)await this.addVariant(Number(a),l);else{let d=[];for(let p=1;p<=3;p++){let T=i.get(`option${p}`);T&&d.push(T.toString())}let c=`/products/${r}.json`,g=(t=(await(await fetch(c)).json()).product.variants)==null?void 0:t.find(p=>p.options?p.options.length===d.length&&p.options.every((T,v)=>T===d[v]):!1);if(g)await this.addVariant(Number(g.id),l);else throw new Error("Variant not found")}}catch(i){u.error("Add from form failed",{error:i instanceof Error?i.message:String(i)}),_.showError("Failed to add product to cart. Please try again.")}},async addVariant(e,r){try{let n=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:r})});if(!n.ok){let t=await n.json();throw new Error(t.description||C.messages.failedToAddToCart)}await n.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(n){throw u.error("Add variant failed",{error:n instanceof Error?n.message:String(n),variantId:e}),n}},showSuccess(){let e=document.querySelector(".afs-quick-add-success");e||(e=o.el("div","afs-quick-add-success"),document.body.appendChild(e)),e.textContent=C.messages.addedToCart,e.classList.add("afs-quick-add-success--show");let r=()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",r)},n=setTimeout(()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",r)},3e3);e.addEventListener("animationend",()=>{clearTimeout(n),r()},{once:!0})}},le={init(e={}){var r,n,t,i;try{if(u.init(e.debug),u.info("Initializing AFS",e),e.apiBaseUrl&&(D.setBaseURL(e.apiBaseUrl),u.info("API base URL set",{url:D.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");if(s.shop=e.shop,s.collections=e.collections||[],s.selectedCollection={id:(n=(r=e.selectedCollection)==null?void 0:r.id)!=null?n:null,sortBy:(i=(t=e.selectedCollection)==null?void 0:t.sortBy)!=null?i:null},s.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.isSearchTemplate&&(window.AFS_Config={isSearchTemplate:!0}),e.initialSearchQuery){let c=M.parse();!c.search&&!c.q&&(s.filters.search=e.initialSearchQuery)}e.moneyFormat&&(s.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(s.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(s.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(s.fallbackProducts=e.fallbackProducts,u.info("Fallback products loaded from Liquid",{count:s.fallbackProducts.length})),e.fallbackPagination&&(s.fallbackPagination=e.fallbackPagination,u.info("Fallback pagination loaded from Liquid",{currentPage:s.fallbackPagination.currentPage,totalPages:s.fallbackPagination.totalPages,totalProducts:s.fallbackPagination.totalProducts})),e.priceRangeHandle!==void 0&&(s.priceRangeHandle=e.priceRangeHandle),u.info("Shop set",{shop:s.shop}),u.info("Collections set",{collections:s.collections});let a=e.containerSelector||e.container||"[data-afs-container]",l=e.filtersSelector||e.filtersContainer,d=e.productsSelector||e.productsContainer;_.init(a,l,d),u.info("DOM initialized"),_.showLoading("both"),_.attachEvents(),u.info("DOM events attached"),this.load()}catch(a){throw u.error("Initialization failed",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,config:e}),_.container&&_.showError(`Initialization failed: ${a instanceof Error?a.message:String(a)}`),a}},async load(){_.showLoading("both");try{let e=M.parse();u.debug("Parsed URL params on load",{urlParams:e}),D.buildFiltersFromUrl(e),D.setPaginationFromUrl(e),D.setSortFromUrl(e),u.info("Loading products & filters...",{shop:s.shop,filters:s.filters}),D.filters(s.filters).then(x.process).catch(Y).finally(()=>{_.hideFiltersSkeleton()}),D.products(s.filters,s.pagination,s.sort).then(W.process).catch(Y).finally(()=>{_.hideFiltersSkeleton()})}catch(e){Y(e)}},Logger:u},ne=class{constructor(r,n={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.currentZoom=2;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let t=typeof r=="string"?document.querySelector(r):r;if(!t)throw u.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=t,this.options={thumbnailsPosition:n.thumbnailsPosition||"left",enableKeyboard:n.enableKeyboard!==!1,enableAutoHeight:n.enableAutoHeight!==!1,maxHeight:n.maxHeight||null,animationDuration:n.animationDuration||300,enableMagnifier:n.enableMagnifier!==!1,magnifierZoom:n.magnifierZoom||3,...n},this.magnifierEnabled=this.options.enableMagnifier,this.currentZoom=this.options.magnifierZoom||3,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){u.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){u.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let r=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(r),this.images.length===0){u.error("AFSSlider: No images found");return}let n=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(n),this.thumbnails.length===0&&u.warn("AFSSlider: No thumbnails found, continuing without thumbnails"),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(t){u.error("AFSSlider: Error building slider structure",{error:t instanceof Error?t.message:String(t)});return}try{this.setupEvents()}catch(t){u.error("AFSSlider: Error setting up events",{error:t instanceof Error?t.message:String(t)})}if(this.magnifierEnabled&&!this.isTouchDevice)try{setTimeout(()=>{this.setupPanZoom()},0)}catch(t){u.error("AFSSlider: Error setting up pan-zoom",{error:t instanceof Error?t.message:String(t)})}if(this.isTouchDevice)try{this.setupPinchZoom()}catch(t){u.error("AFSSlider: Error setting up pinch-zoom",{error:t instanceof Error?t.message:String(t)})}try{this.goToSlide(0)}catch(t){u.error("AFSSlider: Error showing first slide",{error:t instanceof Error?t.message:String(t)})}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let t=document.createElement("div");t.className="afs-slider__viewport",this.images.forEach(i=>{t.appendChild(i)}),this.mainContainer.appendChild(t),this.magnifierEnabled&&!this.isTouchDevice&&this.createZoomControls(t)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let t=document.createElement("button");t.type="button",t.className="afs-slider__prev",t.setAttribute("aria-label","Previous image"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(t)}if(!this.mainContainer.querySelector(".afs-slider__next")){let t=document.createElement("button");t.type="button",t.className="afs-slider__next",t.setAttribute("aria-label","Next image"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(t)}if(this.thumbnails.length===0&&this.thumbnailContainer){let t=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(t)}this.thumbnails.forEach((t,i)=>{var l;let a=t.cloneNode(!0);(l=t.parentNode)==null||l.replaceChild(a,t),this.thumbnails[i]=a,a.addEventListener("click",()=>{this.goToSlide(i)})});let r=this.mainContainer.querySelector(".afs-slider__prev"),n=this.mainContainer.querySelector(".afs-slider__next");r&&r.addEventListener("click",()=>this.prevSlide()),n&&n.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=r=>{if(!this.isInitialized)return;let n=this.container.getBoundingClientRect();if(!(n.width===0||n.height===0))switch(r.key){case"ArrowLeft":r.preventDefault(),this.prevSlide();break;case"ArrowRight":r.preventDefault(),this.nextSlide();break;case"Escape":let t=this.images[this.currentIndex];t&&(t.classList.remove("afs-slider__image--zoomed"),t.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{t.classList.remove("afs-slider__image--zoom-reset")},200));break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let r=0,n=0,t=!1,i=this.mainContainer.querySelector(".afs-slider__viewport");i&&(i.addEventListener("touchstart",a=>{r=a.touches[0].clientX,n=a.touches[0].clientY,t=!0},{passive:!0}),i.addEventListener("touchmove",a=>{t&&a.preventDefault()},{passive:!1}),i.addEventListener("touchend",a=>{if(!t)return;t=!1;let l=a.changedTouches[0].clientX,d=a.changedTouches[0].clientY,c=r-l,f=n-d;Math.abs(c)>Math.abs(f)&&Math.abs(c)>50&&(c>0?this.nextSlide():this.prevSlide())},{passive:!0}))}createZoomControls(r){let n=document.createElement("div");n.className="afs-slider__zoom-controls";let t=document.createElement("input");t.type="range",t.className="afs-slider__zoom-slider",t.setAttribute("min","2"),t.setAttribute("max","5"),t.setAttribute("step","1"),t.setAttribute("value",String(this.currentZoom)),t.setAttribute("aria-label","Zoom level"),t.setAttribute("aria-valuemin","2"),t.setAttribute("aria-valuemax","5"),t.addEventListener("input",i=>{i.stopPropagation();let a=Number(i.target.value);this.setZoomLevel(a)}),t.addEventListener("mousedown",i=>{i.stopPropagation()}),n.appendChild(t),r.appendChild(n)}setZoomLevel(r){var i;this.currentZoom=r;let n=(i=this.mainContainer)==null?void 0:i.querySelector(".afs-slider__viewport");if(n){let a=n.querySelector(".afs-slider__zoom-slider");a&&(a.value=String(r),a.setAttribute("aria-valuenow",String(r)))}let t=this.images[this._currentIndex];t&&t.classList.contains("afs-slider__image--zoomed")&&(t.style.transform="scale(1) translate(0, 0)",setTimeout(()=>{},50))}setupPanZoom(){if(!this.mainContainer)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r){u.warn("AFSSlider: Viewport not found for pan-zoom, skipping zoom setup");return}r.classList.add("afs-slider__viewport--zoomable"),r.addEventListener("mousemove",n=>{let t=this.images[this._currentIndex];if(!t)return;let i=r.getBoundingClientRect(),a=n.clientX-i.left,l=n.clientY-i.top,d=a/i.width,c=l/i.height,f=this.currentZoom,b=-d*(t.offsetWidth*f-i.width),m=-c*(t.offsetHeight*f-i.height);t.style.transform=`
		scale(${f})
		translate(${b/f}px, ${m/f}px)
	  `,t.classList.add("afs-slider__image--zoomed")}),r.addEventListener("mouseenter",()=>{let n=this.images[this._currentIndex];n&&n.classList.add("afs-slider__image--zoomed")}),r.addEventListener("mouseleave",()=>{let n=this.images[this._currentIndex];n&&(n.style.transform="scale(1) translate(0, 0)",n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200))})}setupPinchZoom(){if(!this.mainContainer||!this.isTouchDevice)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r)return;let n=0,t=1,i=0,a=null;r.addEventListener("touchstart",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1];n=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY);let f=this.images[this._currentIndex];if(f){let m=(f.style.transform||"").match(/scale\(([\d.]+)\)/);t=m?parseFloat(m[1]):1}}else if(l.touches.length===1){let d=Date.now();if(d-i<300){l.preventDefault(),a&&clearTimeout(a);let c=this.images[this._currentIndex];if(c){let b=(c.style.transform||"").match(/scale\(([\d.]+)\)/),m=b?parseFloat(b[1]):1;if(m>1)c.style.transform="scale(1) translate(0, 0)",m=1;else{let g=r.getBoundingClientRect(),p=l.touches[0],T=p.clientX-g.left,v=p.clientY-g.top,h=2.5;c.style.transform=`scale(${h}) translate(${(g.width/2-T)/h}px, ${(g.height/2-v)/h}px)`,m=h}}}else i=d}},{passive:!1}),r.addEventListener("touchmove",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1],f=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY),b=Math.max(1,Math.min(4,t*(f/n))),m=this.images[this._currentIndex];if(m){let g=r.getBoundingClientRect(),p=(d.clientX+c.clientX)/2-g.left,T=(d.clientY+c.clientY)/2-g.top,v=(g.width/2-p)/b,h=(g.height/2-T)/b;m.style.transform=`scale(${b}) translate(${v}px, ${h}px)`}}},{passive:!1}),r.addEventListener("touchend",()=>{n=0})}goToSlide(r){if(r<0||r>=this.images.length)return;this._currentIndex=r,this.images.forEach((t,i)=>{i===r?t.classList.add("afs-slider__image--active"):t.classList.remove("afs-slider__image--active")});let n=this.images[this._currentIndex];n&&(n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200)),this.thumbnails.forEach((t,i)=>{t.classList.toggle("afs-slider__thumbnail--active",i===r)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:r,total:this.images.length}}))}prevSlide(){let r=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(r)}nextSlide(){let r=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(r)}adjustHeight(){let r=this.images[this._currentIndex];r&&(r.complete?this.setHeight(r):r.addEventListener("load",()=>{this.setHeight(r)},{once:!0}))}setHeight(r){if(!this.mainContainer)return;let n=this.mainContainer.querySelector(".afs-slider__viewport");if(!n)return;if(this.options.maxHeight){n.style.height=`${this.options.maxHeight}px`,n.style.minHeight=`${this.options.maxHeight}px`,n.style.maxHeight=`${this.options.maxHeight}px`;return}let t=r.naturalHeight||r.offsetHeight,i=r.naturalWidth||r.offsetWidth,a=this.mainContainer.offsetWidth,l=t/i,d=a*l;n.style.height=`${d}px`,n.style.minHeight=`${d}px`}updateVariantImage(r,n,t){var b;if(!r||!n||!Array.isArray(n)||n.length===0)return!1;let i=r.id;if(t&&Array.isArray(t)){if(r.featured_image&&typeof r.featured_image=="object"&&r.featured_image.variant_ids){let m=r.featured_image.position;if(m!=null){let g=m-1;if(g>=0&&g<this.images.length&&g<n.length)return this._currentIndex!==g&&this.goToSlide(g),!0}}for(let m of t)if(m.featured_image&&typeof m.featured_image=="object"&&m.featured_image.variant_ids&&m.featured_image.variant_ids.includes(Number(i))){let g=m.featured_image.position;if(g!=null){let p=g-1;if(p>=0&&p<this.images.length&&p<n.length)return this._currentIndex!==p&&this.goToSlide(p),!0}}}let a=null,l=null;if(r.featured_image&&(typeof r.featured_image=="object"?(a=r.featured_image.src||r.featured_image.url||null,l=(b=r.featured_image.position)!=null?b:null):typeof r.featured_image=="string"&&(a=r.featured_image)),a||(typeof r.image=="string"?a=r.image:r.image&&typeof r.image=="object"?a=r.image.url||r.image.src||null:r.imageUrl?a=r.imageUrl:r.featuredImage&&typeof r.featuredImage=="object"&&(a=r.featuredImage.url||r.featuredImage.src||null)),!a)return!1;let d=m=>m?(typeof m=="string"?m:(m==null?void 0:m.url)||(m==null?void 0:m.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",c=d(a);if(l!=null){let m=l-1;if(m>=0&&m<this.images.length&&m<n.length)return this._currentIndex!==m&&this.goToSlide(m),!0}let f=n.findIndex(m=>{let g=d(m);return g===c||g.includes(c)||c.includes(g)});if(f===-1){let m=c.split("/").pop();f=n.findIndex(g=>d(g).split("/").pop()===m)}return f!==-1&&f<this.images.length?(this._currentIndex!==f&&this.goToSlide(f),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(r=>{r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200)}),this.isInitialized=!1}};async function ge(e,r){var l,d,c,f,b,m,g,p,T,v;let n=o.el("dialog","afs-product-modal",{id:r}),t=((d=(l=C)==null?void 0:l.labels)==null?void 0:d.loadingProduct)||"Loading product...";n.innerHTML=`
	  <div class="afs-product-modal__container">
		<div class="afs-product-modal__close-container">
		  <button class="afs-product-modal__close" type="button">${F.close}</button>
		</div>
		<div class="afs-product-modal__content">
		  <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
			${t}
		  </div>
		</div>
	  </div>
	`;let a=`${U.Shopify&&U.Shopify.routes&&U.Shopify.routes.root||"/"}products/${e}.js`;try{let h=await fetch(a);if(!h.ok){let P=await h.text().catch(()=>""),k=`Failed to load product: HTTP ${h.status} ${h.statusText}${P?" - "+P.substring(0,100):""}`;throw u.error("Product fetch failed",{status:h.status,statusText:h.statusText,url:a,errorText:P}),new Error(k)}let y=await h.json();if(!y.variants||!Array.isArray(y.variants))throw new Error("Invalid product data structure");let E=y.variants.find(P=>B(P))||y.variants[0],S=E?E.id:null,L=()=>{if(!y.variants||y.variants.length===0)return"";if(y.variants.length===1){let w=y.variants[0].title;if(w&&o.equals(w,"Default Title"))return""}if(!y.options||y.options.length===0)return"";let P='<div class="afs-product-modal__variant-selector">';return y.options.forEach((k,w)=>{var K;P+='<div class="afs-product-modal__option-group">',P+=`<label class="afs-product-modal__option-label">${k.name}</label>`,P+='<div class="afs-product-modal__option-values">';let q=[...new Set(y.variants.map(A=>w===0?A.option1:w===1?A.option2:A.option3).filter(Boolean))],Z=Array.from({length:((K=y.options)==null?void 0:K.length)||0},(A,$)=>$===w||!E?null:$===0?E.option1||null:$===1?E.option2||null:E.option3||null);q.forEach(A=>{if(!A)return;let $=te(y,w,A,Z),j=E&&(w===0&&E.option1===A||w===1&&E.option2===A||w===2&&E.option3===A),J=y.variants.find(ee=>w===0?ee.option1===A:w===1?ee.option2===A:ee.option3===A);P+=`<button 
			  class="afs-product-modal__option-value ${j?"afs-product-modal__option-value--selected":""} ${$?"":"afs-product-modal__option-value--unavailable"}"
			  data-option-index="${w}"
			  data-option-value="${A}"
			  data-variant-id="${J?J.id:""}"
			  ${$?"":"disabled"}
			  type="button"
			>${A}</button>`}),P+="</div></div>"}),P+="</div>",P},O=(()=>{if(!y.images||y.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let P='<div class="afs-slider__thumbnails">';y.images.forEach((w,q)=>{let Z=q===0?"afs-slider__thumbnail--active":"",K=o.optimizeImageUrl(w,{width:100,height:100,crop:"center",format:"webp",quality:75}),$=[80,100,120].map(j=>`${o.optimizeImageUrl(w,{width:j,height:j,crop:"center",format:"webp",quality:75})} ${j}w`).join(", ");P+=`
			<div class="afs-slider__thumbnail ${Z}" data-slide-index="${q}">
			  <img 
				src="${K}" 
				srcset="${$}"
				sizes="100px"
				alt="${y.title} - Thumbnail ${q+1}" 
				loading="lazy"
				width="100"
				height="100"
			  />
			</div>
		  `}),P+="</div>";let k='<div class="afs-slider__main">';return y.images.forEach((w,q)=>{let Z=o.optimizeImageUrl(w,{width:800,height:800,format:"webp",quality:85}),A=[400,600,800,1e3,1200].map($=>`${o.optimizeImageUrl(w,{width:$,height:$,format:"webp",quality:$<=600?80:85})} ${$}w`).join(", ");k+=`
			<img 
			  class="afs-slider__image" 
			  src="${Z}" 
			  srcset="${A}"
			  sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
			  alt="${y.title} - Image ${q+1}" 
			  loading="${q===0?"eager":"lazy"}"
			/>
		  `}),k+="</div>",{thumbnails:P,mainImages:k}})(),G=L(),z=P=>o.formatMoney(P,s.moneyFormat||"{{amount}}",s.currency||""),N=y.variants.find(P=>P.id===S)||E,X=z(N.price),R=N.compare_at_price&&N.compare_at_price>N.price?`<span class="afs-product-modal__compare-price">${z(N.compare_at_price)}</span>`:"";n.innerHTML=`
		<div class="afs-product-modal__container">
		  <div class="afs-product-modal__close-container">
			<button class="afs-product-modal__close" type="button">${F.close}</button>
		  </div>
		  <div class="afs-product-modal__content">
			<div class="afs-product-modal__layout">
			  <div class="afs-product-modal__media">
				<div class="afs-slider" id="${r}-slider">
				  ${O.mainImages}
				  ${O.thumbnails}
				</div>
			  </div>
			  <div class="afs-product-modal__details">
				<div class="afs-product-modal__header">
				  <div>
					<span class="afs-product-modal__vendor">${y.vendor||""}</span>
				  </div>
				  <h1 class="afs-product-modal__title">${y.title||""}</h1>
				  <div class="afs-product-modal__price-container">
					<span class="afs-product-modal__price">${X}</span>
					${R}
				  </div>
				</div>
				${G}
				<div class="afs-product-modal__buttons">
				  <div class="afs-product-modal__add-to-cart">
					<div class="afs-product-modal__incrementor">
					  <button class="afs-product-modal__decrease" type="button">${F.minus}</button>
					  <span class="afs-product-modal__count" id="${r}-count">1</span>
					  <button class="afs-product-modal__increase" type="button">${F.plus}</button>
					</div>
					<button
					  class="afs-product-modal__add-button"
					  id="${r}-add-button"
					  data-variant-id="${S}"
					  ${B(N)?"":"disabled"}
					  type="button"
					>
					  ${B(N)?((m=(b=C)==null?void 0:b.buttons)==null?void 0:m.addToCart)||"Add to cart":((f=(c=C)==null?void 0:c.buttons)==null?void 0:f.soldOut)||"Sold out"}
					</button>
				  </div>
				  <button
					class="afs-product-modal__buy-button"
					id="${r}-buy-button"
					data-variant-id="${S}"
					${B(N)?"":"disabled"}
					type="button"
				  >
					${((p=(g=C)==null?void 0:g.buttons)==null?void 0:p.buyNow)||"Buy it now"}
				  </button>
				</div>
				<div class="afs-product-modal__description">
				  <span class="afs-product-modal__description-text">
					${y.description||""}
				  </span>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	  `,n._productData=y,n._currentVariantId=S||void 0,(async()=>{try{let P=await Q(`#${r}-slider`,n,3e3),k=await se(Array.from({length:10},(w,q)=>`.afs-slider__image:nth-child(${q+1})`),P,2e3).catch(()=>Array.from(P.querySelectorAll(".afs-slider__image")));await Q(".afs-slider__thumbnails",P,1e3).catch(()=>{u.warn("Thumbnails container not found, slider will continue without thumbnails",{modalId:r})}),k.length>0?n._slider=new ne(P,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}):u.warn("No images found for slider",{modalId:r})}catch(P){u.error("Failed to initialize slider",{error:P instanceof Error?P.message:String(P),modalId:r})}})(),me(n,r,y,z)}catch(h){let y=h instanceof Error?h.message:String(h),E=h instanceof Error?{message:y,stack:h.stack}:{message:y};u.error("Failed to load product for modal",{error:E,handle:e,productUrl:a,responseStatus:h instanceof Error&&"status"in h?h.status:void 0});let S=((v=(T=C)==null?void 0:T.messages)==null?void 0:v.failedToLoadProductModal)||"Failed to load product. Please try again.";n.innerHTML=`
		<div class="afs-product-modal__container">
		  <div class="afs-product-modal__close-container">
			<button class="afs-product-modal__close" type="button">${F.close}</button>
		  </div>
		  <div class="afs-product-modal__content">
			<div style="padding: 2rem; text-align: center;">
			  <p>${S}</p>
			  ${u.enabled?`<p style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">Error: ${y}</p>`:""}
			</div>
		  </div>
		</div>
	  `,he(n)}return n}function me(e,r,n,t){let i=e.querySelector(".afs-product-modal__close"),a=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};i&&i.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),a()}),e.addEventListener("cancel",g=>{g.preventDefault(),a()}),e.addEventListener("click",g=>{g.target===e&&a()});let l=e.querySelector(".afs-product-modal__decrease"),d=e.querySelector(".afs-product-modal__increase"),c=e.querySelector(`#${r}-count`);l&&c&&l.addEventListener("click",()=>{let g=parseInt(c.textContent||"1",10)||1;g>1&&(c.textContent=String(g-1))}),d&&c&&d.addEventListener("click",()=>{let g=parseInt(c.textContent||"1",10)||1;c.textContent=String(g+1)}),e.querySelectorAll(".afs-product-modal__option-value").forEach(g=>{g.addEventListener("click",()=>{if(g.disabled)return;let p=Number(g.dataset.optionIndex),T=g.dataset.optionValue,v=ae(e,n.options.length);v[p]=T,e.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${p}"]`).forEach(S=>S.classList.remove("afs-product-modal__option-value--selected")),g.classList.add("afs-product-modal__option-value--selected"),e.querySelectorAll(".afs-product-modal__option-value").forEach(S=>{let L=Number(S.dataset.optionIndex),I=S.dataset.optionValue,O=te(n,L,I,v);S.disabled=!O,S.classList.toggle("afs-product-modal__option-value--unavailable",!O)});let h=oe(n.variants,v),E=h.find(S=>B(S))||h[0];if(E)if(e._slider)re(e,r,E,t);else{let S=(L=0)=>{e._slider?re(e,r,E,t):L<20?setTimeout(()=>S(L+1),100):(u.warn("Slider not ready for variant update",{modalId:r}),re(e,r,E,t))};S()}else u.warn("No matching variant found for selected options",{selected:v.filter(Boolean),matchesCount:h.length})})});let b=e.querySelector(`#${r}-add-button`);b&&c&&b.addEventListener("click",async()=>{var T,v;if(b.disabled)return;let g=parseInt(c.textContent||"1",10)||1,p=b.dataset.variantId;try{await de.addVariant(parseInt(p||"0",10),g),a()}catch(h){u.error("Failed to add to cart from modal",{error:h instanceof Error?h.message:String(h)}),_.showError(((v=(T=C)==null?void 0:T.messages)==null?void 0:v.failedToAddToCart)||"Failed to add product to cart. Please try again.")}});let m=e.querySelector(`#${r}-buy-button`);m&&c&&m.addEventListener("click",async()=>{var T,v;if(m.disabled)return;let g=parseInt(c.textContent||"1",10)||1,p=m.dataset.variantId;try{let h=U.Shopify&&U.Shopify.routes&&U.Shopify.routes.root||"/";window.location.href=`${h}cart/${p}:${g}?checkout`}catch(h){u.error("Failed to buy now",{error:h instanceof Error?h.message:String(h)}),_.showError(((v=(T=C)==null?void 0:T.messages)==null?void 0:v.failedToProceedToCheckout)||"Failed to proceed to checkout. Please try again.")}})}function re(e,r,n,t){var c,f,b,m;e._currentVariantId=n.id;let i=e.querySelector(".afs-product-modal__price-container");if(i){let g=t(n.price),p=n.compare_at_price&&n.compare_at_price>n.price?`<span class="afs-product-modal__compare-price">${t(n.compare_at_price)}</span>`:"";i.innerHTML=`
        <span class="afs-product-modal__price">${g}</span>
        ${p}
      `}let a=e.querySelector(`#${r}-add-button`);if(a){let g=B(n);a.dataset.variantId=String(n.id),a.disabled=!g,a.innerHTML=g?((m=(b=C)==null?void 0:b.buttons)==null?void 0:m.addToCart)||"Add to cart":((f=(c=C)==null?void 0:c.buttons)==null?void 0:f.soldOut)||"Sold out"}let l=e.querySelector(`#${r}-buy-button`);if(l){let g=B(n);l.dataset.variantId=String(n.id),l.disabled=!g}let d=e._productData;if(d&&d.images&&d.variants){if(!e._slider){u.debug("Slider not ready, skipping image update",{variantId:n.id});return}let g=n.id,p=null;if(n.featured_image&&typeof n.featured_image=="object"&&n.featured_image.variant_ids){let h=n.featured_image.position;if(h!=null){let y=h-1;y>=0&&y<d.images.length&&(e._slider.currentIndex||0)!==y&&(p=y)}}else for(let h of d.variants)if(h.featured_image&&typeof h.featured_image=="object"&&h.featured_image.variant_ids&&h.featured_image.variant_ids.includes(Number(g))){let y=h.featured_image.position;if(y!=null){let E=y-1;if(E>=0&&E<d.images.length&&(e._slider.currentIndex||0)!==E){p=E;break}}}if(p!==null&&e._slider.goToSlide){e._slider.goToSlide(p);return}if(e._slider.updateVariantImage&&d.images&&e._slider.updateVariantImage(n,d.images,d.variants))return;let T=null,v=null;if(n.featured_image&&(typeof n.featured_image=="object"?(T=n.featured_image.src||n.featured_image.url||null,v=n.featured_image.position||null):typeof n.featured_image=="string"&&(T=n.featured_image)),T||(T=(typeof n.image=="string"?n.image:null)||n.imageUrl||n.image&&typeof n.image=="object"&&(n.image.url||n.image.src)||null||n.featuredImage&&typeof n.featuredImage=="object"&&(n.featuredImage.url||n.featuredImage.src)||null),T&&d.images&&e._slider.goToSlide){let h=S=>S?(typeof S=="string"?S:S&&typeof S=="object"&&(S.url||S.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(v!=null){let S=v-1;if(S>=0&&S<d.images.length){e._slider.goToSlide(S);return}}let y=h(T),E=d.images.findIndex(S=>{let L=h(S);return L===y||L.includes(y)||y.includes(L)});if(E!==-1)e._slider.goToSlide(E);else{let S=y.split("/").pop();if(S){let L=d.images.findIndex(I=>h(I).split("/").pop()===S);L!==-1&&e._slider.goToSlide&&e._slider.goToSlide(L)}}}}}function he(e){let r=e.querySelector(".afs-product-modal__close"),n=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};r&&r.addEventListener("click",n),e.addEventListener("cancel",n),e.addEventListener("click",t=>{t.target===e&&n()})}function ye(e){var i,a;if(!e.handle)return null;let r=((a=(i=C)==null?void 0:i.buttons)==null?void 0:a.quickView)||"Quick view",n=o.el("button","afs-product-card__quick-view",{"data-product-handle":e.handle,"data-product-id":String(e.id||e.productId||e.gid||""),"aria-label":r,type:"button"}),t=o.el("span","afs-product-card__quick-view-icon");return t.innerHTML=F.eye,n.appendChild(t),n}function be(e){if(!e)return;let r=`product-modal-${e}`,n=document.getElementById(r);(async()=>{n||(n=await ge(e,r),document.body.appendChild(n)),n.showModal?(document.body.style.overflow="hidden",n.showModal()):(document.body.style.overflow="hidden",n.style.display="block");let i=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};n.addEventListener("close",i,{once:!0});let a=new MutationObserver(()=>{n&&!n.open&&!n.hasAttribute("open")&&(i(),a.disconnect())});n&&a.observe(n,{attributes:!0,attributeFilter:["open"]})})().catch(i=>{var d,c;let a=i instanceof Error?i.message:String(i);u.error("Failed to open product modal",{error:a,handle:e,stack:i instanceof Error?i.stack:void 0});let l=((c=(d=C)==null?void 0:d.messages)==null?void 0:c.failedToLoadProductModal)||"Failed to load product. Please try again.";_&&typeof _.showError=="function"?_.showError(l):alert(l)})}var U=window;typeof window!="undefined"?(U.AFS=le,U.AFS_State=s):typeof global!="undefined"&&(global.AFS=le);
