"use strict";function J(e){if(C.hideLoading(),f.error("Load failed",{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,shop:i.shop,apiBaseURL:x.baseURL}),i.fallbackProducts&&i.fallbackProducts.length>0){if(f.warn("Initial load failed, using fallback products from Liquid",{error:e instanceof Error?e.message:String(e),fallbackCount:i.fallbackProducts.length}),i.usingFallback=!0,i.products=i.fallbackProducts,i.pagination=G.getPagination(),i.availableFilters=[],C.hideFilters(),C.sortSelect)if(a.isBestSelling(i.sort.field))C.sortSelect.value="best-selling";else{let r=a.equals(i.sort.order,"asc")?"ascending":"descending";C.sortSelect.value=`${i.sort.field}-${r}`}C.renderProducts(i.products),C.renderInfo(i.pagination,i.pagination.total),C.renderPagination(i.pagination),C.renderApplied(i.filters)}else C.showError(`${_.messages.failedToLoad}: ${e instanceof Error?e.message:_.messages.unknownError}. ${_.messages.checkConsole}`)}var B=new Map;var O={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24},M={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'},le=new Set(["shop","shop_domain","cpid"]),_={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",soldOut:"Sold out",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}},a={debounce:(e,r)=>{let t;return(...n)=>{t!==void 0&&clearTimeout(t),t=setTimeout(()=>e(...n),r)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>a.equalsAny(a.toLowerCase(e==null?void 0:e.selectionType),"multiple")||a.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(r=>String(r).trim()).filter(Boolean):String(e).split(",").map(r=>r.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let r=e.productId||e.id||e.gid;return r&&String(r).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,r,t={})=>{let n=document.createElement(e);return r&&(n.className=r),Object.entries(t).forEach(([s,o])=>n.setAttribute(s,o)),n},txt:(e,r)=>(e.textContent=r,e),clear:e=>{for(;e.firstChild;){let r=e.firstChild;r&&e.removeChild(r)}},frag:(e,r)=>{let t=document.createDocumentFragment();return e.forEach(n=>t.appendChild(r(n))),t},optimizeImageUrl:(e,r={})=>{if(!e||typeof e!="string")return"";let{width:t=500,height:n=t,quality:s=80,format:o="webp",crop:l=null}=r;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let c=new URL(e),u=new URLSearchParams(c.search);return u.delete("width"),u.delete("height"),u.delete("crop"),u.delete("format"),u.delete("quality"),u.set("width",String(t)),u.set("height",String(n)),l&&u.set("crop",l),s!==100&&u.set("quality",String(s)),!c.pathname.toLowerCase().endsWith(".gif")&&o&&u.set("format",o),`${c.origin}${c.pathname}?${u.toString()}`}catch(c){return e}},buildImageSrcset:(e,r=[200,300,500])=>e?r.map(t=>`${a.optimizeImageUrl(e,{width:t,format:"webp",quality:t<=200?75:t<=300?80:85})} ${t}w`).join(", "):"",formatMoney:(e,r,t="")=>{if(isNaN(Number(e)))return"";let n=parseFloat(String(e))/100;if(!r||typeof r!="string")return`${t||""}${n.toFixed(2)}`;let s=n.toFixed(2);return r.includes("{{amount_no_decimals}}")?(s=Math.round(n).toString(),r.replace("{{amount_no_decimals}}",s)):r.includes("{{amount_with_comma_separator}}")?(s=n.toFixed(2).replace(".",","),r.replace("{{amount_with_comma_separator}}",s)):r.includes("{{amount_no_decimals_with_comma_separator}}")?(s=Math.round(n).toString(),r.replace("{{amount_no_decimals_with_comma_separator}}",s)):r.includes("{{amount_with_apostrophe_separator}}")?(s=n.toFixed(2).replace(".","'"),r.replace("{{amount_with_apostrophe_separator}}",s)):r.replace("{{amount}}",s)},equals:(e,r)=>e===r?!0:e==null||r===null||r===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(r)&&(r=r.join(",")),typeof e=="string"&&typeof r=="string"?e.trim().toLowerCase()===r.trim().toLowerCase():typeof e=="number"&&typeof r=="number"||typeof e=="boolean"&&typeof r=="boolean"?e===r:String(e).trim().toLowerCase()===String(r).trim().toLowerCase()),equalsAny:(e,...r)=>e==null?!1:r.some(t=>a.equals(e,t)),isVendorKey:e=>a.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>a.equalsAny(e,"productType","productTypes"),isTagKey:e=>a.equalsAny(e,"tag","tags"),isCollectionKey:e=>a.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>a.equalsAny(e,"priceRange","price"),isBestSelling:e=>a.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>a.equals(e,"Collection"),isPriceRangeOptionType:e=>a.equals(e,"priceRange")},de={buildFilterMetadata:e=>{let r=new Map;return Array.isArray(e)&&e.forEach(t=>{t.handle&&r.set(t.handle,{label:t.label||t.queryKey||t.optionKey||t.handle,queryKey:t.queryKey,optionKey:t.optionKey,optionType:t.optionType})}),r}},i={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:O.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},f={enabled:!0,error:(e,r)=>{f.enabled&&console.error("[AFS]",e,r||"")},warn:(e,r)=>{f.enabled&&console.warn("[AFS]",e,r||"")},info:(e,r)=>{f.enabled&&console.info("[AFS]",e,r||"")},debug:(e,r)=>{f.enabled&&console.debug("[AFS]",e,r||"")},log:(e,...r)=>{f.enabled&&console.log(e,...r)},init:e=>{f.enabled=e!==!1,f.log("%cAdvanced Filter & Search initialized","color: #00c853;font-size: 20px;font-weight: bold;background: #0b1e13;padding: 10px 15px;border-radius: 6px;font-family: Arial, sans-serif;")}},H={parse(){let e=new URL(window.location.href),r={},t,n;return e.searchParams.forEach((s,o)=>{if(!le.has(o))if(a.isVendorKey(o))r.vendor=a.split(s);else if(a.isProductTypeKey(o))r.productType=a.split(s);else if(a.isTagKey(o))r.tags=a.split(s);else if(a.isCollectionKey(o))r.collections=a.split(s);else if(a.equals(o,"search"))r.search=s;else if(a.equals(o,"priceMin")){let l=parseFloat(s);!isNaN(l)&&l>=0&&(t=l)}else if(a.equals(o,"priceMax")){let l=parseFloat(s);!isNaN(l)&&l>=0&&(n=l)}else if(a.isPriceRangeKey(o)){let l=s.split("-");if(l.length===2){let d=parseFloat(l[0]),c=parseFloat(l[1]);!isNaN(d)&&d>=0&&(t=d),!isNaN(c)&&c>=0&&(n=c)}}else if(a.equals(o,"page"))r.page=parseInt(s,10)||1;else if(a.equals(o,"limit"))r.limit=parseInt(s,10)||O.PAGE_SIZE;else if(a.equals(o,"sort")){let l=s.toLowerCase().trim();if(a.isBestSelling(l))r.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[d,c]=l.split("-"),u=a.equalsAny(c,"ascending")?"asc":(a.equalsAny(c,"descending"),"desc");r.sort={field:d,order:u}}else{let[d,c]=s.split(":");r.sort={field:d,order:a.equalsAny(c,"asc")?"asc":"desc"}}}else r[o]=a.split(s),f.debug("Handle filter parsed directly",{handle:o,value:s})}),(t!==void 0||n!==void 0)&&(r.priceRange={min:t,max:n}),r},update(e,r,t){let n=new URL(window.location.href);if(n.search="",f.debug("Updating URL",{filters:e,pagination:r}),e&&!a.empty(e)&&Object.keys(e).forEach(o=>{let l=e[o];if(!a.empty(l))if(Array.isArray(l)&&l.length>0)n.searchParams.set(o,l.join(",")),f.debug("URL param set",{key:o,value:l.join(",")});else if(a.isPriceRangeKey(o)&&l&&typeof l=="object"&&!Array.isArray(l)){let d=l,c=typeof d.min=="number"&&!isNaN(d.min)?d.min:void 0,u=typeof d.max=="number"&&!isNaN(d.max)?d.max:void 0;if(i.priceRangeHandle){let g=`${c!==void 0?c:""}-${u!==void 0?u:""}`;n.searchParams.set(i.priceRangeHandle,g),f.debug("Price range URL handle param set",{handle:i.priceRangeHandle,value:g})}else c!==void 0&&n.searchParams.set("priceMin",String(c)),u!==void 0&&n.searchParams.set("priceMax",String(u)),f.debug("Price range URL params set",{priceMin:c,priceMax:u})}else a.equals(o,"search")&&typeof l=="string"&&l.trim()&&(n.searchParams.set(o,l.trim()),f.debug("Search URL param set",{key:o,value:l.trim()}))}),r&&r.page>1&&(n.searchParams.set("page",String(r.page)),f.debug("Page URL param set",{page:r.page})),t&&t.field){if(t.field==="best-selling"||t.field==="bestselling")n.searchParams.set("sort","best-selling");else{let o=a.equals(t.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${t.field}-${o}`)}f.debug("Sort URL param set",{field:t.field,order:t.order})}let s=n.toString();f.info("URL updated",{newUrl:s,oldUrl:window.location.href}),history.pushState({filters:e,pagination:r,sort:t},"",n)}},x={baseURL:"https://fstaging.digitalcoo.com/storefront",__v:"v2.0.1",__id:"01-01-2026",cache:new Map,timestamps:new Map,pending:new Map,key(e,r,t){return`${r.page}-${r.limit}-${t.field}-${t.order}-${JSON.stringify(e)}`},get(e){let r=this.timestamps.get(e);return!r||Date.now()-r>O.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,r){this.cache.set(e,r),this.timestamps.set(e,Date.now())},async fetch(e,r=O.TIMEOUT){let t=new AbortController,n=setTimeout(()=>t.abort(),r);try{f.debug("Fetching",{url:e});let s=await fetch(e,{signal:t.signal});if(clearTimeout(n),!s.ok){let l=await s.text().catch(()=>"");throw new Error(`HTTP ${s.status}: ${s.statusText}${l?" - "+l:""}`)}let o=await s.json();return f.debug("Fetch success",{url:e,hasData:!!o}),o}catch(s){throw clearTimeout(n),s instanceof Error&&s.name==="AbortError"?new Error("Request timeout"):(f.error("Fetch failed",{url:e,error:s instanceof Error?s.message:String(s)}),s)}},shouldSendCpid(){var e;return!!((e=i.selectedCollection)!=null&&e.id)},async products(e,r,t){var c;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!i.shop)throw new Error("Shop not set");let n=this.key(e,r,t),s=this.get(n);if(s)return f.debug("Cache hit",{key:n}),s;if(this.pending.has(n))return f.debug("Request deduplication",{key:n}),this.pending.get(n);let o=new URLSearchParams;if(o.set("shop",i.shop),this.shouldSendCpid()?(o.set("cpid",i.selectedCollection.id),f.debug("cpid sent to products API",{cpid:i.selectedCollection.id,filters:e})):f.debug("cpid not sent to products API",{hasCpid:!!((c=i.selectedCollection)!=null&&c.id),filters:e,reason:"filters present or cpid already in collection filter"}),Object.keys(e).forEach(u=>{let g=e[u];if(!a.empty(g))if(a.isPriceRangeKey(u)&&g&&typeof g=="object"&&!Array.isArray(g)){let m=g,p=typeof m.min=="number"&&!isNaN(m.min)?m.min:void 0,v=typeof m.max=="number"&&!isNaN(m.max)?m.max:void 0;i.priceRangeHandle?o.set(i.priceRangeHandle,`${p!==void 0?p:""}-${v!==void 0?v:""}`):(p!==void 0&&o.set("priceMin",String(p)),v!==void 0&&o.set("priceMax",String(v)))}else u==="search"&&typeof g=="string"&&g.trim()?o.set(u,g.trim()):Array.isArray(g)&&g.length>0?(o.set(u,g.join(",")),f.debug("Filter sent as direct handle param",{handle:u,value:g.join(",")})):typeof g=="string"&&(o.set(u,g),f.debug("Filter sent as direct handle param",{handle:u,value:g}))}),o.set("page",String(r.page)),o.set("limit",String(r.limit)),t.field)if(a.isBestSelling(t.field))o.set("sort","best-selling");else{let u=a.equals(t.order,"asc")?"ascending":"descending";o.set("sort",`${t.field}-${u}`)}let l=`${this.baseURL}/products?${o}`;f.info("Fetching products",{url:l,shop:i.shop,page:r.page}),C.showLoading("products");let d=this.fetch(l).then(u=>{var m,p;if(!u.success||!u.data)throw f.error("Invalid products response",{response:u}),new Error(`Invalid products response: ${u.message||_.messages.unknownError}`);let g=u.data;return f.info("Products response",{productsCount:((m=g.products)==null?void 0:m.length)||0,total:((p=g.pagination)==null?void 0:p.total)||0,hasFilters:!!g.filters}),this.set(n,g),this.pending.delete(n),g}).catch(u=>{throw this.pending.delete(n),f.error("Products fetch failed",{error:u instanceof Error?u.message:String(u),url:l}),u});return C.showLoading("products"),this.pending.set(n,d),d},async filters(e){var d;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!i.shop)throw new Error("Shop not set");let r=new URLSearchParams;r.set("shop",i.shop),this.shouldSendCpid()?(r.set("cpid",i.selectedCollection.id),f.debug("cpid sent to filters API",{cpid:i.selectedCollection.id,filters:e})):f.debug("cpid not sent to filters API",{hasCpid:!!((d=i.selectedCollection)!=null&&d.id),filters:e,reason:"filters present or cpid already in collection filter"});let t={...e};Object.keys(t).forEach(c=>{let u=t[c];if(!a.empty(u)){if(Array.isArray(u))r.set(c,u.join(","));else if(c==="search"&&typeof u=="string"&&u.trim())r.set("search",u.trim());else if(c==="priceRange"&&u&&typeof u=="object"&&!Array.isArray(u)){let g=u,m=typeof g.min=="number"&&!isNaN(g.min)?g.min:void 0,p=typeof g.max=="number"&&!isNaN(g.max)?g.max:void 0;i.priceRangeHandle?r.set(i.priceRangeHandle,`${m!==void 0?m:""}-${p!==void 0?p:""}`):(m!==void 0&&r.set("priceMin",String(m)),p!==void 0&&r.set("priceMax",String(p)))}}});let n={};r.forEach((c,u)=>{n[u]=c}),f.debug("All params for filters endpoint",{params:n});let s=`${this.baseURL}/filters?${r}`;f.info("Fetching filters",{url:s,shop:i.shop}),C.showLoading("filters");let o=await this.fetch(s);if(!o.success||!o.data)throw f.error("Invalid filters response",{response:o}),new Error(`Invalid filters response: ${o.message||_.messages.unknownError}`);let l=o.data;if(!l||typeof l!="object")throw new Error("Invalid filters response: data is not an object");return l.filters!==void 0&&!Array.isArray(l.filters)&&(f.warn("Filters response contains non-array filters",{filters:l.filters}),l.filters=[]),f.info("Filters response:",{filters:l.filters}),l},setBaseURL(e){this.baseURL=e},buildFiltersFromUrl(e){i.filters={vendor:e.vendor||[],productType:e.productType||[],tags:e.tags||[],collections:e.collections||[],search:e.search||"",priceRange:e.priceRange||null},Object.keys(e).forEach(r=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","cpid"].includes(r)){let t=e[r];Array.isArray(t)?i.filters[r]=t:typeof t=="string"&&(i.filters[r]=[t])}}),Y(i.filters)},setPaginationFromUrl(e){e.page?i.pagination.page=e.page:i.fallbackPagination&&i.fallbackPagination.currentPage&&(i.pagination.page=i.fallbackPagination.currentPage)},setSortFromUrl(e){if(e.sort){let r=typeof e.sort=="object"?e.sort.field:e.sort;if(typeof r=="string"){let t=r.toLowerCase().trim();if(t==="best-selling"||t==="bestselling")i.sort={field:"best-selling",order:"asc"};else if(t.includes("-")){let[n,s]=t.split("-"),o=a.equalsAny(s,"ascending")?"asc":(a.equalsAny(s,"descending"),"desc");i.sort={field:n,order:o}}else{let[n,s]=r.split(":");i.sort={field:n,order:s||"desc"}}}else typeof e.sort=="object"&&e.sort.field&&(i.sort={field:e.sort.field,order:e.sort.order||"desc"})}else i.sort={field:"best-selling",order:"asc"}}},C={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(e,r,t){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Container selector cannot be empty. Provide a valid selector or ensure [data-afs-container] exists in the DOM.");if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error(`Container not found. Selector: "${e}". Please ensure the container element exists in the DOM.`);this.container.setAttribute("data-afs-container","true");let n=this.container.querySelector(".afs-main-content")||a.el("div","afs-main-content");n.parentNode||this.container.appendChild(n),this.filtersContainer=r&&r.trim()!==""&&document.querySelector(r)||null,this.filtersContainer||(this.filtersContainer=a.el("div","afs-filters-container")),!this.filtersContainer.parentNode&&n&&n.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=a.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":_.buttons.closeFilters}),this.mobileFilterClose.innerHTML=_.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=a.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",n.parentNode?n.parentNode.insertBefore(this.mobileFilterBackdrop,n):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=t&&t.trim()!==""&&document.querySelector(t)||null,this.productsContainer||(this.productsContainer=a.el("div","afs-products-container")),!this.productsContainer.parentNode&&n&&n.appendChild(this.productsContainer),this.productsInfo=a.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=a.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":_.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${_.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=a.el("div","afs-sort-container");let s=a.el("label","afs-sort-label",{for:"afs-sort-label"});s.textContent=_.labels.sortBy,this.sortSelect=a.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${_.sortOptions.bestSelling}</option>
        <option value="title-ascending">${_.sortOptions.titleAsc}</option>
        <option value="title-descending">${_.sortOptions.titleDesc}</option>
        <option value="price-ascending">${_.sortOptions.priceAsc}</option>
        <option value="price-descending">${_.sortOptions.priceDesc}</option>
        <option value="created-ascending">${_.sortOptions.createdAsc}</option>
        <option value="created-descending">${_.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(s),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=a.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},attachEvents(){if(!C.container)return;C.container.addEventListener("click",t=>{var c,u,g,m,p,v,y;let n=t.target,s=(c=n.closest("[data-afs-action]"))==null?void 0:c.dataset.afsAction,o=n.closest(".afs-filter-item"),l=n instanceof HTMLInputElement&&(n.type==="checkbox"||n.type==="radio")?n:o==null?void 0:o.querySelector(".afs-filter-item__checkbox"),d=n.closest(".afs-pagination__button");if(s==="clear-all")i.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(u=i.selectedCollection)!=null&&u.id&&f.debug("Clear All: keeping server-managed cpid (not exposed to UI)"),i.pagination.page=1,H.update(i.filters,i.pagination,i.sort),C.scrollToProducts(),C.showLoading(),A.apply();else if(s==="toggle-filters"||s==="close-filters")C.toggleMobileFilters();else if(n.closest(".afs-applied-filter-chip__remove")){let b=n.closest(".afs-applied-filter-chip"),S=b==null?void 0:b.querySelector(".afs-applied-filter-chip__remove"),w=S==null?void 0:S.getAttribute("data-afs-filter-key"),L=S==null?void 0:S.getAttribute("data-afs-filter-value");if(!w)return;if(a.equals(w,"cpid")){(g=i.selectedCollection)!=null&&g.id&&(i.selectedCollection.id=null,f.debug("cpid removed, cleared selectedCollection")),H.update(i.filters,i.pagination,i.sort),C.scrollToProducts(),C.showLoading(),A.apply();return}if(a.equals(w,"search")){i.filters.search="",i.pagination.page=1,H.update(i.filters,i.pagination,i.sort),C.scrollToProducts(),C.showLoading(),A.apply();return}if(a.isPriceRangeKey(w)){i.filters.priceRange=null,i.pagination.page=1,H.update(i.filters,i.pagination,i.sort),C.scrollToProducts(),C.showLoading(),A.apply();return}L&&A.toggle(w,L)}else if(l&&o){t.preventDefault(),t.stopPropagation();let b=o.getAttribute("data-afs-filter-handle")||((m=o.parentElement)==null?void 0:m.getAttribute("data-afs-filter-handle")),S=o.getAttribute("data-afs-filter-value"),w=o.getAttribute("data-afs-filter-multiselect")||((p=o.parentElement)==null?void 0:p.getAttribute("data-afs-filter-multiselect"));if(!b||!S){f.warn("Invalid filter item clicked",{handle:b,value:S});return}f.debug("Filter toggle",{handle:b,value:S,currentChecked:l.checked}),(w==="0"||w==="false")&&(i.filters[b]=[]),A.toggle(b,S)}else if(d&&!d.disabled){let b=parseInt(d.getAttribute("data-afs-page")||"0",10);if(b&&b>0){if(i.usingFallback){let w=H.parse().page||i.pagination.page||1;i.pagination.page=b}else i.pagination.page=b;H.update(i.filters,i.pagination,i.sort),C.scrollToProducts(),C.showLoading(),A.applyProductsOnly()}}else if(n.closest(".afs-filter-group__clear")){t.preventDefault(),t.stopPropagation();let b=n.closest(".afs-filter-group__clear");if(!b)return;let S=b.getAttribute("data-afs-filter-handle");if(!S)return;let w=i.filterMetadata.get(S),L=a.isCollectionOptionType(w==null?void 0:w.optionType)||a.isCollectionKey(S);if(i.filters[S]){if(L&&((v=i.selectedCollection)!=null&&v.id)){let E=i.filters[S],T=i.selectedCollection.id;Array.isArray(E)&&E.some(I=>String(I)===String(T))&&(i.selectedCollection.id=null,f.debug("Collection filter cleared (contained cpid), cleared cpid",{handle:S,cpid:T}))}delete i.filters[S],f.debug("Filter cleared",{handle:S,isCollectionFilter:L}),H.update(i.filters,i.pagination,i.sort),C.scrollToProducts(),C.showLoading(),A.apply()}}else if(n.closest(".afs-filter-group__toggle")){t.preventDefault(),t.stopPropagation();let b=n.closest(".afs-filter-group");if(!b)return;let w=!(b.getAttribute("data-afs-collapsed")==="true");b.setAttribute("data-afs-collapsed",w?"true":"false");let L=b.getAttribute("data-afs-filter-key");if(L)try{let P=B.get(L)||{};P.collapsed=w,P.lastUpdated=Date.now(),B.set(L,P);try{let I=`afs_filter_state_${b.getAttribute("data-afs-filter-handle")}`;sessionStorage.setItem(I,JSON.stringify({collapsed:w}))}catch(I){f.debug("Could not persist to sessionStorage",{error:I})}}catch(P){f.error("Failed to persist filter state",{stateKey:L,error:P instanceof Error?P.message:String(P)})}let E=b.querySelector(".afs-filter-group__toggle");E&&E.setAttribute("aria-expanded",w?"false":"true");let T=b.querySelector(".afs-filter-group__icon");T&&(T.innerHTML=w?M.rightArrow||"":M.downArrow||""),f.debug("Filter group toggled",{collapsed:w,stateKey:L})}else if(n.closest(".afs-product-card__quick-add")){t.preventDefault(),t.stopPropagation();let b=n.closest(".afs-product-card__quick-add");if(!b||b.disabled)return;let S=b.getAttribute("data-product-handle"),w=b.getAttribute("data-product-id");S&&Q.add(S,w)}else if(n.closest(".afs-product-card__quick-view")){t.preventDefault(),t.stopPropagation();let b=n.closest(".afs-product-card__quick-view");if(!b)return;let S=b.getAttribute("data-product-handle");if(S){let w=window;(y=w.AFSQuickView)!=null&&y.handleQuickViewClick?w.AFSQuickView.handleQuickViewClick(S):f.error("AFSQuickView module not loaded")}}}),C.container.addEventListener("input",t=>{var s;let n=t.target;if(n.classList.contains("afs-filter-group__search-input")){let l=n.value.toLowerCase(),d=(s=n.closest(".afs-filter-group"))==null?void 0:s.querySelector(".afs-filter-group__items");d!=null&&d._items&&d.querySelectorAll(".afs-filter-item").forEach((c,u)=>{var m;let g=(m=d._items)==null?void 0:m[u];if(g){let p=a.str(typeof g=="string"?g:g.label||g.value||"").toLowerCase();c.style.display=!l||p.includes(l)?"":"none"}})}});let e=t=>{let n=t.value;if(!n)return;f.info("Sort dropdown changed",{sortValue:n,currentSort:i.sort});let s;if(n==="best-selling"||n==="bestselling")s={field:"best-selling",order:"asc"};else if(n.includes("-")){let[o,l]=n.split("-");s={field:o,order:l==="ascending"?"asc":"desc"}}else{let[o,l]=n.split(":");s={field:o,order:l||"desc"}}i.sort=s,i.pagination.page=1,H.update(i.filters,i.pagination,i.sort),f.info("Calling applyProductsOnly after sort change",{sort:i.sort}),C.scrollToProducts(),C.showLoading(),A.applyProductsOnly()},r=null;C.container.addEventListener("focus",t=>{let n=t.target;n.classList.contains("afs-sort-select")&&(r=n.value)},!0),C.container.addEventListener("change",t=>{let n=t.target;if(n.classList.contains("afs-sort-select")){let s=n;e(s),r=s.value}}),C.container.addEventListener("blur",t=>{let n=t.target;if(n.classList.contains("afs-sort-select")){let s=n,o=s.value;o&&o!==r&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{let l;if(a.isBestSelling(i.sort.field))l="best-selling";else{let d=a.equals(i.sort.order,"asc")?"ascending":"descending";l=`${i.sort.field}-${d}`}o!==l&&e(s)})}),r=o}},!0),window.addEventListener("popstate",()=>{let t=H.parse(),n=JSON.stringify(i.filters),s=i.pagination.page,o=JSON.stringify(i.sort);i.filters={vendor:t.vendor||[],productType:t.productType||[],tags:t.tags||[],collections:t.collections||[],search:t.search||"",priceRange:t.priceRange||null},Object.keys(t).forEach(p=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort"].includes(p)){let v=t[p];Array.isArray(v)?i.filters[p]=v:typeof v=="string"&&(i.filters[p]=[v])}});let l=i.priceRangeHandle?i.filters[i.priceRangeHandle]:null;if(i.priceRangeHandle&&Array.isArray(l)&&l.length>0){let v=String(l[0]||"").split("-");if(v.length===2){let y=v[0].trim()?parseInt(v[0],10):void 0,b=v[1].trim()?parseInt(v[1],10):void 0,S=typeof y=="number"&&!isNaN(y)&&y>=0,w=typeof b=="number"&&!isNaN(b)&&b>=0;(S||w)&&(i.filters.priceRange={min:S?y:void 0,max:w?b:void 0},delete i.filters[i.priceRangeHandle])}}let d=t.page||i.pagination.page;if(d!==s&&(i.pagination.page=d),t.sort){let p=typeof t.sort=="object"?t.sort.field:t.sort;if(typeof p=="string"){let v=p.toLowerCase().trim();if(v==="best-selling"||v==="bestselling")i.sort={field:"best-selling",order:"asc"};else if(v.includes("-")){let[y,b]=v.split("-"),S=a.equalsAny(b,"ascending")?"asc":(a.equalsAny(b,"descending"),"desc");i.sort={field:y,order:S}}else{let[y,b]=p.split(":");i.sort={field:y,order:b||"desc"}}}else typeof t.sort=="object"&&t.sort.field&&(i.sort={field:t.sort.field,order:t.sort.order||"desc"})}else i.sort={field:"best-selling",order:"asc"};let c=JSON.stringify(i.filters),u=JSON.stringify(i.sort);!(n!==c)&&(u!==o||d!==s)?A.applyProductsOnly():A.apply()})},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",f.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),f.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let r=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),r&&window.scrollTo(0,parseInt(r||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let r=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${r}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}f.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton(),B.clear(),this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(n=>{let s=n.getAttribute("data-afs-filter-key");if(s){let o=n.querySelector(".afs-filter-group__search-input"),l=n.getAttribute("data-afs-collapsed")==="true",d=(o==null?void 0:o.value)||"",c=B.get(s);B.set(s,{...c,collapsed:l,search:d,lastUpdated:Date.now()})}}),a.clear(this.filtersContainer);let r=e.filter(n=>n?a.isPriceRangeOptionType(n.optionType)?n.range&&typeof n.range.min=="number"&&typeof n.range.max=="number"&&n.range.max>n.range.min:n.values&&n.values.length>0:!1);if(f.debug("Rendering filters",{total:e.length,valid:r.length,filtersWithSearchable:r.filter(n=>n.searchable).length,filtersWithCollapsed:r.filter(n=>n.collapsed).length}),r.length===0){f.warn("No valid filters to render");return}let t=document.createDocumentFragment();r.forEach(n=>{var L;if(a.isPriceRangeOptionType(n.optionType)){let E=this.createPriceRangeGroup(n,B);E&&t.appendChild(E);return}let s;if(n.optionType||n.optionKey){if(s=n.handle,!s){f.error("Option filter missing handle",{filter:n});return}}else if(s=n.queryKey||n.key,!s){f.warn("Standard filter missing queryKey/key",{filter:n});return}f.debug("Filter group handle determined",{handle:s,filterHandle:n.handle,queryKey:n.queryKey,key:n.key,label:n.label,type:n.optionType,optionType:n.optionType,optionKey:n.optionKey,isOptionFilter:!!(n.optionType||n.optionKey)});let o=a.el("div","afs-filter-group",{"data-afs-filter-type":n.optionType||""});o.setAttribute("data-afs-filter-handle",s);let l=s;o.setAttribute("data-afs-filter-key",l);let d=B.get(l),c=(d==null?void 0:d.collapsed)!==void 0?d.collapsed:n.collapsed===!0||n.collapsed==="true"||n.collapsed===1;o.setAttribute("data-afs-collapsed",c?"true":"false"),f.debug("Filter group created",{handle:s,label:n.label,collapsed:c,searchable:n.searchable,showCount:n.showCount,valuesCount:((L=n.values)==null?void 0:L.length)||0});let u=a.el("div","afs-filter-group__header"),g=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":c?"false":"true",title:n.tooltipContent||`Toggle ${n.label||s} filter`}),m=a.el("span","afs-filter-group__icon");m.innerHTML=c?M.rightArrow||"":M.downArrow||"",g.appendChild(m),g.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),n.label||n.optionType||"")),u.appendChild(g);let p=i.filters[s];if(p&&(Array.isArray(p)?p.length>0:typeof p=="object"&&!Array.isArray(p)?Object.keys(p).length>0:!!p)){let E=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${n.label||s} filters`,"data-afs-filter-handle":s});E.textContent=_.buttons.clear,E.title=`${_.buttons.clear} ${n.label||s} filters`,u.appendChild(E)}o.appendChild(u);let y=a.el("div","afs-filter-group__content");if(n.searchable===!0||typeof n.searchable=="string"&&n.searchable.toLowerCase()==="true"){let E=a.el("div","afs-filter-group__search"),T=a.el("input","afs-filter-group__search-input",{type:"text",placeholder:n.searchPlaceholder||"Search...","aria-label":`${_.labels.search}${n.label||s}`,name:`afs-search-${s}`});d!=null&&d.search&&(T.value=d.search),E.appendChild(T),y.appendChild(E),f.debug("Search input added",{handle:s,label:n.label,searchable:n.searchable})}let S=a.el("div","afs-filter-group__items",{"data-afs-filter-handle":s,"data-afs-filter-multiselect":a.isMultiSelect(n)?"1":"0","data-afs-filter-display-type":a.toLowerCase(n.displayType||"CHECKBOX")});S._items=n.values;let w=document.createDocumentFragment();n.values&&n.values.forEach((E,T)=>{let P=this.createFilterItem(s,E,n,T);P&&w.appendChild(P)}),S.appendChild(w),y.appendChild(S),o.appendChild(y),t.appendChild(o)}),t.children.length>0?(this.filtersContainer.appendChild(t),this.showFilters(),f.debug("Filters rendered",{count:t.children.length})):(f.warn("No filter groups created"),this.hideFilters())},createFilterItem(e,r,t,n){var v;let s=a.str(typeof r=="string"?r:r.value||r.key||r.name||"");if(!s||s==="[object Object]")return null;let o=typeof r=="string"?r:r.label||r.value||s;if((a.isCollectionOptionType(t==null?void 0:t.optionType)||a.isCollectionKey(e))&&i.collections&&Array.isArray(i.collections)){if((v=i.selectedCollection)!=null&&v.id&&String(s)===String(i.selectedCollection.id))return null;let y=i.collections.find(b=>{let S=String(b.id||b.gid||b.collectionId||"");return S&&String(S)===String(s)});if(y)o=y.title||y.label||y.name||o;else return null}let c=(i.filters[e]||[]).includes(s),u=a.inputDisplayType(t),g=(u==="radio"?e:e+"-"+s.replace(/\s+/g,"-").toLowerCase())+"_"+(n+1),m=a.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":s,for:g});c&&m.classList.add("afs-filter-item--active");let p=a.el("input","afs-filter-item__checkbox",{type:u});return p.checked=c,p.setAttribute("data-afs-filter-value",s),p.setAttribute("name",g),p.setAttribute("id",g),m.appendChild(p),m.appendChild(a.txt(a.el("span","afs-filter-item__label"),o)),t!=null&&t.showCount&&typeof r=="object"&&r.count&&m.appendChild(a.txt(a.el("span","afs-filter-item__count"),`(${r.count})`)),m},createPriceRangeGroup(e,r=null){var K;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return f.warn("Invalid price range filter",{filter:e}),null;let t=e.range.min,n=e.range.max,s=i.filters.priceRange||{min:t,max:n},o=Math.max(t,Math.min(n,s.min||t)),l=Math.max(t,Math.min(n,s.max||n)),d=a.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),c=r==null?void 0:r.get(e.key||"priceRange"),u=(K=c==null?void 0:c.collapsed)!=null?K:e.collapsed===!0;d.setAttribute("data-afs-collapsed",u?"true":"false");let g=a.el("div","afs-filter-group__header"),m=a.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":u?"false":"true"}),p=a.el("span","afs-filter-group__icon");if(p.innerHTML=u?M.rightArrow||"":M.downArrow||"",m.appendChild(p),m.appendChild(a.txt(a.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),g.appendChild(m),i.filters.priceRange&&(i.filters.priceRange.min!==t||i.filters.priceRange.max!==n)){let $=a.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});$.textContent=_.buttons.clear,$.title=`${_.buttons.clear} ${e.label} filter`,g.appendChild($)}d.appendChild(g);let y=a.el("div","afs-filter-group__content"),b=a.el("div","afs-price-range-container"),S=a.el("div","afs-price-range-track"),w=a.el("div","afs-price-range-active");S.appendChild(w);let L=a.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(t),max:String(n),value:String(o),step:"1"});L.setAttribute("data-afs-range-type","min");let E=a.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(t),max:String(n),value:String(l),step:"1"});E.setAttribute("data-afs-range-type","max"),S.appendChild(L),S.appendChild(E),b.appendChild(S);let T=a.el("div","afs-price-range-values"),P=a.el("span","afs-price-range-value afs-price-range-value--min"),I=a.el("span","afs-price-range-value afs-price-range-value--max"),D=$=>`$${parseFloat(String($)).toFixed(0)}`;P.textContent=D(o),I.textContent=D(l),T.appendChild(P),T.appendChild(a.txt(a.el("span","afs-price-range-separator")," - ")),T.appendChild(I),b.appendChild(T);let R=()=>{let $=parseFloat(L.value),U=parseFloat(E.value),X=n-t,se=($-t)/X*100,ae=(n-U)/X*100;w.style.left=`${se}%`,w.style.right=`${ae}%`,P.textContent=D($),I.textContent=D(U)},k=()=>{let $=parseFloat(L.value),U=parseFloat(E.value);$>U&&(L.value=String(U),E.value=String($)),R()};return L.addEventListener("input",()=>{k(),A.updatePriceRange(parseFloat(L.value),parseFloat(E.value))}),E.addEventListener("input",()=>{k(),A.updatePriceRange(parseFloat(L.value),parseFloat(E.value))}),R(),y.appendChild(b),d.appendChild(y),d},renderProducts(e){if(!this.productsGrid)return;let r=this.productsGrid.querySelectorAll(".afs-skeleton-card");r.length>0&&r.forEach(o=>o.remove());let t=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(o=>{let l=o.getAttribute("data-afs-product-id");l&&t.set(l,o)});let n=new Set(e.map(o=>a.id(o)).filter(o=>o!==null)),s=document.createDocumentFragment();e.forEach(o=>{let l=a.id(o);if(!l)return;let d=t.get(l);if(d){let c=d.querySelector(".afs-product-card__title");c&&c.textContent!==o.title&&(c.textContent=o.title||"");let u=d.querySelector(".afs-product-card__price");if(u){let g=parseFloat(String(o.minPrice||0))*100,m=parseFloat(String(o.maxPrice||0))*100,p=a.formatMoney(g,i.moneyFormat||"{{amount}}",i.currency||""),v=g===m?p:`${_.labels.price}from ${p}`;u.textContent!==v&&(u.textContent=v)}}else{let c=this.createProduct(o);c&&s.appendChild(c)}}),t.forEach((o,l)=>{n.has(l)||o.remove()}),s.children.length>0&&this.productsGrid.appendChild(s)},createProduct(e){var n,s,o;let r=a.el("div","afs-product-card",{"data-afs-product-id":a.id(e)||""});if(e.imageUrl||e.featuredImage){let l=a.el("div","afs-product-card__image"),d=a.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),c=((n=e.featuredImage)==null?void 0:n.url)||((s=e.featuredImage)==null?void 0:s.urlFallback)||e.imageUrl||"";if(c){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let y=[];e.featuredImage.urlSmall&&y.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&y.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&y.push(`${e.featuredImage.urlLarge} 500w`),y.length>0&&(d.setAttribute("srcset",y.join(", ")),d.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),d.src=e.featuredImage.url||e.featuredImage.urlFallback||c}else{let y=a.optimizeImageUrl(c,{width:300,format:"webp",quality:80}),b=a.buildImageSrcset(c,[200,300,500]);b&&(d.setAttribute("srcset",b),d.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),d.src=y||c}d.onerror=function(){var b;let y=((b=e.featuredImage)==null?void 0:b.urlFallback)||c;if(y&&this.src!==y)this.src=y;else if(this.src.includes("_webp.")){let S=c.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");S!==this.src?this.src=S:this.style.display="none"}else this.style.display="none"}}l.appendChild(d);let u=a.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":a.id(e)||"","aria-label":_.buttons.quickAddToCart,type:"button"}),g=a.el("span","afs-product-card__quick-add-icon");g.innerHTML=M.plus,u.appendChild(g);let m=a.el("span","afs-product-card__quick-add-text");m.textContent=_.buttons.quickAdd,u.appendChild(m),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(y=>y.availableForSale))&&(u.disabled=!0,u.classList.add("afs-product-card__quick-add--disabled"),u.setAttribute("aria-label",_.labels.productUnavailable));let v=(o=window.AFSQuickView)==null?void 0:o.createQuickViewButton(e);v&&l.appendChild(v),r.appendChild(l)}let t=a.el("a","afs-product-card__info",{href:`/products/${e.handle}`});if(t){t.appendChild(a.txt(a.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&t.appendChild(a.txt(a.el("div","afs-product-card__vendor"),e.vendor));let l=parseFloat(String(e.minPrice||0))*100,d=parseFloat(String(e.maxPrice||0))*100,c=a.formatMoney(l,i.moneyFormat||"{{amount}}",i.currency||""),u=l===d?c:`from ${c}`;t.appendChild(a.txt(a.el("div","afs-product-card__price"),u)),r.appendChild(t)}return r},updateFilterState(e,r,t){if(!this.filtersContainer){f.warn("Cannot update filter state: filtersContainer not found");return}let n=c=>String(c).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),s=n(r),l=`.afs-filter-item[data-afs-filter-handle="${n(e)}"][data-afs-filter-value="${s}"]`,d=this.filtersContainer.querySelector(l);if(d){let c=d.querySelector(".afs-filter-item__checkbox");c?(c.checked=t,f.debug("Checkbox state updated",{handle:e,value:r,active:t})):f.warn("Checkbox not found in filter item",{handle:e,value:r}),d.classList.toggle("afs-filter-item--active",t)}else f.warn("Filter item not found for state update",{handle:e,value:r,active:t,selector:l})},renderInfo(e,r){if(!this.productsInfo)return;let t=this.sortContainer,n=this.productsInfo.querySelector(".afs-products-info__results");n&&n.remove();let s;if(r===0)s=a.txt(a.el("div","afs-products-info__results"),_.messages.noProductsFound);else if(r===1)s=a.txt(a.el("div","afs-products-info__results"),_.messages.oneProductFound);else{let o=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,r);s=a.txt(a.el("div","afs-products-info__results"),`${_.messages.showingProducts} ${o}-${l} of ${r} ${_.messages.productsFound}`)}t&&t.parentNode?this.productsInfo.insertBefore(s,t):(this.productsInfo.appendChild(s),t&&!t.parentNode&&this.productsInfo.appendChild(t))},renderPagination(e){var l;if(!this.productsGrid||!e)return;let r=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(r&&r.remove(),e.totalPages<=1)return;let t=a.el("div","afs-pagination"),n=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${_.buttons.previous} ${_.messages.pageOf.toLowerCase()}`});n.textContent=_.buttons.previous,n.disabled=e.page<=1,t.appendChild(n);let s=a.el("span","afs-pagination__info");s.textContent=`${_.messages.pageOf} ${e.page} of ${e.totalPages}`,t.appendChild(s);let o=a.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${_.buttons.next} ${_.messages.pageOf.toLowerCase()}`});o.textContent=_.buttons.next,o.disabled=e.page>=e.totalPages,t.appendChild(o),this.productsContainer&&this.productsContainer.appendChild(t)},renderApplied(e){if(!this.container)return;let r=this.container.querySelector(".afs-applied-filters");r&&r.remove();let t=[];if(Object.keys(e).forEach(d=>{let c=e[d];if(a.equals(d,"search")&&c&&typeof c=="string"&&c.trim())t.push({handle:d,label:`${_.labels.search}${c}`,value:c});else if(a.isPriceRangeKey(d)&&c&&typeof c=="object"&&!Array.isArray(c)){let u=c,g=typeof u.min=="number"&&!isNaN(u.min),m=typeof u.max=="number"&&!isNaN(u.max);g&&m?t.push({handle:d,label:`${_.labels.price}$${u.min} - $${u.max}`,value:"__clear__"}):g?t.push({handle:d,label:`${_.labels.price}$${u.min}+`,value:"__clear__"}):m&&t.push({handle:d,label:`${_.labels.price}Up to $${u.max}`,value:"__clear__"})}else Array.isArray(c)&&c.length>0&&c.forEach(u=>{let g=i.filterMetadata.get(d),m=(g==null?void 0:g.label)||d,p=u;if((a.isCollectionOptionType(g==null?void 0:g.optionType)||a.isCollectionKey(d))&&i.collections&&Array.isArray(i.collections)){let y=i.collections.find(b=>{let S=String(b.id||b.gid||b.collectionId||"");return S&&String(S)===String(u)});y&&(p=y.title||y.label||y.name||u)}t.push({handle:d,label:`${m}: ${p}`,value:u})})}),t.length===0)return;let n=a.el("div","afs-applied-filters"),s=a.el("div","afs-applied-filters__header");s.appendChild(a.txt(a.el("div","afs-applied-filters__label"),_.labels.appliedFilters)),n.appendChild(s);let o=a.el("div","afs-applied-filters__list");t.forEach(d=>{let c=a.el("div","afs-applied-filter-chip");c.appendChild(a.txt(a.el("span","afs-applied-filter-chip__label"),d.label));let u=a.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":d.handle,"data-afs-filter-value":d.value,"aria-label":`${_.buttons.clear} filter`,type:"button"});u.innerHTML=M.close,c.appendChild(u),o.appendChild(c)});let l=a.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});l.textContent=_.buttons.clearAll,o.appendChild(l),n.appendChild(o),this.container.insertBefore(n,this.container.firstChild)},scrollToProducts(){i.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),f.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),f.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),f.debug("Scrolled to products info")))},showLoading(e="both"){(e==="products"||e==="both")&&this.showProductsSkeleton(),(e==="filters"||e==="both")&&this.showFiltersSkeleton()},hideLoading(e="both"){var r;(e==="products"||e==="both")&&(Array.isArray(this.loading)?(this.loading.forEach(t=>{t.parentNode&&t.remove()}),this.loading=null):(r=this.loading)!=null&&r.parentNode&&(this.loading.remove(),this.loading=null)),(e==="filters"||e==="both")&&this.hideFiltersSkeleton()},showProductsSkeleton(){var n;if(!this.productsGrid)return;a.clear(this.productsGrid);let e=((n=i.pagination)==null?void 0:n.limit)||O.PAGE_SIZE||24,r=Math.max(e,24),t=[];for(let s=0;s<r;s++){let o=a.el("div","afs-skeleton-card");o.innerHTML=`
				<div class="afs-skeleton-card__image">&#8203;</div>
				<div class="afs-skeleton-card__info">
					<div class="afs-skeleton-card__title">&#8203;</div>
					<div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
					<div class="afs-skeleton-card__price">&#8203;</div>
				</div>
			`,t.push(o)}t.forEach(s=>this.productsGrid.appendChild(s)),this.loading=t},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let r=a.el("div","afs-filters-skeleton");for(let t=0;t<4;t++){let n=a.el("div","afs-skeleton-filter-group");n.innerHTML=`
				<div class="afs-skeleton-filter-group__header">
					<div class="afs-skeleton-filter-group__title">&#8203;</div>
				</div>
				<div class="afs-skeleton-filter-group__content">
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
					<div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
				</div>
			`,r.appendChild(n)}this.filtersContainer.appendChild(r)},hideFiltersSkeleton(){var r;let e=(r=this.filtersContainer)==null?void 0:r.querySelector(".afs-filters-skeleton");e&&e.remove()},hideProductsSkeleton(){var r;let e=(r=this.filtersContainer)==null?void 0:r.querySelector(".afs-filters-skeleton");e&&e.remove()},showError(e){var n;if(!this.productsContainer&&(this.productsContainer=((n=this.container)==null?void 0:n.querySelector(".afs-products-container"))||null,!this.productsContainer&&this.container)){let s=this.container.querySelector(".afs-main-content");s&&(this.productsContainer=a.el("div","afs-products-container"),s.appendChild(this.productsContainer))}if(!this.productsContainer){f.error("Cannot show error: productsContainer not found",{message:e}),console.error("[AFS Error]",e);return}if(this.hideLoading(),i.fallbackProducts&&i.fallbackProducts.length>0){f.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:i.fallbackProducts.length}),i.products=i.fallbackProducts,i.pagination={page:1,limit:O.PAGE_SIZE,total:i.fallbackProducts.length,totalPages:Math.ceil(i.fallbackProducts.length/O.PAGE_SIZE)},this.renderProducts(i.products),this.renderInfo(i.pagination,i.pagination.total),this.renderPagination(i.pagination);return}let r=this.productsContainer.querySelector(".afs-error-message");r&&r.remove();let t=a.el("div","afs-error-message");t.textContent=e||_.messages.failedToLoad,this.productsGrid?(a.clear(this.productsGrid),this.productsGrid.appendChild(t)):this.productsContainer.appendChild(t),f.error("Error displayed",{message:e})},setSortSelectValue(){if(C.sortSelect){if(a.isBestSelling(i.sort.field))C.sortSelect.value="best-selling";else{let e=a.equals(i.sort.order,"asc")?"ascending":"descending";C.sortSelect.value=`${i.sort.field}-${e}`}f.debug("Sort select value updated programmatically",{value:C.sortSelect.value,sort:i.sort})}}},G={getPagination(){let r=H.parse().page||i.fallbackPagination.currentPage||1,t=i.fallbackPagination.totalPages||1,n=i.fallbackPagination.totalProducts||i.fallbackProducts.length||0;return{page:r,limit:O.PAGE_SIZE,total:n,totalPages:t}},reloadPage(e,r,t){let n=new URL(window.location.href);if(n.search="",t&&t.field)if(t.field==="best-selling"||t.field==="bestselling")n.searchParams.set("sort","best-selling");else{let s=a.equals(t.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${t.field}-${s}`)}r&&r.page&&n.searchParams.set("page",String(r.page)),Object.keys(e||{}).forEach(s=>{let o=e[s];if(!a.empty(o))if(Array.isArray(o)&&o.length>0)n.searchParams.set(s,o.join(","));else if(a.isPriceRangeKey(s)&&o&&typeof o=="object"&&!Array.isArray(o)){let l=o,d=typeof l.min=="number"&&!isNaN(l.min)?l.min:void 0,c=typeof l.max=="number"&&!isNaN(l.max)?l.max:void 0;i.priceRangeHandle?n.searchParams.set(i.priceRangeHandle,`${d!==void 0?d:""}-${c!==void 0?c:""}`):(d!==void 0&&n.searchParams.set("priceMin",String(d)),c!==void 0&&n.searchParams.set("priceMax",String(c)))}else a.equals(s,"search")&&typeof o=="string"&&o.trim()&&n.searchParams.set(s,o.trim())}),f.info("Reloading page for fallback mode",{url:n.toString(),sort:t,pagination:r}),window.location.href=n.toString()}},Y=e=>{var t;if(!((t=i.selectedCollection)!=null&&t.id))return;Object.keys(e||{}).some(n=>{let s=e[n];if(a.empty(s)||a.equalsAny(n,"page","limit","sort","size"))return!1;if(a.isPriceRangeKey(n)){if(!s||typeof s!="object"||Array.isArray(s))return!1;let o=s,l=typeof o.min=="number"&&!isNaN(o.min),d=typeof o.max=="number"&&!isNaN(o.max);if(!l&&!d)return!1}return!(a.equals(n,"search")&&(!s||typeof s!="string"||!s.trim()))})&&f.debug("Filters present, keeping cpid (server-managed)",{filters:e})},V={process:e=>{var t,n,s;f.info("Products loaded",{count:((t=e.products)==null?void 0:t.length)||0,total:((n=e.pagination)==null?void 0:n.total)||0}),!(e.products&&Array.isArray(e.products)&&e.products.length>0)&&i.fallbackProducts&&i.fallbackProducts.length>0?(f.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((s=e.products)==null?void 0:s.length)||0,fallbackCount:i.fallbackProducts.length}),i.usingFallback=!0,i.products=i.fallbackProducts,i.pagination=G.getPagination(),i.availableFilters=[],C.hideFilters(),C.hideLoading("products")):(i.usingFallback=!1,i.products=e.products||[],i.pagination=e.pagination||i.pagination,C.showFilters(),C.renderProducts(i.products)),V.updateUI()},updateUI:()=>{C.renderInfo(i.pagination,i.pagination.total||0),C.renderPagination(i.pagination),C.renderApplied(i.filters),C.setSortSelectValue()}},A={process:e=>{i.availableFilters=e.filters||[];try{i.filterMetadata=de.buildFilterMetadata(i.availableFilters)}catch(n){}let r=i.availableFilters.find(n=>a.isPriceRangeOptionType(n.optionType));i.priceRangeHandle=(r==null?void 0:r.handle)||i.priceRangeHandle||null,f.info("Filters set from URL",{filters:i.filters});let t=i.priceRangeHandle?i.filters[i.priceRangeHandle]:null;if(i.priceRangeHandle&&Array.isArray(t)&&t.length>0){let s=String(t[0]||"").split("-");if(s.length===2){let o=s[0].trim()?parseInt(s[0],10):void 0,l=s[1].trim()?parseInt(s[1],10):void 0,d=typeof o=="number"&&!isNaN(o)&&o>=0,c=typeof l=="number"&&!isNaN(l)&&l>=0;(d||c)&&(i.filters.priceRange={min:d?o:void 0,max:c?l:void 0},delete i.filters[i.priceRangeHandle])}}C.renderFilters(i.availableFilters),f.info("Filters rendered",{count:i.availableFilters.length}),V.updateUI(),C.hideLoading("filters")},toggle(e,r){var c,u;let t=a.str(r);if(!t||!e){f.warn("Invalid filter toggle",{handle:e,value:r});return}let n=i.filters[e]||[],s=n.includes(t),o=s?n.filter(g=>g!==t):[...n,t],l=i.filterMetadata.get(e);if(((l==null?void 0:l.optionType)==="Collection"||e==="collections")&&((c=i.selectedCollection)!=null&&c.id)){let g=i.selectedCollection.id;s&&String(t)===String(g)?(i.selectedCollection.id=null,f.debug("Collection filter unchecked (was cpid), cleared cpid",{handle:e,value:t,cpid:g})):o.some(m=>String(m)===String(g))||(i.selectedCollection.id=null,f.debug("Collection filter toggled, cpid no longer in values, cleared cpid",{handle:e,value:t,filterValues:o,wasCpid:String(t)===String(g),originalCpid:g}))}if(o.length===0?delete i.filters[e]:i.filters[e]=o,Y(i.filters),i.pagination.page=1,f.debug("Filter toggled",{handle:e,value:t,wasActive:s,isActive:!s,filterValues:o}),H.update(i.filters,i.pagination,i.sort),C.updateFilterState(e,t,!s),C.scrollToProducts(),C.showLoading(),window.innerWidth<=768&&((u=C.filtersContainer)!=null&&u.classList.contains("afs-filters-container--open"))){C.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let g=document.body.style.top;g&&window.scrollTo(0,parseInt(g||"0",10)*-1)}this.apply()},updatePriceRange(e,r){if(typeof e!="number"||typeof r!="number"||e<0||r<e){f.warn("Invalid price range",{min:e,max:r});return}let t=i.availableFilters.find(n=>a.isPriceRangeOptionType(n.optionType)||a.equals(n.optionKey,"priceRange"));t&&t.range?e===t.range.min&&r===t.range.max?i.filters.priceRange=null:i.filters.priceRange={min:e,max:r}:i.filters.priceRange={min:e,max:r},Y(i.filters),i.pagination.page=1,f.debug("Price range updated",{min:e,max:r,priceRange:i.filters.priceRange}),H.update(i.filters,i.pagination,i.sort),C.scrollToProducts(),C.showLoading("products"),this.apply()},applyProductsOnly:a.debounce(async()=>{if(f.info("applyProductsOnly called",{filters:i.filters,pagination:i.pagination,sort:i.sort,usingFallback:i.usingFallback}),i.usingFallback){f.info("In fallback mode, reloading page with new parameters"),G.reloadPage(i.filters,i.pagination,i.sort);return}C.scrollToProducts(),x.products(i.filters,i.pagination,i.sort).then(V.process)},O.DEBOUNCE),apply:a.debounce(async()=>{C.scrollToProducts(),x.products(i.filters,i.pagination,i.sort).then(V.process),x.filters(i.filters).then(A.process)},O.DEBOUNCE)};var Q={async add(e,r){try{let t=`/products/${e}.json`,n=await fetch(t);if(!n.ok)throw new Error(_.messages.failedToLoadProduct);let o=(await n.json()).product;if(!o||!o.variants||o.variants.length===0)throw new Error("Product has no variants");let l=o.variants.find(d=>d.available)||o.variants[0];await this.addVariant(Number(l.id),1)}catch(t){f.error("Quick add failed",{error:t instanceof Error?t.message:String(t),handle:e}),alert("Failed to add product to cart. Please try again.")}},async addFromForm(e,r){var t,n;try{let s=new FormData(e),o=s.get("id"),l=parseInt(((t=s.get("quantity"))==null?void 0:t.toString())||"1",10);if(o)await this.addVariant(Number(o),l);else{let d=[];for(let v=1;v<=3;v++){let y=s.get(`option${v}`);y&&d.push(y.toString())}let c=`/products/${r}.json`,p=(n=(await(await fetch(c)).json()).product.variants)==null?void 0:n.find(v=>v.options?v.options.length===d.length&&v.options.every((y,b)=>y===d[b]):!1);if(p)await this.addVariant(Number(p.id),l);else throw new Error("Variant not found")}}catch(s){f.error("Add from form failed",{error:s instanceof Error?s.message:String(s)}),alert("Failed to add product to cart. Please try again.")}},async addVariant(e,r){try{let t=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:r})});if(!t.ok){let n=await t.json();throw new Error(n.description||_.messages.failedToAddToCart)}await t.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(t){throw f.error("Add variant failed",{error:t instanceof Error?t.message:String(t),variantId:e}),t}},showSuccess(){let e=document.querySelector(".afs-quick-add-success");e||(e=a.el("div","afs-quick-add-success"),document.body.appendChild(e)),e.textContent=_.messages.addedToCart,e.classList.add("afs-quick-add-success--show");let r=()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",r)},t=setTimeout(()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",r)},3e3);e.addEventListener("animationend",()=>{clearTimeout(t),r()},{once:!0})}},ee={init(e={}){var r,t,n,s;try{if(f.init(e.debug),f.info("Initializing AFS",e),e.apiBaseUrl&&(x.setBaseURL(e.apiBaseUrl),f.info("API base URL set",{url:x.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");i.shop=e.shop,i.collections=e.collections||[],i.selectedCollection={id:(t=(r=e.selectedCollection)==null?void 0:r.id)!=null?t:null,sortBy:(s=(n=e.selectedCollection)==null?void 0:n.sortBy)!=null?s:null},i.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.moneyFormat&&(i.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(i.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(i.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(i.fallbackProducts=e.fallbackProducts,f.info("Fallback products loaded from Liquid",{count:i.fallbackProducts.length})),e.fallbackPagination&&(i.fallbackPagination=e.fallbackPagination,f.info("Fallback pagination loaded from Liquid",{currentPage:i.fallbackPagination.currentPage,totalPages:i.fallbackPagination.totalPages,totalProducts:i.fallbackPagination.totalProducts})),e.priceRangeHandle!==void 0&&(i.priceRangeHandle=e.priceRangeHandle),f.info("Shop set",{shop:i.shop}),f.info("Collections set",{collections:i.collections});let o=e.containerSelector||e.container||"[data-afs-container]",l=e.filtersSelector||e.filtersContainer,d=e.productsSelector||e.productsContainer;C.init(o,l,d),f.info("DOM initialized"),C.showLoading(),C.attachEvents(),f.info("DOM events attached"),this.load()}catch(o){throw f.error("Initialization failed",{error:o instanceof Error?o.message:String(o),stack:o instanceof Error?o.stack:void 0,config:e}),C.container&&C.showError(`Initialization failed: ${o instanceof Error?o.message:String(o)}`),o}},async load(){C.showLoading();try{let e=H.parse();f.debug("Parsed URL params on load",{urlParams:e}),x.buildFiltersFromUrl(e),x.setPaginationFromUrl(e),x.setSortFromUrl(e),f.info("Loading products & filters...",{shop:i.shop,filters:i.filters}),x.products(i.filters,i.pagination,i.sort).then(V.process),x.filters(i.filters).then(A.process)}catch(e){J(e)}},Logger:f},q=window;typeof window!="undefined"?q.AFS=ee:typeof global!="undefined"&&(global.AFS=ee);function W(e,r=document,t=5e3){return new Promise((n,s)=>{let o=r.querySelector(e);if(o){n(o);return}let l=new MutationObserver((u,g)=>{let m=r.querySelector(e);m&&(g.disconnect(),n(m))});l.observe(r.body||r,{childList:!0,subtree:!0});let d=setTimeout(()=>{l.disconnect(),s(new Error(`Element ${e} not found within ${t}ms`))},t),c=n;n=u=>{clearTimeout(d),c(u)}})}function te(e,r=document,t=5e3){return Promise.all(e.map(n=>W(n,r,t)))}function re(e,r){return Array.from({length:r},(t,n)=>{var o;let s=e.querySelector(`.afs-product-modal__option-value[data-option-index="${n}"].afs-product-modal__option-value--selected`);return(o=s==null?void 0:s.dataset.optionValue)!=null?o:null})}function ne(e,r){return e.filter(t=>r.every((n,s)=>n?s===0?t.option1===n:s===1?t.option2===n:t.option3===n:!0))}function ie(e,r,t,n){return e.variants.some(s=>!s.available||r===0&&s.option1!==t||r===1&&s.option2!==t||r===2&&s.option3!==t?!1:n.every((o,l)=>l===r||!o?!0:l===0?s.option1===o:l===1?s.option2===o:s.option3===o))}var z=class{constructor(r,t={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.magnifierZoom=3;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let n=typeof r=="string"?document.querySelector(r):r;if(!n)throw console.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=n,this.options={thumbnailsPosition:t.thumbnailsPosition||"left",enableKeyboard:t.enableKeyboard!==!1,enableAutoHeight:t.enableAutoHeight!==!1,maxHeight:t.maxHeight||null,animationDuration:t.animationDuration||300,enableMagnifier:t.enableMagnifier!==!1,magnifierZoom:t.magnifierZoom||3,...t},this.magnifierEnabled=this.options.enableMagnifier,this.magnifierZoom=this.options.magnifierZoom,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){console.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){console.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let r=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(r),this.images.length===0){console.error("AFSSlider: No images found");return}let t=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(t),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(n){console.error("AFSSlider: Error building slider structure",n);return}try{this.setupEvents()}catch(n){console.error("AFSSlider: Error setting up events",n)}if(this.magnifierEnabled&&!this.isTouchDevice)try{this.setupPanZoom()}catch(n){console.error("AFSSlider: Error setting up pan-zoom",n)}if(this.isTouchDevice)try{this.setupPinchZoom()}catch(n){console.error("AFSSlider: Error setting up pinch-zoom",n)}try{this.goToSlide(0)}catch(n){console.error("AFSSlider: Error showing first slide",n)}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let n=document.createElement("div");n.className="afs-slider__viewport",this.images.forEach(s=>{n.appendChild(s)}),this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let n=document.createElement("button");n.type="button",n.className="afs-slider__prev",n.setAttribute("aria-label","Previous image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__next")){let n=document.createElement("button");n.type="button",n.className="afs-slider__next",n.setAttribute("aria-label","Next image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(n)}this.thumbnails.forEach((n,s)=>{n.addEventListener("click",()=>{this.goToSlide(s)})});let r=this.mainContainer.querySelector(".afs-slider__prev"),t=this.mainContainer.querySelector(".afs-slider__next");r&&r.addEventListener("click",()=>this.prevSlide()),t&&t.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=r=>{if(!this.isInitialized)return;let t=this.container.getBoundingClientRect();if(!(t.width===0||t.height===0))switch(r.key){case"ArrowLeft":r.preventDefault(),this.prevSlide();break;case"ArrowRight":r.preventDefault(),this.nextSlide();break;case"Escape":let n=this.images[this.currentIndex];n&&(n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200));break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let r=0,t=0,n=!1,s=this.mainContainer.querySelector(".afs-slider__viewport");s&&(s.addEventListener("touchstart",o=>{r=o.touches[0].clientX,t=o.touches[0].clientY,n=!0},{passive:!0}),s.addEventListener("touchmove",o=>{n&&o.preventDefault()},{passive:!1}),s.addEventListener("touchend",o=>{if(!n)return;n=!1;let l=o.changedTouches[0].clientX,d=o.changedTouches[0].clientY,c=r-l,u=t-d;Math.abs(c)>Math.abs(u)&&Math.abs(c)>50&&(c>0?this.nextSlide():this.prevSlide())},{passive:!0}))}setupPanZoom(){if(!this.mainContainer)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r)return;r.classList.add("afs-slider__viewport--zoomable");let t=this.magnifierZoom||3;r.addEventListener("mousemove",n=>{let s=this.images[this._currentIndex];if(!s)return;let o=r.getBoundingClientRect(),l=n.clientX-o.left,d=n.clientY-o.top,c=l/o.width,u=d/o.height,g=-c*(s.offsetWidth*t-o.width),m=-u*(s.offsetHeight*t-o.height);s.style.transform=`
        scale(${t})
        translate(${g/t}px, ${m/t}px)
      `,s.classList.add("afs-slider__image--zoomed")}),r.addEventListener("mouseenter",()=>{let n=this.images[this._currentIndex];n&&n.classList.add("afs-slider__image--zoomed")}),r.addEventListener("mouseleave",()=>{let n=this.images[this._currentIndex];n&&(n.style.transform="scale(1) translate(0, 0)",n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200))})}setupPinchZoom(){if(!this.mainContainer||!this.isTouchDevice)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r)return;let t=0,n=1,s=0,o=null;r.addEventListener("touchstart",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1];t=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY);let u=this.images[this._currentIndex];if(u){let m=(u.style.transform||"").match(/scale\(([\d.]+)\)/);n=m?parseFloat(m[1]):1}}else if(l.touches.length===1){let d=Date.now();if(d-s<300){l.preventDefault(),o&&clearTimeout(o);let c=this.images[this._currentIndex];if(c){let g=(c.style.transform||"").match(/scale\(([\d.]+)\)/),m=g?parseFloat(g[1]):1;if(m>1)c.style.transform="scale(1) translate(0, 0)",m=1;else{let p=r.getBoundingClientRect(),v=l.touches[0],y=v.clientX-p.left,b=v.clientY-p.top,S=2.5;c.style.transform=`scale(${S}) translate(${(p.width/2-y)/S}px, ${(p.height/2-b)/S}px)`,m=S}}}else s=d}},{passive:!1}),r.addEventListener("touchmove",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1],u=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY),g=Math.max(1,Math.min(4,n*(u/t))),m=this.images[this._currentIndex];if(m){let p=r.getBoundingClientRect(),v=(d.clientX+c.clientX)/2-p.left,y=(d.clientY+c.clientY)/2-p.top,b=(p.width/2-v)/g,S=(p.height/2-y)/g;m.style.transform=`scale(${g}) translate(${b}px, ${S}px)`}}},{passive:!1}),r.addEventListener("touchend",()=>{t=0})}goToSlide(r){if(r<0||r>=this.images.length)return;this._currentIndex=r,this.images.forEach((n,s)=>{s===r?n.classList.add("afs-slider__image--active"):n.classList.remove("afs-slider__image--active")});let t=this.images[this._currentIndex];t&&(t.classList.remove("afs-slider__image--zoomed"),t.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{t.classList.remove("afs-slider__image--zoom-reset")},200)),this.thumbnails.forEach((n,s)=>{n.classList.toggle("afs-slider__thumbnail--active",s===r)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:r,total:this.images.length}}))}prevSlide(){let r=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(r)}nextSlide(){let r=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(r)}adjustHeight(){let r=this.images[this._currentIndex];r&&(r.complete?this.setHeight(r):r.addEventListener("load",()=>{this.setHeight(r)},{once:!0}))}setHeight(r){if(!this.mainContainer)return;let t=this.mainContainer.querySelector(".afs-slider__viewport");if(!t)return;if(this.options.maxHeight){t.style.height=`${this.options.maxHeight}px`,t.style.minHeight=`${this.options.maxHeight}px`,t.style.maxHeight=`${this.options.maxHeight}px`;return}let n=r.naturalHeight||r.offsetHeight,s=r.naturalWidth||r.offsetWidth,o=this.mainContainer.offsetWidth,l=n/s,d=o*l;t.style.height=`${d}px`,t.style.minHeight=`${d}px`}updateVariantImage(r,t,n){var g;if(!r||!t||!Array.isArray(t)||t.length===0)return!1;let s=r.id;if(n&&Array.isArray(n)){if(r.featured_image&&typeof r.featured_image=="object"&&r.featured_image.variant_ids){let m=r.featured_image.position;if(m!=null){let p=m-1;if(p>=0&&p<this.images.length&&p<t.length)return this._currentIndex!==p&&this.goToSlide(p),!0}}for(let m of n)if(m.featured_image&&typeof m.featured_image=="object"&&m.featured_image.variant_ids&&m.featured_image.variant_ids.includes(Number(s))){let p=m.featured_image.position;if(p!=null){let v=p-1;if(v>=0&&v<this.images.length&&v<t.length)return this._currentIndex!==v&&this.goToSlide(v),!0}}}let o=null,l=null;if(r.featured_image&&(typeof r.featured_image=="object"?(o=r.featured_image.src||r.featured_image.url||null,l=(g=r.featured_image.position)!=null?g:null):typeof r.featured_image=="string"&&(o=r.featured_image)),o||(typeof r.image=="string"?o=r.image:r.image&&typeof r.image=="object"?o=r.image.url||r.image.src||null:r.imageUrl?o=r.imageUrl:r.featuredImage&&typeof r.featuredImage=="object"&&(o=r.featuredImage.url||r.featuredImage.src||null)),!o)return!1;let d=m=>m?(typeof m=="string"?m:(m==null?void 0:m.url)||(m==null?void 0:m.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",c=d(o);if(l!=null){let m=l-1;if(m>=0&&m<this.images.length&&m<t.length)return this._currentIndex!==m&&this.goToSlide(m),!0}let u=t.findIndex(m=>{let p=d(m);return p===c||p.includes(c)||c.includes(p)});if(u===-1){let m=c.split("/").pop();u=t.findIndex(p=>d(p).split("/").pop()===m)}return u!==-1&&u<this.images.length?(this._currentIndex!==u&&this.goToSlide(u),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(r=>{r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200)}),this.isInitialized=!1}};async function oe(e,r){let t=a.el("dialog","afs-product-modal",{id:r});t.innerHTML=`
      <div class="afs-product-modal__container">
        <div class="afs-product-modal__close-container">
          <button class="afs-product-modal__close" type="button">${M.close}</button>
        </div>
        <div class="afs-product-modal__content">
          <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
            ${_.labels.loadingProduct}
          </div>
        </div>
      </div>
    `;let s=`${q.Shopify&&q.Shopify.routes&&q.Shopify.routes.root||"/"}products/${e}.js`;try{let o=await fetch(s);if(!o.ok)throw new Error("Failed to load product");let l=await o.json();if(!l.variants||!Array.isArray(l.variants))throw new Error("Invalid product data structure");let d=l.variants.find(w=>w.available)||l.variants[0],c=d?d.id:null,u=()=>{if(!l.variants||l.variants.length===0)return"";if(l.variants.length===1){let E=l.variants[0].title;if(E&&a.equals(E,"Default Title"))return""}if(!l.options||l.options.length===0)return"";let w='<div class="afs-product-modal__variant-selector">';return l.options.forEach((L,E)=>{w+='<div class="afs-product-modal__option-group">',w+=`<label class="afs-product-modal__option-label">${L.name}</label>`,w+='<div class="afs-product-modal__option-values">',[...new Set(l.variants.map(P=>E===0?P.option1:E===1?P.option2:P.option3).filter(Boolean))].forEach(P=>{let I=l.variants.find(k=>E===0?k.option1===P:E===1?k.option2===P:k.option3===P),D=I&&I.available,R=I&&I.id===c;w+=`<button 
              class="afs-product-modal__option-value ${R?"afs-product-modal__option-value--selected":""} ${D?"":"afs-product-modal__option-value--unavailable"}"
              data-option-index="${E}"
              data-option-value="${P}"
              data-variant-id="${I?I.id:""}"
              ${D?"":"disabled"}
              type="button"
            >${P}</button>`}),w+="</div></div>"}),w+="</div>",w},m=(()=>{if(!l.images||l.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let w='<div class="afs-slider__thumbnails">';l.images.forEach((E,T)=>{let P=T===0?"afs-slider__thumbnail--active":"",I=a.optimizeImageUrl(E,{width:100,height:100,crop:"center",format:"webp",quality:75}),R=[80,100,120].map(k=>`${a.optimizeImageUrl(E,{width:k,height:k,crop:"center",format:"webp",quality:75})} ${k}w`).join(", ");w+=`
            <div class="afs-slider__thumbnail ${P}" data-slide-index="${T}">
              <img 
                src="${I}" 
                srcset="${R}"
                sizes="100px"
                alt="${l.title} - Thumbnail ${T+1}" 
                loading="lazy"
                width="100"
                height="100"
              />
            </div>
          `}),w+="</div>";let L='<div class="afs-slider__main">';return l.images.forEach((E,T)=>{let P=a.optimizeImageUrl(E,{width:800,height:800,format:"webp",quality:85}),D=[400,600,800,1e3,1200].map(R=>`${a.optimizeImageUrl(E,{width:R,height:R,format:"webp",quality:R<=600?80:85})} ${R}w`).join(", ");L+=`
            <img 
              class="afs-slider__image" 
              src="${P}" 
              srcset="${D}"
              sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
              alt="${l.title} - Image ${T+1}" 
              loading="${T===0?"eager":"lazy"}"
            />
          `}),L+="</div>",{thumbnails:w,mainImages:L}})(),p=u(),v=w=>a.formatMoney(w,i.moneyFormat||"{{amount}}",i.currency||""),y=l.variants.find(w=>w.id===c)||d,b=v(y.price),S=y.compare_at_price&&y.compare_at_price>y.price?`<span class="afs-product-modal__compare-price">${v(y.compare_at_price)}</span>`:"";t.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${M.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div class="afs-product-modal__layout">
              <div class="afs-product-modal__media">
                <div class="afs-slider" id="${r}-slider">
                  ${m.mainImages}
                  ${m.thumbnails}
                </div>
              </div>
              <div class="afs-product-modal__details">
                <div class="afs-product-modal__header">
                  <div>
                    <span class="afs-product-modal__vendor">${l.vendor||""}</span>
                  </div>
                  <h1 class="afs-product-modal__title">${l.title||""}</h1>
                  <div class="afs-product-modal__price-container">
                    <span class="afs-product-modal__price">${b}</span>
                    ${S}
                  </div>
                </div>
                ${p}
                <div class="afs-product-modal__buttons">
                  <div class="afs-product-modal__add-to-cart">
                    <div class="afs-product-modal__incrementor">
                      <button class="afs-product-modal__decrease" type="button">${M.minus}</button>
                      <span class="afs-product-modal__count" id="${r}-count">1</span>
                      <button class="afs-product-modal__increase" type="button">${M.plus}</button>
                    </div>
                    <button
                      class="afs-product-modal__add-button"
                      id="${r}-add-button"
                      data-variant-id="${c}"
                      ${y.available?"":"disabled"}
                      type="button"
                    >
                      ${y.available?_.buttons.addToCart:_.buttons.soldOut}
                    </button>
                  </div>
                  <button
                    class="afs-product-modal__buy-button"
                    id="${r}-buy-button"
                    data-variant-id="${c}"
                    ${y.available?"":"disabled"}
                    type="button"
                  >
                    ${_.buttons.buyNow}
                  </button>
                </div>
                <div class="afs-product-modal__description">
                  <span class="afs-product-modal__description-text">
                    ${l.description||""}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `,t._productData=l,t._currentVariantId=c||void 0,(async()=>{try{let w=await W(`#${r}-slider`,t,3e3);(await te(Array.from({length:10},(E,T)=>`.afs-slider__image:nth-child(${T+1})`),w,2e3).catch(()=>Array.from(w.querySelectorAll(".afs-slider__image")))).length>0?t._slider=new z(w,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}):f.warn("No images found for slider",{modalId:r})}catch(w){f.error("Failed to initialize slider",{error:w instanceof Error?w.message:String(w),modalId:r})}})(),ce(t,r,l,v)}catch(o){f.error("Failed to load product for modal",{error:o instanceof Error?o.message:String(o),handle:e}),t.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${M.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div style="padding: 2rem; text-align: center;">
              <p>${_.messages.failedToLoadProductModal}</p>
            </div>
          </div>
        </div>
      `,pe(t)}return t}function ce(e,r,t,n){let s=e.querySelector(".afs-product-modal__close"),o=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};s&&s.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),o()}),e.addEventListener("cancel",p=>{p.preventDefault(),o()}),e.addEventListener("click",p=>{p.target===e&&o()});let l=e.querySelector(".afs-product-modal__decrease"),d=e.querySelector(".afs-product-modal__increase"),c=e.querySelector(`#${r}-count`);l&&c&&l.addEventListener("click",()=>{let p=parseInt(c.textContent||"1",10)||1;p>1&&(c.textContent=String(p-1))}),d&&c&&d.addEventListener("click",()=>{let p=parseInt(c.textContent||"1",10)||1;c.textContent=String(p+1)}),e.querySelectorAll(".afs-product-modal__option-value").forEach(p=>{p.addEventListener("click",()=>{if(p.disabled)return;let v=Number(p.dataset.optionIndex),y=p.dataset.optionValue,b=re(e,t.options.length);b[v]=y,e.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${v}"]`).forEach(L=>L.classList.remove("afs-product-modal__option-value--selected")),p.classList.add("afs-product-modal__option-value--selected"),e.querySelectorAll(".afs-product-modal__option-value").forEach(L=>{let E=Number(L.dataset.optionIndex),T=L.dataset.optionValue,P=ie(t,E,T,b);L.disabled=!P,L.classList.toggle("afs-product-modal__option-value--unavailable",!P)});let w=ne(t.variants,b).find(L=>L.available);w&&ue(e,r,w,n)})});let g=e.querySelector(`#${r}-add-button`);g&&c&&g.addEventListener("click",async()=>{if(g.disabled)return;let p=parseInt(c.textContent||"1",10)||1,v=g.dataset.variantId;try{await Q.addVariant(parseInt(v||"0",10),p),o()}catch(y){f.error("Failed to add to cart from modal",{error:y instanceof Error?y.message:String(y)}),alert(_.messages.failedToAddToCart)}});let m=e.querySelector(`#${r}-buy-button`);m&&c&&m.addEventListener("click",async()=>{if(m.disabled)return;let p=parseInt(c.textContent||"1",10)||1,v=m.dataset.variantId;try{let y=q.Shopify&&q.Shopify.routes&&q.Shopify.routes.root||"/";window.location.href=`${y}cart/${v}:${p}?checkout`}catch(y){f.error("Failed to buy now",{error:y instanceof Error?y.message:String(y)}),alert(_.messages.failedToProceedToCheckout)}})}function ue(e,r,t,n){e._currentVariantId=t.id;let s=e.querySelector(".afs-product-modal__price-container");if(s){let c=n(t.price),u=t.compare_at_price&&t.compare_at_price>t.price?`<span class="afs-product-modal__compare-price">${n(t.compare_at_price)}</span>`:"";s.innerHTML=`
        <span class="afs-product-modal__price">${c}</span>
        ${u}
      `}let o=e.querySelector(`#${r}-add-button`);o&&(o.dataset.variantId=String(t.id),o.disabled=!t.available,o.innerHTML=t.available?_.buttons.addToCart:_.buttons.soldOut);let l=e.querySelector(`#${r}-buy-button`);l&&(l.dataset.variantId=String(t.id),l.disabled=!t.available);let d=e._productData;if(d&&d.images&&e._slider&&d.variants){let c=t.id,u=null;if(t.featured_image&&typeof t.featured_image=="object"&&t.featured_image.variant_ids){let p=t.featured_image.position;if(p!=null){let v=p-1;v>=0&&v<d.images.length&&(e._slider.currentIndex||0)!==v&&(u=v)}}else for(let p of d.variants)if(p.featured_image&&typeof p.featured_image=="object"&&p.featured_image.variant_ids&&p.featured_image.variant_ids.includes(Number(c))){let v=p.featured_image.position;if(v!=null){let y=v-1;if(y>=0&&y<d.images.length&&(e._slider.currentIndex||0)!==y){u=y;break}}}if(u!==null&&e._slider.goToSlide){e._slider.goToSlide(u);return}if(e._slider.updateVariantImage&&d.images&&e._slider.updateVariantImage(t,d.images,d.variants))return;let g=null,m=null;if(t.featured_image&&(typeof t.featured_image=="object"?(g=t.featured_image.src||t.featured_image.url||null,m=t.featured_image.position||null):typeof t.featured_image=="string"&&(g=t.featured_image)),g||(g=(typeof t.image=="string"?t.image:null)||t.imageUrl||t.image&&typeof t.image=="object"&&(t.image.url||t.image.src)||null||t.featuredImage&&typeof t.featuredImage=="object"&&(t.featuredImage.url||t.featuredImage.src)||null),g&&d.images&&e._slider.goToSlide){let p=b=>b?(typeof b=="string"?b:b&&typeof b=="object"&&(b.url||b.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(m!=null){let b=m-1;if(b>=0&&b<d.images.length){e._slider.goToSlide(b);return}}let v=p(g),y=d.images.findIndex(b=>{let S=p(b);return S===v||S.includes(v)||v.includes(S)});if(y!==-1)e._slider.goToSlide(y);else{let b=v.split("/").pop();if(b){let S=d.images.findIndex(w=>p(w).split("/").pop()===b);S!==-1&&e._slider.goToSlide&&e._slider.goToSlide(S)}}}}}function pe(e){let r=e.querySelector(".afs-product-modal__close"),t=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};r&&r.addEventListener("click",t),e.addEventListener("cancel",t),e.addEventListener("click",n=>{n.target===e&&t()})}function fe(e){if(!e.handle)return null;let r=a.el("button","afs-product-card__quick-view",{"data-product-handle":e.handle,"data-product-id":String(e.id||e.productId||e.gid||""),"aria-label":_.buttons.quickView,type:"button"}),t=a.el("span","afs-product-card__quick-view-icon");return t.innerHTML=M.eye,r.appendChild(t),r}function ge(e){if(!e)return;let r=`product-modal-${e}`,t=document.getElementById(r);(async()=>{t||(t=await oe(e,r),document.body.appendChild(t)),t.showModal?(document.body.style.overflow="hidden",t.showModal()):(document.body.style.overflow="hidden",t.style.display="block");let s=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};t.addEventListener("close",s,{once:!0});let o=new MutationObserver(()=>{t&&!t.open&&!t.hasAttribute("open")&&(s(),o.disconnect())});t&&o.observe(t,{attributes:!0,attributeFilter:["open"]})})().catch(s=>{f.error("Failed to open product modal",{error:s instanceof Error?s.message:String(s),handle:e}),alert(_.messages.failedToLoadProductModal)})}typeof window!="undefined"&&(window.AFSSlider=z);typeof window!="undefined"&&(window.AFSQuickView={createQuickViewButton:fe,handleQuickViewClick:ge,createProductModal:oe});var Z={apiBaseUrl:"https://fstaging.digitalcoo.com/storefront",shop:"",searchInputSelector:'input[type="search"], input[name*="search"], input[placeholder*="search" i], .search__input, [data-search-input]',minQueryLength:2,debounceMs:300,maxSuggestions:5,maxProducts:6,showSuggestions:!0,showProducts:!0,enableKeyboardNav:!0},h={config:Z,activeInput:null,dropdown:null,currentQuery:"",isOpen:!1,selectedIndex:-1,searchResults:null,isLoading:!1,abortController:null,replacedInputs:new Set},F={createDropdown(){let e=a.el("div","afs-search-dropdown");return e.setAttribute("role","listbox"),e.setAttribute("aria-label","Search results"),e},createSuggestionItem(e,r){let t=a.el("div","afs-search-dropdown__suggestion",{role:"option","data-index":String(r),tabindex:"-1"}),n=a.el("span","afs-search-dropdown__suggestion-icon");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>';let s=a.el("span","afs-search-dropdown__suggestion-text");return s.textContent=e,t.appendChild(n),t.appendChild(s),t},createProductItem(e,r){var o,l;let t=a.el("a","afs-search-dropdown__product",{href:`/products/${e.handle||""}`,role:"option","data-index":String(r),tabindex:"-1"});if(e.imageUrl||e.featuredImage){let d=a.el("div","afs-search-dropdown__product-image"),c=a.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async"}),u=((o=e.featuredImage)==null?void 0:o.url)||((l=e.featuredImage)==null?void 0:l.urlFallback)||e.imageUrl||"";u&&(c.src=u),d.appendChild(c),t.appendChild(d)}let n=a.el("div","afs-search-dropdown__product-info"),s=a.el("div","afs-search-dropdown__product-title");if(s.textContent=e.title||"",n.appendChild(s),e.vendor){let d=a.el("div","afs-search-dropdown__product-vendor");d.textContent=e.vendor,n.appendChild(d)}if(e.minPrice!==void 0){let d=a.el("div","afs-search-dropdown__product-price"),c=parseFloat(String(e.minPrice||0))*100,u=parseFloat(String(e.maxPrice||0))*100,g=a.formatMoney(c,i.moneyFormat||"{{amount}}",i.currency||""),m=c===u?g:`from ${g}`;d.textContent=m,n.appendChild(d)}return t.appendChild(n),t},createDidYouMeanItem(e){let r=a.el("div","afs-search-dropdown__did-you-mean",{role:"option","data-type":"did-you-mean",tabindex:"-1"}),t=a.el("span","afs-search-dropdown__did-you-mean-text");return t.innerHTML=`Did you mean <strong>${e}</strong>?`,r.appendChild(t),r},createEmptyState(e){let r=a.el("div","afs-search-dropdown__empty",{role:"option"});return r.textContent=e,r},createLoadingState(){let e=a.el("div","afs-search-dropdown__loading",{role:"option"});return e.innerHTML=`
			<div class="afs-search-dropdown__loading-spinner"></div>
			<span>${_.labels.loading}</span>
		`,e},renderDropdown(e,r){var s;if(!h.dropdown)return;if(h.dropdown.innerHTML="",h.selectedIndex=-1,h.isLoading){h.dropdown.appendChild(this.createLoadingState());return}if(!e)return;let t=document.createDocumentFragment(),n=0;if(e.didYouMean&&e.zeroResults){let o=this.createDidYouMeanItem(e.didYouMean);o.setAttribute("data-index",String(n)),t.appendChild(o),n++}if(h.config.showSuggestions&&e.suggestions&&e.suggestions.length>0){let o=a.el("div","afs-search-dropdown__header");o.textContent="Suggestions",t.appendChild(o),e.suggestions.slice(0,h.config.maxSuggestions).forEach(l=>{let d=this.createSuggestionItem(l,n);t.appendChild(d),n++})}if(h.config.showProducts&&e.products&&e.products.length>0){let o=a.el("div","afs-search-dropdown__header");if(o.textContent=`Products (${((s=e.pagination)==null?void 0:s.total)||e.products.length})`,t.appendChild(o),e.products.slice(0,h.config.maxProducts).forEach(l=>{let d=this.createProductItem(l,n);t.appendChild(d),n++}),e.pagination&&e.pagination.total>h.config.maxProducts){let l=a.el("a","afs-search-dropdown__view-all",{href:`/search?q=${encodeURIComponent(r)}`,role:"option"});l.textContent=`View all ${e.pagination.total} results`,l.setAttribute("data-index",String(n)),t.appendChild(l),n++}}e.zeroResults&&(!e.suggestions||e.suggestions.length===0)&&(!e.products||e.products.length===0)&&t.appendChild(this.createEmptyState("No products found. Try adjusting your search terms.")),h.dropdown.appendChild(t)},positionDropdown(e){if(!h.dropdown)return;let r=e.getBoundingClientRect(),t=window.pageYOffset||document.documentElement.scrollTop,n=window.pageXOffset||document.documentElement.scrollLeft;h.dropdown.style.position="absolute",h.dropdown.style.top=`${r.bottom+t}px`,h.dropdown.style.left=`${r.left+n}px`,h.dropdown.style.width=`${r.width}px`,h.dropdown.style.maxHeight="400px",h.dropdown.style.overflowY="auto",h.dropdown.style.zIndex="9999"},showDropdown(){!h.dropdown||!h.activeInput||(h.isOpen=!0,h.dropdown.classList.add("afs-search-dropdown--visible"),h.dropdown.setAttribute("aria-expanded","true"),this.positionDropdown(h.activeInput),document.body.appendChild(h.dropdown))},hideDropdown(){h.dropdown&&(h.isOpen=!1,h.selectedIndex=-1,h.dropdown.classList.remove("afs-search-dropdown--visible"),h.dropdown.setAttribute("aria-expanded","false"),h.dropdown.parentNode&&h.dropdown.parentNode.removeChild(h.dropdown))},highlightItem(e){if(!h.dropdown)return;h.dropdown.querySelectorAll('[role="option"][data-index]').forEach((t,n)=>{n===e?(t.classList.add("afs-search-dropdown__item--selected"),t.scrollIntoView({block:"nearest",behavior:"smooth"})):t.classList.remove("afs-search-dropdown__item--selected")}),h.selectedIndex=e},getSelectedItem(){return!h.dropdown||h.selectedIndex<0?null:h.dropdown.querySelectorAll('[role="option"][data-index]')[h.selectedIndex]||null}},me={async search(e){let r=h.config.shop,t=h.config.apiBaseUrl;if(!r&&i.shop&&(r=i.shop),!t&&x.baseURL&&(t=x.baseURL),!r||!t)return f.error("Search API: shop or apiBaseUrl not configured",{hasShop:!!r,hasApiBaseUrl:!!t,stateShop:i.shop,apiBaseURL:x.baseURL}),null;h.abortController&&h.abortController.abort(),h.abortController=new AbortController;let n=new URLSearchParams;n.set("shop",r),n.set("q",e),n.set("suggestions","true"),n.set("autocomplete","true"),n.set("limit",String(h.config.maxProducts));let s=`${t}/search?${n}`;try{h.isLoading=!0,F.renderDropdown(null,e);let o=await fetch(s,{signal:h.abortController.signal,headers:{Accept:"application/json"}});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);let l=await o.json();return!l.success||!l.data?(f.error("Invalid search response",{data:l}),null):l.data}catch(o){return o.name==="AbortError"?(f.debug("Search request aborted"),null):(f.error("Search API error",{error:o.message,query:e}),null)}finally{h.isLoading=!1}}},N={debouncedSearch:a.debounce(async e=>{var t,n;if(e.length<h.config.minQueryLength){h.searchResults=null,F.hideDropdown();return}h.currentQuery=e;let r=await me.search(e);h.searchResults=r,F.renderDropdown(r,e),r&&(((t=r.products)==null?void 0:t.length)>0||((n=r.suggestions)==null?void 0:n.length)>0)||r!=null&&r.zeroResults?F.showDropdown():F.hideDropdown()},Z.debounceMs),handleInput(e){let r=e.target,t=r.value.trim();h.activeInput=r,N.debouncedSearch(t)},handleFocus(e){let r=e.target;h.activeInput=r,r.value.trim().length>=h.config.minQueryLength&&h.searchResults&&(F.renderDropdown(h.searchResults,r.value.trim()),F.showDropdown())},handleBlur(e){setTimeout(()=>{var r,t;!((r=h.dropdown)!=null&&r.matches(":hover"))&&!((t=h.activeInput)!=null&&t.matches(":focus"))&&F.hideDropdown()},200)},handleKeyDown(e){var n,s,o,l;if(!h.isOpen||!h.dropdown)return;let t=h.dropdown.querySelectorAll('[role="option"][data-index]').length;switch(e.key){case"ArrowDown":e.preventDefault(),h.selectedIndex=Math.min(h.selectedIndex+1,t-1),F.highlightItem(h.selectedIndex);break;case"ArrowUp":e.preventDefault(),h.selectedIndex=Math.max(h.selectedIndex-1,-1),h.selectedIndex>=0?F.highlightItem(h.selectedIndex):(n=h.activeInput)==null||n.focus();break;case"Enter":e.preventDefault();let d=F.getSelectedItem();if(d)if(d.tagName==="A")window.location.href=d.href;else if(d.getAttribute("data-type")==="did-you-mean"){let c=(s=h.searchResults)==null?void 0:s.didYouMean;c&&h.activeInput&&(h.activeInput.value=c,N.debouncedSearch(c))}else{let c=(o=d.querySelector(".afs-search-dropdown__suggestion-text"))==null?void 0:o.textContent;c&&h.activeInput&&(h.activeInput.value=c,N.debouncedSearch(c))}else if(h.activeInput){let c=h.activeInput.value.trim();c&&(window.location.href=`/search?q=${encodeURIComponent(c)}`)}break;case"Escape":e.preventDefault(),F.hideDropdown(),(l=h.activeInput)==null||l.blur();break}},handleClick(e){var n,s;let t=e.target.closest('[role="option"]');if(t&&t.tagName!=="A")if(e.preventDefault(),t.getAttribute("data-type")==="did-you-mean"){let o=(n=h.searchResults)==null?void 0:n.didYouMean;o&&h.activeInput&&(h.activeInput.value=o,N.debouncedSearch(o))}else{let o=(s=t.querySelector(".afs-search-dropdown__suggestion-text"))==null?void 0:s.textContent;o&&h.activeInput&&(h.activeInput.value=o,N.debouncedSearch(o))}}},j={replaceInput(e){if(h.replacedInputs.has(e))return;let r=e.closest("form");r&&r.addEventListener("submit",t=>{t.preventDefault();let n=e.value.trim();n&&(window.location.href=`/search?q=${encodeURIComponent(n)}`)}),e.addEventListener("input",N.handleInput),e.addEventListener("focus",N.handleFocus),e.addEventListener("blur",N.handleBlur),e.addEventListener("keydown",N.handleKeyDown),e.setAttribute("data-afs-search","true"),h.replacedInputs.add(e)},findAndReplaceInputs(){document.querySelectorAll(h.config.searchInputSelector).forEach(r=>{var t,n;(r.type==="search"||(t=r.name)!=null&&t.toLowerCase().includes("search")||(n=r.placeholder)!=null&&n.toLowerCase().includes("search")||r.closest(".search")||r.hasAttribute("data-search-input"))&&this.replaceInput(r)})},init(e={}){h.config={...Z,...e},!h.config.shop&&i.shop&&(h.config.shop=i.shop),!h.config.apiBaseUrl&&x.baseURL&&(h.config.apiBaseUrl=x.baseURL),h.dropdown=F.createDropdown(),h.dropdown.addEventListener("click",N.handleClick),this.findAndReplaceInputs(),new MutationObserver(()=>{this.findAndReplaceInputs()}).observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("click",t=>{var n,s;h.isOpen&&!((n=h.dropdown)!=null&&n.contains(t.target))&&!((s=h.activeInput)!=null&&s.contains(t.target))&&F.hideDropdown()}),f.info("Search module initialized",{config:h.config})}};if(typeof window!="undefined"){let e=window;e.AFSSearch={init:j.init.bind(j)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{j.init()}):j.init();
