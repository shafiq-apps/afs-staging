"use strict";var X=(n=>(n.ALL="__all__",n.CLEAR="__clear__",n.DEFAULT_TITLE="Default Title",n))(X||{}),q={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24},V={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'},re=new Set(["shop","shop_domain","keep","cpid"]),_={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}},o={debounce:(e,i)=>{let r;return(...n)=>{r!==void 0&&clearTimeout(r),r=setTimeout(()=>e(...n),i)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.selectionType),"multiple")||o.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(i=>String(i).trim()).filter(Boolean):String(e).split(",").map(i=>i.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let i=e.productId||e.id||e.gid;return i&&String(i).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,i,r={})=>{let n=document.createElement(e);return i&&(n.className=i),Object.entries(r).forEach(([a,s])=>n.setAttribute(a,s)),n},txt:(e,i)=>(e.textContent=i,e),clear:e=>{for(;e.firstChild;){let i=e.firstChild;i&&e.removeChild(i)}},frag:(e,i)=>{let r=document.createDocumentFragment();return e.forEach(n=>r.appendChild(i(n))),r},optimizeImageUrl:(e,i={})=>{if(!e||typeof e!="string")return"";let{width:r=500,height:n=r,quality:a=80,format:s="webp",crop:l=null}=i;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let p=new URL(e),d=new URLSearchParams(p.search);return d.delete("width"),d.delete("height"),d.delete("crop"),d.delete("format"),d.delete("quality"),d.set("width",String(r)),d.set("height",String(n)),l&&d.set("crop",l),a!==100&&d.set("quality",String(a)),!p.pathname.toLowerCase().endsWith(".gif")&&s&&d.set("format",s),`${p.origin}${p.pathname}?${d.toString()}`}catch(p){return e}},buildImageSrcset:(e,i=[200,300,500])=>e?i.map(r=>`${o.optimizeImageUrl(e,{width:r,format:"webp",quality:r<=200?75:r<=300?80:85})} ${r}w`).join(", "):"",formatMoney:(e,i,r="")=>{if(isNaN(Number(e)))return"";let n=parseFloat(String(e))/100;if(!i||typeof i!="string")return`${r||""}${n.toFixed(2)}`;let a=n.toFixed(2);return i.includes("{{amount_no_decimals}}")?(a=Math.round(n).toString(),i.replace("{{amount_no_decimals}}",a)):i.includes("{{amount_with_comma_separator}}")?(a=n.toFixed(2).replace(".",","),i.replace("{{amount_with_comma_separator}}",a)):i.includes("{{amount_no_decimals_with_comma_separator}}")?(a=Math.round(n).toString(),i.replace("{{amount_no_decimals_with_comma_separator}}",a)):i.includes("{{amount_with_apostrophe_separator}}")?(a=n.toFixed(2).replace(".","'"),i.replace("{{amount_with_apostrophe_separator}}",a)):i.replace("{{amount}}",a)},equals:(e,i)=>e===i?!0:e==null||i===null||i===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(i)&&(i=i.join(",")),typeof e=="string"&&typeof i=="string"?e.trim().toLowerCase()===i.trim().toLowerCase():typeof e=="number"&&typeof i=="number"||typeof e=="boolean"&&typeof i=="boolean"?e===i:String(e).trim().toLowerCase()===String(i).trim().toLowerCase()),equalsAny:(e,...i)=>e==null?!1:i.some(r=>o.equals(e,r)),isVendorKey:e=>o.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>o.equalsAny(e,"productType","productTypes"),isTagKey:e=>o.equalsAny(e,"tag","tags"),isCollectionKey:e=>o.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>o.equalsAny(e,"priceRange","price"),isBestSelling:e=>o.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>o.equals(e,"Collection"),isPriceRangeOptionType:e=>o.equals(e,"priceRange")},J={buildFilterMetadata:e=>{let i=new Map;return Array.isArray(e)&&e.forEach(r=>{r.handle&&i.set(r.handle,{label:r.label||r.queryKey||r.optionKey||r.handle,queryKey:r.queryKey,optionKey:r.optionKey,optionType:r.optionType})}),i}},t={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:q.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,keep:null,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},g={enabled:!0,error:(e,i)=>{g.enabled&&console.error("[AFS]",e,i||"")},warn:(e,i)=>{g.enabled&&console.warn("[AFS]",e,i||"")},info:(e,i)=>{g.enabled&&console.info("[AFS]",e,i||"")},debug:(e,i)=>{g.enabled&&console.debug("[AFS]",e,i||"")},log:(e,...i)=>{g.enabled&&console.log(e,...i)},init:e=>{g.enabled=e!==!1,g.log("%cAdvanced Filter & Search initialized","color: #00c853;font-size: 20px;font-weight: bold;background: #0b1e13;padding: 10px 15px;border-radius: 6px;font-family: Arial, sans-serif;")}},H={parse(){let e=new URL(window.location.href),i={},r,n;return e.searchParams.forEach((a,s)=>{if(!re.has(s))if(o.isVendorKey(s))i.vendor=o.split(a);else if(o.isProductTypeKey(s))i.productType=o.split(a);else if(o.isTagKey(s))i.tags=o.split(a);else if(o.isCollectionKey(s))i.collections=o.split(a);else if(o.equals(s,"search"))i.search=a;else if(o.equals(s,"priceMin")){let l=parseFloat(a);!isNaN(l)&&l>=0&&(r=l)}else if(o.equals(s,"priceMax")){let l=parseFloat(a);!isNaN(l)&&l>=0&&(n=l)}else if(o.isPriceRangeKey(s)){let l=a.split("-");if(l.length===2){let u=parseFloat(l[0]),p=parseFloat(l[1]);!isNaN(u)&&u>=0&&(r=u),!isNaN(p)&&p>=0&&(n=p)}}else if(o.equals(s,"page"))i.page=parseInt(a,10)||1;else if(o.equals(s,"limit"))i.limit=parseInt(a,10)||q.PAGE_SIZE;else if(o.equals(s,"sort")){let l=a.toLowerCase().trim();if(o.isBestSelling(l))i.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[u,p]=l.split("-"),d=o.equalsAny(p,"ascending")?"asc":(o.equalsAny(p,"descending"),"desc");i.sort={field:u,order:d}}else{let[u,p]=a.split(":");i.sort={field:u,order:o.equalsAny(p,"asc")?"asc":"desc"}}}else i[s]=o.split(a),g.debug("Handle filter parsed directly",{handle:s,value:a})}),(r!==void 0||n!==void 0)&&(i.priceRange={min:r,max:n}),i},update(e,i,r){let n=new URL(window.location.href);if(n.search="",g.debug("Updating URL",{filters:e,pagination:i}),e&&!o.empty(e)&&Object.keys(e).forEach(s=>{let l=e[s];if(!o.empty(l))if(Array.isArray(l)&&l.length>0)n.searchParams.set(s,l.join(",")),g.debug("URL param set",{key:s,value:l.join(",")});else if(o.isPriceRangeKey(s)&&l&&typeof l=="object"&&!Array.isArray(l)){let u=l,p=typeof u.min=="number"&&!isNaN(u.min)?u.min:void 0,d=typeof u.max=="number"&&!isNaN(u.max)?u.max:void 0;if(t.priceRangeHandle){let c=`${p!==void 0?p:""}-${d!==void 0?d:""}`;n.searchParams.set(t.priceRangeHandle,c),g.debug("Price range URL handle param set",{handle:t.priceRangeHandle,value:c})}else p!==void 0&&n.searchParams.set("priceMin",String(p)),d!==void 0&&n.searchParams.set("priceMax",String(d)),g.debug("Price range URL params set",{priceMin:p,priceMax:d})}else o.equals(s,"search")&&typeof l=="string"&&l.trim()&&(n.searchParams.set(s,l.trim()),g.debug("Search URL param set",{key:s,value:l.trim()}))}),i&&i.page>1&&(n.searchParams.set("page",String(i.page)),g.debug("Page URL param set",{page:i.page})),r&&r.field){if(r.field==="best-selling"||r.field==="bestselling")n.searchParams.set("sort","best-selling");else{let s=o.equals(r.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${r.field}-${s}`)}g.debug("Sort URL param set",{field:r.field,order:r.order})}t.keep!==null&&t.keep!==void 0&&(o.equals(t.keep,"__all__")?n.searchParams.set("keep","__all__"):Array.isArray(t.keep)&&t.keep.length>0&&n.searchParams.set("keep",t.keep.join(",")),g.debug("Keep filters URL param set",{keep:t.keep}));let a=n.toString();g.info("URL updated",{newUrl:a,oldUrl:window.location.href}),history.pushState({filters:e,pagination:i,sort:r},"",n)}},D={baseURL:"http://localhost:3554",cache:new Map,timestamps:new Map,pending:new Map,key(e,i,r){return`${i.page}-${i.limit}-${r.field}-${r.order}-${JSON.stringify(e)}`},get(e){let i=this.timestamps.get(e);return!i||Date.now()-i>q.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,i){this.cache.set(e,i),this.timestamps.set(e,Date.now())},async fetch(e,i=q.TIMEOUT){let r=new AbortController,n=setTimeout(()=>r.abort(),i);try{g.debug("Fetching",{url:e});let a=await fetch(e,{signal:r.signal});if(clearTimeout(n),!a.ok){let l=await a.text().catch(()=>"");throw new Error(`HTTP ${a.status}: ${a.statusText}${l?" - "+l:""}`)}let s=await a.json();return g.debug("Fetch success",{url:e,hasData:!!s}),s}catch(a){throw clearTimeout(n),a instanceof Error&&a.name==="AbortError"?new Error("Request timeout"):(g.error("Fetch failed",{url:e,error:a instanceof Error?a.message:String(a)}),a)}},shouldSendCpid(e){var r;return(r=t.selectedCollection)!=null&&r.id?!Object.keys(e||{}).some(n=>{let a=t.filterMetadata.get(n);return(o.isCollectionOptionType(a==null?void 0:a.optionType)||o.isCollectionKey(n))&&Array.isArray(e[n])&&e[n].length>0?e[n].some(l=>String(l)===String(t.selectedCollection.id)):!1}):!1},async products(e,i,r){var p;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!t.shop)throw new Error("Shop not set");let n=this.key(e,i,r),a=this.get(n);if(a)return g.debug("Cache hit",{key:n}),a;if(this.pending.has(n))return g.debug("Request deduplication",{key:n}),this.pending.get(n);let s=new URLSearchParams;if(s.set("shop",t.shop),this.shouldSendCpid(e)?(s.set("cpid",t.selectedCollection.id),g.debug("cpid sent to products API",{cpid:t.selectedCollection.id,filters:e})):g.debug("cpid not sent to products API",{hasCpid:!!((p=t.selectedCollection)!=null&&p.id),filters:e,reason:"filters present or cpid already in collection filter"}),Object.keys(e).forEach(d=>{let c=e[d];if(!o.empty(c))if(o.isPriceRangeKey(d)&&c&&typeof c=="object"&&!Array.isArray(c)){let m=c,f=typeof m.min=="number"&&!isNaN(m.min)?m.min:void 0,h=typeof m.max=="number"&&!isNaN(m.max)?m.max:void 0;t.priceRangeHandle?s.set(t.priceRangeHandle,`${f!==void 0?f:""}-${h!==void 0?h:""}`):(f!==void 0&&s.set("priceMin",String(f)),h!==void 0&&s.set("priceMax",String(h)))}else d==="search"&&typeof c=="string"&&c.trim()?s.set(d,c.trim()):Array.isArray(c)&&c.length>0?(s.set(d,c.join(",")),g.debug("Filter sent as direct handle param",{handle:d,value:c.join(",")})):typeof c=="string"&&(s.set(d,c),g.debug("Filter sent as direct handle param",{handle:d,value:c}))}),s.set("page",String(i.page)),s.set("limit",String(i.limit)),r.field)if(o.isBestSelling(r.field))s.set("sort","best-selling");else{let d=o.equals(r.order,"asc")?"ascending":"descending";s.set("sort",`${r.field}-${d}`)}t.keep!==null&&t.keep!==void 0&&(o.equals(t.keep,"__all__")?s.set("keep","__all__"):Array.isArray(t.keep)&&t.keep.length>0&&s.set("keep",t.keep.join(",")),g.debug("Keep filters sent to products API",{keep:t.keep}));let l=`${this.baseURL}/storefront/products?${s}`;g.info("Fetching products",{url:l,shop:t.shop,page:i.page});let u=this.fetch(l).then(d=>{var m,f;if(!d.success||!d.data)throw g.error("Invalid products response",{response:d}),new Error(`Invalid products response: ${d.message||_.messages.unknownError}`);let c=d.data;return g.info("Products response",{productsCount:((m=c.products)==null?void 0:m.length)||0,total:((f=c.pagination)==null?void 0:f.total)||0,hasFilters:!!c.filters}),this.set(n,c),this.pending.delete(n),c}).catch(d=>{throw this.pending.delete(n),g.error("Products fetch failed",{error:d instanceof Error?d.message:String(d),url:l}),d});return this.pending.set(n,u),u},async filters(e){var p;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!t.shop)throw new Error("Shop not set");let i=new URLSearchParams;i.set("shop",t.shop),this.shouldSendCpid(e)?(i.set("cpid",t.selectedCollection.id),g.debug("cpid sent to filters API",{cpid:t.selectedCollection.id,filters:e})):g.debug("cpid not sent to filters API",{hasCpid:!!((p=t.selectedCollection)!=null&&p.id),filters:e,reason:"filters present or cpid already in collection filter"});let r={...e},n=null;if(t.keep!==null&&t.keep!==void 0){if(o.equals(t.keep,"__all__"))Object.keys(r).forEach(d=>{delete r[d]}),i.set("keep","__all__"),g.debug("Keep filters: __all__ - excluded all filters from aggregation query");else{if(Array.isArray(t.keep)&&t.keep.length>0)n=t.keep[0],i.set("keep",t.keep.join(",")),g.debug("Keep parameter set (array)",{keep:t.keep.join(","),keepHandle:n});else if(t.keep!==null&&!o.equals(t.keep,"__all__")&&typeof t.keep=="string"){let d=t.keep.trim();d&&(n=d,i.set("keep",n),g.debug("Keep parameter set (string)",{keep:n,keepHandle:n}))}else g.warn("Keep has invalid value, not adding to params",{StateKeep:t.keep});n&&r.hasOwnProperty(n)&&(delete r[n],g.debug("Excluded keep filter from aggregation query",{excludedHandle:n,remainingFilters:Object.keys(r)}))}g.debug("Keep filters sent to filters API",{keep:t.keep,params:i.toString()})}else g.debug("Keep filters not set, skipping keep parameter",{StateKeep:t.keep});Object.keys(r).forEach(d=>{let c=r[d];if(!o.empty(c)){if(Array.isArray(c))i.set(d,c.join(","));else if(d==="search"&&typeof c=="string"&&c.trim())i.set("search",c.trim());else if(d==="priceRange"&&c&&typeof c=="object"&&!Array.isArray(c)){let m=c,f=typeof m.min=="number"&&!isNaN(m.min)?m.min:void 0,h=typeof m.max=="number"&&!isNaN(m.max)?m.max:void 0;t.priceRangeHandle?i.set(t.priceRangeHandle,`${f!==void 0?f:""}-${h!==void 0?h:""}`):(f!==void 0&&i.set("priceMin",String(f)),h!==void 0&&i.set("priceMax",String(h)))}}});let a={};i.forEach((d,c)=>{a[c]=d}),g.debug("All params for filters endpoint",{params:a,hasKeep:i.has("keep"),keepValue:i.get("keep"),StateKeep:t.keep});let s=`${this.baseURL}/storefront/filters?${i}`;g.info("Fetching filters",{url:s,shop:t.shop,hasKeepParam:i.has("keep")});let l=await this.fetch(s);if(!l.success||!l.data)throw g.error("Invalid filters response",{response:l}),new Error(`Invalid filters response: ${l.message||_.messages.unknownError}`);let u=l.data;if(!u||typeof u!="object")throw new Error("Invalid filters response: data is not an object");return u.filters!==void 0&&!Array.isArray(u.filters)&&(g.warn("Filters response contains non-array filters",{filters:u.filters}),u.filters=[]),g.info("Filters response:",{filters:u.filters}),u},setBaseURL(e){this.baseURL=e}},v={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(e,i,r){if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error("Container not found");this.container.setAttribute("data-afs-container","true");let n=this.container.querySelector(".afs-main-content")||o.el("div","afs-main-content");n.parentNode||this.container.appendChild(n),this.filtersContainer=document.querySelector(i||"")||o.el("div","afs-filters-container"),!this.filtersContainer.parentNode&&n&&n.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=o.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":_.buttons.closeFilters}),this.mobileFilterClose.innerHTML=_.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=o.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",n.parentNode?n.parentNode.insertBefore(this.mobileFilterBackdrop,n):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=document.querySelector(r||"")||o.el("div","afs-products-container"),!this.productsContainer.parentNode&&n&&n.appendChild(this.productsContainer),this.productsInfo=o.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=o.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":_.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${_.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=o.el("div","afs-sort-container");let a=o.el("label","afs-sort-label",{for:"afs-sort-label"});a.textContent=_.labels.sortBy,this.sortSelect=o.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${_.sortOptions.bestSelling}</option>
        <option value="title-ascending">${_.sortOptions.titleAsc}</option>
        <option value="title-descending">${_.sortOptions.titleDesc}</option>
        <option value="price-ascending">${_.sortOptions.priceAsc}</option>
        <option value="price-descending">${_.sortOptions.priceDesc}</option>
        <option value="created-ascending">${_.sortOptions.createdAsc}</option>
        <option value="created-descending">${_.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(a),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=o.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",g.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),g.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let i=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),i&&window.scrollTo(0,parseInt(i||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let i=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${i}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}g.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton();let i=new Map;this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(a=>{let s=a.getAttribute("data-afs-filter-key");if(s){let l=a.querySelector(".afs-filter-group__search-input"),u=a.getAttribute("data-afs-collapsed")==="true",p=(l==null?void 0:l.value)||"",d=i.get(s);i.set(s,{...d,collapsed:u,search:p,lastUpdated:Date.now()})}}),o.clear(this.filtersContainer);let r=e.filter(a=>a?o.isPriceRangeOptionType(a.optionType)?a.range&&typeof a.range.min=="number"&&typeof a.range.max=="number"&&a.range.max>a.range.min:a.values&&a.values.length>0:!1);if(g.debug("Rendering filters",{total:e.length,valid:r.length,filtersWithSearchable:r.filter(a=>a.searchable).length,filtersWithCollapsed:r.filter(a=>a.collapsed).length}),r.length===0){g.warn("No valid filters to render");return}let n=document.createDocumentFragment();r.forEach(a=>{var A;if(o.isPriceRangeOptionType(a.optionType)){let P=this.createPriceRangeGroup(a,i);P&&n.appendChild(P);return}let s;if(a.optionType||a.optionKey){if(s=a.handle,!s){g.error("Option filter missing handle",{filter:a});return}}else if(s=a.queryKey||a.key,!s){g.warn("Standard filter missing queryKey/key",{filter:a});return}g.debug("Filter group handle determined",{handle:s,filterHandle:a.handle,queryKey:a.queryKey,key:a.key,label:a.label,type:a.optionType,optionType:a.optionType,optionKey:a.optionKey,isOptionFilter:!!(a.optionType||a.optionKey)});let l=o.el("div","afs-filter-group",{"data-afs-filter-type":a.optionType||""});l.setAttribute("data-afs-filter-handle",s);let u=s;l.setAttribute("data-afs-filter-key",u);let p=i.get(u),d=(p==null?void 0:p.collapsed)!==void 0?p.collapsed:a.collapsed===!0||a.collapsed==="true"||a.collapsed===1;l.setAttribute("data-afs-collapsed",d?"true":"false"),g.debug("Filter group created",{handle:s,label:a.label,collapsed:d,searchable:a.searchable,showCount:a.showCount,valuesCount:((A=a.values)==null?void 0:A.length)||0});let c=o.el("div","afs-filter-group__header"),m=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":d?"false":"true",title:a.tooltipContent||`Toggle ${a.label||s} filter`}),f=o.el("span","afs-filter-group__icon");f.innerHTML=d?V.rightArrow||"":V.downArrow||"",m.appendChild(f),m.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),a.label||a.optionType||"")),c.appendChild(m);let h=t.filters[s];if(h&&(Array.isArray(h)?h.length>0:typeof h=="object"&&!Array.isArray(h)?Object.keys(h).length>0:!!h)){let P=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${a.label||s} filters`,"data-afs-filter-handle":s});P.textContent=_.buttons.clear,P.title=`${_.buttons.clear} ${a.label||s} filters`,c.appendChild(P)}l.appendChild(c);let y=o.el("div","afs-filter-group__content");if(a.searchable===!0||typeof a.searchable=="string"&&a.searchable.toLowerCase()==="true"){let P=o.el("div","afs-filter-group__search"),L=o.el("input","afs-filter-group__search-input",{type:"text",placeholder:a.searchPlaceholder||"Search...","aria-label":`${_.labels.search}${a.label||s}`,name:`afs-search-${s}`});p!=null&&p.search&&(L.value=p.search),P.appendChild(L),y.appendChild(P),g.debug("Search input added",{handle:s,label:a.label,searchable:a.searchable})}let C=o.el("div","afs-filter-group__items",{"data-afs-filter-handle":s,"data-afs-filter-multiselect":o.isMultiSelect(a)?"1":"0","data-afs-filter-display-type":o.toLowerCase(a.displayType||"CHECKBOX")});C._items=a.values;let E=document.createDocumentFragment();a.values&&a.values.forEach((P,L)=>{let F=this.createFilterItem(s,P,a,L);F&&E.appendChild(F)}),C.appendChild(E),y.appendChild(C),l.appendChild(y),n.appendChild(l)}),n.children.length>0?(this.filtersContainer.appendChild(n),this.showFilters(),g.debug("Filters rendered",{count:n.children.length})):(g.warn("No filter groups created"),this.hideFilters())},createFilterItem(e,i,r,n){let a=o.str(typeof i=="string"?i:i.value||i.key||i.name||"");if(!a||a==="[object Object]")return null;let s=typeof i=="string"?i:i.label||i.value||a;if((o.isCollectionOptionType(r==null?void 0:r.optionType)||o.isCollectionKey(e))&&t.collections&&Array.isArray(t.collections)){let h=t.collections.find(b=>{let y=String(b.id||b.gid||b.collectionId||"");return y&&String(y)===String(a)});if(h)s=h.title||h.label||h.name||s;else return null}let p=(t.filters[e]||[]).includes(a),d=o.inputDisplayType(r),c=(d==="radio"?e:e+"-"+a.replace(/\s+/g,"-").toLowerCase())+"_"+(n+1),m=o.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":a,for:c});p&&m.classList.add("afs-filter-item--active");let f=o.el("input","afs-filter-item__checkbox",{type:d});return f.checked=p,f.setAttribute("data-afs-filter-value",a),f.setAttribute("name",c),f.setAttribute("id",c),m.appendChild(f),m.appendChild(o.txt(o.el("span","afs-filter-item__label"),s)),r!=null&&r.showCount&&typeof i=="object"&&i.count&&m.appendChild(o.txt(o.el("span","afs-filter-item__count"),`(${i.count})`)),m},createPriceRangeGroup(e,i=null){var O;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return g.warn("Invalid price range filter",{filter:e}),null;let r=e.range.min,n=e.range.max,a=t.filters.priceRange||{min:r,max:n},s=Math.max(r,Math.min(n,a.min||r)),l=Math.max(r,Math.min(n,a.max||n)),u=o.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),p=i==null?void 0:i.get(e.key||"priceRange"),d=(O=p==null?void 0:p.collapsed)!=null?O:e.collapsed===!0;u.setAttribute("data-afs-collapsed",d?"true":"false");let c=o.el("div","afs-filter-group__header"),m=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":d?"false":"true"}),f=o.el("span","afs-filter-group__icon");if(f.innerHTML=d?V.rightArrow||"":V.downArrow||"",m.appendChild(f),m.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),c.appendChild(m),t.filters.priceRange&&(t.filters.priceRange.min!==r||t.filters.priceRange.max!==n)){let T=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});T.textContent=_.buttons.clear,T.title=`${_.buttons.clear} ${e.label} filter`,c.appendChild(T)}u.appendChild(c);let b=o.el("div","afs-filter-group__content"),y=o.el("div","afs-price-range-container"),S=o.el("div","afs-price-range-track"),C=o.el("div","afs-price-range-active");S.appendChild(C);let E=o.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(r),max:String(n),value:String(s),step:"1"});E.setAttribute("data-afs-range-type","min");let A=o.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(r),max:String(n),value:String(l),step:"1"});A.setAttribute("data-afs-range-type","max"),S.appendChild(E),S.appendChild(A),y.appendChild(S);let P=o.el("div","afs-price-range-values"),L=o.el("span","afs-price-range-value afs-price-range-value--min"),F=o.el("span","afs-price-range-value afs-price-range-value--max"),k=T=>`$${parseFloat(String(T)).toFixed(0)}`;L.textContent=k(s),F.textContent=k(l),P.appendChild(L),P.appendChild(o.txt(o.el("span","afs-price-range-separator")," - ")),P.appendChild(F),y.appendChild(P);let j=()=>{let T=parseFloat(E.value),M=parseFloat(A.value),I=n-r,$=(T-r)/I*100,K=(n-M)/I*100;C.style.left=`${$}%`,C.style.right=`${K}%`,L.textContent=k(T),F.textContent=k(M)},w=()=>{let T=parseFloat(E.value),M=parseFloat(A.value);T>M&&(E.value=String(M),A.value=String(T)),j()};return E.addEventListener("input",()=>{w(),x.updatePriceRange(parseFloat(E.value),parseFloat(A.value))}),A.addEventListener("input",()=>{w(),x.updatePriceRange(parseFloat(E.value),parseFloat(A.value))}),j(),b.appendChild(y),u.appendChild(b),u},renderProducts(e){if(!this.productsGrid)return;let i=this.productsGrid.querySelectorAll(".afs-skeleton-card");i.length>0&&i.forEach(s=>s.remove());let r=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(s=>{let l=s.getAttribute("data-afs-product-id");l&&r.set(l,s)});let n=new Set(e.map(s=>o.id(s)).filter(s=>s!==null)),a=document.createDocumentFragment();e.forEach(s=>{let l=o.id(s);if(!l)return;let u=r.get(l);if(u){let p=u.querySelector(".afs-product-card__title");p&&p.textContent!==s.title&&(p.textContent=s.title||"");let d=u.querySelector(".afs-product-card__price");if(d){let c=parseFloat(String(s.minPrice||0))*100,m=parseFloat(String(s.maxPrice||0))*100,f=o.formatMoney(c,t.moneyFormat||"{{amount}}",t.currency||""),h=c===m?f:`${_.labels.price}from ${f}`;d.textContent!==h&&(d.textContent=h)}}else{let p=this.createProduct(s);p&&a.appendChild(p)}}),r.forEach((s,l)=>{n.has(l)||s.remove()}),a.children.length>0&&this.productsGrid.appendChild(a)},createProduct(e){var n,a,s;let i=o.el("div","afs-product-card",{"data-afs-product-id":o.id(e)||""});if(e.imageUrl||e.featuredImage){let l=o.el("div","afs-product-card__image"),u=o.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),p=((n=e.featuredImage)==null?void 0:n.url)||((a=e.featuredImage)==null?void 0:a.urlFallback)||e.imageUrl||"";if(p){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let b=[];e.featuredImage.urlSmall&&b.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&b.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&b.push(`${e.featuredImage.urlLarge} 500w`),b.length>0&&(u.setAttribute("srcset",b.join(", ")),u.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),u.src=e.featuredImage.url||e.featuredImage.urlFallback||p}else{let b=o.optimizeImageUrl(p,{width:300,format:"webp",quality:80}),y=o.buildImageSrcset(p,[200,300,500]);y&&(u.setAttribute("srcset",y),u.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),u.src=b||p}u.onerror=function(){var y;let b=((y=e.featuredImage)==null?void 0:y.urlFallback)||p;if(b&&this.src!==b)this.src=b;else if(this.src.includes("_webp.")){let S=p.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");S!==this.src?this.src=S:this.style.display="none"}else this.style.display="none"}}l.appendChild(u);let d=o.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":o.id(e)||"","aria-label":_.buttons.quickAddToCart,type:"button"}),c=o.el("span","afs-product-card__quick-add-icon");c.innerHTML=V.plus,d.appendChild(c);let m=o.el("span","afs-product-card__quick-add-text");m.textContent=_.buttons.quickAdd,d.appendChild(m),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(b=>b.availableForSale))&&(d.disabled=!0,d.classList.add("afs-product-card__quick-add--disabled"),d.setAttribute("aria-label",_.labels.productUnavailable));let h=(s=window.AFSQuickView)==null?void 0:s.createQuickViewButton(e);h&&l.appendChild(h),i.appendChild(l)}let r=o.el("div","afs-product-card__info");if(r){r.appendChild(o.txt(o.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&r.appendChild(o.txt(o.el("div","afs-product-card__vendor"),e.vendor));let l=parseFloat(String(e.minPrice||0))*100,u=parseFloat(String(e.maxPrice||0))*100,p=o.formatMoney(l,t.moneyFormat||"{{amount}}",t.currency||""),d=l===u?p:`from ${p}`;r.appendChild(o.txt(o.el("div","afs-product-card__price"),d)),i.appendChild(r)}return i},updateFilterState(e,i,r){if(!this.filtersContainer){g.warn("Cannot update filter state: filtersContainer not found");return}let n=p=>String(p).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),a=n(i),l=`.afs-filter-item[data-afs-filter-handle="${n(e)}"][data-afs-filter-value="${a}"]`,u=this.filtersContainer.querySelector(l);if(u){let p=u.querySelector(".afs-filter-item__checkbox");p?(p.checked=r,g.debug("Checkbox state updated",{handle:e,value:i,active:r})):g.warn("Checkbox not found in filter item",{handle:e,value:i}),u.classList.toggle("afs-filter-item--active",r)}else g.warn("Filter item not found for state update",{handle:e,value:i,active:r,selector:l})},renderInfo(e,i){if(!this.productsInfo)return;let r=this.sortContainer,n=this.productsInfo.querySelector(".afs-products-info__results");n&&n.remove();let a;if(i===0)a=o.txt(o.el("div","afs-products-info__results"),_.messages.noProductsFound);else if(i===1)a=o.txt(o.el("div","afs-products-info__results"),_.messages.oneProductFound);else{let s=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,i);a=o.txt(o.el("div","afs-products-info__results"),`${_.messages.showingProducts} ${s}-${l} of ${i} ${_.messages.productsFound}`)}r&&r.parentNode?this.productsInfo.insertBefore(a,r):(this.productsInfo.appendChild(a),r&&!r.parentNode&&this.productsInfo.appendChild(r))},renderPagination(e){var l;if(!this.productsGrid||!e)return;let i=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(i&&i.remove(),e.totalPages<=1)return;let r=o.el("div","afs-pagination"),n=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${_.buttons.previous} ${_.messages.pageOf.toLowerCase()}`});n.textContent=_.buttons.previous,n.disabled=e.page<=1,r.appendChild(n);let a=o.el("span","afs-pagination__info");a.textContent=`${_.messages.pageOf} ${e.page} of ${e.totalPages}`,r.appendChild(a);let s=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${_.buttons.next} ${_.messages.pageOf.toLowerCase()}`});s.textContent=_.buttons.next,s.disabled=e.page>=e.totalPages,r.appendChild(s),this.productsContainer&&this.productsContainer.appendChild(r)},renderApplied(e){var u,p;if(!this.container)return;let i=this.container.querySelector(".afs-applied-filters");i&&i.remove();let r=[];if(Object.keys(e).forEach(d=>{let c=e[d];if(o.equals(d,"search")&&c&&typeof c=="string"&&c.trim())r.push({handle:d,label:`${_.labels.search}${c}`,value:c});else if(o.isPriceRangeKey(d)&&c&&typeof c=="object"&&!Array.isArray(c)){let m=c,f=typeof m.min=="number"&&!isNaN(m.min),h=typeof m.max=="number"&&!isNaN(m.max);f&&h?r.push({handle:d,label:`${_.labels.price}$${m.min} - $${m.max}`,value:"__clear__"}):f?r.push({handle:d,label:`${_.labels.price}$${m.min}+`,value:"__clear__"}):h&&r.push({handle:d,label:`${_.labels.price}Up to $${m.max}`,value:"__clear__"})}else Array.isArray(c)&&c.length>0&&c.forEach(m=>{let f=t.filterMetadata.get(d),h=(f==null?void 0:f.label)||d,b=m;if((o.isCollectionOptionType(f==null?void 0:f.optionType)||o.isCollectionKey(d))&&t.collections&&Array.isArray(t.collections)){let S=t.collections.find(C=>{let E=String(C.id||C.gid||C.collectionId||"");return E&&String(E)===String(m)});S&&(b=S.title||S.label||S.name||m)}r.push({handle:d,label:`${h}: ${b}`,value:m})})}),(u=t.selectedCollection)!=null&&u.id&&!Object.keys(e).some(c=>{let m=t.filterMetadata.get(c);return(o.isCollectionOptionType(m==null?void 0:m.optionType)||o.isCollectionKey(c))&&Array.isArray(e[c])&&e[c].includes(String(t.selectedCollection.id))})){let c=(p=t.collections)==null?void 0:p.find(f=>{let h=String(f.id||f.gid||f.collectionId||"");return h&&String(h)===String(t.selectedCollection.id)}),m=(c==null?void 0:c.title)||(c==null?void 0:c.label)||(c==null?void 0:c.name)||"Collection";r.push({handle:"cpid",label:`${_.labels.collection}${m}`,value:String(t.selectedCollection.id)})}if(r.length===0)return;let n=o.el("div","afs-applied-filters"),a=o.el("div","afs-applied-filters__header");a.appendChild(o.txt(o.el("div","afs-applied-filters__label"),_.labels.appliedFilters)),n.appendChild(a);let s=o.el("div","afs-applied-filters__list");r.forEach(d=>{let c=o.el("div","afs-applied-filter-chip");c.appendChild(o.txt(o.el("span","afs-applied-filter-chip__label"),d.label));let m=o.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":d.handle,"data-afs-filter-value":d.value,"aria-label":`${_.buttons.clear} filter`,type:"button"});m.innerHTML=V.close,c.appendChild(m),s.appendChild(c)});let l=o.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});l.textContent=_.buttons.clearAll,s.appendChild(l),n.appendChild(s),this.container.insertBefore(n,this.container.firstChild)},scrollToProducts(){t.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),g.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),g.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),g.debug("Scrolled to products info")))},showLoading(){var e;if(this.productsGrid){o.clear(this.productsGrid);let i=((e=t.pagination)==null?void 0:e.limit)||q.PAGE_SIZE||24,r=Math.max(i,24),n=[];for(let a=0;a<r;a++){let s=o.el("div","afs-skeleton-card");s.innerHTML=`
            <div class="afs-skeleton-card__image">&#8203;</div>
            <div class="afs-skeleton-card__info">
              <div class="afs-skeleton-card__title">&#8203;</div>
              <div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
              <div class="afs-skeleton-card__price">&#8203;</div>
            </div>
          `,n.push(s)}n.forEach(a=>this.productsGrid.appendChild(a)),this.loading=n}this.filtersContainer&&this.filtersContainer.style.display!=="none"&&this.showFiltersSkeleton()},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let i=o.el("div","afs-filters-skeleton");for(let r=0;r<4;r++){let n=o.el("div","afs-skeleton-filter-group");n.innerHTML=`
          <div class="afs-skeleton-filter-group__header">
            <div class="afs-skeleton-filter-group__title">&#8203;</div>
          </div>
          <div class="afs-skeleton-filter-group__content">
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
          </div>
        `,i.appendChild(n)}this.filtersContainer.appendChild(i)},hideFiltersSkeleton(){var i;let e=(i=this.filtersContainer)==null?void 0:i.querySelector(".afs-filters-skeleton");e&&e.remove()},hideLoading(){var e;Array.isArray(this.loading)?(this.loading.forEach(i=>{i.parentNode&&i.remove()}),this.loading=null):(e=this.loading)!=null&&e.parentNode&&(this.loading.remove(),this.loading=null),this.hideFiltersSkeleton()},showError(e){if(!this.productsContainer){g.error("Cannot show error: productsContainer not found");return}if(this.hideLoading(),t.fallbackProducts&&t.fallbackProducts.length>0){g.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:t.fallbackProducts.length}),t.products=t.fallbackProducts,t.pagination={page:1,limit:q.PAGE_SIZE,total:t.fallbackProducts.length,totalPages:Math.ceil(t.fallbackProducts.length/q.PAGE_SIZE)},this.renderProducts(t.products),this.renderInfo(t.pagination,t.pagination.total),this.renderPagination(t.pagination);return}let i=this.productsContainer.querySelector(".afs-error-message");i&&i.remove();let r=o.el("div","afs-error-message");r.textContent=e||_.messages.failedToLoad,this.productsGrid?(o.clear(this.productsGrid),this.productsGrid.appendChild(r)):this.productsContainer.appendChild(r),g.error("Error displayed",{message:e})}},G={getPagination(){let i=H.parse().page||t.fallbackPagination.currentPage||1,r=t.fallbackPagination.totalPages||1,n=t.fallbackPagination.totalProducts||t.fallbackProducts.length||0;return{page:i,limit:q.PAGE_SIZE,total:n,totalPages:r}},reloadPage(e,i,r){let n=new URL(window.location.href);if(n.search="",r&&r.field)if(r.field==="best-selling"||r.field==="bestselling")n.searchParams.set("sort","best-selling");else{let a=o.equals(r.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${r.field}-${a}`)}i&&i.page&&n.searchParams.set("page",String(i.page)),Object.keys(e||{}).forEach(a=>{let s=e[a];if(!o.empty(s))if(Array.isArray(s)&&s.length>0)n.searchParams.set(a,s.join(","));else if(o.isPriceRangeKey(a)&&s&&typeof s=="object"&&!Array.isArray(s)){let l=s,u=typeof l.min=="number"&&!isNaN(l.min)?l.min:void 0,p=typeof l.max=="number"&&!isNaN(l.max)?l.max:void 0;t.priceRangeHandle?n.searchParams.set(t.priceRangeHandle,`${u!==void 0?u:""}-${p!==void 0?p:""}`):(u!==void 0&&n.searchParams.set("priceMin",String(u)),p!==void 0&&n.searchParams.set("priceMax",String(p)))}else o.equals(a,"search")&&typeof s=="string"&&s.trim()&&n.searchParams.set(a,s.trim())}),g.info("Reloading page for fallback mode",{url:n.toString(),sort:r,pagination:i}),window.location.href=n.toString()}},Q=e=>{var r;if(!((r=t.selectedCollection)!=null&&r.id))return;Object.keys(e||{}).some(n=>{let a=e[n];if(o.empty(a)||o.equalsAny(n,"page","limit","sort","size"))return!1;if(o.isPriceRangeKey(n)){if(!a||typeof a!="object"||Array.isArray(a))return!1;let s=a,l=typeof s.min=="number"&&!isNaN(s.min),u=typeof s.max=="number"&&!isNaN(s.max);if(!l&&!u)return!1}return!(o.equals(n,"search")&&(!a||typeof a!="string"||!a.trim()))})&&(t.selectedCollection.id=null,g.debug("Filters present, cleared cpid",{filters:e}))},x={toggle(e,i){var p,d;let r=o.str(i);if(!r||!e){g.warn("Invalid filter toggle",{handle:e,value:i});return}let n=t.filters[e]||[],a=n.includes(r),s=a?n.filter(c=>c!==r):[...n,r],l=t.filterMetadata.get(e);if(((l==null?void 0:l.optionType)==="Collection"||e==="collections")&&((p=t.selectedCollection)!=null&&p.id)){let c=t.selectedCollection.id;a&&String(r)===String(c)?(t.selectedCollection.id=null,g.debug("Collection filter unchecked (was cpid), cleared cpid",{handle:e,value:r,cpid:c})):s.some(m=>String(m)===String(c))||(t.selectedCollection.id=null,g.debug("Collection filter toggled, cpid no longer in values, cleared cpid",{handle:e,value:r,filterValues:s,wasCpid:String(r)===String(c),originalCpid:c}))}if(s.length===0?delete t.filters[e]:t.filters[e]=s,Q(t.filters),t.pagination.page=1,g.debug("Filter toggled",{handle:e,value:r,wasActive:a,isActive:!a,filterValues:s}),H.update(t.filters,t.pagination,t.sort),v.updateFilterState(e,r,!a),v.scrollToProducts(),v.showLoading(),window.innerWidth<=768&&((d=v.filtersContainer)!=null&&d.classList.contains("afs-filters-container--open"))){v.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let c=document.body.style.top;c&&window.scrollTo(0,parseInt(c||"0",10)*-1)}this.apply()},updatePriceRange(e,i){if(typeof e!="number"||typeof i!="number"||e<0||i<e){g.warn("Invalid price range",{min:e,max:i});return}let r=t.availableFilters.find(n=>o.isPriceRangeOptionType(n.optionType)||o.equals(n.optionKey,"priceRange"));r&&r.range?e===r.range.min&&i===r.range.max?t.filters.priceRange=null:t.filters.priceRange={min:e,max:i}:t.filters.priceRange={min:e,max:i},Q(t.filters),t.pagination.page=1,g.debug("Price range updated",{min:e,max:i,priceRange:t.filters.priceRange}),H.update(t.filters,t.pagination,t.sort),v.scrollToProducts(),v.showLoading(),this.apply()},applyProductsOnly:o.debounce(async()=>{var e;if(g.info("applyProductsOnly called",{filters:t.filters,pagination:t.pagination,sort:t.sort,usingFallback:t.usingFallback}),t.usingFallback){g.info("In fallback mode, reloading page with new parameters"),G.reloadPage(t.filters,t.pagination,t.sort);return}v.scrollToProducts(),v.showLoading();try{g.info("Fetching products...",{url:`${D.baseURL}/storefront/products`});let i=await D.products(t.filters,t.pagination,t.sort);g.info("Products fetched successfully",{count:((e=i.products)==null?void 0:e.length)||0}),t.products=i.products||[],t.pagination=i.pagination||t.pagination,t.usingFallback=!1,v.showFilters(),v.renderProducts(t.products),v.renderInfo(t.pagination,t.pagination.total||0),v.renderPagination(t.pagination),v.renderApplied(t.filters),v.hideLoading()}catch(i){if(v.hideLoading(),g.error("Failed to load products",{error:i instanceof Error?i.message:String(i)}),t.fallbackProducts&&t.fallbackProducts.length>0){if(g.warn("Products API failed, using fallback products from Liquid",{error:i instanceof Error?i.message:String(i),fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=G.getPagination(),t.availableFilters=[],v.hideFilters(),v.sortSelect)if(o.isBestSelling(t.sort.field))v.sortSelect.value="best-selling";else{let r=o.equals(t.sort.order,"asc")?"ascending":"descending";v.sortSelect.value=`${t.sort.field}-${r}`}v.renderProducts(t.products),v.renderInfo(t.pagination,t.pagination.total),v.renderPagination(t.pagination),v.renderApplied(t.filters)}else v.showError(`${_.messages.failedToLoadProducts}: ${i instanceof Error?i.message:_.messages.unknownError}`)}},q.DEBOUNCE),apply:o.debounce(async()=>{var e;v.scrollToProducts(),v.showLoading();try{let i=await D.products(t.filters,t.pagination,t.sort);t.products=i.products||[],t.pagination=i.pagination||t.pagination;try{let r=await D.filters(t.filters);if(Array.isArray(r.filters)){t.availableFilters=r.filters,t.filterMetadata=J.buildFilterMetadata(t.availableFilters);let n=t.availableFilters.find(a=>o.isPriceRangeOptionType(a.optionType));if(t.priceRangeHandle=(n==null?void 0:n.handle)||t.priceRangeHandle,(e=t.selectedCollection)!=null&&e.id){let a=t.availableFilters.find(s=>s.optionType==="Collection"||o.isCollectionKey(s.queryKey)||o.isCollectionKey(s.handle));if(a){let s=a.handle||a.queryKey||"collections",l=t.filters[s]||[];l.includes(String(t.selectedCollection.id))||(t.filters[s]=[...l,String(t.selectedCollection.id)],g.debug("Converted cpid to collection filter",{cpid:t.selectedCollection.id,handle:s}))}}v.renderFilters(t.availableFilters)}}catch(r){g.warn("Failed to fetch updated filters",{error:r instanceof Error?r.message:String(r)})}v.renderProducts(t.products),v.renderInfo(t.pagination,t.pagination.total||0),v.renderPagination(t.pagination),v.renderApplied(t.filters),v.hideLoading()}catch(i){if(v.hideLoading(),g.error("Failed to apply filters",{error:i instanceof Error?i.message:String(i)}),t.fallbackProducts&&t.fallbackProducts.length>0){if(g.warn("Filters API failed, using fallback products from Liquid",{error:i instanceof Error?i.message:String(i),fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=G.getPagination(),t.availableFilters=[],v.hideFilters(),v.sortSelect)if(o.isBestSelling(t.sort.field))v.sortSelect.value="best-selling";else{let r=o.equals(t.sort.order,"asc")?"ascending":"descending";v.sortSelect.value=`${t.sort.field}-${r}`}v.renderProducts(t.products),v.renderInfo(t.pagination,t.pagination.total),v.renderPagination(t.pagination),v.renderApplied(t.filters)}else v.showError(`${_.messages.failedToLoadProducts}: ${i instanceof Error?i.message:_.messages.unknownError}`)}},q.DEBOUNCE)};var ee={async add(e,i){try{let r=`/products/${e}.json`,n=await fetch(r);if(!n.ok)throw new Error(_.messages.failedToLoadProduct);let s=(await n.json()).product;if(!s||!s.variants||s.variants.length===0)throw new Error("Product has no variants");let l=s.variants.find(u=>u.available)||s.variants[0];await this.addVariant(Number(l.id),1)}catch(r){g.error("Quick add failed",{error:r instanceof Error?r.message:String(r),handle:e}),alert("Failed to add product to cart. Please try again.")}},async addFromForm(e,i){var r,n;try{let a=new FormData(e),s=a.get("id"),l=parseInt(((r=a.get("quantity"))==null?void 0:r.toString())||"1",10);if(s)await this.addVariant(Number(s),l);else{let u=[];for(let h=1;h<=3;h++){let b=a.get(`option${h}`);b&&u.push(b.toString())}let p=`/products/${i}.json`,f=(n=(await(await fetch(p)).json()).product.variants)==null?void 0:n.find(h=>h.options?h.options.length===u.length&&h.options.every((b,y)=>b===u[y]):!1);if(f)await this.addVariant(Number(f.id),l);else throw new Error("Variant not found")}}catch(a){g.error("Add from form failed",{error:a instanceof Error?a.message:String(a)}),alert("Failed to add product to cart. Please try again.")}},async addVariant(e,i){try{let r=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:i})});if(!r.ok){let n=await r.json();throw new Error(n.description||_.messages.failedToAddToCart)}await r.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(r){throw g.error("Add variant failed",{error:r instanceof Error?r.message:String(r),variantId:e}),r}},showSuccess(){let e=document.querySelector(".afs-quick-add-success");e||(e=o.el("div","afs-quick-add-success"),document.body.appendChild(e)),e.textContent=_.messages.addedToCart,e.classList.add("afs-quick-add-success--show");let i=()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",i)},r=setTimeout(()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",i)},3e3);e.addEventListener("animationend",()=>{clearTimeout(r),i()},{once:!0})}},ne={attach(){if(!v.container)return;v.container.addEventListener("click",r=>{var p,d,c,m,f,h,b;let n=r.target,a=(p=n.closest("[data-afs-action]"))==null?void 0:p.dataset.afsAction,s=n.closest(".afs-filter-item"),l=n instanceof HTMLInputElement&&(n.type==="checkbox"||n.type==="radio")?n:s==null?void 0:s.querySelector(".afs-filter-item__checkbox"),u=n.closest(".afs-pagination__button");if(a==="clear-all")t.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(d=t.selectedCollection)!=null&&d.id&&(t.selectedCollection.id=null,g.debug("Clear All: cleared cpid")),t.pagination.page=1,H.update(t.filters,t.pagination,t.sort),v.scrollToProducts(),v.showLoading(),x.apply();else if(a==="toggle-filters"||a==="close-filters")v.toggleMobileFilters();else if(n.closest(".afs-applied-filter-chip__remove")){let y=n.closest(".afs-applied-filter-chip"),S=y==null?void 0:y.querySelector(".afs-applied-filter-chip__remove"),C=S==null?void 0:S.getAttribute("data-afs-filter-key"),E=S==null?void 0:S.getAttribute("data-afs-filter-value");if(!C)return;if(o.equals(C,"cpid")){(c=t.selectedCollection)!=null&&c.id&&(t.selectedCollection.id=null,g.debug("cpid removed, cleared selectedCollection")),H.update(t.filters,t.pagination,t.sort),v.scrollToProducts(),v.showLoading(),x.apply();return}if(o.equals(C,"search")){t.filters.search="",t.pagination.page=1,H.update(t.filters,t.pagination,t.sort),v.scrollToProducts(),v.showLoading(),x.apply();return}if(o.isPriceRangeKey(C)){t.filters.priceRange=null,t.pagination.page=1,H.update(t.filters,t.pagination,t.sort),v.scrollToProducts(),v.showLoading(),x.apply();return}E&&x.toggle(C,E)}else if(l&&s){r.preventDefault(),r.stopPropagation();let y=s.getAttribute("data-afs-filter-handle")||((m=s.parentElement)==null?void 0:m.getAttribute("data-afs-filter-handle")),S=s.getAttribute("data-afs-filter-value"),C=s.getAttribute("data-afs-filter-multiselect")||((f=s.parentElement)==null?void 0:f.getAttribute("data-afs-filter-multiselect"));if(!y||!S){g.warn("Invalid filter item clicked",{handle:y,value:S});return}g.debug("Filter toggle",{handle:y,value:S,currentChecked:l.checked}),(C==="0"||C==="false")&&(t.filters[y]=[]),x.toggle(y,S)}else if(u&&!u.disabled){let y=parseInt(u.getAttribute("data-afs-page")||"0",10);if(y&&y>0){if(t.usingFallback){let C=H.parse().page||t.pagination.page||1;t.pagination.page=y}else t.pagination.page=y;H.update(t.filters,t.pagination,t.sort),v.scrollToProducts(),v.showLoading(),x.applyProductsOnly()}}else if(n.closest(".afs-filter-group__clear")){r.preventDefault(),r.stopPropagation();let y=n.closest(".afs-filter-group__clear");if(!y)return;let S=y.getAttribute("data-afs-filter-handle");if(!S)return;let C=t.filterMetadata.get(S),E=o.isCollectionOptionType(C==null?void 0:C.optionType)||o.isCollectionKey(S);if(t.filters[S]){if(E&&((h=t.selectedCollection)!=null&&h.id)){let A=t.filters[S],P=t.selectedCollection.id;Array.isArray(A)&&A.some(F=>String(F)===String(P))&&(t.selectedCollection.id=null,g.debug("Collection filter cleared (contained cpid), cleared cpid",{handle:S,cpid:P}))}delete t.filters[S],g.debug("Filter cleared",{handle:S,isCollectionFilter:E}),H.update(t.filters,t.pagination,t.sort),v.scrollToProducts(),v.showLoading(),x.apply()}}else if(n.closest(".afs-filter-group__toggle")){r.preventDefault(),r.stopPropagation();let y=n.closest(".afs-filter-group");if(!y)return;let C=!(y.getAttribute("data-afs-collapsed")==="true");y.setAttribute("data-afs-collapsed",C?"true":"false");let E=y.getAttribute("data-afs-filter-key");if(E)try{let L=states.get(E)||{};L.collapsed=C,L.lastUpdated=Date.now(),states.set(E,L);try{let F=`afs_filter_state_${y.getAttribute("data-afs-filter-handle")}`;sessionStorage.setItem(F,JSON.stringify({collapsed:C}))}catch(F){g.debug("Could not persist to sessionStorage",{error:F})}}catch(L){g.error("Failed to persist filter state",{stateKey:E,error:L instanceof Error?L.message:String(L)})}let A=y.querySelector(".afs-filter-group__toggle");A&&A.setAttribute("aria-expanded",C?"false":"true");let P=y.querySelector(".afs-filter-group__icon");P&&(P.innerHTML=C?V.rightArrow||"":V.downArrow||""),g.debug("Filter group toggled",{collapsed:C,stateKey:E})}else if(n.closest(".afs-product-card__quick-add")){r.preventDefault(),r.stopPropagation();let y=n.closest(".afs-product-card__quick-add");if(!y||y.disabled)return;let S=y.getAttribute("data-product-handle"),C=y.getAttribute("data-product-id");S&&ee.add(S,C)}else if(n.closest(".afs-product-card__quick-view")){r.preventDefault(),r.stopPropagation();let y=n.closest(".afs-product-card__quick-view");if(!y)return;let S=y.getAttribute("data-product-handle");if(S){let C=window;(b=C.AFSQuickView)!=null&&b.handleQuickViewClick?C.AFSQuickView.handleQuickViewClick(S):g.error("AFSQuickView module not loaded")}}}),v.container.addEventListener("input",r=>{var a;let n=r.target;if(n.classList.contains("afs-filter-group__search-input")){let l=n.value.toLowerCase(),u=(a=n.closest(".afs-filter-group"))==null?void 0:a.querySelector(".afs-filter-group__items");u!=null&&u._items&&u.querySelectorAll(".afs-filter-item").forEach((p,d)=>{var m;let c=(m=u._items)==null?void 0:m[d];if(c){let f=o.str(typeof c=="string"?c:c.label||c.value||"").toLowerCase();p.style.display=!l||f.includes(l)?"":"none"}})}});let e=r=>{let n=r.value;if(!n)return;g.info("Sort dropdown changed",{sortValue:n,currentSort:t.sort});let a;if(n==="best-selling"||n==="bestselling")a={field:"best-selling",order:"asc"};else if(n.includes("-")){let[s,l]=n.split("-");a={field:s,order:l==="ascending"?"asc":"desc"}}else{let[s,l]=n.split(":");a={field:s,order:l||"desc"}}t.sort=a,t.pagination.page=1,H.update(t.filters,t.pagination,t.sort),g.info("Calling applyProductsOnly after sort change",{sort:t.sort}),v.scrollToProducts(),v.showLoading(),x.applyProductsOnly()},i=null;v.container.addEventListener("focus",r=>{let n=r.target;n.classList.contains("afs-sort-select")&&(i=n.value)},!0),v.container.addEventListener("change",r=>{let n=r.target;if(n.classList.contains("afs-sort-select")){let a=n;e(a),i=a.value}}),v.container.addEventListener("blur",r=>{let n=r.target;if(n.classList.contains("afs-sort-select")){let a=n,s=a.value;s&&s!==i&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{let l;if(o.isBestSelling(t.sort.field))l="best-selling";else{let u=o.equals(t.sort.order,"asc")?"ascending":"descending";l=`${t.sort.field}-${u}`}s!==l&&e(a)})}),i=s}},!0),window.addEventListener("popstate",()=>{let r=H.parse(),n=JSON.stringify(t.filters),a=t.pagination.page,s=JSON.stringify(t.sort);r.keep!==void 0&&(r.keep==="__all__"||typeof r.keep=="string"&&o.equals(r.keep,"__all__")?t.keep="__all__":Array.isArray(r.keep)&&r.keep.length>0?t.keep=r.keep:t.keep=null),t.filters={vendor:r.vendor||[],productType:r.productType||[],tags:r.tags||[],collections:r.collections||[],search:r.search||"",priceRange:r.priceRange||null},Object.keys(r).forEach(f=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","keep"].includes(f)){let h=r[f];Array.isArray(h)?t.filters[f]=h:typeof h=="string"&&(t.filters[f]=[h])}});let l=t.priceRangeHandle?t.filters[t.priceRangeHandle]:null;if(t.priceRangeHandle&&Array.isArray(l)&&l.length>0){let h=String(l[0]||"").split("-");if(h.length===2){let b=h[0].trim()?parseFloat(h[0]):void 0,y=h[1].trim()?parseFloat(h[1]):void 0,S=typeof b=="number"&&!isNaN(b)&&b>=0,C=typeof y=="number"&&!isNaN(y)&&y>=0;(S||C)&&(t.filters.priceRange={min:S?b:void 0,max:C?y:void 0},delete t.filters[t.priceRangeHandle])}}let u=r.page||t.pagination.page;if(u!==a&&(t.pagination.page=u),r.sort){let f=typeof r.sort=="object"?r.sort.field:r.sort;if(typeof f=="string"){let h=f.toLowerCase().trim();if(h==="best-selling"||h==="bestselling")t.sort={field:"best-selling",order:"asc"};else if(h.includes("-")){let[b,y]=h.split("-"),S=o.equalsAny(y,"ascending")?"asc":(o.equalsAny(y,"descending"),"desc");t.sort={field:b,order:S}}else{let[b,y]=f.split(":");t.sort={field:b,order:y||"desc"}}}else typeof r.sort=="object"&&r.sort.field&&(t.sort={field:r.sort.field,order:r.sort.order||"desc"})}else t.sort={field:"best-selling",order:"asc"};let p=JSON.stringify(t.filters),d=JSON.stringify(t.sort);!(n!==p)&&(d!==s||u!==a)?x.applyProductsOnly():x.apply()})}},Y={init(e={}){var i,r,n,a;try{if(g.init(e.debug),g.info("Initializing AFS",e),e.apiBaseUrl&&(D.setBaseURL(e.apiBaseUrl),g.info("API base URL set",{url:D.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");t.shop=e.shop,t.collections=e.collections||[],t.selectedCollection={id:(r=(i=e.selectedCollection)==null?void 0:i.id)!=null?r:null,sortBy:(a=(n=e.selectedCollection)==null?void 0:n.sortBy)!=null?a:null},t.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.moneyFormat&&(t.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(t.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(t.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(t.fallbackProducts=e.fallbackProducts,g.info("Fallback products loaded from Liquid",{count:t.fallbackProducts.length})),e.fallbackPagination&&(t.fallbackPagination=e.fallbackPagination,g.info("Fallback pagination loaded from Liquid",{currentPage:t.fallbackPagination.currentPage,totalPages:t.fallbackPagination.totalPages,totalProducts:t.fallbackPagination.totalProducts})),e.keep!==void 0&&(o.equalsAny(e.keep,"__all__","__ALL__")?t.keep="__all__":Array.isArray(e.keep)&&e.keep.length>0?t.keep=e.keep:typeof e.keep=="string"&&e.keep.trim()?t.keep=o.split(e.keep):t.keep=null,g.info("Keep filters set from config",{keep:t.keep})),e.priceRangeHandle!==void 0&&(t.priceRangeHandle=e.priceRangeHandle),g.info("Shop set",{shop:t.shop}),g.info("Collections set",{collections:t.collections}),v.init(e.containerSelector||"[data-afs-container]",e.filtersSelector,e.productsSelector),g.info("DOM initialized"),v.showLoading(),ne.attach(),g.info("Events attached"),this.load()}catch(s){throw g.error("Initialization failed",{error:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,config:e}),v.container&&v.showError(`Initialization failed: ${s instanceof Error?s.message:String(s)}`),s}},async load(){var e,i,r,n,a;v.showLoading();try{let s=H.parse();g.debug("Parsed URL params on load",{urlParams:s}),t.filters={vendor:s.vendor||[],productType:s.productType||[],tags:s.tags||[],collections:s.collections||[],search:s.search||"",priceRange:s.priceRange||null},Object.keys(s).forEach(f=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","keep","cpid"].includes(f)){let h=s[f];Array.isArray(h)?t.filters[f]=h:typeof h=="string"&&(t.filters[f]=[h])}}),Q(t.filters),g.info("Loading filters...",{shop:t.shop,filters:t.filters});let l;try{l=await D.filters(t.filters),g.info("Filters loaded",{filtersCount:((e=l.filters)==null?void 0:e.length)||0})}catch(f){g.warn("Failed to load filters, continuing with empty filters",{error:f instanceof Error?f.message:String(f)}),l={filters:[]}}Array.isArray(l.filters)||(g.error("Invalid filters response: filters is not an array",{filters:l.filters}),l.filters=[]),t.availableFilters=l.filters||[],t.filterMetadata=J.buildFilterMetadata(t.availableFilters);let u=t.availableFilters.find(f=>o.isPriceRangeOptionType(f.optionType));t.priceRangeHandle=(u==null?void 0:u.handle)||t.priceRangeHandle||null;let p=t.priceRangeHandle?t.filters[t.priceRangeHandle]:null;if(t.priceRangeHandle&&Array.isArray(p)&&p.length>0){let h=String(p[0]||"").split("-");if(h.length===2){let b=h[0].trim()?parseFloat(h[0]):void 0,y=h[1].trim()?parseFloat(h[1]):void 0,S=typeof b=="number"&&!isNaN(b)&&b>=0,C=typeof y=="number"&&!isNaN(y)&&y>=0;(S||C)&&(t.filters.priceRange={min:S?b:void 0,max:C?y:void 0},delete t.filters[t.priceRangeHandle])}}if((i=t.selectedCollection)!=null&&i.id){let f=t.availableFilters.find(h=>h.optionType==="Collection"||o.isCollectionKey(h.queryKey)||o.isCollectionKey(h.handle));if(f){let h=f.handle||f.queryKey||"collections";(t.filters[h]||[]).includes(String(t.selectedCollection.id))||(t.filters[h]||(t.filters[h]=[]),t.filters[h].push(String(t.selectedCollection.id)),g.debug("Converted cpid to collection filter",{cpid:t.selectedCollection.id,handle:h}))}}if(s.keep!==void 0?(s.keep==="__all__"||typeof s.keep=="string"&&o.equals(s.keep,"__all__")?t.keep="__all__":Array.isArray(s.keep)&&s.keep.length>0?t.keep=s.keep:t.keep=null,g.debug("Keep filters set from URL",{keep:t.keep})):t.keep=null,g.info("Filters set from URL",{filters:t.filters}),s.page?t.pagination.page=s.page:t.fallbackPagination&&t.fallbackPagination.currentPage&&(t.pagination.page=t.fallbackPagination.currentPage),s.sort){let f=typeof s.sort=="object"?s.sort.field:s.sort;if(typeof f=="string"){let h=f.toLowerCase().trim();if(h==="best-selling"||h==="bestselling")t.sort={field:"best-selling",order:"asc"};else if(h.includes("-")){let[b,y]=h.split("-"),S=o.equalsAny(y,"ascending")?"asc":(o.equalsAny(y,"descending"),"desc");t.sort={field:b,order:S}}else{let[b,y]=f.split(":");t.sort={field:b,order:y||"desc"}}}else typeof s.sort=="object"&&s.sort.field&&(t.sort={field:s.sort.field,order:s.sort.order||"desc"})}else t.sort={field:"best-selling",order:"asc"};v.renderFilters(t.availableFilters),g.info("Filters rendered",{count:t.availableFilters.length}),g.info("Loading products...",{filters:t.filters,pagination:t.pagination});let d=await D.products(t.filters,t.pagination,t.sort);g.info("Products loaded",{count:((r=d.products)==null?void 0:r.length)||0,total:((n=d.pagination)==null?void 0:n.total)||0});let c=d.products&&Array.isArray(d.products)&&d.products.length>0,m=t.availableFilters&&Array.isArray(t.availableFilters)&&t.availableFilters.length>0;if(!c&&t.fallbackProducts&&t.fallbackProducts.length>0?(g.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((a=d.products)==null?void 0:a.length)||0,fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=G.getPagination(),t.availableFilters=[],v.hideFilters()):(t.usingFallback=!1,t.products=d.products||[],t.pagination=d.pagination||t.pagination,v.showFilters()),v.renderProducts(t.products),v.renderInfo(t.pagination,t.pagination.total||0),v.renderPagination(t.pagination),v.renderApplied(t.filters),v.sortSelect){if(o.isBestSelling(t.sort.field))v.sortSelect.value="best-selling";else{let f=o.equals(t.sort.order,"asc")?"ascending":"descending";v.sortSelect.value=`${t.sort.field}-${f}`}g.debug("Sort select value updated programmatically",{value:v.sortSelect.value,sort:t.sort})}v.hideLoading(),t.products.length===0&&!m&&(!t.fallbackProducts||t.fallbackProducts.length===0)&&v.showError("No products or filters found. Please check your configuration.")}catch(s){if(v.hideLoading(),g.error("Load failed",{error:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,shop:t.shop,apiBaseURL:D.baseURL}),t.fallbackProducts&&t.fallbackProducts.length>0){if(g.warn("Initial load failed, using fallback products from Liquid",{error:s instanceof Error?s.message:String(s),fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=G.getPagination(),t.availableFilters=[],v.hideFilters(),v.sortSelect)if(o.isBestSelling(t.sort.field))v.sortSelect.value="best-selling";else{let l=o.equals(t.sort.order,"asc")?"ascending":"descending";v.sortSelect.value=`${t.sort.field}-${l}`}v.renderProducts(t.products),v.renderInfo(t.pagination,t.pagination.total),v.renderPagination(t.pagination),v.renderApplied(t.filters)}else v.showError(`${_.messages.failedToLoad}: ${s instanceof Error?s.message:_.messages.unknownError}. ${_.messages.checkConsole}`)}},Logger:g},N=window;N.DOM=v;N.AFS_State=t;N.AFS_API=D;N.AFS_LOG=g;N.QuickAdd=ee;N.$=o;N.Icons=V;N.Lang=_;N.SpecialValue=X;typeof window!="undefined"?N.AFS=Y:typeof global!="undefined"&&(global.AFS=Y);function Z(e,i=document,r=5e3){return new Promise((n,a)=>{let s=i.querySelector(e);if(s){n(s);return}let l=new MutationObserver((d,c)=>{let m=i.querySelector(e);m&&(c.disconnect(),n(m))});l.observe(i.body||i,{childList:!0,subtree:!0});let u=setTimeout(()=>{l.disconnect(),a(new Error(`Element ${e} not found within ${r}ms`))},r),p=n;n=d=>{clearTimeout(u),p(d)}})}function te(e,i=document,r=5e3){return Promise.all(e.map(n=>Z(n,i,r)))}var z=class{constructor(i,r={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.magnifierZoom=3;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let n=typeof i=="string"?document.querySelector(i):i;if(!n)throw console.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=n,this.options={thumbnailsPosition:r.thumbnailsPosition||"left",enableKeyboard:r.enableKeyboard!==!1,enableAutoHeight:r.enableAutoHeight!==!1,maxHeight:r.maxHeight||null,animationDuration:r.animationDuration||300,enableMagnifier:r.enableMagnifier!==!1,magnifierZoom:r.magnifierZoom||3,...r},this.magnifierEnabled=this.options.enableMagnifier,this.magnifierZoom=this.options.magnifierZoom,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){console.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){console.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let i=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(i),this.images.length===0){console.error("AFSSlider: No images found");return}let r=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(r),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(n){console.error("AFSSlider: Error building slider structure",n);return}try{this.setupEvents()}catch(n){console.error("AFSSlider: Error setting up events",n)}if(this.magnifierEnabled&&!this.isTouchDevice)try{this.setupPanZoom()}catch(n){console.error("AFSSlider: Error setting up pan-zoom",n)}if(this.isTouchDevice)try{this.setupPinchZoom()}catch(n){console.error("AFSSlider: Error setting up pinch-zoom",n)}try{this.goToSlide(0)}catch(n){console.error("AFSSlider: Error showing first slide",n)}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let n=document.createElement("div");n.className="afs-slider__viewport",this.images.forEach(a=>{n.appendChild(a)}),this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let n=document.createElement("button");n.type="button",n.className="afs-slider__prev",n.setAttribute("aria-label","Previous image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__next")){let n=document.createElement("button");n.type="button",n.className="afs-slider__next",n.setAttribute("aria-label","Next image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(n)}this.thumbnails.forEach((n,a)=>{n.addEventListener("click",()=>{this.goToSlide(a)})});let i=this.mainContainer.querySelector(".afs-slider__prev"),r=this.mainContainer.querySelector(".afs-slider__next");i&&i.addEventListener("click",()=>this.prevSlide()),r&&r.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=i=>{if(!this.isInitialized)return;let r=this.container.getBoundingClientRect();if(!(r.width===0||r.height===0))switch(i.key){case"ArrowLeft":i.preventDefault(),this.prevSlide();break;case"ArrowRight":i.preventDefault(),this.nextSlide();break;case"Escape":let n=this.images[this.currentIndex];n&&(n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200));break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let i=0,r=0,n=!1,a=this.mainContainer.querySelector(".afs-slider__viewport");a&&(a.addEventListener("touchstart",s=>{i=s.touches[0].clientX,r=s.touches[0].clientY,n=!0},{passive:!0}),a.addEventListener("touchmove",s=>{n&&s.preventDefault()},{passive:!1}),a.addEventListener("touchend",s=>{if(!n)return;n=!1;let l=s.changedTouches[0].clientX,u=s.changedTouches[0].clientY,p=i-l,d=r-u;Math.abs(p)>Math.abs(d)&&Math.abs(p)>50&&(p>0?this.nextSlide():this.prevSlide())},{passive:!0}))}setupPanZoom(){if(!this.mainContainer)return;let i=this.mainContainer.querySelector(".afs-slider__viewport");if(!i)return;i.classList.add("afs-slider__viewport--zoomable");let r=this.magnifierZoom||3;i.addEventListener("mousemove",n=>{let a=this.images[this._currentIndex];if(!a)return;let s=i.getBoundingClientRect(),l=n.clientX-s.left,u=n.clientY-s.top,p=l/s.width,d=u/s.height,c=-p*(a.offsetWidth*r-s.width),m=-d*(a.offsetHeight*r-s.height);a.style.transform=`
        scale(${r})
        translate(${c/r}px, ${m/r}px)
      `,a.classList.add("afs-slider__image--zoomed")}),i.addEventListener("mouseenter",()=>{let n=this.images[this._currentIndex];n&&n.classList.add("afs-slider__image--zoomed")}),i.addEventListener("mouseleave",()=>{let n=this.images[this.currentIndex];n&&(n.classList.remove("afs-slider__image--zoomed"),n.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{n.classList.remove("afs-slider__image--zoom-reset")},200))})}setupPinchZoom(){if(!this.mainContainer||!this.isTouchDevice)return;let i=this.mainContainer.querySelector(".afs-slider__viewport");if(!i)return;let r=0,n=1,a=0,s=null;i.addEventListener("touchstart",l=>{if(l.touches.length===2){l.preventDefault();let u=l.touches[0],p=l.touches[1];r=Math.hypot(p.clientX-u.clientX,p.clientY-u.clientY);let d=this.images[this._currentIndex];if(d){let m=(d.style.transform||"").match(/scale\(([\d.]+)\)/);n=m?parseFloat(m[1]):1}}else if(l.touches.length===1){let u=Date.now();if(u-a<300){l.preventDefault(),s&&clearTimeout(s);let p=this.images[this._currentIndex];if(p){let c=(p.style.transform||"").match(/scale\(([\d.]+)\)/),m=c?parseFloat(c[1]):1;if(m>1)p.style.transform="scale(1) translate(0, 0)",m=1;else{let f=i.getBoundingClientRect(),h=l.touches[0],b=h.clientX-f.left,y=h.clientY-f.top,S=2.5;p.style.transform=`scale(${S}) translate(${(f.width/2-b)/S}px, ${(f.height/2-y)/S}px)`,m=S}}}else a=u}},{passive:!1}),i.addEventListener("touchmove",l=>{if(l.touches.length===2){l.preventDefault();let u=l.touches[0],p=l.touches[1],d=Math.hypot(p.clientX-u.clientX,p.clientY-u.clientY),c=Math.max(1,Math.min(4,n*(d/r))),m=this.images[this._currentIndex];if(m){let f=i.getBoundingClientRect(),h=(u.clientX+p.clientX)/2-f.left,b=(u.clientY+p.clientY)/2-f.top,y=(f.width/2-h)/c,S=(f.height/2-b)/c;m.style.transform=`scale(${c}) translate(${y}px, ${S}px)`}}},{passive:!1}),i.addEventListener("touchend",()=>{r=0})}goToSlide(i){if(i<0||i>=this.images.length)return;this._currentIndex=i,this.images.forEach((n,a)=>{a===i?n.classList.add("afs-slider__image--active"):n.classList.remove("afs-slider__image--active")});let r=this.images[this._currentIndex];r&&(r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200)),this.thumbnails.forEach((n,a)=>{n.classList.toggle("afs-slider__thumbnail--active",a===i)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:i,total:this.images.length}}))}prevSlide(){let i=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(i)}nextSlide(){let i=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(i)}adjustHeight(){let i=this.images[this._currentIndex];i&&(i.complete?this.setHeight(i):i.addEventListener("load",()=>{this.setHeight(i)},{once:!0}))}setHeight(i){if(!this.mainContainer)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r)return;if(this.options.maxHeight){r.style.height=`${this.options.maxHeight}px`,r.style.minHeight=`${this.options.maxHeight}px`,r.style.maxHeight=`${this.options.maxHeight}px`;return}let n=i.naturalHeight||i.offsetHeight,a=i.naturalWidth||i.offsetWidth,s=this.mainContainer.offsetWidth,l=n/a,u=s*l;r.style.height=`${u}px`,r.style.minHeight=`${u}px`}updateVariantImage(i,r,n){var c;if(!i||!r||!Array.isArray(r)||r.length===0)return!1;let a=i.id;if(n&&Array.isArray(n)){if(i.featured_image&&typeof i.featured_image=="object"&&i.featured_image.variant_ids){let m=i.featured_image.position;if(m!=null){let f=m-1;if(f>=0&&f<this.images.length&&f<r.length)return this._currentIndex!==f&&this.goToSlide(f),!0}}for(let m of n)if(m.featured_image&&typeof m.featured_image=="object"&&m.featured_image.variant_ids&&m.featured_image.variant_ids.includes(Number(a))){let f=m.featured_image.position;if(f!=null){let h=f-1;if(h>=0&&h<this.images.length&&h<r.length)return this._currentIndex!==h&&this.goToSlide(h),!0}}}let s=null,l=null;if(i.featured_image&&(typeof i.featured_image=="object"?(s=i.featured_image.src||i.featured_image.url||null,l=(c=i.featured_image.position)!=null?c:null):typeof i.featured_image=="string"&&(s=i.featured_image)),s||(typeof i.image=="string"?s=i.image:i.image&&typeof i.image=="object"?s=i.image.url||i.image.src||null:i.imageUrl?s=i.imageUrl:i.featuredImage&&typeof i.featuredImage=="object"&&(s=i.featuredImage.url||i.featuredImage.src||null)),!s)return!1;let u=m=>m?(typeof m=="string"?m:(m==null?void 0:m.url)||(m==null?void 0:m.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",p=u(s);if(l!=null){let m=l-1;if(m>=0&&m<this.images.length&&m<r.length)return this._currentIndex!==m&&this.goToSlide(m),!0}let d=r.findIndex(m=>{let f=u(m);return f===p||f.includes(p)||p.includes(f)});if(d===-1){let m=p.split("/").pop();d=r.findIndex(f=>u(f).split("/").pop()===m)}return d!==-1&&d<this.images.length?(this._currentIndex!==d&&this.goToSlide(d),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(i=>{i.classList.remove("afs-slider__image--zoomed"),i.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{i.classList.remove("afs-slider__image--zoom-reset")},200)}),this.isInitialized=!1}},R=window;function W(){return{State:R.AFS_State||{moneyFormat:null,currency:null},Log:R.AFS_LOG||{error:()=>{},warn:()=>{},info:()=>{},debug:()=>{},log:()=>{},init:()=>{}},QuickAdd:R.QuickAdd||{add:async()=>{},addFromForm:async()=>{},addVariant:async()=>{},showSuccess:()=>{}},$:R.$||{debounce:()=>()=>{},toLowerCase:()=>"",inputDisplayType:()=>"checkbox",isMultiSelect:()=>!1,split:()=>[],id:()=>null,str:()=>"",empty:()=>!0,el:()=>document.createElement("div"),txt:()=>document.createElement("div"),clear:()=>{},frag:()=>document.createDocumentFragment(),optimizeImageUrl:()=>"",buildImageSrcset:()=>"",formatMoney:()=>"",equals:()=>!1,equalsAny:()=>!1,isVendorKey:()=>!1,isProductTypeKey:()=>!1,isTagKey:()=>!1,isCollectionKey:()=>!1,isPriceRangeKey:()=>!1,isBestSelling:()=>!1,isCollectionOptionType:()=>!1,isPriceRangeOptionType:()=>!1},Icons:R.Icons||{rightArrow:"",downArrow:"",close:"",minus:"",plus:"",eye:""},Lang:R.Lang||{buttons:{quickAdd:"",quickAddToCart:"",quickView:"",addToCart:"",buyNow:"",clear:"",clearAll:"",close:"",closeFilters:"",toggleFilters:"",filters:"",previous:"",next:"",apply:""},labels:{sortBy:"",appliedFilters:"",search:"",price:"",collection:"",productUnavailable:"",loading:"",loadingProduct:""},sortOptions:{bestSelling:"",titleAsc:"",titleDesc:"",priceAsc:"",priceDesc:"",createdAsc:"",createdDesc:""},messages:{noProductsFound:"",oneProductFound:"",productsFound:"",showingProducts:"",pageOf:"",addedToCart:"",failedToLoad:"",failedToLoadProducts:"",failedToLoadProduct:"",failedToAddToCart:"",failedToProceedToCheckout:"",failedToLoadProductModal:"",failedToLoadFilters:"",initializationFailed:"",loadFailed:"",unknownError:"",checkConsole:""},placeholders:{searchProducts:"",searchFilter:""}},SpecialValue:R.SpecialValue||{DEFAULT_TITLE:"Default Title"}}}async function ie(e,i){let r=W(),{State:n,Log:a,QuickAdd:s,$:l,Icons:u,Lang:p,SpecialValue:d}=r,c=l.el("dialog","afs-product-modal",{id:i});c.innerHTML=`
      <div class="afs-product-modal__container">
        <div class="afs-product-modal__close-container">
          <button class="afs-product-modal__close" type="button">${u.close}</button>
        </div>
        <div class="afs-product-modal__content">
          <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
            ${p.labels.loadingProduct}
          </div>
        </div>
      </div>
    `;let f=`${R.Shopify&&R.Shopify.routes&&R.Shopify.routes.root||"/"}products/${e}.js`;try{let h=await fetch(f);if(!h.ok)throw new Error("Failed to load product");let b=await h.json();if(!b.variants||!Array.isArray(b.variants))throw new Error("Invalid product data structure");let y=b.variants.find(w=>w.available)||b.variants[0],S=y?y.id:null,C=()=>{if(!b.variants||b.variants.length===0)return"";if(b.variants.length===1){let T=b.variants[0].title;if(T&&l.equals(T,d.DEFAULT_TITLE))return""}if(!b.options||b.options.length===0)return"";let w='<div class="afs-product-modal__variant-selector">';return b.options.forEach((O,T)=>{w+='<div class="afs-product-modal__option-group">',w+=`<label class="afs-product-modal__option-label">${O.name}</label>`,w+='<div class="afs-product-modal__option-values">',[...new Set(b.variants.map(I=>T===0?I.option1:T===1?I.option2:I.option3).filter(Boolean))].forEach(I=>{let $=b.variants.find(U=>T===0?U.option1===I:T===1?U.option2===I:U.option3===I),K=$&&$.available,B=$&&$.id===S;w+=`<button 
              class="afs-product-modal__option-value ${B?"afs-product-modal__option-value--selected":""} ${K?"":"afs-product-modal__option-value--unavailable"}"
              data-option-index="${T}"
              data-option-value="${I}"
              data-variant-id="${$?$.id:""}"
              ${K?"":"disabled"}
              type="button"
            >${I}</button>`}),w+="</div></div>"}),w+="</div>",w},A=(()=>{if(!b.images||b.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let w='<div class="afs-slider__thumbnails">';b.images.forEach((T,M)=>{let I=M===0?"afs-slider__thumbnail--active":"",$=l.optimizeImageUrl(T,{width:100,height:100,crop:"center",format:"webp",quality:75}),B=[80,100,120].map(U=>`${l.optimizeImageUrl(T,{width:U,height:U,crop:"center",format:"webp",quality:75})} ${U}w`).join(", ");w+=`
            <div class="afs-slider__thumbnail ${I}" data-slide-index="${M}">
              <img 
                src="${$}" 
                srcset="${B}"
                sizes="100px"
                alt="${b.title} - Thumbnail ${M+1}" 
                loading="lazy"
                width="100"
                height="100"
              />
            </div>
          `}),w+="</div>";let O='<div class="afs-slider__main">';return b.images.forEach((T,M)=>{let I=l.optimizeImageUrl(T,{width:800,height:800,format:"webp",quality:85}),K=[400,600,800,1e3,1200].map(B=>`${l.optimizeImageUrl(T,{width:B,height:B,format:"webp",quality:B<=600?80:85})} ${B}w`).join(", ");O+=`
            <img 
              class="afs-slider__image" 
              src="${I}" 
              srcset="${K}"
              sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
              alt="${b.title} - Image ${M+1}" 
              loading="${M===0?"eager":"lazy"}"
            />
          `}),O+="</div>",{thumbnails:w,mainImages:O}})(),P=C(),L=w=>l.formatMoney(w,n.moneyFormat||"{{amount}}",n.currency||""),F=b.variants.find(w=>w.id===S)||y,k=L(F.price),j=F.compare_at_price&&F.compare_at_price>F.price?`<span class="afs-product-modal__compare-price">${L(F.compare_at_price)}</span>`:"";c.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${u.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div class="afs-product-modal__layout">
              <div class="afs-product-modal__media">
                <div class="afs-slider" id="${i}-slider">
                  ${A.mainImages}
                  ${A.thumbnails}
                </div>
              </div>
              <div class="afs-product-modal__details">
                <div class="afs-product-modal__header">
                  <div>
                    <span class="afs-product-modal__vendor">${b.vendor||""}</span>
                  </div>
                  <h1 class="afs-product-modal__title">${b.title||""}</h1>
                  <div class="afs-product-modal__price-container">
                    <span class="afs-product-modal__price">${k}</span>
                    ${j}
                  </div>
                </div>
                ${P}
                <div class="afs-product-modal__buttons">
                  <div class="afs-product-modal__add-to-cart">
                    <div class="afs-product-modal__incrementor">
                      <button class="afs-product-modal__decrease" type="button">${u.minus}</button>
                      <span class="afs-product-modal__count" id="${i}-count">1</span>
                      <button class="afs-product-modal__increase" type="button">${u.plus}</button>
                    </div>
                    <button
                      class="afs-product-modal__add-button"
                      id="${i}-add-button"
                      data-variant-id="${S}"
                      ${F.available?"":"disabled"}
                      type="button"
                    >
                      ${p.buttons.addToCart}
                    </button>
                  </div>
                  <button
                    class="afs-product-modal__buy-button"
                    id="${i}-buy-button"
                    data-variant-id="${S}"
                    ${F.available?"":"disabled"}
                    type="button"
                  >
                    ${p.buttons.buyNow}
                  </button>
                </div>
                <div class="afs-product-modal__description">
                  <span class="afs-product-modal__description-text">
                    ${b.description||""}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `,c._productData=b,c._currentVariantId=S||void 0,(async()=>{try{let w=await Z(`#${i}-slider`,c,3e3);(await te(Array.from({length:10},(T,M)=>`.afs-slider__image:nth-child(${M+1})`),w,2e3).catch(()=>Array.from(w.querySelectorAll(".afs-slider__image")))).length>0?c._slider=new z(w,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}):a.warn("No images found for slider",{modalId:i})}catch(w){a.error("Failed to initialize slider",{error:w instanceof Error?w.message:String(w),modalId:i})}})(),se(c,i,b,L,r)}catch(h){let b=W(),{Log:y,Icons:S,Lang:C}=b;y.error("Failed to load product for modal",{error:h instanceof Error?h.message:String(h),handle:e}),c.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${S.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div style="padding: 2rem; text-align: center;">
              <p>${C.messages.failedToLoadProductModal}</p>
            </div>
          </div>
        </div>
      `,oe(c,b)}return c}function se(e,i,r,n,a){let{Log:s,QuickAdd:l,Lang:u}=a,p=e.querySelector(".afs-product-modal__close"),d=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};p&&p.addEventListener("click",S=>{S.preventDefault(),S.stopPropagation(),d()}),e.addEventListener("cancel",S=>{S.preventDefault(),d()}),e.addEventListener("click",S=>{S.target===e&&d()});let c=e.querySelector(".afs-product-modal__decrease"),m=e.querySelector(".afs-product-modal__increase"),f=e.querySelector(`#${i}-count`);c&&f&&c.addEventListener("click",()=>{let S=parseInt(f.textContent||"1",10)||1;S>1&&(f.textContent=String(S-1))}),m&&f&&m.addEventListener("click",()=>{let S=parseInt(f.textContent||"1",10)||1;f.textContent=String(S+1)}),e.querySelectorAll(".afs-product-modal__option-value").forEach(S=>{S.addEventListener("click",()=>{var P;if(S.disabled)return;let C=[];r.options&&r.options.forEach((L,F)=>{let k=e.querySelector(`.afs-product-modal__option-value[data-option-index="${F}"].afs-product-modal__option-value--selected`);k&&(C[F]=k.dataset.optionValue||"")});let E=parseInt(S.dataset.optionIndex||"0",10);C[E]=S.dataset.optionValue||"",e.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${E}"]`).forEach(L=>{L.classList.remove("afs-product-modal__option-value--selected")}),S.classList.add("afs-product-modal__option-value--selected");let A=(P=r.variants)==null?void 0:P.find(L=>r.options?r.options.every((F,k)=>k===0?L.option1===C[k]:k===1?L.option2===C[k]:L.option3===C[k]):!1);A&&ae(e,i,A,n,a)})});let b=e.querySelector(`#${i}-add-button`);b&&f&&b.addEventListener("click",async()=>{if(b.disabled)return;let S=parseInt(f.textContent||"1",10)||1,C=b.dataset.variantId;try{await l.addVariant(parseInt(C||"0",10),S),d()}catch(E){s.error("Failed to add to cart from modal",{error:E instanceof Error?E.message:String(E)}),alert(u.messages.failedToAddToCart)}});let y=e.querySelector(`#${i}-buy-button`);y&&f&&y.addEventListener("click",async()=>{if(y.disabled)return;let S=parseInt(f.textContent||"1",10)||1,C=y.dataset.variantId;try{let E=R.Shopify&&R.Shopify.routes&&R.Shopify.routes.root||"/";window.location.href=`${E}cart/${C}:${S}?checkout`}catch(E){s.error("Failed to buy now",{error:E instanceof Error?E.message:String(E)}),alert(u.messages.failedToProceedToCheckout)}})}function ae(e,i,r,n,a){let{Lang:s}=a;e._currentVariantId=r.id;let l=e.querySelector(".afs-product-modal__price-container");if(l){let c=n(r.price),m=r.compare_at_price&&r.compare_at_price>r.price?`<span class="afs-product-modal__compare-price">${n(r.compare_at_price)}</span>`:"";l.innerHTML=`
        <span class="afs-product-modal__price">${c}</span>
        ${m}
      `}let u=e.querySelector(`#${i}-add-button`);u&&(u.dataset.variantId=String(r.id),u.disabled=!r.available,u.innerHTML=s.buttons.addToCart);let p=e.querySelector(`#${i}-buy-button`);p&&(p.dataset.variantId=String(r.id),p.disabled=!r.available);let d=e._productData;if(d&&d.images&&e._slider&&d.variants){let c=r.id,m=null;if(r.featured_image&&typeof r.featured_image=="object"&&r.featured_image.variant_ids){let b=r.featured_image.position;if(b!=null){let y=b-1;y>=0&&y<d.images.length&&(e._slider.currentIndex||0)!==y&&(m=y)}}else for(let b of d.variants)if(b.featured_image&&typeof b.featured_image=="object"&&b.featured_image.variant_ids&&b.featured_image.variant_ids.includes(Number(c))){let y=b.featured_image.position;if(y!=null){let S=y-1;if(S>=0&&S<d.images.length&&(e._slider.currentIndex||0)!==S){m=S;break}}}if(m!==null&&e._slider.goToSlide){e._slider.goToSlide(m);return}if(e._slider.updateVariantImage&&d.images&&e._slider.updateVariantImage(r,d.images,d.variants))return;let f=null,h=null;if(r.featured_image&&(typeof r.featured_image=="object"?(f=r.featured_image.src||r.featured_image.url||null,h=r.featured_image.position||null):typeof r.featured_image=="string"&&(f=r.featured_image)),f||(f=(typeof r.image=="string"?r.image:null)||r.imageUrl||r.image&&typeof r.image=="object"&&(r.image.url||r.image.src)||null||r.featuredImage&&typeof r.featuredImage=="object"&&(r.featuredImage.url||r.featuredImage.src)||null),f&&d.images&&e._slider.goToSlide){let b=C=>C?(typeof C=="string"?C:C&&typeof C=="object"&&(C.url||C.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(h!=null){let C=h-1;if(C>=0&&C<d.images.length){e._slider.goToSlide(C);return}}let y=b(f),S=d.images.findIndex(C=>{let E=b(C);return E===y||E.includes(y)||y.includes(E)});if(S!==-1)e._slider.goToSlide(S);else{let C=y.split("/").pop();if(C){let E=d.images.findIndex(A=>b(A).split("/").pop()===C);E!==-1&&e._slider.goToSlide&&e._slider.goToSlide(E)}}}}}function oe(e,i){let r=e.querySelector(".afs-product-modal__close"),n=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};r&&r.addEventListener("click",n),e.addEventListener("cancel",n),e.addEventListener("click",a=>{a.target===e&&n()})}function le(e){let i=W(),{$:r,Icons:n,Lang:a}=i;if(!e.handle)return null;let s=r.el("button","afs-product-card__quick-view",{"data-product-handle":e.handle,"data-product-id":String(e.id||e.productId||e.gid||""),"aria-label":a.buttons.quickView,type:"button"}),l=r.el("span","afs-product-card__quick-view-icon");return l.innerHTML=n.eye,s.appendChild(l),s}function de(e){let i=W(),{Log:r,Lang:n}=i;if(!e)return;let a=`product-modal-${e}`,s=document.getElementById(a);(async()=>{s||(s=await ie(e,a),document.body.appendChild(s)),s.showModal?(document.body.style.overflow="hidden",s.showModal()):(document.body.style.overflow="hidden",s.style.display="block");let u=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};s.addEventListener("close",u,{once:!0});let p=new MutationObserver(()=>{s&&!s.open&&!s.hasAttribute("open")&&(u(),p.disconnect())});s&&p.observe(s,{attributes:!0,attributeFilter:["open"]})})().catch(u=>{r.error("Failed to open product modal",{error:u instanceof Error?u.message:String(u),handle:e}),alert(n.messages.failedToLoadProductModal)})}typeof window!="undefined"&&(window.AFSSlider=z);typeof window!="undefined"&&(window.AFSQuickView={createQuickViewButton:le,handleQuickViewClick:de,createProductModal:ie});
