"use strict";var z=new Map;var J=(r=>(r.ALL="__all__",r.CLEAR="__clear__",r.DEFAULT_TITLE="Default Title",r))(J||{}),q={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24},B={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'},ne=new Set(["shop","shop_domain","cpid"]),_={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}},o={debounce:(e,t)=>{let i;return(...r)=>{i!==void 0&&clearTimeout(i),i=setTimeout(()=>e(...r),t)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.selectionType),"multiple")||o.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(t=>String(t).trim()).filter(Boolean):String(e).split(",").map(t=>t.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let t=e.productId||e.id||e.gid;return t&&String(t).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,t,i={})=>{let r=document.createElement(e);return t&&(r.className=t),Object.entries(i).forEach(([s,a])=>r.setAttribute(s,a)),r},txt:(e,t)=>(e.textContent=t,e),clear:e=>{for(;e.firstChild;){let t=e.firstChild;t&&e.removeChild(t)}},frag:(e,t)=>{let i=document.createDocumentFragment();return e.forEach(r=>i.appendChild(t(r))),i},optimizeImageUrl:(e,t={})=>{if(!e||typeof e!="string")return"";let{width:i=500,height:r=i,quality:s=80,format:a="webp",crop:l=null}=t;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let c=new URL(e),u=new URLSearchParams(c.search);return u.delete("width"),u.delete("height"),u.delete("crop"),u.delete("format"),u.delete("quality"),u.set("width",String(i)),u.set("height",String(r)),l&&u.set("crop",l),s!==100&&u.set("quality",String(s)),!c.pathname.toLowerCase().endsWith(".gif")&&a&&u.set("format",a),`${c.origin}${c.pathname}?${u.toString()}`}catch(c){return e}},buildImageSrcset:(e,t=[200,300,500])=>e?t.map(i=>`${o.optimizeImageUrl(e,{width:i,format:"webp",quality:i<=200?75:i<=300?80:85})} ${i}w`).join(", "):"",formatMoney:(e,t,i="")=>{if(isNaN(Number(e)))return"";let r=parseFloat(String(e))/100;if(!t||typeof t!="string")return`${i||""}${r.toFixed(2)}`;let s=r.toFixed(2);return t.includes("{{amount_no_decimals}}")?(s=Math.round(r).toString(),t.replace("{{amount_no_decimals}}",s)):t.includes("{{amount_with_comma_separator}}")?(s=r.toFixed(2).replace(".",","),t.replace("{{amount_with_comma_separator}}",s)):t.includes("{{amount_no_decimals_with_comma_separator}}")?(s=Math.round(r).toString(),t.replace("{{amount_no_decimals_with_comma_separator}}",s)):t.includes("{{amount_with_apostrophe_separator}}")?(s=r.toFixed(2).replace(".","'"),t.replace("{{amount_with_apostrophe_separator}}",s)):t.replace("{{amount}}",s)},equals:(e,t)=>e===t?!0:e==null||t===null||t===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(t)&&(t=t.join(",")),typeof e=="string"&&typeof t=="string"?e.trim().toLowerCase()===t.trim().toLowerCase():typeof e=="number"&&typeof t=="number"||typeof e=="boolean"&&typeof t=="boolean"?e===t:String(e).trim().toLowerCase()===String(t).trim().toLowerCase()),equalsAny:(e,...t)=>e==null?!1:t.some(i=>o.equals(e,i)),isVendorKey:e=>o.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>o.equalsAny(e,"productType","productTypes"),isTagKey:e=>o.equalsAny(e,"tag","tags"),isCollectionKey:e=>o.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>o.equalsAny(e,"priceRange","price"),isBestSelling:e=>o.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>o.equals(e,"Collection"),isPriceRangeOptionType:e=>o.equals(e,"priceRange")},ee={buildFilterMetadata:e=>{let t=new Map;return Array.isArray(e)&&e.forEach(i=>{i.handle&&t.set(i.handle,{label:i.label||i.queryKey||i.optionKey||i.handle,queryKey:i.queryKey,optionKey:i.optionKey,optionType:i.optionType})}),t}},n={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:q.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},m={enabled:!0,error:(e,t)=>{m.enabled&&console.error("[AFS]",e,t||"")},warn:(e,t)=>{m.enabled&&console.warn("[AFS]",e,t||"")},info:(e,t)=>{m.enabled&&console.info("[AFS]",e,t||"")},debug:(e,t)=>{m.enabled&&console.debug("[AFS]",e,t||"")},log:(e,...t)=>{m.enabled&&console.log(e,...t)},init:e=>{m.enabled=e!==!1,m.log("%cAdvanced Filter & Search initialized","color: #00c853;font-size: 20px;font-weight: bold;background: #0b1e13;padding: 10px 15px;border-radius: 6px;font-family: Arial, sans-serif;")}},H={parse(){let e=new URL(window.location.href),t={},i,r;return e.searchParams.forEach((s,a)=>{if(!ne.has(a))if(o.isVendorKey(a))t.vendor=o.split(s);else if(o.isProductTypeKey(a))t.productType=o.split(s);else if(o.isTagKey(a))t.tags=o.split(s);else if(o.isCollectionKey(a))t.collections=o.split(s);else if(o.equals(a,"search"))t.search=s;else if(o.equals(a,"priceMin")){let l=parseFloat(s);!isNaN(l)&&l>=0&&(i=l)}else if(o.equals(a,"priceMax")){let l=parseFloat(s);!isNaN(l)&&l>=0&&(r=l)}else if(o.isPriceRangeKey(a)){let l=s.split("-");if(l.length===2){let d=parseFloat(l[0]),c=parseFloat(l[1]);!isNaN(d)&&d>=0&&(i=d),!isNaN(c)&&c>=0&&(r=c)}}else if(o.equals(a,"page"))t.page=parseInt(s,10)||1;else if(o.equals(a,"limit"))t.limit=parseInt(s,10)||q.PAGE_SIZE;else if(o.equals(a,"sort")){let l=s.toLowerCase().trim();if(o.isBestSelling(l))t.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[d,c]=l.split("-"),u=o.equalsAny(c,"ascending")?"asc":(o.equalsAny(c,"descending"),"desc");t.sort={field:d,order:u}}else{let[d,c]=s.split(":");t.sort={field:d,order:o.equalsAny(c,"asc")?"asc":"desc"}}}else t[a]=o.split(s),m.debug("Handle filter parsed directly",{handle:a,value:s})}),(i!==void 0||r!==void 0)&&(t.priceRange={min:i,max:r}),t},update(e,t,i){let r=new URL(window.location.href);if(r.search="",m.debug("Updating URL",{filters:e,pagination:t}),e&&!o.empty(e)&&Object.keys(e).forEach(a=>{let l=e[a];if(!o.empty(l))if(Array.isArray(l)&&l.length>0)r.searchParams.set(a,l.join(",")),m.debug("URL param set",{key:a,value:l.join(",")});else if(o.isPriceRangeKey(a)&&l&&typeof l=="object"&&!Array.isArray(l)){let d=l,c=typeof d.min=="number"&&!isNaN(d.min)?d.min:void 0,u=typeof d.max=="number"&&!isNaN(d.max)?d.max:void 0;if(n.priceRangeHandle){let f=`${c!==void 0?c:""}-${u!==void 0?u:""}`;r.searchParams.set(n.priceRangeHandle,f),m.debug("Price range URL handle param set",{handle:n.priceRangeHandle,value:f})}else c!==void 0&&r.searchParams.set("priceMin",String(c)),u!==void 0&&r.searchParams.set("priceMax",String(u)),m.debug("Price range URL params set",{priceMin:c,priceMax:u})}else o.equals(a,"search")&&typeof l=="string"&&l.trim()&&(r.searchParams.set(a,l.trim()),m.debug("Search URL param set",{key:a,value:l.trim()}))}),t&&t.page>1&&(r.searchParams.set("page",String(t.page)),m.debug("Page URL param set",{page:t.page})),i&&i.field){if(i.field==="best-selling"||i.field==="bestselling")r.searchParams.set("sort","best-selling");else{let a=o.equals(i.order,"asc")?"ascending":"descending";r.searchParams.set("sort",`${i.field}-${a}`)}m.debug("Sort URL param set",{field:i.field,order:i.order})}let s=r.toString();m.info("URL updated",{newUrl:s,oldUrl:window.location.href}),history.pushState({filters:e,pagination:t,sort:i},"",r)}},O={baseURL:"https://fstaging.digitalcoo.com/storefront",__v:"v2.0.1",__id:"01-01-2026",cache:new Map,timestamps:new Map,pending:new Map,key(e,t,i){return`${t.page}-${t.limit}-${i.field}-${i.order}-${JSON.stringify(e)}`},get(e){let t=this.timestamps.get(e);return!t||Date.now()-t>q.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,t){this.cache.set(e,t),this.timestamps.set(e,Date.now())},async fetch(e,t=q.TIMEOUT){let i=new AbortController,r=setTimeout(()=>i.abort(),t);try{m.debug("Fetching",{url:e});let s=await fetch(e,{signal:i.signal});if(clearTimeout(r),!s.ok){let l=await s.text().catch(()=>"");throw new Error(`HTTP ${s.status}: ${s.statusText}${l?" - "+l:""}`)}let a=await s.json();return m.debug("Fetch success",{url:e,hasData:!!a}),a}catch(s){throw clearTimeout(r),s instanceof Error&&s.name==="AbortError"?new Error("Request timeout"):(m.error("Fetch failed",{url:e,error:s instanceof Error?s.message:String(s)}),s)}},shouldSendCpid(e){var t;return!!((t=n.selectedCollection)!=null&&t.id)},async products(e,t,i){var c;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!n.shop)throw new Error("Shop not set");let r=this.key(e,t,i),s=this.get(r);if(s)return m.debug("Cache hit",{key:r}),s;if(this.pending.has(r))return m.debug("Request deduplication",{key:r}),this.pending.get(r);let a=new URLSearchParams;if(a.set("shop",n.shop),this.shouldSendCpid(e)?(a.set("cpid",n.selectedCollection.id),m.debug("cpid sent to products API",{cpid:n.selectedCollection.id,filters:e})):m.debug("cpid not sent to products API",{hasCpid:!!((c=n.selectedCollection)!=null&&c.id),filters:e,reason:"filters present or cpid already in collection filter"}),Object.keys(e).forEach(u=>{let f=e[u];if(!o.empty(f))if(o.isPriceRangeKey(u)&&f&&typeof f=="object"&&!Array.isArray(f)){let p=f,g=typeof p.min=="number"&&!isNaN(p.min)?p.min:void 0,v=typeof p.max=="number"&&!isNaN(p.max)?p.max:void 0;n.priceRangeHandle?a.set(n.priceRangeHandle,`${g!==void 0?g:""}-${v!==void 0?v:""}`):(g!==void 0&&a.set("priceMin",String(g)),v!==void 0&&a.set("priceMax",String(v)))}else u==="search"&&typeof f=="string"&&f.trim()?a.set(u,f.trim()):Array.isArray(f)&&f.length>0?(a.set(u,f.join(",")),m.debug("Filter sent as direct handle param",{handle:u,value:f.join(",")})):typeof f=="string"&&(a.set(u,f),m.debug("Filter sent as direct handle param",{handle:u,value:f}))}),a.set("page",String(t.page)),a.set("limit",String(t.limit)),i.field)if(o.isBestSelling(i.field))a.set("sort","best-selling");else{let u=o.equals(i.order,"asc")?"ascending":"descending";a.set("sort",`${i.field}-${u}`)}let l=`${this.baseURL}/products?${a}`;m.info("Fetching products",{url:l,shop:n.shop,page:t.page});let d=this.fetch(l).then(u=>{var p,g;if(!u.success||!u.data)throw m.error("Invalid products response",{response:u}),new Error(`Invalid products response: ${u.message||_.messages.unknownError}`);let f=u.data;return m.info("Products response",{productsCount:((p=f.products)==null?void 0:p.length)||0,total:((g=f.pagination)==null?void 0:g.total)||0,hasFilters:!!f.filters}),this.set(r,f),this.pending.delete(r),f}).catch(u=>{throw this.pending.delete(r),m.error("Products fetch failed",{error:u instanceof Error?u.message:String(u),url:l}),u});return this.pending.set(r,d),d},async filters(e){var d;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!n.shop)throw new Error("Shop not set");let t=new URLSearchParams;t.set("shop",n.shop),this.shouldSendCpid(e)?(t.set("cpid",n.selectedCollection.id),m.debug("cpid sent to filters API",{cpid:n.selectedCollection.id,filters:e})):m.debug("cpid not sent to filters API",{hasCpid:!!((d=n.selectedCollection)!=null&&d.id),filters:e,reason:"filters present or cpid already in collection filter"});let i={...e};Object.keys(i).forEach(c=>{let u=i[c];if(!o.empty(u)){if(Array.isArray(u))t.set(c,u.join(","));else if(c==="search"&&typeof u=="string"&&u.trim())t.set("search",u.trim());else if(c==="priceRange"&&u&&typeof u=="object"&&!Array.isArray(u)){let f=u,p=typeof f.min=="number"&&!isNaN(f.min)?f.min:void 0,g=typeof f.max=="number"&&!isNaN(f.max)?f.max:void 0;n.priceRangeHandle?t.set(n.priceRangeHandle,`${p!==void 0?p:""}-${g!==void 0?g:""}`):(p!==void 0&&t.set("priceMin",String(p)),g!==void 0&&t.set("priceMax",String(g)))}}});let r={};t.forEach((c,u)=>{r[u]=c}),m.debug("All params for filters endpoint",{params:r});let s=`${this.baseURL}/filters?${t}`;m.info("Fetching filters",{url:s,shop:n.shop});let a=await this.fetch(s);if(!a.success||!a.data)throw m.error("Invalid filters response",{response:a}),new Error(`Invalid filters response: ${a.message||_.messages.unknownError}`);let l=a.data;if(!l||typeof l!="object")throw new Error("Invalid filters response: data is not an object");return l.filters!==void 0&&!Array.isArray(l.filters)&&(m.warn("Filters response contains non-array filters",{filters:l.filters}),l.filters=[]),m.info("Filters response:",{filters:l.filters}),l},setBaseURL(e){this.baseURL=e}},S={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(e,t,i){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Container selector cannot be empty. Provide a valid selector or ensure [data-afs-container] exists in the DOM.");if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error(`Container not found. Selector: "${e}". Please ensure the container element exists in the DOM.`);this.container.setAttribute("data-afs-container","true");let r=this.container.querySelector(".afs-main-content")||o.el("div","afs-main-content");r.parentNode||this.container.appendChild(r),this.filtersContainer=t&&t.trim()!==""&&document.querySelector(t)||null,this.filtersContainer||(this.filtersContainer=o.el("div","afs-filters-container")),!this.filtersContainer.parentNode&&r&&r.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=o.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":_.buttons.closeFilters}),this.mobileFilterClose.innerHTML=_.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=o.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",r.parentNode?r.parentNode.insertBefore(this.mobileFilterBackdrop,r):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=i&&i.trim()!==""&&document.querySelector(i)||null,this.productsContainer||(this.productsContainer=o.el("div","afs-products-container")),!this.productsContainer.parentNode&&r&&r.appendChild(this.productsContainer),this.productsInfo=o.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=o.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":_.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${_.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=o.el("div","afs-sort-container");let s=o.el("label","afs-sort-label",{for:"afs-sort-label"});s.textContent=_.labels.sortBy,this.sortSelect=o.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${_.sortOptions.bestSelling}</option>
        <option value="title-ascending">${_.sortOptions.titleAsc}</option>
        <option value="title-descending">${_.sortOptions.titleDesc}</option>
        <option value="price-ascending">${_.sortOptions.priceAsc}</option>
        <option value="price-descending">${_.sortOptions.priceDesc}</option>
        <option value="created-ascending">${_.sortOptions.createdAsc}</option>
        <option value="created-descending">${_.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(s),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=o.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",m.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),m.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let t=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),t&&window.scrollTo(0,parseInt(t||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let t=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${t}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}m.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton(),z.clear(),this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(r=>{let s=r.getAttribute("data-afs-filter-key");if(s){let a=r.querySelector(".afs-filter-group__search-input"),l=r.getAttribute("data-afs-collapsed")==="true",d=(a==null?void 0:a.value)||"",c=z.get(s);z.set(s,{...c,collapsed:l,search:d,lastUpdated:Date.now()})}}),o.clear(this.filtersContainer);let t=e.filter(r=>r?o.isPriceRangeOptionType(r.optionType)?r.range&&typeof r.range.min=="number"&&typeof r.range.max=="number"&&r.range.max>r.range.min:r.values&&r.values.length>0:!1);if(m.debug("Rendering filters",{total:e.length,valid:t.length,filtersWithSearchable:t.filter(r=>r.searchable).length,filtersWithCollapsed:t.filter(r=>r.collapsed).length}),t.length===0){m.warn("No valid filters to render");return}let i=document.createDocumentFragment();t.forEach(r=>{var E;if(o.isPriceRangeOptionType(r.optionType)){let P=this.createPriceRangeGroup(r,z);P&&i.appendChild(P);return}let s;if(r.optionType||r.optionKey){if(s=r.handle,!s){m.error("Option filter missing handle",{filter:r});return}}else if(s=r.queryKey||r.key,!s){m.warn("Standard filter missing queryKey/key",{filter:r});return}m.debug("Filter group handle determined",{handle:s,filterHandle:r.handle,queryKey:r.queryKey,key:r.key,label:r.label,type:r.optionType,optionType:r.optionType,optionKey:r.optionKey,isOptionFilter:!!(r.optionType||r.optionKey)});let a=o.el("div","afs-filter-group",{"data-afs-filter-type":r.optionType||""});a.setAttribute("data-afs-filter-handle",s);let l=s;a.setAttribute("data-afs-filter-key",l);let d=z.get(l),c=(d==null?void 0:d.collapsed)!==void 0?d.collapsed:r.collapsed===!0||r.collapsed==="true"||r.collapsed===1;a.setAttribute("data-afs-collapsed",c?"true":"false"),m.debug("Filter group created",{handle:s,label:r.label,collapsed:c,searchable:r.searchable,showCount:r.showCount,valuesCount:((E=r.values)==null?void 0:E.length)||0});let u=o.el("div","afs-filter-group__header"),f=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":c?"false":"true",title:r.tooltipContent||`Toggle ${r.label||s} filter`}),p=o.el("span","afs-filter-group__icon");p.innerHTML=c?B.rightArrow||"":B.downArrow||"",f.appendChild(p),f.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),r.label||r.optionType||"")),u.appendChild(f);let g=n.filters[s];if(g&&(Array.isArray(g)?g.length>0:typeof g=="object"&&!Array.isArray(g)?Object.keys(g).length>0:!!g)){let P=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${r.label||s} filters`,"data-afs-filter-handle":s});P.textContent=_.buttons.clear,P.title=`${_.buttons.clear} ${r.label||s} filters`,u.appendChild(P)}a.appendChild(u);let h=o.el("div","afs-filter-group__content");if(r.searchable===!0||typeof r.searchable=="string"&&r.searchable.toLowerCase()==="true"){let P=o.el("div","afs-filter-group__search"),A=o.el("input","afs-filter-group__search-input",{type:"text",placeholder:r.searchPlaceholder||"Search...","aria-label":`${_.labels.search}${r.label||s}`,name:`afs-search-${s}`});d!=null&&d.search&&(A.value=d.search),P.appendChild(A),h.appendChild(P),m.debug("Search input added",{handle:s,label:r.label,searchable:r.searchable})}let b=o.el("div","afs-filter-group__items",{"data-afs-filter-handle":s,"data-afs-filter-multiselect":o.isMultiSelect(r)?"1":"0","data-afs-filter-display-type":o.toLowerCase(r.displayType||"CHECKBOX")});b._items=r.values;let C=document.createDocumentFragment();r.values&&r.values.forEach((P,A)=>{let T=this.createFilterItem(s,P,r,A);T&&C.appendChild(T)}),b.appendChild(C),h.appendChild(b),a.appendChild(h),i.appendChild(a)}),i.children.length>0?(this.filtersContainer.appendChild(i),this.showFilters(),m.debug("Filters rendered",{count:i.children.length})):(m.warn("No filter groups created"),this.hideFilters())},createFilterItem(e,t,i,r){var v;let s=o.str(typeof t=="string"?t:t.value||t.key||t.name||"");if(!s||s==="[object Object]")return null;let a=typeof t=="string"?t:t.label||t.value||s;if((o.isCollectionOptionType(i==null?void 0:i.optionType)||o.isCollectionKey(e))&&n.collections&&Array.isArray(n.collections)){if((v=n.selectedCollection)!=null&&v.id&&String(s)===String(n.selectedCollection.id))return null;let h=n.collections.find(y=>{let b=String(y.id||y.gid||y.collectionId||"");return b&&String(b)===String(s)});if(h)a=h.title||h.label||h.name||a;else return null}let c=(n.filters[e]||[]).includes(s),u=o.inputDisplayType(i),f=(u==="radio"?e:e+"-"+s.replace(/\s+/g,"-").toLowerCase())+"_"+(r+1),p=o.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":s,for:f});c&&p.classList.add("afs-filter-item--active");let g=o.el("input","afs-filter-item__checkbox",{type:u});return g.checked=c,g.setAttribute("data-afs-filter-value",s),g.setAttribute("name",f),g.setAttribute("id",f),p.appendChild(g),p.appendChild(o.txt(o.el("span","afs-filter-item__label"),a)),i!=null&&i.showCount&&typeof t=="object"&&t.count&&p.appendChild(o.txt(o.el("span","afs-filter-item__count"),`(${t.count})`)),p},createPriceRangeGroup(e,t=null){var D;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return m.warn("Invalid price range filter",{filter:e}),null;let i=e.range.min,r=e.range.max,s=n.filters.priceRange||{min:i,max:r},a=Math.max(i,Math.min(r,s.min||i)),l=Math.max(i,Math.min(r,s.max||r)),d=o.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),c=t==null?void 0:t.get(e.key||"priceRange"),u=(D=c==null?void 0:c.collapsed)!=null?D:e.collapsed===!0;d.setAttribute("data-afs-collapsed",u?"true":"false");let f=o.el("div","afs-filter-group__header"),p=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":u?"false":"true"}),g=o.el("span","afs-filter-group__icon");if(g.innerHTML=u?B.rightArrow||"":B.downArrow||"",p.appendChild(g),p.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),f.appendChild(p),n.filters.priceRange&&(n.filters.priceRange.min!==i||n.filters.priceRange.max!==r)){let L=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});L.textContent=_.buttons.clear,L.title=`${_.buttons.clear} ${e.label} filter`,f.appendChild(L)}d.appendChild(f);let h=o.el("div","afs-filter-group__content"),y=o.el("div","afs-price-range-container"),b=o.el("div","afs-price-range-track"),C=o.el("div","afs-price-range-active");b.appendChild(C);let E=o.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(i),max:String(r),value:String(a),step:"1"});E.setAttribute("data-afs-range-type","min");let P=o.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(i),max:String(r),value:String(l),step:"1"});P.setAttribute("data-afs-range-type","max"),b.appendChild(E),b.appendChild(P),y.appendChild(b);let A=o.el("div","afs-price-range-values"),T=o.el("span","afs-price-range-value afs-price-range-value--min"),F=o.el("span","afs-price-range-value afs-price-range-value--max"),M=L=>`$${parseFloat(String(L)).toFixed(0)}`;T.textContent=M(a),F.textContent=M(l),A.appendChild(T),A.appendChild(o.txt(o.el("span","afs-price-range-separator")," - ")),A.appendChild(F),y.appendChild(A);let K=()=>{let L=parseFloat(E.value),x=parseFloat(P.value),I=r-i,$=(L-i)/I*100,G=(r-x)/I*100;C.style.left=`${$}%`,C.style.right=`${G}%`,T.textContent=M(L),F.textContent=M(x)},w=()=>{let L=parseFloat(E.value),x=parseFloat(P.value);L>x&&(E.value=String(x),P.value=String(L)),K()};return E.addEventListener("input",()=>{w(),k.updatePriceRange(parseFloat(E.value),parseFloat(P.value))}),P.addEventListener("input",()=>{w(),k.updatePriceRange(parseFloat(E.value),parseFloat(P.value))}),K(),h.appendChild(y),d.appendChild(h),d},renderProducts(e){if(!this.productsGrid)return;let t=this.productsGrid.querySelectorAll(".afs-skeleton-card");t.length>0&&t.forEach(a=>a.remove());let i=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(a=>{let l=a.getAttribute("data-afs-product-id");l&&i.set(l,a)});let r=new Set(e.map(a=>o.id(a)).filter(a=>a!==null)),s=document.createDocumentFragment();e.forEach(a=>{let l=o.id(a);if(!l)return;let d=i.get(l);if(d){let c=d.querySelector(".afs-product-card__title");c&&c.textContent!==a.title&&(c.textContent=a.title||"");let u=d.querySelector(".afs-product-card__price");if(u){let f=parseFloat(String(a.minPrice||0))*100,p=parseFloat(String(a.maxPrice||0))*100,g=o.formatMoney(f,n.moneyFormat||"{{amount}}",n.currency||""),v=f===p?g:`${_.labels.price}from ${g}`;u.textContent!==v&&(u.textContent=v)}}else{let c=this.createProduct(a);c&&s.appendChild(c)}}),i.forEach((a,l)=>{r.has(l)||a.remove()}),s.children.length>0&&this.productsGrid.appendChild(s)},createProduct(e){var r,s,a;let t=o.el("div","afs-product-card",{"data-afs-product-id":o.id(e)||""});if(e.imageUrl||e.featuredImage){let l=o.el("div","afs-product-card__image"),d=o.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),c=((r=e.featuredImage)==null?void 0:r.url)||((s=e.featuredImage)==null?void 0:s.urlFallback)||e.imageUrl||"";if(c){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let h=[];e.featuredImage.urlSmall&&h.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&h.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&h.push(`${e.featuredImage.urlLarge} 500w`),h.length>0&&(d.setAttribute("srcset",h.join(", ")),d.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),d.src=e.featuredImage.url||e.featuredImage.urlFallback||c}else{let h=o.optimizeImageUrl(c,{width:300,format:"webp",quality:80}),y=o.buildImageSrcset(c,[200,300,500]);y&&(d.setAttribute("srcset",y),d.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),d.src=h||c}d.onerror=function(){var y;let h=((y=e.featuredImage)==null?void 0:y.urlFallback)||c;if(h&&this.src!==h)this.src=h;else if(this.src.includes("_webp.")){let b=c.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");b!==this.src?this.src=b:this.style.display="none"}else this.style.display="none"}}l.appendChild(d);let u=o.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":o.id(e)||"","aria-label":_.buttons.quickAddToCart,type:"button"}),f=o.el("span","afs-product-card__quick-add-icon");f.innerHTML=B.plus,u.appendChild(f);let p=o.el("span","afs-product-card__quick-add-text");p.textContent=_.buttons.quickAdd,u.appendChild(p),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(h=>h.availableForSale))&&(u.disabled=!0,u.classList.add("afs-product-card__quick-add--disabled"),u.setAttribute("aria-label",_.labels.productUnavailable));let v=(a=window.AFSQuickView)==null?void 0:a.createQuickViewButton(e);v&&l.appendChild(v),t.appendChild(l)}let i=o.el("div","afs-product-card__info");if(i){i.appendChild(o.txt(o.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&i.appendChild(o.txt(o.el("div","afs-product-card__vendor"),e.vendor));let l=parseFloat(String(e.minPrice||0))*100,d=parseFloat(String(e.maxPrice||0))*100,c=o.formatMoney(l,n.moneyFormat||"{{amount}}",n.currency||""),u=l===d?c:`from ${c}`;i.appendChild(o.txt(o.el("div","afs-product-card__price"),u)),t.appendChild(i)}return t},updateFilterState(e,t,i){if(!this.filtersContainer){m.warn("Cannot update filter state: filtersContainer not found");return}let r=c=>String(c).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),s=r(t),l=`.afs-filter-item[data-afs-filter-handle="${r(e)}"][data-afs-filter-value="${s}"]`,d=this.filtersContainer.querySelector(l);if(d){let c=d.querySelector(".afs-filter-item__checkbox");c?(c.checked=i,m.debug("Checkbox state updated",{handle:e,value:t,active:i})):m.warn("Checkbox not found in filter item",{handle:e,value:t}),d.classList.toggle("afs-filter-item--active",i)}else m.warn("Filter item not found for state update",{handle:e,value:t,active:i,selector:l})},renderInfo(e,t){if(!this.productsInfo)return;let i=this.sortContainer,r=this.productsInfo.querySelector(".afs-products-info__results");r&&r.remove();let s;if(t===0)s=o.txt(o.el("div","afs-products-info__results"),_.messages.noProductsFound);else if(t===1)s=o.txt(o.el("div","afs-products-info__results"),_.messages.oneProductFound);else{let a=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,t);s=o.txt(o.el("div","afs-products-info__results"),`${_.messages.showingProducts} ${a}-${l} of ${t} ${_.messages.productsFound}`)}i&&i.parentNode?this.productsInfo.insertBefore(s,i):(this.productsInfo.appendChild(s),i&&!i.parentNode&&this.productsInfo.appendChild(i))},renderPagination(e){var l;if(!this.productsGrid||!e)return;let t=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(t&&t.remove(),e.totalPages<=1)return;let i=o.el("div","afs-pagination"),r=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${_.buttons.previous} ${_.messages.pageOf.toLowerCase()}`});r.textContent=_.buttons.previous,r.disabled=e.page<=1,i.appendChild(r);let s=o.el("span","afs-pagination__info");s.textContent=`${_.messages.pageOf} ${e.page} of ${e.totalPages}`,i.appendChild(s);let a=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${_.buttons.next} ${_.messages.pageOf.toLowerCase()}`});a.textContent=_.buttons.next,a.disabled=e.page>=e.totalPages,i.appendChild(a),this.productsContainer&&this.productsContainer.appendChild(i)},renderApplied(e){if(!this.container)return;let t=this.container.querySelector(".afs-applied-filters");t&&t.remove();let i=[];if(Object.keys(e).forEach(d=>{let c=e[d];if(o.equals(d,"search")&&c&&typeof c=="string"&&c.trim())i.push({handle:d,label:`${_.labels.search}${c}`,value:c});else if(o.isPriceRangeKey(d)&&c&&typeof c=="object"&&!Array.isArray(c)){let u=c,f=typeof u.min=="number"&&!isNaN(u.min),p=typeof u.max=="number"&&!isNaN(u.max);f&&p?i.push({handle:d,label:`${_.labels.price}$${u.min} - $${u.max}`,value:"__clear__"}):f?i.push({handle:d,label:`${_.labels.price}$${u.min}+`,value:"__clear__"}):p&&i.push({handle:d,label:`${_.labels.price}Up to $${u.max}`,value:"__clear__"})}else Array.isArray(c)&&c.length>0&&c.forEach(u=>{let f=n.filterMetadata.get(d),p=(f==null?void 0:f.label)||d,g=u;if((o.isCollectionOptionType(f==null?void 0:f.optionType)||o.isCollectionKey(d))&&n.collections&&Array.isArray(n.collections)){let h=n.collections.find(y=>{let b=String(y.id||y.gid||y.collectionId||"");return b&&String(b)===String(u)});h&&(g=h.title||h.label||h.name||u)}i.push({handle:d,label:`${p}: ${g}`,value:u})})}),i.length===0)return;let r=o.el("div","afs-applied-filters"),s=o.el("div","afs-applied-filters__header");s.appendChild(o.txt(o.el("div","afs-applied-filters__label"),_.labels.appliedFilters)),r.appendChild(s);let a=o.el("div","afs-applied-filters__list");i.forEach(d=>{let c=o.el("div","afs-applied-filter-chip");c.appendChild(o.txt(o.el("span","afs-applied-filter-chip__label"),d.label));let u=o.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":d.handle,"data-afs-filter-value":d.value,"aria-label":`${_.buttons.clear} filter`,type:"button"});u.innerHTML=B.close,c.appendChild(u),a.appendChild(c)});let l=o.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});l.textContent=_.buttons.clearAll,a.appendChild(l),r.appendChild(a),this.container.insertBefore(r,this.container.firstChild)},scrollToProducts(){n.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),m.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),m.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),m.debug("Scrolled to products info")))},showLoading(){var e;if(this.productsGrid){o.clear(this.productsGrid);let t=((e=n.pagination)==null?void 0:e.limit)||q.PAGE_SIZE||24,i=Math.max(t,24),r=[];for(let s=0;s<i;s++){let a=o.el("div","afs-skeleton-card");a.innerHTML=`
            <div class="afs-skeleton-card__image">&#8203;</div>
            <div class="afs-skeleton-card__info">
              <div class="afs-skeleton-card__title">&#8203;</div>
              <div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
              <div class="afs-skeleton-card__price">&#8203;</div>
            </div>
          `,r.push(a)}r.forEach(s=>this.productsGrid.appendChild(s)),this.loading=r}this.filtersContainer&&this.filtersContainer.style.display!=="none"&&this.showFiltersSkeleton()},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let t=o.el("div","afs-filters-skeleton");for(let i=0;i<4;i++){let r=o.el("div","afs-skeleton-filter-group");r.innerHTML=`
          <div class="afs-skeleton-filter-group__header">
            <div class="afs-skeleton-filter-group__title">&#8203;</div>
          </div>
          <div class="afs-skeleton-filter-group__content">
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
          </div>
        `,t.appendChild(r)}this.filtersContainer.appendChild(t)},hideFiltersSkeleton(){var t;let e=(t=this.filtersContainer)==null?void 0:t.querySelector(".afs-filters-skeleton");e&&e.remove()},hideLoading(){var e;Array.isArray(this.loading)?(this.loading.forEach(t=>{t.parentNode&&t.remove()}),this.loading=null):(e=this.loading)!=null&&e.parentNode&&(this.loading.remove(),this.loading=null),this.hideFiltersSkeleton()},showError(e){var r;if(!this.productsContainer&&(this.productsContainer=((r=this.container)==null?void 0:r.querySelector(".afs-products-container"))||null,!this.productsContainer&&this.container)){let s=this.container.querySelector(".afs-main-content");s&&(this.productsContainer=o.el("div","afs-products-container"),s.appendChild(this.productsContainer))}if(!this.productsContainer){m.error("Cannot show error: productsContainer not found",{message:e}),console.error("[AFS Error]",e);return}if(this.hideLoading(),n.fallbackProducts&&n.fallbackProducts.length>0){m.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:n.fallbackProducts.length}),n.products=n.fallbackProducts,n.pagination={page:1,limit:q.PAGE_SIZE,total:n.fallbackProducts.length,totalPages:Math.ceil(n.fallbackProducts.length/q.PAGE_SIZE)},this.renderProducts(n.products),this.renderInfo(n.pagination,n.pagination.total),this.renderPagination(n.pagination);return}let t=this.productsContainer.querySelector(".afs-error-message");t&&t.remove();let i=o.el("div","afs-error-message");i.textContent=e||_.messages.failedToLoad,this.productsGrid?(o.clear(this.productsGrid),this.productsGrid.appendChild(i)):this.productsContainer.appendChild(i),m.error("Error displayed",{message:e})}},j={getPagination(){let t=H.parse().page||n.fallbackPagination.currentPage||1,i=n.fallbackPagination.totalPages||1,r=n.fallbackPagination.totalProducts||n.fallbackProducts.length||0;return{page:t,limit:q.PAGE_SIZE,total:r,totalPages:i}},reloadPage(e,t,i){let r=new URL(window.location.href);if(r.search="",i&&i.field)if(i.field==="best-selling"||i.field==="bestselling")r.searchParams.set("sort","best-selling");else{let s=o.equals(i.order,"asc")?"ascending":"descending";r.searchParams.set("sort",`${i.field}-${s}`)}t&&t.page&&r.searchParams.set("page",String(t.page)),Object.keys(e||{}).forEach(s=>{let a=e[s];if(!o.empty(a))if(Array.isArray(a)&&a.length>0)r.searchParams.set(s,a.join(","));else if(o.isPriceRangeKey(s)&&a&&typeof a=="object"&&!Array.isArray(a)){let l=a,d=typeof l.min=="number"&&!isNaN(l.min)?l.min:void 0,c=typeof l.max=="number"&&!isNaN(l.max)?l.max:void 0;n.priceRangeHandle?r.searchParams.set(n.priceRangeHandle,`${d!==void 0?d:""}-${c!==void 0?c:""}`):(d!==void 0&&r.searchParams.set("priceMin",String(d)),c!==void 0&&r.searchParams.set("priceMax",String(c)))}else o.equals(s,"search")&&typeof a=="string"&&a.trim()&&r.searchParams.set(s,a.trim())}),m.info("Reloading page for fallback mode",{url:r.toString(),sort:i,pagination:t}),window.location.href=r.toString()}},Z=e=>{var i;if(!((i=n.selectedCollection)!=null&&i.id))return;Object.keys(e||{}).some(r=>{let s=e[r];if(o.empty(s)||o.equalsAny(r,"page","limit","sort","size"))return!1;if(o.isPriceRangeKey(r)){if(!s||typeof s!="object"||Array.isArray(s))return!1;let a=s,l=typeof a.min=="number"&&!isNaN(a.min),d=typeof a.max=="number"&&!isNaN(a.max);if(!l&&!d)return!1}return!(o.equals(r,"search")&&(!s||typeof s!="string"||!s.trim()))})&&m.debug("Filters present, keeping cpid (server-managed)",{filters:e})},k={toggle(e,t){var c,u;let i=o.str(t);if(!i||!e){m.warn("Invalid filter toggle",{handle:e,value:t});return}let r=n.filters[e]||[],s=r.includes(i),a=s?r.filter(f=>f!==i):[...r,i],l=n.filterMetadata.get(e);if(((l==null?void 0:l.optionType)==="Collection"||e==="collections")&&((c=n.selectedCollection)!=null&&c.id)){let f=n.selectedCollection.id;s&&String(i)===String(f)?(n.selectedCollection.id=null,m.debug("Collection filter unchecked (was cpid), cleared cpid",{handle:e,value:i,cpid:f})):a.some(p=>String(p)===String(f))||(n.selectedCollection.id=null,m.debug("Collection filter toggled, cpid no longer in values, cleared cpid",{handle:e,value:i,filterValues:a,wasCpid:String(i)===String(f),originalCpid:f}))}if(a.length===0?delete n.filters[e]:n.filters[e]=a,Z(n.filters),n.pagination.page=1,m.debug("Filter toggled",{handle:e,value:i,wasActive:s,isActive:!s,filterValues:a}),H.update(n.filters,n.pagination,n.sort),S.updateFilterState(e,i,!s),S.scrollToProducts(),S.showLoading(),window.innerWidth<=768&&((u=S.filtersContainer)!=null&&u.classList.contains("afs-filters-container--open"))){S.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let f=document.body.style.top;f&&window.scrollTo(0,parseInt(f||"0",10)*-1)}this.apply()},updatePriceRange(e,t){if(typeof e!="number"||typeof t!="number"||e<0||t<e){m.warn("Invalid price range",{min:e,max:t});return}let i=n.availableFilters.find(r=>o.isPriceRangeOptionType(r.optionType)||o.equals(r.optionKey,"priceRange"));i&&i.range?e===i.range.min&&t===i.range.max?n.filters.priceRange=null:n.filters.priceRange={min:e,max:t}:n.filters.priceRange={min:e,max:t},Z(n.filters),n.pagination.page=1,m.debug("Price range updated",{min:e,max:t,priceRange:n.filters.priceRange}),H.update(n.filters,n.pagination,n.sort),S.scrollToProducts(),S.showLoading(),this.apply()},applyProductsOnly:o.debounce(async()=>{var e;if(m.info("applyProductsOnly called",{filters:n.filters,pagination:n.pagination,sort:n.sort,usingFallback:n.usingFallback}),n.usingFallback){m.info("In fallback mode, reloading page with new parameters"),j.reloadPage(n.filters,n.pagination,n.sort);return}S.scrollToProducts(),S.showLoading();try{m.info("Fetching products...",{url:`${O.baseURL}/products`});let t=await O.products(n.filters,n.pagination,n.sort);m.info("Products fetched successfully",{count:((e=t.products)==null?void 0:e.length)||0}),n.products=t.products||[],n.pagination=t.pagination||n.pagination,n.usingFallback=!1,S.showFilters(),S.renderProducts(n.products),S.renderInfo(n.pagination,n.pagination.total||0),S.renderPagination(n.pagination),S.renderApplied(n.filters),S.hideLoading()}catch(t){if(S.hideLoading(),m.error("Failed to load products",{error:t instanceof Error?t.message:String(t)}),n.fallbackProducts&&n.fallbackProducts.length>0){if(m.warn("Products API failed, using fallback products from Liquid",{error:t instanceof Error?t.message:String(t),fallbackCount:n.fallbackProducts.length}),n.usingFallback=!0,n.products=n.fallbackProducts,n.pagination=j.getPagination(),n.availableFilters=[],S.hideFilters(),S.sortSelect)if(o.isBestSelling(n.sort.field))S.sortSelect.value="best-selling";else{let i=o.equals(n.sort.order,"asc")?"ascending":"descending";S.sortSelect.value=`${n.sort.field}-${i}`}S.renderProducts(n.products),S.renderInfo(n.pagination,n.pagination.total),S.renderPagination(n.pagination),S.renderApplied(n.filters)}else S.showError(`${_.messages.failedToLoadProducts}: ${t instanceof Error?t.message:_.messages.unknownError}`)}},q.DEBOUNCE),apply:o.debounce(async()=>{S.scrollToProducts(),S.showLoading();try{let e=await O.products(n.filters,n.pagination,n.sort);n.products=e.products||[],n.pagination=e.pagination||n.pagination;try{let t=await O.filters(n.filters);if(Array.isArray(t.filters)){n.availableFilters=t.filters,n.filterMetadata=ee.buildFilterMetadata(n.availableFilters);let i=n.availableFilters.find(r=>o.isPriceRangeOptionType(r.optionType));n.priceRangeHandle=(i==null?void 0:i.handle)||n.priceRangeHandle,S.renderFilters(n.availableFilters)}}catch(t){m.warn("Failed to fetch updated filters",{error:t instanceof Error?t.message:String(t)})}S.renderProducts(n.products),S.renderInfo(n.pagination,n.pagination.total||0),S.renderPagination(n.pagination),S.renderApplied(n.filters),S.hideLoading()}catch(e){if(S.hideLoading(),m.error("Failed to apply filters",{error:e instanceof Error?e.message:String(e)}),n.fallbackProducts&&n.fallbackProducts.length>0){if(m.warn("Filters API failed, using fallback products from Liquid",{error:e instanceof Error?e.message:String(e),fallbackCount:n.fallbackProducts.length}),n.usingFallback=!0,n.products=n.fallbackProducts,n.pagination=j.getPagination(),n.availableFilters=[],S.hideFilters(),S.sortSelect)if(o.isBestSelling(n.sort.field))S.sortSelect.value="best-selling";else{let t=o.equals(n.sort.order,"asc")?"ascending":"descending";S.sortSelect.value=`${n.sort.field}-${t}`}S.renderProducts(n.products),S.renderInfo(n.pagination,n.pagination.total),S.renderPagination(n.pagination),S.renderApplied(n.filters)}else S.showError(`${_.messages.failedToLoadProducts}: ${e instanceof Error?e.message:_.messages.unknownError}`)}},q.DEBOUNCE)};var te={async add(e,t){try{let i=`/products/${e}.json`,r=await fetch(i);if(!r.ok)throw new Error(_.messages.failedToLoadProduct);let a=(await r.json()).product;if(!a||!a.variants||a.variants.length===0)throw new Error("Product has no variants");let l=a.variants.find(d=>d.available)||a.variants[0];await this.addVariant(Number(l.id),1)}catch(i){m.error("Quick add failed",{error:i instanceof Error?i.message:String(i),handle:e}),alert("Failed to add product to cart. Please try again.")}},async addFromForm(e,t){var i,r;try{let s=new FormData(e),a=s.get("id"),l=parseInt(((i=s.get("quantity"))==null?void 0:i.toString())||"1",10);if(a)await this.addVariant(Number(a),l);else{let d=[];for(let v=1;v<=3;v++){let h=s.get(`option${v}`);h&&d.push(h.toString())}let c=`/products/${t}.json`,g=(r=(await(await fetch(c)).json()).product.variants)==null?void 0:r.find(v=>v.options?v.options.length===d.length&&v.options.every((h,y)=>h===d[y]):!1);if(g)await this.addVariant(Number(g.id),l);else throw new Error("Variant not found")}}catch(s){m.error("Add from form failed",{error:s instanceof Error?s.message:String(s)}),alert("Failed to add product to cart. Please try again.")}},async addVariant(e,t){try{let i=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:t})});if(!i.ok){let r=await i.json();throw new Error(r.description||_.messages.failedToAddToCart)}await i.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(i){throw m.error("Add variant failed",{error:i instanceof Error?i.message:String(i),variantId:e}),i}},showSuccess(){let e=document.querySelector(".afs-quick-add-success");e||(e=o.el("div","afs-quick-add-success"),document.body.appendChild(e)),e.textContent=_.messages.addedToCart,e.classList.add("afs-quick-add-success--show");let t=()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",t)},i=setTimeout(()=>{e.classList.remove("afs-quick-add-success--show"),e.removeEventListener("animationend",t)},3e3);e.addEventListener("animationend",()=>{clearTimeout(i),t()},{once:!0})}},se={attach(){if(!S.container)return;S.container.addEventListener("click",i=>{var c,u,f,p,g,v,h;let r=i.target,s=(c=r.closest("[data-afs-action]"))==null?void 0:c.dataset.afsAction,a=r.closest(".afs-filter-item"),l=r instanceof HTMLInputElement&&(r.type==="checkbox"||r.type==="radio")?r:a==null?void 0:a.querySelector(".afs-filter-item__checkbox"),d=r.closest(".afs-pagination__button");if(s==="clear-all")n.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(u=n.selectedCollection)!=null&&u.id&&m.debug("Clear All: keeping server-managed cpid (not exposed to UI)"),n.pagination.page=1,H.update(n.filters,n.pagination,n.sort),S.scrollToProducts(),S.showLoading(),k.apply();else if(s==="toggle-filters"||s==="close-filters")S.toggleMobileFilters();else if(r.closest(".afs-applied-filter-chip__remove")){let y=r.closest(".afs-applied-filter-chip"),b=y==null?void 0:y.querySelector(".afs-applied-filter-chip__remove"),C=b==null?void 0:b.getAttribute("data-afs-filter-key"),E=b==null?void 0:b.getAttribute("data-afs-filter-value");if(!C)return;if(o.equals(C,"cpid")){(f=n.selectedCollection)!=null&&f.id&&(n.selectedCollection.id=null,m.debug("cpid removed, cleared selectedCollection")),H.update(n.filters,n.pagination,n.sort),S.scrollToProducts(),S.showLoading(),k.apply();return}if(o.equals(C,"search")){n.filters.search="",n.pagination.page=1,H.update(n.filters,n.pagination,n.sort),S.scrollToProducts(),S.showLoading(),k.apply();return}if(o.isPriceRangeKey(C)){n.filters.priceRange=null,n.pagination.page=1,H.update(n.filters,n.pagination,n.sort),S.scrollToProducts(),S.showLoading(),k.apply();return}E&&k.toggle(C,E)}else if(l&&a){i.preventDefault(),i.stopPropagation();let y=a.getAttribute("data-afs-filter-handle")||((p=a.parentElement)==null?void 0:p.getAttribute("data-afs-filter-handle")),b=a.getAttribute("data-afs-filter-value"),C=a.getAttribute("data-afs-filter-multiselect")||((g=a.parentElement)==null?void 0:g.getAttribute("data-afs-filter-multiselect"));if(!y||!b){m.warn("Invalid filter item clicked",{handle:y,value:b});return}m.debug("Filter toggle",{handle:y,value:b,currentChecked:l.checked}),(C==="0"||C==="false")&&(n.filters[y]=[]),k.toggle(y,b)}else if(d&&!d.disabled){let y=parseInt(d.getAttribute("data-afs-page")||"0",10);if(y&&y>0){if(n.usingFallback){let C=H.parse().page||n.pagination.page||1;n.pagination.page=y}else n.pagination.page=y;H.update(n.filters,n.pagination,n.sort),S.scrollToProducts(),S.showLoading(),k.applyProductsOnly()}}else if(r.closest(".afs-filter-group__clear")){i.preventDefault(),i.stopPropagation();let y=r.closest(".afs-filter-group__clear");if(!y)return;let b=y.getAttribute("data-afs-filter-handle");if(!b)return;let C=n.filterMetadata.get(b),E=o.isCollectionOptionType(C==null?void 0:C.optionType)||o.isCollectionKey(b);if(n.filters[b]){if(E&&((v=n.selectedCollection)!=null&&v.id)){let P=n.filters[b],A=n.selectedCollection.id;Array.isArray(P)&&P.some(F=>String(F)===String(A))&&(n.selectedCollection.id=null,m.debug("Collection filter cleared (contained cpid), cleared cpid",{handle:b,cpid:A}))}delete n.filters[b],m.debug("Filter cleared",{handle:b,isCollectionFilter:E}),H.update(n.filters,n.pagination,n.sort),S.scrollToProducts(),S.showLoading(),k.apply()}}else if(r.closest(".afs-filter-group__toggle")){i.preventDefault(),i.stopPropagation();let y=r.closest(".afs-filter-group");if(!y)return;let C=!(y.getAttribute("data-afs-collapsed")==="true");y.setAttribute("data-afs-collapsed",C?"true":"false");let E=y.getAttribute("data-afs-filter-key");if(E)try{let T=z.get(E)||{};T.collapsed=C,T.lastUpdated=Date.now(),z.set(E,T);try{let F=`afs_filter_state_${y.getAttribute("data-afs-filter-handle")}`;sessionStorage.setItem(F,JSON.stringify({collapsed:C}))}catch(F){m.debug("Could not persist to sessionStorage",{error:F})}}catch(T){m.error("Failed to persist filter state",{stateKey:E,error:T instanceof Error?T.message:String(T)})}let P=y.querySelector(".afs-filter-group__toggle");P&&P.setAttribute("aria-expanded",C?"false":"true");let A=y.querySelector(".afs-filter-group__icon");A&&(A.innerHTML=C?B.rightArrow||"":B.downArrow||""),m.debug("Filter group toggled",{collapsed:C,stateKey:E})}else if(r.closest(".afs-product-card__quick-add")){i.preventDefault(),i.stopPropagation();let y=r.closest(".afs-product-card__quick-add");if(!y||y.disabled)return;let b=y.getAttribute("data-product-handle"),C=y.getAttribute("data-product-id");b&&te.add(b,C)}else if(r.closest(".afs-product-card__quick-view")){i.preventDefault(),i.stopPropagation();let y=r.closest(".afs-product-card__quick-view");if(!y)return;let b=y.getAttribute("data-product-handle");if(b){let C=window;(h=C.AFSQuickView)!=null&&h.handleQuickViewClick?C.AFSQuickView.handleQuickViewClick(b):m.error("AFSQuickView module not loaded")}}}),S.container.addEventListener("input",i=>{var s;let r=i.target;if(r.classList.contains("afs-filter-group__search-input")){let l=r.value.toLowerCase(),d=(s=r.closest(".afs-filter-group"))==null?void 0:s.querySelector(".afs-filter-group__items");d!=null&&d._items&&d.querySelectorAll(".afs-filter-item").forEach((c,u)=>{var p;let f=(p=d._items)==null?void 0:p[u];if(f){let g=o.str(typeof f=="string"?f:f.label||f.value||"").toLowerCase();c.style.display=!l||g.includes(l)?"":"none"}})}});let e=i=>{let r=i.value;if(!r)return;m.info("Sort dropdown changed",{sortValue:r,currentSort:n.sort});let s;if(r==="best-selling"||r==="bestselling")s={field:"best-selling",order:"asc"};else if(r.includes("-")){let[a,l]=r.split("-");s={field:a,order:l==="ascending"?"asc":"desc"}}else{let[a,l]=r.split(":");s={field:a,order:l||"desc"}}n.sort=s,n.pagination.page=1,H.update(n.filters,n.pagination,n.sort),m.info("Calling applyProductsOnly after sort change",{sort:n.sort}),S.scrollToProducts(),S.showLoading(),k.applyProductsOnly()},t=null;S.container.addEventListener("focus",i=>{let r=i.target;r.classList.contains("afs-sort-select")&&(t=r.value)},!0),S.container.addEventListener("change",i=>{let r=i.target;if(r.classList.contains("afs-sort-select")){let s=r;e(s),t=s.value}}),S.container.addEventListener("blur",i=>{let r=i.target;if(r.classList.contains("afs-sort-select")){let s=r,a=s.value;a&&a!==t&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{let l;if(o.isBestSelling(n.sort.field))l="best-selling";else{let d=o.equals(n.sort.order,"asc")?"ascending":"descending";l=`${n.sort.field}-${d}`}a!==l&&e(s)})}),t=a}},!0),window.addEventListener("popstate",()=>{let i=H.parse(),r=JSON.stringify(n.filters),s=n.pagination.page,a=JSON.stringify(n.sort);n.filters={vendor:i.vendor||[],productType:i.productType||[],tags:i.tags||[],collections:i.collections||[],search:i.search||"",priceRange:i.priceRange||null},Object.keys(i).forEach(g=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort"].includes(g)){let v=i[g];Array.isArray(v)?n.filters[g]=v:typeof v=="string"&&(n.filters[g]=[v])}});let l=n.priceRangeHandle?n.filters[n.priceRangeHandle]:null;if(n.priceRangeHandle&&Array.isArray(l)&&l.length>0){let v=String(l[0]||"").split("-");if(v.length===2){let h=v[0].trim()?parseInt(v[0],10):void 0,y=v[1].trim()?parseInt(v[1],10):void 0,b=typeof h=="number"&&!isNaN(h)&&h>=0,C=typeof y=="number"&&!isNaN(y)&&y>=0;(b||C)&&(n.filters.priceRange={min:b?h:void 0,max:C?y:void 0},delete n.filters[n.priceRangeHandle])}}let d=i.page||n.pagination.page;if(d!==s&&(n.pagination.page=d),i.sort){let g=typeof i.sort=="object"?i.sort.field:i.sort;if(typeof g=="string"){let v=g.toLowerCase().trim();if(v==="best-selling"||v==="bestselling")n.sort={field:"best-selling",order:"asc"};else if(v.includes("-")){let[h,y]=v.split("-"),b=o.equalsAny(y,"ascending")?"asc":(o.equalsAny(y,"descending"),"desc");n.sort={field:h,order:b}}else{let[h,y]=g.split(":");n.sort={field:h,order:y||"desc"}}}else typeof i.sort=="object"&&i.sort.field&&(n.sort={field:i.sort.field,order:i.sort.order||"desc"})}else n.sort={field:"best-selling",order:"asc"};let c=JSON.stringify(n.filters),u=JSON.stringify(n.sort);!(r!==c)&&(u!==a||d!==s)?k.applyProductsOnly():k.apply()})}},X={init(e={}){var t,i,r,s;try{if(m.init(e.debug),m.info("Initializing AFS",e),e.apiBaseUrl&&(O.setBaseURL(e.apiBaseUrl),m.info("API base URL set",{url:O.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");n.shop=e.shop,n.collections=e.collections||[],n.selectedCollection={id:(i=(t=e.selectedCollection)==null?void 0:t.id)!=null?i:null,sortBy:(s=(r=e.selectedCollection)==null?void 0:r.sortBy)!=null?s:null},n.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.moneyFormat&&(n.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(n.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(n.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(n.fallbackProducts=e.fallbackProducts,m.info("Fallback products loaded from Liquid",{count:n.fallbackProducts.length})),e.fallbackPagination&&(n.fallbackPagination=e.fallbackPagination,m.info("Fallback pagination loaded from Liquid",{currentPage:n.fallbackPagination.currentPage,totalPages:n.fallbackPagination.totalPages,totalProducts:n.fallbackPagination.totalProducts})),e.priceRangeHandle!==void 0&&(n.priceRangeHandle=e.priceRangeHandle),m.info("Shop set",{shop:n.shop}),m.info("Collections set",{collections:n.collections});let a=e.containerSelector||e.container||"[data-afs-container]",l=e.filtersSelector||e.filtersContainer,d=e.productsSelector||e.productsContainer;S.init(a,l,d),m.info("DOM initialized"),S.showLoading(),se.attach(),m.info("Events attached"),this.load()}catch(a){throw m.error("Initialization failed",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,config:e}),S.container&&S.showError(`Initialization failed: ${a instanceof Error?a.message:String(a)}`),a}},async load(){var e,t,i,r;S.showLoading();try{let s=H.parse();m.debug("Parsed URL params on load",{urlParams:s}),n.filters={vendor:s.vendor||[],productType:s.productType||[],tags:s.tags||[],collections:s.collections||[],search:s.search||"",priceRange:s.priceRange||null},Object.keys(s).forEach(p=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","cpid"].includes(p)){let g=s[p];Array.isArray(g)?n.filters[p]=g:typeof g=="string"&&(n.filters[p]=[g])}}),Z(n.filters),m.info("Loading filters...",{shop:n.shop,filters:n.filters});let a;try{a=await O.filters(n.filters),m.info("Filters loaded",{filtersCount:((e=a.filters)==null?void 0:e.length)||0})}catch(p){m.warn("Failed to load filters, continuing with empty filters",{error:p instanceof Error?p.message:String(p)}),a={filters:[]}}Array.isArray(a.filters)||(m.error("Invalid filters response: filters is not an array",{filters:a.filters}),a.filters=[]),n.availableFilters=a.filters||[],n.filterMetadata=ee.buildFilterMetadata(n.availableFilters);let l=n.availableFilters.find(p=>o.isPriceRangeOptionType(p.optionType));n.priceRangeHandle=(l==null?void 0:l.handle)||n.priceRangeHandle||null;let d=n.priceRangeHandle?n.filters[n.priceRangeHandle]:null;if(n.priceRangeHandle&&Array.isArray(d)&&d.length>0){let g=String(d[0]||"").split("-");if(g.length===2){let v=g[0].trim()?parseInt(g[0],10):void 0,h=g[1].trim()?parseInt(g[1],10):void 0,y=typeof v=="number"&&!isNaN(v)&&v>=0,b=typeof h=="number"&&!isNaN(h)&&h>=0;(y||b)&&(n.filters.priceRange={min:y?v:void 0,max:b?h:void 0},delete n.filters[n.priceRangeHandle])}}if(m.info("Filters set from URL",{filters:n.filters}),s.page?n.pagination.page=s.page:n.fallbackPagination&&n.fallbackPagination.currentPage&&(n.pagination.page=n.fallbackPagination.currentPage),s.sort){let p=typeof s.sort=="object"?s.sort.field:s.sort;if(typeof p=="string"){let g=p.toLowerCase().trim();if(g==="best-selling"||g==="bestselling")n.sort={field:"best-selling",order:"asc"};else if(g.includes("-")){let[v,h]=g.split("-"),y=o.equalsAny(h,"ascending")?"asc":(o.equalsAny(h,"descending"),"desc");n.sort={field:v,order:y}}else{let[v,h]=p.split(":");n.sort={field:v,order:h||"desc"}}}else typeof s.sort=="object"&&s.sort.field&&(n.sort={field:s.sort.field,order:s.sort.order||"desc"})}else n.sort={field:"best-selling",order:"asc"};S.renderFilters(n.availableFilters),m.info("Filters rendered",{count:n.availableFilters.length}),m.info("Loading products...",{filters:n.filters,pagination:n.pagination});let c=await O.products(n.filters,n.pagination,n.sort);m.info("Products loaded",{count:((t=c.products)==null?void 0:t.length)||0,total:((i=c.pagination)==null?void 0:i.total)||0});let u=c.products&&Array.isArray(c.products)&&c.products.length>0,f=n.availableFilters&&Array.isArray(n.availableFilters)&&n.availableFilters.length>0;if(!u&&n.fallbackProducts&&n.fallbackProducts.length>0?(m.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((r=c.products)==null?void 0:r.length)||0,fallbackCount:n.fallbackProducts.length}),n.usingFallback=!0,n.products=n.fallbackProducts,n.pagination=j.getPagination(),n.availableFilters=[],S.hideFilters()):(n.usingFallback=!1,n.products=c.products||[],n.pagination=c.pagination||n.pagination,S.showFilters()),S.renderProducts(n.products),S.renderInfo(n.pagination,n.pagination.total||0),S.renderPagination(n.pagination),S.renderApplied(n.filters),S.sortSelect){if(o.isBestSelling(n.sort.field))S.sortSelect.value="best-selling";else{let p=o.equals(n.sort.order,"asc")?"ascending":"descending";S.sortSelect.value=`${n.sort.field}-${p}`}m.debug("Sort select value updated programmatically",{value:S.sortSelect.value,sort:n.sort})}S.hideLoading(),n.products.length===0&&!f&&(!n.fallbackProducts||n.fallbackProducts.length===0)&&S.showError("No products or filters found. Please check your configuration.")}catch(s){if(S.hideLoading(),m.error("Load failed",{error:s instanceof Error?s.message:String(s),stack:s instanceof Error?s.stack:void 0,shop:n.shop,apiBaseURL:O.baseURL}),n.fallbackProducts&&n.fallbackProducts.length>0){if(m.warn("Initial load failed, using fallback products from Liquid",{error:s instanceof Error?s.message:String(s),fallbackCount:n.fallbackProducts.length}),n.usingFallback=!0,n.products=n.fallbackProducts,n.pagination=j.getPagination(),n.availableFilters=[],S.hideFilters(),S.sortSelect)if(o.isBestSelling(n.sort.field))S.sortSelect.value="best-selling";else{let a=o.equals(n.sort.order,"asc")?"ascending":"descending";S.sortSelect.value=`${n.sort.field}-${a}`}S.renderProducts(n.products),S.renderInfo(n.pagination,n.pagination.total),S.renderPagination(n.pagination),S.renderApplied(n.filters)}else S.showError(`${_.messages.failedToLoad}: ${s instanceof Error?s.message:_.messages.unknownError}. ${_.messages.checkConsole}`)}},Logger:m},N=window;N.DOM=S;N.AFS_State=n;N.AFS_API=O;N.AFS_LOG=m;N.QuickAdd=te;N.$=o;N.Icons=B;N.Lang=_;N.SpecialValue=J;typeof window!="undefined"?N.AFS=X:typeof global!="undefined"&&(global.AFS=X);function Y(e,t=document,i=5e3){return new Promise((r,s)=>{let a=t.querySelector(e);if(a){r(a);return}let l=new MutationObserver((u,f)=>{let p=t.querySelector(e);p&&(f.disconnect(),r(p))});l.observe(t.body||t,{childList:!0,subtree:!0});let d=setTimeout(()=>{l.disconnect(),s(new Error(`Element ${e} not found within ${i}ms`))},i),c=r;r=u=>{clearTimeout(d),c(u)}})}function re(e,t=document,i=5e3){return Promise.all(e.map(r=>Y(r,t,i)))}var W=class{constructor(t,i={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.magnifierZoom=3;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let r=typeof t=="string"?document.querySelector(t):t;if(!r)throw console.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=r,this.options={thumbnailsPosition:i.thumbnailsPosition||"left",enableKeyboard:i.enableKeyboard!==!1,enableAutoHeight:i.enableAutoHeight!==!1,maxHeight:i.maxHeight||null,animationDuration:i.animationDuration||300,enableMagnifier:i.enableMagnifier!==!1,magnifierZoom:i.magnifierZoom||3,...i},this.magnifierEnabled=this.options.enableMagnifier,this.magnifierZoom=this.options.magnifierZoom,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){console.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){console.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let t=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(t),this.images.length===0){console.error("AFSSlider: No images found");return}let i=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(i),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(r){console.error("AFSSlider: Error building slider structure",r);return}try{this.setupEvents()}catch(r){console.error("AFSSlider: Error setting up events",r)}if(this.magnifierEnabled&&!this.isTouchDevice)try{this.setupPanZoom()}catch(r){console.error("AFSSlider: Error setting up pan-zoom",r)}if(this.isTouchDevice)try{this.setupPinchZoom()}catch(r){console.error("AFSSlider: Error setting up pinch-zoom",r)}try{this.goToSlide(0)}catch(r){console.error("AFSSlider: Error showing first slide",r)}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let r=document.createElement("div");r.className="afs-slider__viewport",this.images.forEach(s=>{r.appendChild(s)}),this.mainContainer.appendChild(r)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let r=document.createElement("button");r.type="button",r.className="afs-slider__prev",r.setAttribute("aria-label","Previous image"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(r)}if(!this.mainContainer.querySelector(".afs-slider__next")){let r=document.createElement("button");r.type="button",r.className="afs-slider__next",r.setAttribute("aria-label","Next image"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(r)}this.thumbnails.forEach((r,s)=>{r.addEventListener("click",()=>{this.goToSlide(s)})});let t=this.mainContainer.querySelector(".afs-slider__prev"),i=this.mainContainer.querySelector(".afs-slider__next");t&&t.addEventListener("click",()=>this.prevSlide()),i&&i.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=t=>{if(!this.isInitialized)return;let i=this.container.getBoundingClientRect();if(!(i.width===0||i.height===0))switch(t.key){case"ArrowLeft":t.preventDefault(),this.prevSlide();break;case"ArrowRight":t.preventDefault(),this.nextSlide();break;case"Escape":let r=this.images[this.currentIndex];r&&(r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200));break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let t=0,i=0,r=!1,s=this.mainContainer.querySelector(".afs-slider__viewport");s&&(s.addEventListener("touchstart",a=>{t=a.touches[0].clientX,i=a.touches[0].clientY,r=!0},{passive:!0}),s.addEventListener("touchmove",a=>{r&&a.preventDefault()},{passive:!1}),s.addEventListener("touchend",a=>{if(!r)return;r=!1;let l=a.changedTouches[0].clientX,d=a.changedTouches[0].clientY,c=t-l,u=i-d;Math.abs(c)>Math.abs(u)&&Math.abs(c)>50&&(c>0?this.nextSlide():this.prevSlide())},{passive:!0}))}setupPanZoom(){if(!this.mainContainer)return;let t=this.mainContainer.querySelector(".afs-slider__viewport");if(!t)return;t.classList.add("afs-slider__viewport--zoomable");let i=this.magnifierZoom||3;t.addEventListener("mousemove",r=>{let s=this.images[this._currentIndex];if(!s)return;let a=t.getBoundingClientRect(),l=r.clientX-a.left,d=r.clientY-a.top,c=l/a.width,u=d/a.height,f=-c*(s.offsetWidth*i-a.width),p=-u*(s.offsetHeight*i-a.height);s.style.transform=`
        scale(${i})
        translate(${f/i}px, ${p/i}px)
      `,s.classList.add("afs-slider__image--zoomed")}),t.addEventListener("mouseenter",()=>{let r=this.images[this._currentIndex];r&&r.classList.add("afs-slider__image--zoomed")}),t.addEventListener("mouseleave",()=>{let r=this.images[this._currentIndex];r&&(r.style.transform="scale(1) translate(0, 0)",r.classList.remove("afs-slider__image--zoomed"),r.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{r.classList.remove("afs-slider__image--zoom-reset")},200))})}setupPinchZoom(){if(!this.mainContainer||!this.isTouchDevice)return;let t=this.mainContainer.querySelector(".afs-slider__viewport");if(!t)return;let i=0,r=1,s=0,a=null;t.addEventListener("touchstart",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1];i=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY);let u=this.images[this._currentIndex];if(u){let p=(u.style.transform||"").match(/scale\(([\d.]+)\)/);r=p?parseFloat(p[1]):1}}else if(l.touches.length===1){let d=Date.now();if(d-s<300){l.preventDefault(),a&&clearTimeout(a);let c=this.images[this._currentIndex];if(c){let f=(c.style.transform||"").match(/scale\(([\d.]+)\)/),p=f?parseFloat(f[1]):1;if(p>1)c.style.transform="scale(1) translate(0, 0)",p=1;else{let g=t.getBoundingClientRect(),v=l.touches[0],h=v.clientX-g.left,y=v.clientY-g.top,b=2.5;c.style.transform=`scale(${b}) translate(${(g.width/2-h)/b}px, ${(g.height/2-y)/b}px)`,p=b}}}else s=d}},{passive:!1}),t.addEventListener("touchmove",l=>{if(l.touches.length===2){l.preventDefault();let d=l.touches[0],c=l.touches[1],u=Math.hypot(c.clientX-d.clientX,c.clientY-d.clientY),f=Math.max(1,Math.min(4,r*(u/i))),p=this.images[this._currentIndex];if(p){let g=t.getBoundingClientRect(),v=(d.clientX+c.clientX)/2-g.left,h=(d.clientY+c.clientY)/2-g.top,y=(g.width/2-v)/f,b=(g.height/2-h)/f;p.style.transform=`scale(${f}) translate(${y}px, ${b}px)`}}},{passive:!1}),t.addEventListener("touchend",()=>{i=0})}goToSlide(t){if(t<0||t>=this.images.length)return;this._currentIndex=t,this.images.forEach((r,s)=>{s===t?r.classList.add("afs-slider__image--active"):r.classList.remove("afs-slider__image--active")});let i=this.images[this._currentIndex];i&&(i.classList.remove("afs-slider__image--zoomed"),i.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{i.classList.remove("afs-slider__image--zoom-reset")},200)),this.thumbnails.forEach((r,s)=>{r.classList.toggle("afs-slider__thumbnail--active",s===t)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:t,total:this.images.length}}))}prevSlide(){let t=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(t)}nextSlide(){let t=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(t)}adjustHeight(){let t=this.images[this._currentIndex];t&&(t.complete?this.setHeight(t):t.addEventListener("load",()=>{this.setHeight(t)},{once:!0}))}setHeight(t){if(!this.mainContainer)return;let i=this.mainContainer.querySelector(".afs-slider__viewport");if(!i)return;if(this.options.maxHeight){i.style.height=`${this.options.maxHeight}px`,i.style.minHeight=`${this.options.maxHeight}px`,i.style.maxHeight=`${this.options.maxHeight}px`;return}let r=t.naturalHeight||t.offsetHeight,s=t.naturalWidth||t.offsetWidth,a=this.mainContainer.offsetWidth,l=r/s,d=a*l;i.style.height=`${d}px`,i.style.minHeight=`${d}px`}updateVariantImage(t,i,r){var f;if(!t||!i||!Array.isArray(i)||i.length===0)return!1;let s=t.id;if(r&&Array.isArray(r)){if(t.featured_image&&typeof t.featured_image=="object"&&t.featured_image.variant_ids){let p=t.featured_image.position;if(p!=null){let g=p-1;if(g>=0&&g<this.images.length&&g<i.length)return this._currentIndex!==g&&this.goToSlide(g),!0}}for(let p of r)if(p.featured_image&&typeof p.featured_image=="object"&&p.featured_image.variant_ids&&p.featured_image.variant_ids.includes(Number(s))){let g=p.featured_image.position;if(g!=null){let v=g-1;if(v>=0&&v<this.images.length&&v<i.length)return this._currentIndex!==v&&this.goToSlide(v),!0}}}let a=null,l=null;if(t.featured_image&&(typeof t.featured_image=="object"?(a=t.featured_image.src||t.featured_image.url||null,l=(f=t.featured_image.position)!=null?f:null):typeof t.featured_image=="string"&&(a=t.featured_image)),a||(typeof t.image=="string"?a=t.image:t.image&&typeof t.image=="object"?a=t.image.url||t.image.src||null:t.imageUrl?a=t.imageUrl:t.featuredImage&&typeof t.featuredImage=="object"&&(a=t.featuredImage.url||t.featuredImage.src||null)),!a)return!1;let d=p=>p?(typeof p=="string"?p:(p==null?void 0:p.url)||(p==null?void 0:p.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",c=d(a);if(l!=null){let p=l-1;if(p>=0&&p<this.images.length&&p<i.length)return this._currentIndex!==p&&this.goToSlide(p),!0}let u=i.findIndex(p=>{let g=d(p);return g===c||g.includes(c)||c.includes(g)});if(u===-1){let p=c.split("/").pop();u=i.findIndex(g=>d(g).split("/").pop()===p)}return u!==-1&&u<this.images.length?(this._currentIndex!==u&&this.goToSlide(u),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(t=>{t.classList.remove("afs-slider__image--zoomed"),t.classList.add("afs-slider__image--zoom-reset"),setTimeout(()=>{t.classList.remove("afs-slider__image--zoom-reset")},200)}),this.isInitialized=!1}},R=window;function Q(){return{State:R.AFS_State||{moneyFormat:null,currency:null},Log:R.AFS_LOG||{error:()=>{},warn:()=>{},info:()=>{},debug:()=>{},log:()=>{},init:()=>{}},QuickAdd:R.QuickAdd||{add:async()=>{},addFromForm:async()=>{},addVariant:async()=>{},showSuccess:()=>{}},$:R.$||{debounce:()=>()=>{},toLowerCase:()=>"",inputDisplayType:()=>"checkbox",isMultiSelect:()=>!1,split:()=>[],id:()=>null,str:()=>"",empty:()=>!0,el:()=>document.createElement("div"),txt:()=>document.createElement("div"),clear:()=>{},frag:()=>document.createDocumentFragment(),optimizeImageUrl:()=>"",buildImageSrcset:()=>"",formatMoney:()=>"",equals:()=>!1,equalsAny:()=>!1,isVendorKey:()=>!1,isProductTypeKey:()=>!1,isTagKey:()=>!1,isCollectionKey:()=>!1,isPriceRangeKey:()=>!1,isBestSelling:()=>!1,isCollectionOptionType:()=>!1,isPriceRangeOptionType:()=>!1},Icons:R.Icons||{rightArrow:"",downArrow:"",close:"",minus:"",plus:"",eye:""},Lang:R.Lang||{buttons:{quickAdd:"",quickAddToCart:"",quickView:"",addToCart:"",buyNow:"",clear:"",clearAll:"",close:"",closeFilters:"",toggleFilters:"",filters:"",previous:"",next:"",apply:""},labels:{sortBy:"",appliedFilters:"",search:"",price:"",collection:"",productUnavailable:"",loading:"",loadingProduct:""},sortOptions:{bestSelling:"",titleAsc:"",titleDesc:"",priceAsc:"",priceDesc:"",createdAsc:"",createdDesc:""},messages:{noProductsFound:"",oneProductFound:"",productsFound:"",showingProducts:"",pageOf:"",addedToCart:"",failedToLoad:"",failedToLoadProducts:"",failedToLoadProduct:"",failedToAddToCart:"",failedToProceedToCheckout:"",failedToLoadProductModal:"",failedToLoadFilters:"",initializationFailed:"",loadFailed:"",unknownError:"",checkConsole:""},placeholders:{searchProducts:"",searchFilter:""}},SpecialValue:R.SpecialValue||{DEFAULT_TITLE:"Default Title"}}}async function ie(e,t){let i=Q(),{State:r,Log:s,QuickAdd:a,$:l,Icons:d,Lang:c,SpecialValue:u}=i,f=l.el("dialog","afs-product-modal",{id:t});f.innerHTML=`
      <div class="afs-product-modal__container">
        <div class="afs-product-modal__close-container">
          <button class="afs-product-modal__close" type="button">${d.close}</button>
        </div>
        <div class="afs-product-modal__content">
          <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
            ${c.labels.loadingProduct}
          </div>
        </div>
      </div>
    `;let g=`${R.Shopify&&R.Shopify.routes&&R.Shopify.routes.root||"/"}products/${e}.js`;try{let v=await fetch(g);if(!v.ok)throw new Error("Failed to load product");let h=await v.json();if(!h.variants||!Array.isArray(h.variants))throw new Error("Invalid product data structure");let y=h.variants.find(w=>w.available)||h.variants[0],b=y?y.id:null,C=()=>{if(!h.variants||h.variants.length===0)return"";if(h.variants.length===1){let L=h.variants[0].title;if(L&&l.equals(L,u.DEFAULT_TITLE))return""}if(!h.options||h.options.length===0)return"";let w='<div class="afs-product-modal__variant-selector">';return h.options.forEach((D,L)=>{w+='<div class="afs-product-modal__option-group">',w+=`<label class="afs-product-modal__option-label">${D.name}</label>`,w+='<div class="afs-product-modal__option-values">',[...new Set(h.variants.map(I=>L===0?I.option1:L===1?I.option2:I.option3).filter(Boolean))].forEach(I=>{let $=h.variants.find(U=>L===0?U.option1===I:L===1?U.option2===I:U.option3===I),G=$&&$.available,V=$&&$.id===b;w+=`<button 
              class="afs-product-modal__option-value ${V?"afs-product-modal__option-value--selected":""} ${G?"":"afs-product-modal__option-value--unavailable"}"
              data-option-index="${L}"
              data-option-value="${I}"
              data-variant-id="${$?$.id:""}"
              ${G?"":"disabled"}
              type="button"
            >${I}</button>`}),w+="</div></div>"}),w+="</div>",w},P=(()=>{if(!h.images||h.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let w='<div class="afs-slider__thumbnails">';h.images.forEach((L,x)=>{let I=x===0?"afs-slider__thumbnail--active":"",$=l.optimizeImageUrl(L,{width:100,height:100,crop:"center",format:"webp",quality:75}),V=[80,100,120].map(U=>`${l.optimizeImageUrl(L,{width:U,height:U,crop:"center",format:"webp",quality:75})} ${U}w`).join(", ");w+=`
            <div class="afs-slider__thumbnail ${I}" data-slide-index="${x}">
              <img 
                src="${$}" 
                srcset="${V}"
                sizes="100px"
                alt="${h.title} - Thumbnail ${x+1}" 
                loading="lazy"
                width="100"
                height="100"
              />
            </div>
          `}),w+="</div>";let D='<div class="afs-slider__main">';return h.images.forEach((L,x)=>{let I=l.optimizeImageUrl(L,{width:800,height:800,format:"webp",quality:85}),G=[400,600,800,1e3,1200].map(V=>`${l.optimizeImageUrl(L,{width:V,height:V,format:"webp",quality:V<=600?80:85})} ${V}w`).join(", ");D+=`
            <img 
              class="afs-slider__image" 
              src="${I}" 
              srcset="${G}"
              sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
              alt="${h.title} - Image ${x+1}" 
              loading="${x===0?"eager":"lazy"}"
            />
          `}),D+="</div>",{thumbnails:w,mainImages:D}})(),A=C(),T=w=>l.formatMoney(w,r.moneyFormat||"{{amount}}",r.currency||""),F=h.variants.find(w=>w.id===b)||y,M=T(F.price),K=F.compare_at_price&&F.compare_at_price>F.price?`<span class="afs-product-modal__compare-price">${T(F.compare_at_price)}</span>`:"";f.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${d.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div class="afs-product-modal__layout">
              <div class="afs-product-modal__media">
                <div class="afs-slider" id="${t}-slider">
                  ${P.mainImages}
                  ${P.thumbnails}
                </div>
              </div>
              <div class="afs-product-modal__details">
                <div class="afs-product-modal__header">
                  <div>
                    <span class="afs-product-modal__vendor">${h.vendor||""}</span>
                  </div>
                  <h1 class="afs-product-modal__title">${h.title||""}</h1>
                  <div class="afs-product-modal__price-container">
                    <span class="afs-product-modal__price">${M}</span>
                    ${K}
                  </div>
                </div>
                ${A}
                <div class="afs-product-modal__buttons">
                  <div class="afs-product-modal__add-to-cart">
                    <div class="afs-product-modal__incrementor">
                      <button class="afs-product-modal__decrease" type="button">${d.minus}</button>
                      <span class="afs-product-modal__count" id="${t}-count">1</span>
                      <button class="afs-product-modal__increase" type="button">${d.plus}</button>
                    </div>
                    <button
                      class="afs-product-modal__add-button"
                      id="${t}-add-button"
                      data-variant-id="${b}"
                      ${F.available?"":"disabled"}
                      type="button"
                    >
                      ${c.buttons.addToCart}
                    </button>
                  </div>
                  <button
                    class="afs-product-modal__buy-button"
                    id="${t}-buy-button"
                    data-variant-id="${b}"
                    ${F.available?"":"disabled"}
                    type="button"
                  >
                    ${c.buttons.buyNow}
                  </button>
                </div>
                <div class="afs-product-modal__description">
                  <span class="afs-product-modal__description-text">
                    ${h.description||""}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `,f._productData=h,f._currentVariantId=b||void 0,(async()=>{try{let w=await Y(`#${t}-slider`,f,3e3);(await re(Array.from({length:10},(L,x)=>`.afs-slider__image:nth-child(${x+1})`),w,2e3).catch(()=>Array.from(w.querySelectorAll(".afs-slider__image")))).length>0?f._slider=new W(w,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}):s.warn("No images found for slider",{modalId:t})}catch(w){s.error("Failed to initialize slider",{error:w instanceof Error?w.message:String(w),modalId:t})}})(),ae(f,t,h,T,i)}catch(v){let h=Q(),{Log:y,Icons:b,Lang:C}=h;y.error("Failed to load product for modal",{error:v instanceof Error?v.message:String(v),handle:e}),f.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${b.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div style="padding: 2rem; text-align: center;">
              <p>${C.messages.failedToLoadProductModal}</p>
            </div>
          </div>
        </div>
      `,le(f,h)}return f}function ae(e,t,i,r,s){let{Log:a,QuickAdd:l,Lang:d}=s,c=e.querySelector(".afs-product-modal__close"),u=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};c&&c.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation(),u()}),e.addEventListener("cancel",b=>{b.preventDefault(),u()}),e.addEventListener("click",b=>{b.target===e&&u()});let f=e.querySelector(".afs-product-modal__decrease"),p=e.querySelector(".afs-product-modal__increase"),g=e.querySelector(`#${t}-count`);f&&g&&f.addEventListener("click",()=>{let b=parseInt(g.textContent||"1",10)||1;b>1&&(g.textContent=String(b-1))}),p&&g&&p.addEventListener("click",()=>{let b=parseInt(g.textContent||"1",10)||1;g.textContent=String(b+1)}),e.querySelectorAll(".afs-product-modal__option-value").forEach(b=>{b.addEventListener("click",()=>{var A;if(b.disabled)return;let C=[];i.options&&i.options.forEach((T,F)=>{let M=e.querySelector(`.afs-product-modal__option-value[data-option-index="${F}"].afs-product-modal__option-value--selected`);M&&(C[F]=M.dataset.optionValue||"")});let E=parseInt(b.dataset.optionIndex||"0",10);C[E]=b.dataset.optionValue||"",e.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${E}"]`).forEach(T=>{T.classList.remove("afs-product-modal__option-value--selected")}),b.classList.add("afs-product-modal__option-value--selected");let P=(A=i.variants)==null?void 0:A.find(T=>i.options?i.options.every((F,M)=>M===0?T.option1===C[M]:M===1?T.option2===C[M]:T.option3===C[M]):!1);P&&oe(e,t,P,r,s)})});let h=e.querySelector(`#${t}-add-button`);h&&g&&h.addEventListener("click",async()=>{if(h.disabled)return;let b=parseInt(g.textContent||"1",10)||1,C=h.dataset.variantId;try{await l.addVariant(parseInt(C||"0",10),b),u()}catch(E){a.error("Failed to add to cart from modal",{error:E instanceof Error?E.message:String(E)}),alert(d.messages.failedToAddToCart)}});let y=e.querySelector(`#${t}-buy-button`);y&&g&&y.addEventListener("click",async()=>{if(y.disabled)return;let b=parseInt(g.textContent||"1",10)||1,C=y.dataset.variantId;try{let E=R.Shopify&&R.Shopify.routes&&R.Shopify.routes.root||"/";window.location.href=`${E}cart/${C}:${b}?checkout`}catch(E){a.error("Failed to buy now",{error:E instanceof Error?E.message:String(E)}),alert(d.messages.failedToProceedToCheckout)}})}function oe(e,t,i,r,s){let{Lang:a}=s;e._currentVariantId=i.id;let l=e.querySelector(".afs-product-modal__price-container");if(l){let f=r(i.price),p=i.compare_at_price&&i.compare_at_price>i.price?`<span class="afs-product-modal__compare-price">${r(i.compare_at_price)}</span>`:"";l.innerHTML=`
        <span class="afs-product-modal__price">${f}</span>
        ${p}
      `}let d=e.querySelector(`#${t}-add-button`);d&&(d.dataset.variantId=String(i.id),d.disabled=!i.available,d.innerHTML=a.buttons.addToCart);let c=e.querySelector(`#${t}-buy-button`);c&&(c.dataset.variantId=String(i.id),c.disabled=!i.available);let u=e._productData;if(u&&u.images&&e._slider&&u.variants){let f=i.id,p=null;if(i.featured_image&&typeof i.featured_image=="object"&&i.featured_image.variant_ids){let h=i.featured_image.position;if(h!=null){let y=h-1;y>=0&&y<u.images.length&&(e._slider.currentIndex||0)!==y&&(p=y)}}else for(let h of u.variants)if(h.featured_image&&typeof h.featured_image=="object"&&h.featured_image.variant_ids&&h.featured_image.variant_ids.includes(Number(f))){let y=h.featured_image.position;if(y!=null){let b=y-1;if(b>=0&&b<u.images.length&&(e._slider.currentIndex||0)!==b){p=b;break}}}if(p!==null&&e._slider.goToSlide){e._slider.goToSlide(p);return}if(e._slider.updateVariantImage&&u.images&&e._slider.updateVariantImage(i,u.images,u.variants))return;let g=null,v=null;if(i.featured_image&&(typeof i.featured_image=="object"?(g=i.featured_image.src||i.featured_image.url||null,v=i.featured_image.position||null):typeof i.featured_image=="string"&&(g=i.featured_image)),g||(g=(typeof i.image=="string"?i.image:null)||i.imageUrl||i.image&&typeof i.image=="object"&&(i.image.url||i.image.src)||null||i.featuredImage&&typeof i.featuredImage=="object"&&(i.featuredImage.url||i.featuredImage.src)||null),g&&u.images&&e._slider.goToSlide){let h=C=>C?(typeof C=="string"?C:C&&typeof C=="object"&&(C.url||C.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(v!=null){let C=v-1;if(C>=0&&C<u.images.length){e._slider.goToSlide(C);return}}let y=h(g),b=u.images.findIndex(C=>{let E=h(C);return E===y||E.includes(y)||y.includes(E)});if(b!==-1)e._slider.goToSlide(b);else{let C=y.split("/").pop();if(C){let E=u.images.findIndex(P=>h(P).split("/").pop()===C);E!==-1&&e._slider.goToSlide&&e._slider.goToSlide(E)}}}}}function le(e,t){let i=e.querySelector(".afs-product-modal__close"),r=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};i&&i.addEventListener("click",r),e.addEventListener("cancel",r),e.addEventListener("click",s=>{s.target===e&&r()})}function de(e){let t=Q(),{$:i,Icons:r,Lang:s}=t;if(!e.handle)return null;let a=i.el("button","afs-product-card__quick-view",{"data-product-handle":e.handle,"data-product-id":String(e.id||e.productId||e.gid||""),"aria-label":s.buttons.quickView,type:"button"}),l=i.el("span","afs-product-card__quick-view-icon");return l.innerHTML=r.eye,a.appendChild(l),a}function ce(e){let t=Q(),{Log:i,Lang:r}=t;if(!e)return;let s=`product-modal-${e}`,a=document.getElementById(s);(async()=>{a||(a=await ie(e,s),document.body.appendChild(a)),a.showModal?(document.body.style.overflow="hidden",a.showModal()):(document.body.style.overflow="hidden",a.style.display="block");let d=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};a.addEventListener("close",d,{once:!0});let c=new MutationObserver(()=>{a&&!a.open&&!a.hasAttribute("open")&&(d(),c.disconnect())});a&&c.observe(a,{attributes:!0,attributeFilter:["open"]})})().catch(d=>{i.error("Failed to open product modal",{error:d instanceof Error?d.message:String(d),handle:e}),alert(r.messages.failedToLoadProductModal)})}typeof window!="undefined"&&(window.AFSSlider=W);typeof window!="undefined"&&(window.AFSQuickView={createQuickViewButton:de,handleQuickViewClick:ce,createProductModal:ie});
