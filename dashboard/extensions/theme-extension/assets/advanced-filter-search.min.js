"use strict";var J=(n=>(n.ALL="__all__",n.CLEAR="__clear__",n.DEFAULT_TITLE="Default Title",n))(J||{}),V={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24},K={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'},ie=new Set(["shop","shop_domain","keep","cpid"]),_={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}},o={debounce:(t,i)=>{let r;return(...n)=>{r!==void 0&&clearTimeout(r),r=setTimeout(()=>t(...n),i)}},toLowerCase:t=>String(t||"").toLowerCase(),inputDisplayType:t=>o.equalsAny(o.toLowerCase(t==null?void 0:t.displayType),"radio")?"radio":"checkbox",isMultiSelect:t=>o.equalsAny(o.toLowerCase(t==null?void 0:t.selectionType),"multiple")||o.equalsAny(t==null?void 0:t.selectionType,"MULTIPLE"),split:t=>t?Array.isArray(t)?t.map(i=>String(i).trim()).filter(Boolean):String(t).split(",").map(i=>i.trim()).filter(Boolean):[],id:t=>{if(!t)return null;let i=t.productId||t.id||t.gid;return i&&String(i).split("/").pop()||null},str:t=>String(t||"").trim(),empty:t=>t?Array.isArray(t)?t.length===0:typeof t=="object"?Object.keys(t).length===0:!1:!0,el:(t,i,r={})=>{let n=document.createElement(t);return i&&(n.className=i),Object.entries(r).forEach(([s,a])=>n.setAttribute(s,a)),n},txt:(t,i)=>(t.textContent=i,t),clear:t=>{for(;t.firstChild;){let i=t.firstChild;i&&t.removeChild(i)}},frag:(t,i)=>{let r=document.createDocumentFragment();return t.forEach(n=>r.appendChild(i(n))),r},optimizeImageUrl:(t,i={})=>{if(!t||typeof t!="string")return"";let{width:r=500,height:n=r,quality:s=80,format:a="webp",crop:d=null}=i;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(t))return t;try{let b=new URL(t),c=new URLSearchParams(b.search);return c.delete("width"),c.delete("height"),c.delete("crop"),c.delete("format"),c.delete("quality"),c.set("width",String(r)),c.set("height",String(n)),d&&c.set("crop",d),s!==100&&c.set("quality",String(s)),!b.pathname.toLowerCase().endsWith(".gif")&&a&&c.set("format",a),`${b.origin}${b.pathname}?${c.toString()}`}catch(b){return t}},buildImageSrcset:(t,i=[200,300,500])=>t?i.map(r=>`${o.optimizeImageUrl(t,{width:r,format:"webp",quality:r<=200?75:r<=300?80:85})} ${r}w`).join(", "):"",formatMoney:(t,i,r="")=>{if(isNaN(Number(t)))return"";let n=parseFloat(String(t))/100;if(!i||typeof i!="string")return`${r||""}${n.toFixed(2)}`;let s=n.toFixed(2);return i.includes("{{amount_no_decimals}}")?(s=Math.round(n).toString(),i.replace("{{amount_no_decimals}}",s)):i.includes("{{amount_with_comma_separator}}")?(s=n.toFixed(2).replace(".",","),i.replace("{{amount_with_comma_separator}}",s)):i.includes("{{amount_no_decimals_with_comma_separator}}")?(s=Math.round(n).toString(),i.replace("{{amount_no_decimals_with_comma_separator}}",s)):i.includes("{{amount_with_apostrophe_separator}}")?(s=n.toFixed(2).replace(".","'"),i.replace("{{amount_with_apostrophe_separator}}",s)):i.replace("{{amount}}",s)},equals:(t,i)=>t===i?!0:t==null||i===null||i===void 0?!1:(Array.isArray(t)&&(t=t.join(",")),Array.isArray(i)&&(i=i.join(",")),typeof t=="string"&&typeof i=="string"?t.trim().toLowerCase()===i.trim().toLowerCase():typeof t=="number"&&typeof i=="number"||typeof t=="boolean"&&typeof i=="boolean"?t===i:String(t).trim().toLowerCase()===String(i).trim().toLowerCase()),equalsAny:(t,...i)=>t==null?!1:i.some(r=>o.equals(t,r)),isVendorKey:t=>o.equalsAny(t,"vendor","vendors"),isProductTypeKey:t=>o.equalsAny(t,"productType","productTypes"),isTagKey:t=>o.equalsAny(t,"tag","tags"),isCollectionKey:t=>o.equalsAny(t,"collection","collections"),isPriceRangeKey:t=>o.equalsAny(t,"priceRange","price"),isBestSelling:t=>o.equalsAny(t,"best-selling","bestselling"),isCollectionOptionType:t=>o.equals(t,"Collection"),isPriceRangeOptionType:t=>o.equals(t,"priceRange")},ee={buildFilterMetadata:t=>{let i=new Map;return Array.isArray(t)&&t.forEach(r=>{r.handle&&i.set(r.handle,{label:r.label||r.queryKey||r.optionKey||r.handle,queryKey:r.queryKey,optionKey:r.optionKey,optionType:r.optionType})}),i}},e={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:V.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,keep:null,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},u={enabled:!0,error:(t,i)=>{u.enabled&&console.error("[AFS]",t,i||"")},warn:(t,i)=>{u.enabled&&console.warn("[AFS]",t,i||"")},info:(t,i)=>{u.enabled&&console.info("[AFS]",t,i||"")},debug:(t,i)=>{u.enabled&&console.debug("[AFS]",t,i||"")},log:(t,...i)=>{u.enabled&&console.log(t,...i)},init:t=>{u.enabled=t!==!1,u.log("%cAdvanced Filter & Search","color: white; background-color: #c21f29; font-size: 16px; font-weight: bold; padding: 4px 8px; border-radius: 4px;")}},N={parse(){let t=new URL(window.location.href),i={},r,n;return t.searchParams.forEach((s,a)=>{if(!ie.has(a))if(o.isVendorKey(a))i.vendor=o.split(s);else if(o.isProductTypeKey(a))i.productType=o.split(s);else if(o.isTagKey(a))i.tags=o.split(s);else if(o.isCollectionKey(a))i.collections=o.split(s);else if(o.equals(a,"search"))i.search=s;else if(o.equals(a,"priceMin")){let d=parseFloat(s);!isNaN(d)&&d>=0&&(r=d)}else if(o.equals(a,"priceMax")){let d=parseFloat(s);!isNaN(d)&&d>=0&&(n=d)}else if(o.isPriceRangeKey(a)){let d=s.split("-");if(d.length===2){let m=parseFloat(d[0]),b=parseFloat(d[1]);!isNaN(m)&&m>=0&&(r=m),!isNaN(b)&&b>=0&&(n=b)}}else if(o.equals(a,"page"))i.page=parseInt(s,10)||1;else if(o.equals(a,"limit"))i.limit=parseInt(s,10)||V.PAGE_SIZE;else if(o.equals(a,"sort")){let d=s.toLowerCase().trim();if(o.isBestSelling(d))i.sort={field:"best-selling",order:"asc"};else if(d.includes("-")){let[m,b]=d.split("-"),c=o.equalsAny(b,"ascending")?"asc":(o.equalsAny(b,"descending"),"desc");i.sort={field:m,order:c}}else{let[m,b]=s.split(":");i.sort={field:m,order:o.equalsAny(b,"asc")?"asc":"desc"}}}else i[a]=o.split(s),u.debug("Handle filter parsed directly",{handle:a,value:s})}),(r!==void 0||n!==void 0)&&(i.priceRange={min:r,max:n}),i},update(t,i,r){let n=new URL(window.location.href);if(n.search="",u.debug("Updating URL",{filters:t,pagination:i}),t&&!o.empty(t)&&Object.keys(t).forEach(a=>{let d=t[a];if(!o.empty(d))if(Array.isArray(d)&&d.length>0)n.searchParams.set(a,d.join(",")),u.debug("URL param set",{key:a,value:d.join(",")});else if(o.isPriceRangeKey(a)&&d&&typeof d=="object"&&!Array.isArray(d)){let m=d,b=typeof m.min=="number"&&!isNaN(m.min)?m.min:void 0,c=typeof m.max=="number"&&!isNaN(m.max)?m.max:void 0;if(e.priceRangeHandle){let g=`${b!==void 0?b:""}-${c!==void 0?c:""}`;n.searchParams.set(e.priceRangeHandle,g),u.debug("Price range URL handle param set",{handle:e.priceRangeHandle,value:g})}else b!==void 0&&n.searchParams.set("priceMin",String(b)),c!==void 0&&n.searchParams.set("priceMax",String(c)),u.debug("Price range URL params set",{priceMin:b,priceMax:c})}else o.equals(a,"search")&&typeof d=="string"&&d.trim()&&(n.searchParams.set(a,d.trim()),u.debug("Search URL param set",{key:a,value:d.trim()}))}),i&&i.page>1&&(n.searchParams.set("page",String(i.page)),u.debug("Page URL param set",{page:i.page})),r&&r.field){if(r.field==="best-selling"||r.field==="bestselling")n.searchParams.set("sort","best-selling");else{let a=o.equals(r.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${r.field}-${a}`)}u.debug("Sort URL param set",{field:r.field,order:r.order})}e.keep!==null&&e.keep!==void 0&&(o.equals(e.keep,"__all__")?n.searchParams.set("keep","__all__"):Array.isArray(e.keep)&&e.keep.length>0&&n.searchParams.set("keep",e.keep.join(",")),u.debug("Keep filters URL param set",{keep:e.keep}));let s=n.toString();u.info("URL updated",{newUrl:s,oldUrl:window.location.href}),history.pushState({filters:t,pagination:i,sort:r},"",n)}},D={baseURL:"http://localhost:3554",cache:new Map,timestamps:new Map,pending:new Map,key(t,i,r){return`${i.page}-${i.limit}-${r.field}-${r.order}-${JSON.stringify(t)}`},get(t){let i=this.timestamps.get(t);return!i||Date.now()-i>V.CACHE_TTL?(this.cache.delete(t),this.timestamps.delete(t),null):this.cache.get(t)||null},set(t,i){this.cache.set(t,i),this.timestamps.set(t,Date.now())},async fetch(t,i=V.TIMEOUT){let r=new AbortController,n=setTimeout(()=>r.abort(),i);try{u.debug("Fetching",{url:t});let s=await fetch(t,{signal:r.signal});if(clearTimeout(n),!s.ok){let d=await s.text().catch(()=>"");throw new Error(`HTTP ${s.status}: ${s.statusText}${d?" - "+d:""}`)}let a=await s.json();return u.debug("Fetch success",{url:t,hasData:!!a}),a}catch(s){throw clearTimeout(n),s instanceof Error&&s.name==="AbortError"?new Error("Request timeout"):(u.error("Fetch failed",{url:t,error:s instanceof Error?s.message:String(s)}),s)}},shouldSendCpid(t){var r;return(r=e.selectedCollection)!=null&&r.id?!Object.keys(t||{}).some(n=>{let s=e.filterMetadata.get(n);return(o.isCollectionOptionType(s==null?void 0:s.optionType)||o.isCollectionKey(n))&&Array.isArray(t[n])&&t[n].length>0?t[n].some(d=>String(d)===String(e.selectedCollection.id)):!1}):!1},async products(t,i,r){var b;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!e.shop)throw new Error("Shop not set");let n=this.key(t,i,r),s=this.get(n);if(s)return u.debug("Cache hit",{key:n}),s;if(this.pending.has(n))return u.debug("Request deduplication",{key:n}),this.pending.get(n);let a=new URLSearchParams;if(a.set("shop",e.shop),this.shouldSendCpid(t)?(a.set("cpid",e.selectedCollection.id),u.debug("cpid sent to products API",{cpid:e.selectedCollection.id,filters:t})):u.debug("cpid not sent to products API",{hasCpid:!!((b=e.selectedCollection)!=null&&b.id),filters:t,reason:"filters present or cpid already in collection filter"}),Object.keys(t).forEach(c=>{let g=t[c];if(!o.empty(g))if(o.isPriceRangeKey(c)&&g&&typeof g=="object"&&!Array.isArray(g)){let h=g,l=typeof h.min=="number"&&!isNaN(h.min)?h.min:void 0,f=typeof h.max=="number"&&!isNaN(h.max)?h.max:void 0;e.priceRangeHandle?a.set(e.priceRangeHandle,`${l!==void 0?l:""}-${f!==void 0?f:""}`):(l!==void 0&&a.set("priceMin",String(l)),f!==void 0&&a.set("priceMax",String(f)))}else c==="search"&&typeof g=="string"&&g.trim()?a.set(c,g.trim()):Array.isArray(g)&&g.length>0?(a.set(c,g.join(",")),u.debug("Filter sent as direct handle param",{handle:c,value:g.join(",")})):typeof g=="string"&&(a.set(c,g),u.debug("Filter sent as direct handle param",{handle:c,value:g}))}),a.set("page",String(i.page)),a.set("limit",String(i.limit)),r.field)if(o.isBestSelling(r.field))a.set("sort","best-selling");else{let c=o.equals(r.order,"asc")?"ascending":"descending";a.set("sort",`${r.field}-${c}`)}e.keep!==null&&e.keep!==void 0&&(o.equals(e.keep,"__all__")?a.set("keep","__all__"):Array.isArray(e.keep)&&e.keep.length>0&&a.set("keep",e.keep.join(",")),u.debug("Keep filters sent to products API",{keep:e.keep}));let d=`${this.baseURL}/storefront/products?${a}`;u.info("Fetching products",{url:d,shop:e.shop,page:i.page});let m=this.fetch(d).then(c=>{var h,l;if(!c.success||!c.data)throw u.error("Invalid products response",{response:c}),new Error(`Invalid products response: ${c.message||_.messages.unknownError}`);let g=c.data;return u.info("Products response",{productsCount:((h=g.products)==null?void 0:h.length)||0,total:((l=g.pagination)==null?void 0:l.total)||0,hasFilters:!!g.filters}),this.set(n,g),this.pending.delete(n),g}).catch(c=>{throw this.pending.delete(n),u.error("Products fetch failed",{error:c instanceof Error?c.message:String(c),url:d}),c});return this.pending.set(n,m),m},async filters(t){var b;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!e.shop)throw new Error("Shop not set");let i=new URLSearchParams;i.set("shop",e.shop),this.shouldSendCpid(t)?(i.set("cpid",e.selectedCollection.id),u.debug("cpid sent to filters API",{cpid:e.selectedCollection.id,filters:t})):u.debug("cpid not sent to filters API",{hasCpid:!!((b=e.selectedCollection)!=null&&b.id),filters:t,reason:"filters present or cpid already in collection filter"});let r={...t},n=null;if(e.keep!==null&&e.keep!==void 0){if(o.equals(e.keep,"__all__"))Object.keys(r).forEach(c=>{delete r[c]}),i.set("keep","__all__"),u.debug("Keep filters: __all__ - excluded all filters from aggregation query");else{if(Array.isArray(e.keep)&&e.keep.length>0)n=e.keep[0],i.set("keep",e.keep.join(",")),u.debug("Keep parameter set (array)",{keep:e.keep.join(","),keepHandle:n});else if(e.keep!==null&&!o.equals(e.keep,"__all__")&&typeof e.keep=="string"){let c=e.keep.trim();c&&(n=c,i.set("keep",n),u.debug("Keep parameter set (string)",{keep:n,keepHandle:n}))}else u.warn("Keep has invalid value, not adding to params",{StateKeep:e.keep});n&&r.hasOwnProperty(n)&&(delete r[n],u.debug("Excluded keep filter from aggregation query",{excludedHandle:n,remainingFilters:Object.keys(r)}))}u.debug("Keep filters sent to filters API",{keep:e.keep,params:i.toString()})}else u.debug("Keep filters not set, skipping keep parameter",{StateKeep:e.keep});Object.keys(r).forEach(c=>{let g=r[c];if(!o.empty(g)){if(Array.isArray(g))i.set(c,g.join(","));else if(c==="search"&&typeof g=="string"&&g.trim())i.set("search",g.trim());else if(c==="priceRange"&&g&&typeof g=="object"&&!Array.isArray(g)){let h=g,l=typeof h.min=="number"&&!isNaN(h.min)?h.min:void 0,f=typeof h.max=="number"&&!isNaN(h.max)?h.max:void 0;e.priceRangeHandle?i.set(e.priceRangeHandle,`${l!==void 0?l:""}-${f!==void 0?f:""}`):(l!==void 0&&i.set("priceMin",String(l)),f!==void 0&&i.set("priceMax",String(f)))}}});let s={};i.forEach((c,g)=>{s[g]=c}),u.debug("All params for filters endpoint",{params:s,hasKeep:i.has("keep"),keepValue:i.get("keep"),StateKeep:e.keep});let a=`${this.baseURL}/storefront/filters?${i}`;u.info("Fetching filters",{url:a,shop:e.shop,hasKeepParam:i.has("keep")});let d=await this.fetch(a);if(!d.success||!d.data)throw u.error("Invalid filters response",{response:d}),new Error(`Invalid filters response: ${d.message||_.messages.unknownError}`);let m=d.data;if(!m||typeof m!="object")throw new Error("Invalid filters response: data is not an object");return m.filters!==void 0&&!Array.isArray(m.filters)&&(u.warn("Filters response contains non-array filters",{filters:m.filters}),m.filters=[]),u.info("Filters response:",{filters:m.filters}),m},setBaseURL(t){this.baseURL=t}},y={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(t,i,r){if(this.container=document.querySelector(t)||document.querySelector("[data-afs-container]"),!this.container)throw new Error("Container not found");this.container.setAttribute("data-afs-container","true");let n=this.container.querySelector(".afs-main-content")||o.el("div","afs-main-content");n.parentNode||this.container.appendChild(n),this.filtersContainer=document.querySelector(i||"")||o.el("div","afs-filters-container"),!this.filtersContainer.parentNode&&n&&n.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=o.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":_.buttons.closeFilters}),this.mobileFilterClose.innerHTML=_.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=o.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",n.parentNode?n.parentNode.insertBefore(this.mobileFilterBackdrop,n):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=document.querySelector(r||"")||o.el("div","afs-products-container"),!this.productsContainer.parentNode&&n&&n.appendChild(this.productsContainer),this.productsInfo=o.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=o.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":_.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${_.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=o.el("div","afs-sort-container");let s=o.el("label","afs-sort-label",{for:"afs-sort-label"});s.textContent=_.labels.sortBy,this.sortSelect=o.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${_.sortOptions.bestSelling}</option>
        <option value="title-ascending">${_.sortOptions.titleAsc}</option>
        <option value="title-descending">${_.sortOptions.titleDesc}</option>
        <option value="price-ascending">${_.sortOptions.priceAsc}</option>
        <option value="price-descending">${_.sortOptions.priceDesc}</option>
        <option value="created-ascending">${_.sortOptions.createdAsc}</option>
        <option value="created-descending">${_.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(s),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=o.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",u.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),u.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let t=this.filtersContainer.classList.contains("afs-filters-container--open");if(t){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let i=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),i&&window.scrollTo(0,parseInt(i||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let i=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${i}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}u.debug("Mobile filters drawer toggled",{isOpen:!t})},renderFilters(t){if(!this.filtersContainer||!Array.isArray(t))return;this.hideFiltersSkeleton();let i=new Map;this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(s=>{let a=s.getAttribute("data-afs-filter-key");if(a){let d=s.querySelector(".afs-filter-group__search-input");i.set(a,{collapsed:s.getAttribute("data-afs-collapsed")==="true",search:(d==null?void 0:d.value)||""})}}),o.clear(this.filtersContainer);let r=t.filter(s=>s?o.isPriceRangeOptionType(s.optionType)?s.range&&typeof s.range.min=="number"&&typeof s.range.max=="number"&&s.range.max>s.range.min:s.values&&s.values.length>0:!1);if(u.debug("Rendering filters",{total:t.length,valid:r.length,filtersWithSearchable:r.filter(s=>s.searchable).length,filtersWithCollapsed:r.filter(s=>s.collapsed).length}),r.length===0){u.warn("No valid filters to render");return}let n=document.createDocumentFragment();r.forEach(s=>{var w;if(o.isPriceRangeOptionType(s.optionType)){let L=this.createPriceRangeGroup(s,i);L&&n.appendChild(L);return}let a;if(s.optionType||s.optionKey){if(a=s.handle,!a){u.error("Option filter missing handle",{filter:s});return}}else if(a=s.queryKey||s.key,!a){u.warn("Standard filter missing queryKey/key",{filter:s});return}u.debug("Filter group handle determined",{handle:a,filterHandle:s.handle,queryKey:s.queryKey,key:s.key,label:s.label,type:s.optionType,optionType:s.optionType,optionKey:s.optionKey,isOptionFilter:!!(s.optionType||s.optionKey)});let d=o.el("div","afs-filter-group",{"data-afs-filter-type":s.optionType||""});d.setAttribute("data-afs-filter-handle",a);let m=a;d.setAttribute("data-afs-filter-key",m);let b=i.get(m),c=(b==null?void 0:b.collapsed)!==void 0?b.collapsed:s.collapsed===!0||s.collapsed==="true"||s.collapsed===1;d.setAttribute("data-afs-collapsed",c?"true":"false"),u.debug("Filter group created",{handle:a,label:s.label,collapsed:c,searchable:s.searchable,showCount:s.showCount,valuesCount:((w=s.values)==null?void 0:w.length)||0});let g=o.el("div","afs-filter-group__header"),h=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":c?"false":"true",title:s.tooltipContent||`Toggle ${s.label||a} filter`}),l=o.el("span","afs-filter-group__icon");l.innerHTML=c?K.rightArrow||"":K.downArrow||"",h.appendChild(l),h.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),s.label||s.optionType||"")),g.appendChild(h);let f=e.filters[a];if(f&&(Array.isArray(f)?f.length>0:typeof f=="object"&&!Array.isArray(f)?Object.keys(f).length>0:!!f)){let L=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${s.label||a} filters`,"data-afs-filter-handle":a});L.textContent=_.buttons.clear,L.title=`${_.buttons.clear} ${s.label||a} filters`,g.appendChild(L)}d.appendChild(g);let S=o.el("div","afs-filter-group__content");if(s.searchable===!0||typeof s.searchable=="string"&&s.searchable.toLowerCase()==="true"){let L=o.el("div","afs-filter-group__search"),x=o.el("input","afs-filter-group__search-input",{type:"text",placeholder:s.searchPlaceholder||"Search...","aria-label":`${_.labels.search}${s.label||a}`,name:`afs-search-${a}`});b!=null&&b.search&&(x.value=b.search),L.appendChild(x),S.appendChild(L),u.debug("Search input added",{handle:a,label:s.label,searchable:s.searchable})}let C=o.el("div","afs-filter-group__items",{"data-afs-filter-handle":a,"data-afs-filter-multiselect":o.isMultiSelect(s)?"1":"0","data-afs-filter-display-type":o.toLowerCase(s.displayType||"CHECKBOX")});C._items=s.values;let P=document.createDocumentFragment();s.values&&s.values.forEach((L,x)=>{let M=this.createFilterItem(a,L,s,x);M&&P.appendChild(M)}),C.appendChild(P),S.appendChild(C),d.appendChild(S),n.appendChild(d)}),n.children.length>0?(this.filtersContainer.appendChild(n),this.showFilters(),u.debug("Filters rendered",{count:n.children.length})):(u.warn("No filter groups created"),this.hideFilters())},createFilterItem(t,i,r,n){let s=o.str(typeof i=="string"?i:i.value||i.key||i.name||"");if(!s||s==="[object Object]")return null;let a=typeof i=="string"?i:i.label||i.value||s;if((o.isCollectionOptionType(r==null?void 0:r.optionType)||o.isCollectionKey(t))&&e.collections&&Array.isArray(e.collections)){let f=e.collections.find(p=>{let S=String(p.id||p.gid||p.collectionId||"");return S&&String(S)===String(s)});if(f)a=f.title||f.label||f.name||a;else return null}let b=(e.filters[t]||[]).includes(s),c=o.inputDisplayType(r),g=(c==="radio"?t:t+"-"+s.replace(/\s+/g,"-").toLowerCase())+"_"+(n+1),h=o.el("label","afs-filter-item",{"data-afs-filter-handle":t,"data-afs-filter-value":s,for:g});b&&h.classList.add("afs-filter-item--active");let l=o.el("input","afs-filter-item__checkbox",{type:c});return l.checked=b,l.setAttribute("data-afs-filter-value",s),l.setAttribute("name",g),l.setAttribute("id",g),h.appendChild(l),h.appendChild(o.txt(o.el("span","afs-filter-item__label"),a)),r!=null&&r.showCount&&typeof i=="object"&&i.count&&h.appendChild(o.txt(o.el("span","afs-filter-item__count"),`(${i.count})`)),h},createPriceRangeGroup(t,i=null){var T;if(!t.range||typeof t.range.min!="number"||typeof t.range.max!="number")return u.warn("Invalid price range filter",{filter:t}),null;let r=t.range.min,n=t.range.max,s=e.filters.priceRange||{min:r,max:n},a=Math.max(r,Math.min(n,s.min||r)),d=Math.max(r,Math.min(n,s.max||n)),m=o.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":t.key||"priceRange"}),b=i==null?void 0:i.get(t.key||"priceRange"),c=(T=b==null?void 0:b.collapsed)!=null?T:t.collapsed===!0;m.setAttribute("data-afs-collapsed",c?"true":"false");let g=o.el("div","afs-filter-group__header"),h=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":c?"false":"true"}),l=o.el("span","afs-filter-group__icon");if(l.innerHTML=c?K.rightArrow||"":K.downArrow||"",h.appendChild(l),h.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),t.label||"Price")),g.appendChild(h),e.filters.priceRange&&(e.filters.priceRange.min!==r||e.filters.priceRange.max!==n)){let A=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${_.buttons.clear} ${t.label} filter`,"data-afs-filter-handle":"priceRange"});A.textContent=_.buttons.clear,A.title=`${_.buttons.clear} ${t.label} filter`,g.appendChild(A)}m.appendChild(g);let p=o.el("div","afs-filter-group__content"),S=o.el("div","afs-price-range-container"),v=o.el("div","afs-price-range-track"),C=o.el("div","afs-price-range-active");v.appendChild(C);let P=o.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(r),max:String(n),value:String(a),step:"1"});P.setAttribute("data-afs-range-type","min");let w=o.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(r),max:String(n),value:String(d),step:"1"});w.setAttribute("data-afs-range-type","max"),v.appendChild(P),v.appendChild(w),S.appendChild(v);let L=o.el("div","afs-price-range-values"),x=o.el("span","afs-price-range-value afs-price-range-value--min"),M=o.el("span","afs-price-range-value afs-price-range-value--max"),R=A=>`$${parseFloat(String(A)).toFixed(0)}`;x.textContent=R(a),M.textContent=R(d),L.appendChild(x),L.appendChild(o.txt(o.el("span","afs-price-range-separator")," - ")),L.appendChild(M),S.appendChild(L);let E=()=>{let A=parseFloat(P.value),H=parseFloat(w.value),F=n-r,$=(A-r)/F*100,k=(n-H)/F*100;C.style.left=`${$}%`,C.style.right=`${k}%`,x.textContent=R(A),M.textContent=R(H)},I=()=>{let A=parseFloat(P.value),H=parseFloat(w.value);A>H&&(P.value=String(H),w.value=String(A)),E()};return P.addEventListener("input",()=>{I(),q.updatePriceRange(parseFloat(P.value),parseFloat(w.value))}),w.addEventListener("input",()=>{I(),q.updatePriceRange(parseFloat(P.value),parseFloat(w.value))}),E(),p.appendChild(S),m.appendChild(p),m},renderProducts(t){if(!this.productsGrid)return;let i=this.productsGrid.querySelectorAll(".afs-skeleton-card");i.length>0&&i.forEach(a=>a.remove());let r=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(a=>{let d=a.getAttribute("data-afs-product-id");d&&r.set(d,a)});let n=new Set(t.map(a=>o.id(a)).filter(a=>a!==null)),s=document.createDocumentFragment();t.forEach(a=>{let d=o.id(a);if(!d)return;let m=r.get(d);if(m){let b=m.querySelector(".afs-product-card__title");b&&b.textContent!==a.title&&(b.textContent=a.title||"");let c=m.querySelector(".afs-product-card__price");if(c){let g=parseFloat(String(a.minPrice||0))*100,h=parseFloat(String(a.maxPrice||0))*100,l=o.formatMoney(g,e.moneyFormat||"{{amount}}",e.currency||""),f=g===h?l:`${_.labels.price}from ${l}`;c.textContent!==f&&(c.textContent=f)}}else{let b=this.createProduct(a);b&&s.appendChild(b)}}),r.forEach((a,d)=>{n.has(d)||a.remove()}),s.children.length>0&&this.productsGrid.appendChild(s)},createProduct(t){var n,s,a;let i=o.el("div","afs-product-card",{"data-afs-product-id":o.id(t)||""});if(t.imageUrl||t.featuredImage){let d=o.el("div","afs-product-card__image"),m=o.el("img","",{alt:t.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),b=((n=t.featuredImage)==null?void 0:n.url)||((s=t.featuredImage)==null?void 0:s.urlFallback)||t.imageUrl||"";if(b){if(t.featuredImage&&(t.featuredImage.urlSmall||t.featuredImage.urlMedium||t.featuredImage.urlLarge)){let p=[];t.featuredImage.urlSmall&&p.push(`${t.featuredImage.urlSmall} 200w`),t.featuredImage.urlMedium&&p.push(`${t.featuredImage.urlMedium} 300w`),t.featuredImage.urlLarge&&p.push(`${t.featuredImage.urlLarge} 500w`),p.length>0&&(m.setAttribute("srcset",p.join(", ")),m.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),m.src=t.featuredImage.url||t.featuredImage.urlFallback||b}else{let p=o.optimizeImageUrl(b,{width:300,format:"webp",quality:80}),S=o.buildImageSrcset(b,[200,300,500]);S&&(m.setAttribute("srcset",S),m.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),m.src=p||b}m.onerror=function(){var S;let p=((S=t.featuredImage)==null?void 0:S.urlFallback)||b;if(p&&this.src!==p)this.src=p;else if(this.src.includes("_webp.")){let v=b.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");v!==this.src?this.src=v:this.style.display="none"}else this.style.display="none"}}d.appendChild(m);let c=o.el("button","afs-product-card__quick-add",{"data-product-handle":t.handle||"","data-product-id":o.id(t)||"","aria-label":_.buttons.quickAddToCart,type:"button"}),g=o.el("span","afs-product-card__quick-add-icon");g.innerHTML=K.plus,c.appendChild(g);let h=o.el("span","afs-product-card__quick-add-text");h.textContent=_.buttons.quickAdd,c.appendChild(h),(parseInt(String(t.totalInventory||0),10)<=0||t.variants&&!t.variants.some(p=>p.availableForSale))&&(c.disabled=!0,c.classList.add("afs-product-card__quick-add--disabled"),c.setAttribute("aria-label",_.labels.productUnavailable));let f=(a=window.AFSQuickView)==null?void 0:a.createQuickViewButton(t);f&&d.appendChild(f),i.appendChild(d)}let r=o.el("div","afs-product-card__info");if(r){r.appendChild(o.txt(o.el("h3","afs-product-card__title"),t.title||"Untitled")),t.vendor&&r.appendChild(o.txt(o.el("div","afs-product-card__vendor"),t.vendor));let d=parseFloat(String(t.minPrice||0))*100,m=parseFloat(String(t.maxPrice||0))*100,b=o.formatMoney(d,e.moneyFormat||"{{amount}}",e.currency||""),c=d===m?b:`from ${b}`;r.appendChild(o.txt(o.el("div","afs-product-card__price"),c)),i.appendChild(r)}return i},updateFilterState(t,i,r){if(!this.filtersContainer){u.warn("Cannot update filter state: filtersContainer not found");return}let n=b=>String(b).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),s=n(i),d=`.afs-filter-item[data-afs-filter-handle="${n(t)}"][data-afs-filter-value="${s}"]`,m=this.filtersContainer.querySelector(d);if(m){let b=m.querySelector(".afs-filter-item__checkbox");b?(b.checked=r,u.debug("Checkbox state updated",{handle:t,value:i,active:r})):u.warn("Checkbox not found in filter item",{handle:t,value:i}),m.classList.toggle("afs-filter-item--active",r)}else u.warn("Filter item not found for state update",{handle:t,value:i,active:r,selector:d})},renderInfo(t,i){if(!this.productsInfo)return;let r=this.sortContainer,n=this.productsInfo.querySelector(".afs-products-info__results");n&&n.remove();let s;if(i===0)s=o.txt(o.el("div","afs-products-info__results"),_.messages.noProductsFound);else if(i===1)s=o.txt(o.el("div","afs-products-info__results"),_.messages.oneProductFound);else{let a=(t.page-1)*t.limit+1,d=Math.min(t.page*t.limit,i);s=o.txt(o.el("div","afs-products-info__results"),`${_.messages.showingProducts} ${a}-${d} of ${i} ${_.messages.productsFound}`)}r&&r.parentNode?this.productsInfo.insertBefore(s,r):(this.productsInfo.appendChild(s),r&&!r.parentNode&&this.productsInfo.appendChild(r))},renderPagination(t){var d;if(!this.productsGrid||!t)return;let i=(d=this.productsGrid.parentNode)==null?void 0:d.querySelector(".afs-pagination");if(i&&i.remove(),t.totalPages<=1)return;let r=o.el("div","afs-pagination"),n=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(t.page-1),"aria-label":`${_.buttons.previous} ${_.messages.pageOf.toLowerCase()}`});n.textContent=_.buttons.previous,n.disabled=t.page<=1,r.appendChild(n);let s=o.el("span","afs-pagination__info");s.textContent=`${_.messages.pageOf} ${t.page} of ${t.totalPages}`,r.appendChild(s);let a=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(t.page+1),"aria-label":`${_.buttons.next} ${_.messages.pageOf.toLowerCase()}`});a.textContent=_.buttons.next,a.disabled=t.page>=t.totalPages,r.appendChild(a),this.productsContainer&&this.productsContainer.appendChild(r)},renderApplied(t){var m,b;if(!this.container)return;let i=this.container.querySelector(".afs-applied-filters");i&&i.remove();let r=[];if(Object.keys(t).forEach(c=>{let g=t[c];if(o.equals(c,"search")&&g&&typeof g=="string"&&g.trim())r.push({handle:c,label:`${_.labels.search}${g}`,value:g});else if(o.isPriceRangeKey(c)&&g&&typeof g=="object"&&!Array.isArray(g)){let h=g,l=typeof h.min=="number"&&!isNaN(h.min),f=typeof h.max=="number"&&!isNaN(h.max);l&&f?r.push({handle:c,label:`${_.labels.price}$${h.min} - $${h.max}`,value:"__clear__"}):l?r.push({handle:c,label:`${_.labels.price}$${h.min}+`,value:"__clear__"}):f&&r.push({handle:c,label:`${_.labels.price}Up to $${h.max}`,value:"__clear__"})}else Array.isArray(g)&&g.length>0&&g.forEach(h=>{let l=e.filterMetadata.get(c),f=(l==null?void 0:l.label)||c,p=h;if((o.isCollectionOptionType(l==null?void 0:l.optionType)||o.isCollectionKey(c))&&e.collections&&Array.isArray(e.collections)){let v=e.collections.find(C=>{let P=String(C.id||C.gid||C.collectionId||"");return P&&String(P)===String(h)});v&&(p=v.title||v.label||v.name||h)}r.push({handle:c,label:`${f}: ${p}`,value:h})})}),(m=e.selectedCollection)!=null&&m.id&&!Object.keys(t).some(g=>{let h=e.filterMetadata.get(g);return(o.isCollectionOptionType(h==null?void 0:h.optionType)||o.isCollectionKey(g))&&Array.isArray(t[g])&&t[g].includes(String(e.selectedCollection.id))})){let g=(b=e.collections)==null?void 0:b.find(l=>{let f=String(l.id||l.gid||l.collectionId||"");return f&&String(f)===String(e.selectedCollection.id)}),h=(g==null?void 0:g.title)||(g==null?void 0:g.label)||(g==null?void 0:g.name)||"Collection";r.push({handle:"cpid",label:`${_.labels.collection}${h}`,value:String(e.selectedCollection.id)})}if(r.length===0)return;let n=o.el("div","afs-applied-filters"),s=o.el("div","afs-applied-filters__header");s.appendChild(o.txt(o.el("div","afs-applied-filters__label"),_.labels.appliedFilters)),n.appendChild(s);let a=o.el("div","afs-applied-filters__list");r.forEach(c=>{let g=o.el("div","afs-applied-filter-chip");g.appendChild(o.txt(o.el("span","afs-applied-filter-chip__label"),c.label));let h=o.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":c.handle,"data-afs-filter-value":c.value,"aria-label":`${_.buttons.clear} filter`,type:"button"});h.innerHTML=K.close,g.appendChild(h),a.appendChild(g)});let d=o.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});d.textContent=_.buttons.clearAll,a.appendChild(d),n.appendChild(a),this.container.insertBefore(n,this.container.firstChild)},scrollToProducts(){e.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),u.debug("Scrolled to products info")))},showLoading(){var t;if(this.productsGrid){o.clear(this.productsGrid);let i=((t=e.pagination)==null?void 0:t.limit)||V.PAGE_SIZE||24,r=Math.max(i,24),n=[];for(let s=0;s<r;s++){let a=o.el("div","afs-skeleton-card");a.innerHTML=`
            <div class="afs-skeleton-card__image">&#8203;</div>
            <div class="afs-skeleton-card__info">
              <div class="afs-skeleton-card__title">&#8203;</div>
              <div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
              <div class="afs-skeleton-card__price">&#8203;</div>
            </div>
          `,n.push(a)}n.forEach(s=>this.productsGrid.appendChild(s)),this.loading=n}this.filtersContainer&&this.filtersContainer.style.display!=="none"&&this.showFiltersSkeleton()},showFiltersSkeleton(){if(!this.filtersContainer)return;let t=this.filtersContainer.querySelector(".afs-filters-skeleton");t&&t.remove();let i=o.el("div","afs-filters-skeleton");for(let r=0;r<4;r++){let n=o.el("div","afs-skeleton-filter-group");n.innerHTML=`
          <div class="afs-skeleton-filter-group__header">
            <div class="afs-skeleton-filter-group__title">&#8203;</div>
          </div>
          <div class="afs-skeleton-filter-group__content">
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
          </div>
        `,i.appendChild(n)}this.filtersContainer.appendChild(i)},hideFiltersSkeleton(){var i;let t=(i=this.filtersContainer)==null?void 0:i.querySelector(".afs-filters-skeleton");t&&t.remove()},hideLoading(){var t;Array.isArray(this.loading)?(this.loading.forEach(i=>{i.parentNode&&i.remove()}),this.loading=null):(t=this.loading)!=null&&t.parentNode&&(this.loading.remove(),this.loading=null),this.hideFiltersSkeleton()},showError(t){if(!this.productsContainer){u.error("Cannot show error: productsContainer not found");return}if(this.hideLoading(),e.fallbackProducts&&e.fallbackProducts.length>0){u.warn("API error occurred, using fallback products from Liquid",{error:t,fallbackCount:e.fallbackProducts.length}),e.products=e.fallbackProducts,e.pagination={page:1,limit:V.PAGE_SIZE,total:e.fallbackProducts.length,totalPages:Math.ceil(e.fallbackProducts.length/V.PAGE_SIZE)},this.renderProducts(e.products),this.renderInfo(e.pagination,e.pagination.total),this.renderPagination(e.pagination);return}let i=this.productsContainer.querySelector(".afs-error-message");i&&i.remove();let r=o.el("div","afs-error-message");r.textContent=t||_.messages.failedToLoad,this.productsGrid?(o.clear(this.productsGrid),this.productsGrid.appendChild(r)):this.productsContainer.appendChild(r),u.error("Error displayed",{message:t})}},Q={getPagination(){let i=N.parse().page||e.fallbackPagination.currentPage||1,r=e.fallbackPagination.totalPages||1,n=e.fallbackPagination.totalProducts||e.fallbackProducts.length||0;return{page:i,limit:V.PAGE_SIZE,total:n,totalPages:r}},reloadPage(t,i,r){let n=new URL(window.location.href);if(n.search="",r&&r.field)if(r.field==="best-selling"||r.field==="bestselling")n.searchParams.set("sort","best-selling");else{let s=o.equals(r.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${r.field}-${s}`)}i&&i.page&&n.searchParams.set("page",String(i.page)),Object.keys(t||{}).forEach(s=>{let a=t[s];if(!o.empty(a))if(Array.isArray(a)&&a.length>0)n.searchParams.set(s,a.join(","));else if(o.isPriceRangeKey(s)&&a&&typeof a=="object"&&!Array.isArray(a)){let d=a,m=typeof d.min=="number"&&!isNaN(d.min)?d.min:void 0,b=typeof d.max=="number"&&!isNaN(d.max)?d.max:void 0;e.priceRangeHandle?n.searchParams.set(e.priceRangeHandle,`${m!==void 0?m:""}-${b!==void 0?b:""}`):(m!==void 0&&n.searchParams.set("priceMin",String(m)),b!==void 0&&n.searchParams.set("priceMax",String(b)))}else o.equals(s,"search")&&typeof a=="string"&&a.trim()&&n.searchParams.set(s,a.trim())}),u.info("Reloading page for fallback mode",{url:n.toString(),sort:r,pagination:i}),window.location.href=n.toString()}},Z=t=>{var r;if(!((r=e.selectedCollection)!=null&&r.id))return;Object.keys(t||{}).some(n=>{let s=t[n];if(o.empty(s)||o.equalsAny(n,"page","limit","sort","size"))return!1;if(o.isPriceRangeKey(n)){if(!s||typeof s!="object"||Array.isArray(s))return!1;let a=s,d=typeof a.min=="number"&&!isNaN(a.min),m=typeof a.max=="number"&&!isNaN(a.max);if(!d&&!m)return!1}return!(o.equals(n,"search")&&(!s||typeof s!="string"||!s.trim()))})&&(e.selectedCollection.id=null,u.debug("Filters present, cleared cpid",{filters:t}))},q={toggle(t,i){var b,c;let r=o.str(i);if(!r||!t){u.warn("Invalid filter toggle",{handle:t,value:i});return}let n=e.filters[t]||[],s=n.includes(r),a=s?n.filter(g=>g!==r):[...n,r],d=e.filterMetadata.get(t);if(((d==null?void 0:d.optionType)==="Collection"||t==="collections")&&((b=e.selectedCollection)!=null&&b.id)){let g=e.selectedCollection.id;s&&String(r)===String(g)?(e.selectedCollection.id=null,u.debug("Collection filter unchecked (was cpid), cleared cpid",{handle:t,value:r,cpid:g})):a.some(h=>String(h)===String(g))||(e.selectedCollection.id=null,u.debug("Collection filter toggled, cpid no longer in values, cleared cpid",{handle:t,value:r,filterValues:a,wasCpid:String(r)===String(g),originalCpid:g}))}if(a.length===0?delete e.filters[t]:e.filters[t]=a,Z(e.filters),e.pagination.page=1,u.debug("Filter toggled",{handle:t,value:r,wasActive:s,isActive:!s,filterValues:a}),N.update(e.filters,e.pagination,e.sort),y.updateFilterState(t,r,!s),y.scrollToProducts(),y.showLoading(),window.innerWidth<=768&&((c=y.filtersContainer)!=null&&c.classList.contains("afs-filters-container--open"))){y.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let g=document.body.style.top;g&&window.scrollTo(0,parseInt(g||"0",10)*-1)}this.apply()},updatePriceRange(t,i){if(typeof t!="number"||typeof i!="number"||t<0||i<t){u.warn("Invalid price range",{min:t,max:i});return}let r=e.availableFilters.find(n=>o.isPriceRangeOptionType(n.optionType)||o.equals(n.optionKey,"priceRange"));r&&r.range?t===r.range.min&&i===r.range.max?e.filters.priceRange=null:e.filters.priceRange={min:t,max:i}:e.filters.priceRange={min:t,max:i},Z(e.filters),e.pagination.page=1,u.debug("Price range updated",{min:t,max:i,priceRange:e.filters.priceRange}),N.update(e.filters,e.pagination,e.sort),y.scrollToProducts(),y.showLoading(),this.apply()},applyProductsOnly:o.debounce(async()=>{var t;if(u.info("applyProductsOnly called",{filters:e.filters,pagination:e.pagination,sort:e.sort,usingFallback:e.usingFallback}),e.usingFallback){u.info("In fallback mode, reloading page with new parameters"),Q.reloadPage(e.filters,e.pagination,e.sort);return}y.scrollToProducts(),y.showLoading();try{u.info("Fetching products...",{url:`${D.baseURL}/storefront/products`});let i=await D.products(e.filters,e.pagination,e.sort);u.info("Products fetched successfully",{count:((t=i.products)==null?void 0:t.length)||0}),e.products=i.products||[],e.pagination=i.pagination||e.pagination,e.usingFallback=!1,y.showFilters(),y.renderProducts(e.products),y.renderInfo(e.pagination,e.pagination.total||0),y.renderPagination(e.pagination),y.renderApplied(e.filters),y.hideLoading()}catch(i){if(y.hideLoading(),u.error("Failed to load products",{error:i instanceof Error?i.message:String(i)}),e.fallbackProducts&&e.fallbackProducts.length>0){if(u.warn("Products API failed, using fallback products from Liquid",{error:i instanceof Error?i.message:String(i),fallbackCount:e.fallbackProducts.length}),e.usingFallback=!0,e.products=e.fallbackProducts,e.pagination=Q.getPagination(),e.availableFilters=[],y.hideFilters(),y.sortSelect)if(o.isBestSelling(e.sort.field))y.sortSelect.value="best-selling";else{let r=o.equals(e.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${e.sort.field}-${r}`}y.renderProducts(e.products),y.renderInfo(e.pagination,e.pagination.total),y.renderPagination(e.pagination),y.renderApplied(e.filters)}else y.showError(`${_.messages.failedToLoadProducts}: ${i instanceof Error?i.message:_.messages.unknownError}`)}},V.DEBOUNCE),apply:o.debounce(async()=>{var t;y.scrollToProducts(),y.showLoading();try{let i=await D.products(e.filters,e.pagination,e.sort);e.products=i.products||[],e.pagination=i.pagination||e.pagination;try{let r=await D.filters(e.filters);if(Array.isArray(r.filters)){e.availableFilters=r.filters,e.filterMetadata=ee.buildFilterMetadata(e.availableFilters);let n=e.availableFilters.find(s=>o.isPriceRangeOptionType(s.optionType));if(e.priceRangeHandle=(n==null?void 0:n.handle)||e.priceRangeHandle,(t=e.selectedCollection)!=null&&t.id){let s=e.availableFilters.find(a=>a.optionType==="Collection"||o.isCollectionKey(a.queryKey)||o.isCollectionKey(a.handle));if(s){let a=s.handle||s.queryKey||"collections",d=e.filters[a]||[];d.includes(String(e.selectedCollection.id))||(e.filters[a]=[...d,String(e.selectedCollection.id)],u.debug("Converted cpid to collection filter",{cpid:e.selectedCollection.id,handle:a}))}}y.renderFilters(e.availableFilters)}}catch(r){u.warn("Failed to fetch updated filters",{error:r instanceof Error?r.message:String(r)})}y.renderProducts(e.products),y.renderInfo(e.pagination,e.pagination.total||0),y.renderPagination(e.pagination),y.renderApplied(e.filters),y.hideLoading()}catch(i){if(y.hideLoading(),u.error("Failed to apply filters",{error:i instanceof Error?i.message:String(i)}),e.fallbackProducts&&e.fallbackProducts.length>0){if(u.warn("Filters API failed, using fallback products from Liquid",{error:i instanceof Error?i.message:String(i),fallbackCount:e.fallbackProducts.length}),e.usingFallback=!0,e.products=e.fallbackProducts,e.pagination=Q.getPagination(),e.availableFilters=[],y.hideFilters(),y.sortSelect)if(o.isBestSelling(e.sort.field))y.sortSelect.value="best-selling";else{let r=o.equals(e.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${e.sort.field}-${r}`}y.renderProducts(e.products),y.renderInfo(e.pagination,e.pagination.total),y.renderPagination(e.pagination),y.renderApplied(e.filters)}else y.showError(`${_.messages.failedToLoadProducts}: ${i instanceof Error?i.message:_.messages.unknownError}`)}},V.DEBOUNCE)};var te={async add(t,i){try{let r=`/products/${t}.json`,n=await fetch(r);if(!n.ok)throw new Error(_.messages.failedToLoadProduct);let a=(await n.json()).product;if(!a||!a.variants||a.variants.length===0)throw new Error("Product has no variants");let d=a.variants.find(m=>m.available)||a.variants[0];await this.addVariant(Number(d.id),1)}catch(r){u.error("Quick add failed",{error:r instanceof Error?r.message:String(r),handle:t}),alert("Failed to add product to cart. Please try again.")}},async addFromForm(t,i){var r,n;try{let s=new FormData(t),a=s.get("id"),d=parseInt(((r=s.get("quantity"))==null?void 0:r.toString())||"1",10);if(a)await this.addVariant(Number(a),d);else{let m=[];for(let f=1;f<=3;f++){let p=s.get(`option${f}`);p&&m.push(p.toString())}let b=`/products/${i}.json`,l=(n=(await(await fetch(b)).json()).product.variants)==null?void 0:n.find(f=>f.options?f.options.length===m.length&&f.options.every((p,S)=>p===m[S]):!1);if(l)await this.addVariant(Number(l.id),d);else throw new Error("Variant not found")}}catch(s){u.error("Add from form failed",{error:s instanceof Error?s.message:String(s)}),alert("Failed to add product to cart. Please try again.")}},async addVariant(t,i){try{let r=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,quantity:i})});if(!r.ok){let n=await r.json();throw new Error(n.description||_.messages.failedToAddToCart)}await r.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(r){throw u.error("Add variant failed",{error:r instanceof Error?r.message:String(r),variantId:t}),r}},showSuccess(){let t=document.querySelector(".afs-quick-add-success");t||(t=o.el("div","afs-quick-add-success"),document.body.appendChild(t)),t.textContent=_.messages.addedToCart,t.classList.add("afs-quick-add-success--show"),setTimeout(()=>{t.classList.remove("afs-quick-add-success--show")},3e3)}},re={attach(){if(!y.container)return;y.container.addEventListener("click",r=>{var b,c,g,h,l,f,p;let n=r.target,s=(b=n.closest("[data-afs-action]"))==null?void 0:b.dataset.afsAction,a=n.closest(".afs-filter-item"),d=n instanceof HTMLInputElement&&(n.type==="checkbox"||n.type==="radio")?n:a==null?void 0:a.querySelector(".afs-filter-item__checkbox"),m=n.closest(".afs-pagination__button");if(s==="clear-all")e.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(c=e.selectedCollection)!=null&&c.id&&(e.selectedCollection.id=null,u.debug("Clear All: cleared cpid")),e.pagination.page=1,N.update(e.filters,e.pagination,e.sort),y.scrollToProducts(),y.showLoading(),q.apply();else if(s==="toggle-filters"||s==="close-filters")y.toggleMobileFilters();else if(n.closest(".afs-applied-filter-chip__remove")){let S=n.closest(".afs-applied-filter-chip"),v=S==null?void 0:S.querySelector(".afs-applied-filter-chip__remove"),C=v==null?void 0:v.getAttribute("data-afs-filter-key"),P=v==null?void 0:v.getAttribute("data-afs-filter-value");if(!C)return;if(o.equals(C,"cpid")){(g=e.selectedCollection)!=null&&g.id&&(e.selectedCollection.id=null,u.debug("cpid removed, cleared selectedCollection")),N.update(e.filters,e.pagination,e.sort),y.scrollToProducts(),y.showLoading(),q.apply();return}if(o.equals(C,"search")){e.filters.search="",e.pagination.page=1,N.update(e.filters,e.pagination,e.sort),y.scrollToProducts(),y.showLoading(),q.apply();return}if(o.isPriceRangeKey(C)){e.filters.priceRange=null,e.pagination.page=1,N.update(e.filters,e.pagination,e.sort),y.scrollToProducts(),y.showLoading(),q.apply();return}P&&q.toggle(C,P)}else if(d&&a){r.preventDefault(),r.stopPropagation();let S=a.getAttribute("data-afs-filter-handle")||((h=a.parentElement)==null?void 0:h.getAttribute("data-afs-filter-handle")),v=a.getAttribute("data-afs-filter-value"),C=a.getAttribute("data-afs-filter-multiselect")||((l=a.parentElement)==null?void 0:l.getAttribute("data-afs-filter-multiselect"));if(!S||!v){u.warn("Invalid filter item clicked",{handle:S,value:v});return}u.debug("Filter toggle",{handle:S,value:v,currentChecked:d.checked}),(C==="0"||C==="false")&&(e.filters[S]=[]),q.toggle(S,v)}else if(m&&!m.disabled){let S=parseInt(m.getAttribute("data-afs-page")||"0",10);if(S&&S>0){if(e.usingFallback){let C=N.parse().page||e.pagination.page||1;e.pagination.page=S}else e.pagination.page=S;N.update(e.filters,e.pagination,e.sort),y.scrollToProducts(),y.showLoading(),q.applyProductsOnly()}}else if(n.closest(".afs-filter-group__clear")){r.preventDefault(),r.stopPropagation();let S=n.closest(".afs-filter-group__clear");if(!S)return;let v=S.getAttribute("data-afs-filter-handle");if(!v)return;let C=e.filterMetadata.get(v),P=o.isCollectionOptionType(C==null?void 0:C.optionType)||o.isCollectionKey(v);if(e.filters[v]){if(P&&((f=e.selectedCollection)!=null&&f.id)){let w=e.filters[v],L=e.selectedCollection.id;Array.isArray(w)&&w.some(M=>String(M)===String(L))&&(e.selectedCollection.id=null,u.debug("Collection filter cleared (contained cpid), cleared cpid",{handle:v,cpid:L}))}delete e.filters[v],u.debug("Filter cleared",{handle:v,isCollectionFilter:P}),N.update(e.filters,e.pagination,e.sort),y.scrollToProducts(),y.showLoading(),q.apply()}}else if(n.closest(".afs-filter-group__toggle")){r.preventDefault(),r.stopPropagation();let S=n.closest(".afs-filter-group");if(!S)return;let C=!(S.getAttribute("data-afs-collapsed")==="true");S.setAttribute("data-afs-collapsed",C?"true":"false");let P=S.querySelector(".afs-filter-group__toggle");P&&P.setAttribute("aria-expanded",C?"false":"true");let w=S.querySelector(".afs-filter-group__icon");w&&(w.innerHTML=C?K.rightArrow||"":K.downArrow||""),u.debug("Filter group toggled",{collapsed:C})}else if(n.closest(".afs-product-card__quick-add")){r.preventDefault(),r.stopPropagation();let S=n.closest(".afs-product-card__quick-add");if(!S||S.disabled)return;let v=S.getAttribute("data-product-handle"),C=S.getAttribute("data-product-id");v&&te.add(v,C)}else if(n.closest(".afs-product-card__quick-view")){r.preventDefault(),r.stopPropagation();let S=n.closest(".afs-product-card__quick-view");if(!S)return;let v=S.getAttribute("data-product-handle");if(v){let C=window;(p=C.AFSQuickView)!=null&&p.handleQuickViewClick?C.AFSQuickView.handleQuickViewClick(v):u.error("AFSQuickView module not loaded")}}}),y.container.addEventListener("input",r=>{var s;let n=r.target;if(n.classList.contains("afs-filter-group__search-input")){let d=n.value.toLowerCase(),m=(s=n.closest(".afs-filter-group"))==null?void 0:s.querySelector(".afs-filter-group__items");m!=null&&m._items&&m.querySelectorAll(".afs-filter-item").forEach((b,c)=>{var h;let g=(h=m._items)==null?void 0:h[c];if(g){let l=o.str(typeof g=="string"?g:g.label||g.value||"").toLowerCase();b.style.display=!d||l.includes(d)?"":"none"}})}});let t=r=>{let n=r.value;if(!n)return;u.info("Sort dropdown changed",{sortValue:n,currentSort:e.sort});let s;if(n==="best-selling"||n==="bestselling")s={field:"best-selling",order:"asc"};else if(n.includes("-")){let[a,d]=n.split("-");s={field:a,order:d==="ascending"?"asc":"desc"}}else{let[a,d]=n.split(":");s={field:a,order:d||"desc"}}e.sort=s,e.pagination.page=1,N.update(e.filters,e.pagination,e.sort),u.info("Calling applyProductsOnly after sort change",{sort:e.sort}),y.scrollToProducts(),y.showLoading(),q.applyProductsOnly()},i=null;y.container.addEventListener("focus",r=>{let n=r.target;n.classList.contains("afs-sort-select")&&(i=n.value)},!0),y.container.addEventListener("change",r=>{let n=r.target;if(n.classList.contains("afs-sort-select")){let s=n;t(s),i=s.value}}),y.container.addEventListener("blur",r=>{let n=r.target;if(n.classList.contains("afs-sort-select")){let s=n,a=s.value;a&&a!==i&&setTimeout(()=>{let d;if(o.isBestSelling(e.sort.field))d="best-selling";else{let m=o.equals(e.sort.order,"asc")?"ascending":"descending";d=`${e.sort.field}-${m}`}a!==d&&t(s)},50),i=a}},!0),window.addEventListener("popstate",()=>{let r=N.parse(),n=JSON.stringify(e.filters),s=e.pagination.page,a=JSON.stringify(e.sort);r.keep!==void 0&&(r.keep==="__all__"||typeof r.keep=="string"&&o.equals(r.keep,"__all__")?e.keep="__all__":Array.isArray(r.keep)&&r.keep.length>0?e.keep=r.keep:e.keep=null),e.filters={vendor:r.vendor||[],productType:r.productType||[],tags:r.tags||[],collections:r.collections||[],search:r.search||"",priceRange:r.priceRange||null},Object.keys(r).forEach(l=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","keep"].includes(l)){let f=r[l];Array.isArray(f)?e.filters[l]=f:typeof f=="string"&&(e.filters[l]=[f])}});let d=e.priceRangeHandle?e.filters[e.priceRangeHandle]:null;if(e.priceRangeHandle&&Array.isArray(d)&&d.length>0){let f=String(d[0]||"").split("-");if(f.length===2){let p=f[0].trim()?parseFloat(f[0]):void 0,S=f[1].trim()?parseFloat(f[1]):void 0,v=typeof p=="number"&&!isNaN(p)&&p>=0,C=typeof S=="number"&&!isNaN(S)&&S>=0;(v||C)&&(e.filters.priceRange={min:v?p:void 0,max:C?S:void 0},delete e.filters[e.priceRangeHandle])}}let m=r.page||e.pagination.page;if(m!==s&&(e.pagination.page=m),r.sort){let l=typeof r.sort=="object"?r.sort.field:r.sort;if(typeof l=="string"){let f=l.toLowerCase().trim();if(f==="best-selling"||f==="bestselling")e.sort={field:"best-selling",order:"asc"};else if(f.includes("-")){let[p,S]=f.split("-"),v=o.equalsAny(S,"ascending")?"asc":(o.equalsAny(S,"descending"),"desc");e.sort={field:p,order:v}}else{let[p,S]=l.split(":");e.sort={field:p,order:S||"desc"}}}else typeof r.sort=="object"&&r.sort.field&&(e.sort={field:r.sort.field,order:r.sort.order||"desc"})}else e.sort={field:"best-selling",order:"asc"};let b=JSON.stringify(e.filters),c=JSON.stringify(e.sort);!(n!==b)&&(c!==a||m!==s)?q.applyProductsOnly():q.apply()})}},X={init(t={}){var i,r,n,s;try{if(u.init(t.enableLogging!==void 0?t.enableLogging:t.debug),u.info("Initializing AFS",t),t.apiBaseUrl&&(D.setBaseURL(t.apiBaseUrl),u.info("API base URL set",{url:D.baseURL})),!t.shop)throw new Error("Shop parameter is required in config");e.shop=t.shop,e.collections=t.collections||[],e.selectedCollection={id:(r=(i=t.selectedCollection)==null?void 0:i.id)!=null?r:null,sortBy:(s=(n=t.selectedCollection)==null?void 0:n.sortBy)!=null?s:null},e.scrollToProductsOnFilter=t.scrollToProductsOnFilter!==!1,t.moneyFormat&&(e.moneyFormat=t.moneyFormat),t.moneyWithCurrencyFormat&&(e.moneyWithCurrencyFormat=t.moneyWithCurrencyFormat),t.currency&&(e.currency=t.currency),t.fallbackProducts&&Array.isArray(t.fallbackProducts)&&t.fallbackProducts.length>0&&(e.fallbackProducts=t.fallbackProducts,u.info("Fallback products loaded from Liquid",{count:e.fallbackProducts.length})),t.fallbackPagination&&(e.fallbackPagination=t.fallbackPagination,u.info("Fallback pagination loaded from Liquid",{currentPage:e.fallbackPagination.currentPage,totalPages:e.fallbackPagination.totalPages,totalProducts:e.fallbackPagination.totalProducts})),t.keep!==void 0&&(o.equalsAny(t.keep,"__all__","__ALL__")?e.keep="__all__":Array.isArray(t.keep)&&t.keep.length>0?e.keep=t.keep:typeof t.keep=="string"&&t.keep.trim()?e.keep=o.split(t.keep):e.keep=null,u.info("Keep filters set from config",{keep:e.keep})),t.priceRangeHandle!==void 0&&(e.priceRangeHandle=t.priceRangeHandle),u.info("Shop set",{shop:e.shop}),u.info("Collections set",{collections:e.collections});let a=t.container||t.containerSelector||"[data-afs-container]",d=t.filtersContainer||t.filtersSelector,m=t.productsContainer||t.productsSelector;y.init(a,d,m),u.info("DOM initialized"),y.showLoading(),re.attach(),u.info("Events attached"),this.load()}catch(a){throw u.error("Initialization failed",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,config:t}),y.container&&y.showError(`Initialization failed: ${a instanceof Error?a.message:String(a)}`),a}},async load(){var t,i,r,n,s;y.showLoading();try{let a=N.parse();u.debug("Parsed URL params on load",{urlParams:a}),e.filters={vendor:a.vendor||[],productType:a.productType||[],tags:a.tags||[],collections:a.collections||[],search:a.search||"",priceRange:a.priceRange||null},Object.keys(a).forEach(l=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","keep","cpid"].includes(l)){let f=a[l];Array.isArray(f)?e.filters[l]=f:typeof f=="string"&&(e.filters[l]=[f])}}),Z(e.filters),u.info("Loading filters...",{shop:e.shop,filters:e.filters});let d;try{d=await D.filters(e.filters),u.info("Filters loaded",{filtersCount:((t=d.filters)==null?void 0:t.length)||0})}catch(l){u.warn("Failed to load filters, continuing with empty filters",{error:l instanceof Error?l.message:String(l)}),d={filters:[]}}Array.isArray(d.filters)||(u.error("Invalid filters response: filters is not an array",{filters:d.filters}),d.filters=[]),e.availableFilters=d.filters||[],e.filterMetadata=ee.buildFilterMetadata(e.availableFilters);let m=e.availableFilters.find(l=>o.isPriceRangeOptionType(l.optionType));e.priceRangeHandle=(m==null?void 0:m.handle)||e.priceRangeHandle||null;let b=e.priceRangeHandle?e.filters[e.priceRangeHandle]:null;if(e.priceRangeHandle&&Array.isArray(b)&&b.length>0){let f=String(b[0]||"").split("-");if(f.length===2){let p=f[0].trim()?parseFloat(f[0]):void 0,S=f[1].trim()?parseFloat(f[1]):void 0,v=typeof p=="number"&&!isNaN(p)&&p>=0,C=typeof S=="number"&&!isNaN(S)&&S>=0;(v||C)&&(e.filters.priceRange={min:v?p:void 0,max:C?S:void 0},delete e.filters[e.priceRangeHandle])}}if((i=e.selectedCollection)!=null&&i.id){let l=e.availableFilters.find(f=>f.optionType==="Collection"||o.isCollectionKey(f.queryKey)||o.isCollectionKey(f.handle));if(l){let f=l.handle||l.queryKey||"collections";(e.filters[f]||[]).includes(String(e.selectedCollection.id))||(e.filters[f]||(e.filters[f]=[]),e.filters[f].push(String(e.selectedCollection.id)),u.debug("Converted cpid to collection filter",{cpid:e.selectedCollection.id,handle:f}))}}if(a.keep!==void 0?(a.keep==="__all__"||typeof a.keep=="string"&&o.equals(a.keep,"__all__")?e.keep="__all__":Array.isArray(a.keep)&&a.keep.length>0?e.keep=a.keep:e.keep=null,u.debug("Keep filters set from URL",{keep:e.keep})):e.keep=null,u.info("Filters set from URL",{filters:e.filters}),a.page?e.pagination.page=a.page:e.fallbackPagination&&e.fallbackPagination.currentPage&&(e.pagination.page=e.fallbackPagination.currentPage),a.sort){let l=typeof a.sort=="object"?a.sort.field:a.sort;if(typeof l=="string"){let f=l.toLowerCase().trim();if(f==="best-selling"||f==="bestselling")e.sort={field:"best-selling",order:"asc"};else if(f.includes("-")){let[p,S]=f.split("-"),v=o.equalsAny(S,"ascending")?"asc":(o.equalsAny(S,"descending"),"desc");e.sort={field:p,order:v}}else{let[p,S]=l.split(":");e.sort={field:p,order:S||"desc"}}}else typeof a.sort=="object"&&a.sort.field&&(e.sort={field:a.sort.field,order:a.sort.order||"desc"})}else e.sort={field:"best-selling",order:"asc"};y.renderFilters(e.availableFilters),u.info("Filters rendered",{count:e.availableFilters.length}),u.info("Loading products...",{filters:e.filters,pagination:e.pagination});let c=await D.products(e.filters,e.pagination,e.sort);u.info("Products loaded",{count:((r=c.products)==null?void 0:r.length)||0,total:((n=c.pagination)==null?void 0:n.total)||0});let g=c.products&&Array.isArray(c.products)&&c.products.length>0,h=e.availableFilters&&Array.isArray(e.availableFilters)&&e.availableFilters.length>0;if(!g&&e.fallbackProducts&&e.fallbackProducts.length>0?(u.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((s=c.products)==null?void 0:s.length)||0,fallbackCount:e.fallbackProducts.length}),e.usingFallback=!0,e.products=e.fallbackProducts,e.pagination=Q.getPagination(),e.availableFilters=[],y.hideFilters()):(e.usingFallback=!1,e.products=c.products||[],e.pagination=c.pagination||e.pagination,y.showFilters()),y.renderProducts(e.products),y.renderInfo(e.pagination,e.pagination.total||0),y.renderPagination(e.pagination),y.renderApplied(e.filters),y.sortSelect){if(o.isBestSelling(e.sort.field))y.sortSelect.value="best-selling";else{let l=o.equals(e.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${e.sort.field}-${l}`}u.debug("Sort select value updated programmatically",{value:y.sortSelect.value,sort:e.sort})}y.hideLoading(),e.products.length===0&&!h&&(!e.fallbackProducts||e.fallbackProducts.length===0)&&y.showError("No products or filters found. Please check your configuration.")}catch(a){if(y.hideLoading(),u.error("Load failed",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,shop:e.shop,apiBaseURL:D.baseURL}),e.fallbackProducts&&e.fallbackProducts.length>0){if(u.warn("Initial load failed, using fallback products from Liquid",{error:a instanceof Error?a.message:String(a),fallbackCount:e.fallbackProducts.length}),e.usingFallback=!0,e.products=e.fallbackProducts,e.pagination=Q.getPagination(),e.availableFilters=[],y.hideFilters(),y.sortSelect)if(o.isBestSelling(e.sort.field))y.sortSelect.value="best-selling";else{let d=o.equals(e.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${e.sort.field}-${d}`}y.renderProducts(e.products),y.renderInfo(e.pagination,e.pagination.total),y.renderPagination(e.pagination),y.renderApplied(e.filters)}else y.showError(`${_.messages.failedToLoad}: ${a instanceof Error?a.message:_.messages.unknownError}. ${_.messages.checkConsole}`)}},Logger:u},B=window;B.DOM=y;B.AFS_State=e;B.AFS_API=D;B.AFS_LOG=u;B.QuickAdd=te;B.$=o;B.Icons=K;B.Lang=_;B.SpecialValue=J;typeof window!="undefined"?B.AFS=X:typeof global!="undefined"&&(global.AFS=X);(function(){"use strict";let t=window,i=t.AFS_State||{moneyFormat:null,currency:null},r=t.AFS_LOG||{error:()=>{},warn:()=>{},info:()=>{},debug:()=>{},log:()=>{},init:()=>{}},n=t.QuickAdd||{add:async()=>{},addFromForm:async()=>{},addVariant:async()=>{},showSuccess:()=>{}},s=t.$||{debounce:()=>()=>{},toLowerCase:()=>"",inputDisplayType:()=>"checkbox",isMultiSelect:()=>!1,split:()=>[],id:()=>null,str:()=>"",empty:()=>!0,el:()=>document.createElement("div"),txt:()=>document.createElement("div"),clear:()=>{},frag:()=>document.createDocumentFragment(),optimizeImageUrl:()=>"",buildImageSrcset:()=>"",formatMoney:()=>"",equals:()=>!1,equalsAny:()=>!1,isVendorKey:()=>!1,isProductTypeKey:()=>!1,isTagKey:()=>!1,isCollectionKey:()=>!1,isPriceRangeKey:()=>!1,isBestSelling:()=>!1,isCollectionOptionType:()=>!1,isPriceRangeOptionType:()=>!1},a=t.Icons||{rightArrow:"",downArrow:"",close:"",minus:"",plus:"",eye:""};async function d(l,f){let p=s.el("dialog","afs-product-modal",{id:f});p.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${a.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
              ${Lang.labels.loadingProduct}
            </div>
          </div>
        </div>
      `;let v=`${t.Shopify&&t.Shopify.routes&&t.Shopify.routes.root||"/"}products/${l}.js`;try{let C=await fetch(v);if(!C.ok)throw new Error("Failed to load product");let P=await C.json();if(!P.variants||!Array.isArray(P.variants))throw new Error("Invalid product data structure");let w=P.variants.find(F=>F.available)||P.variants[0],L=w?w.id:null,x=()=>{if(!P.variants||P.variants.length===0)return"";if(P.variants.length===1){let k=P.variants[0].title;if(k&&s.equals(k,SpecialValue.DEFAULT_TITLE))return""}if(!P.options||P.options.length===0)return"";let F='<div class="afs-product-modal__variant-selector">';return P.options.forEach(($,k)=>{F+='<div class="afs-product-modal__option-group">',F+=`<label class="afs-product-modal__option-label">${$.name}</label>`,F+='<div class="afs-product-modal__option-values">',[...new Set(P.variants.map(O=>k===0?O.option1:k===1?O.option2:O.option3).filter(Boolean))].forEach(O=>{let U=P.variants.find(j=>k===0?j.option1===O:k===1?j.option2===O:j.option3===O),W=U&&U.available,G=U&&U.id===L;F+=`<button 
                class="afs-product-modal__option-value ${G?"afs-product-modal__option-value--selected":""} ${W?"":"afs-product-modal__option-value--unavailable"}"
                data-option-index="${k}"
                data-option-value="${O}"
                data-variant-id="${U?U.id:""}"
                ${W?"":"disabled"}
                type="button"
              >${O}</button>`}),F+="</div></div>"}),F+="</div>",F},R=(()=>{if(!P.images||P.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let F='<div class="afs-slider__thumbnails">';P.images.forEach((k,z)=>{let O=z===0?"afs-slider__thumbnail--active":"",U=s.optimizeImageUrl(k,{width:100,height:100,crop:"center",format:"webp",quality:75}),G=[80,100,120].map(j=>`${s.optimizeImageUrl(k,{width:j,height:j,crop:"center",format:"webp",quality:75})} ${j}w`).join(", ");F+=`
              <div class="afs-slider__thumbnail ${O}" data-slide-index="${z}">
                <img 
                  src="${U}" 
                  srcset="${G}"
                  sizes="100px"
                  alt="${P.title} - Thumbnail ${z+1}" 
                  loading="lazy"
                  width="100"
                  height="100"
                />
              </div>
            `}),F+="</div>";let $='<div class="afs-slider__main">';return P.images.forEach((k,z)=>{let O=s.optimizeImageUrl(k,{width:800,height:800,format:"webp",quality:85}),W=[400,600,800,1e3,1200].map(G=>`${s.optimizeImageUrl(k,{width:G,height:G,format:"webp",quality:G<=600?80:85})} ${G}w`).join(", ");$+=`
              <img 
                class="afs-slider__image" 
                src="${O}" 
                srcset="${W}"
                sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
                alt="${P.title} - Image ${z+1}" 
                loading="${z===0?"eager":"lazy"}"
              />
            `}),$+="</div>",{thumbnails:F,mainImages:$}})(),E=x(),I=F=>s.formatMoney(F,i.moneyFormat||"{{amount}}",i.currency||""),T=P.variants.find(F=>F.id===L)||w,A=I(T.price),H=T.compare_at_price&&T.compare_at_price>T.price?`<span class="afs-product-modal__compare-price">${I(T.compare_at_price)}</span>`:"";p.innerHTML=`
          <div class="afs-product-modal__container">
            <div class="afs-product-modal__close-container">
              <button class="afs-product-modal__close" type="button">${a.close}</button>
            </div>
            <div class="afs-product-modal__content">
              <div class="afs-product-modal__layout">
                <div class="afs-product-modal__media">
                  <div class="afs-slider" id="${f}-slider">
                    ${R.mainImages}
                    ${R.thumbnails}
                  </div>
                </div>
                <div class="afs-product-modal__details">
                  <div class="afs-product-modal__header">
                    <div>
                      <span class="afs-product-modal__vendor">${P.vendor||""}</span>
                    </div>
                    <h1 class="afs-product-modal__title">${P.title||""}</h1>
                    <div class="afs-product-modal__price-container">
                      <span class="afs-product-modal__price">${A}</span>
                      ${H}
                    </div>
                  </div>
                  ${E}
                  <div class="afs-product-modal__buttons">
                    <div class="afs-product-modal__add-to-cart">
                      <div class="afs-product-modal__incrementor">
                        <button class="afs-product-modal__decrease" type="button">${a.minus}</button>
                        <span class="afs-product-modal__count" id="${f}-count">1</span>
                        <button class="afs-product-modal__increase" type="button">${a.plus}</button>
                      </div>
                      <button
                        class="afs-product-modal__add-button"
                        id="${f}-add-button"
                        data-variant-id="${L}"
                        ${T.available?"":"disabled"}
                        type="button"
                      >
                        ${Lang.buttons.addToCart}
                      </button>
                    </div>
                    <button
                      class="afs-product-modal__buy-button"
                      id="${f}-buy-button"
                      data-variant-id="${L}"
                      ${T.available?"":"disabled"}
                      type="button"
                    >
                      ${Lang.buttons.buyNow}
                    </button>
                  </div>
                  <div class="afs-product-modal__description">
                    <span class="afs-product-modal__description-text">
                      ${P.description||""}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,p._productData=P,p._currentVariantId=L||void 0,setTimeout(()=>{let F=p.querySelector(`#${f}-slider`);F&&t.AFSSlider&&(p._slider=new t.AFSSlider(F,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}))},100),m(p,f,P,I)}catch(C){r.error("Failed to load product for modal",{error:C instanceof Error?C.message:String(C),handle:l}),p.innerHTML=`
          <div class="afs-product-modal__container">
            <div class="afs-product-modal__close-container">
              <button class="afs-product-modal__close" type="button">${a.close}</button>
            </div>
            <div class="afs-product-modal__content">
              <div style="padding: 2rem; text-align: center;">
                <p>${Lang.messages.failedToLoadProductModal}</p>
              </div>
            </div>
          </div>
        `,c(p)}return p}function m(l,f,p,S){let v=l.querySelector(".afs-product-modal__close"),C=()=>{l._slider&&typeof l._slider.destroy=="function"&&(l._slider.destroy(),l._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),l.close?l.close():l.style.display="none"};v&&v.addEventListener("click",E=>{E.preventDefault(),E.stopPropagation(),C()}),l.addEventListener("cancel",E=>{E.preventDefault(),C()}),l.addEventListener("click",E=>{E.target===l&&C()});let P=l.querySelector(".afs-product-modal__decrease"),w=l.querySelector(".afs-product-modal__increase"),L=l.querySelector(`#${f}-count`);P&&L&&P.addEventListener("click",()=>{let E=parseInt(L.textContent||"1",10)||1;E>1&&(L.textContent=String(E-1))}),w&&L&&w.addEventListener("click",()=>{let E=parseInt(L.textContent||"1",10)||1;L.textContent=String(E+1)}),l.querySelectorAll(".afs-product-modal__option-value").forEach(E=>{E.addEventListener("click",()=>{var H;if(E.disabled)return;let I=[];p.options&&p.options.forEach((F,$)=>{let k=l.querySelector(`.afs-product-modal__option-value[data-option-index="${$}"].afs-product-modal__option-value--selected`);k&&(I[$]=k.dataset.optionValue||"")});let T=parseInt(E.dataset.optionIndex||"0",10);I[T]=E.dataset.optionValue||"",l.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${T}"]`).forEach(F=>{F.classList.remove("afs-product-modal__option-value--selected")}),E.classList.add("afs-product-modal__option-value--selected");let A=(H=p.variants)==null?void 0:H.find(F=>p.options?p.options.every(($,k)=>k===0?F.option1===I[k]:k===1?F.option2===I[k]:F.option3===I[k]):!1);A&&b(l,f,A,S)})});let M=l.querySelector(`#${f}-add-button`);M&&L&&M.addEventListener("click",async()=>{if(M.disabled)return;let E=parseInt(L.textContent||"1",10)||1,I=M.dataset.variantId;try{await n.addVariant(parseInt(I||"0",10),E),C()}catch(T){r.error("Failed to add to cart from modal",{error:T instanceof Error?T.message:String(T)}),alert(Lang.messages.failedToAddToCart)}});let R=l.querySelector(`#${f}-buy-button`);R&&L&&R.addEventListener("click",async()=>{if(R.disabled)return;let E=parseInt(L.textContent||"1",10)||1,I=R.dataset.variantId;try{let T=t.Shopify&&t.Shopify.routes&&t.Shopify.routes.root||"/";window.location.href=`${T}cart/${I}:${E}?checkout`}catch(T){r.error("Failed to buy now",{error:T instanceof Error?T.message:String(T)}),alert(Lang.messages.failedToProceedToCheckout)}})}function b(l,f,p,S){l._currentVariantId=p.id;let v=l.querySelector(".afs-product-modal__price-container");if(v){let L=S(p.price),x=p.compare_at_price&&p.compare_at_price>p.price?`<span class="afs-product-modal__compare-price">${S(p.compare_at_price)}</span>`:"";v.innerHTML=`
          <span class="afs-product-modal__price">${L}</span>
          ${x}
        `}let C=l.querySelector(`#${f}-add-button`);C&&(C.dataset.variantId=String(p.id),C.disabled=!p.available,C.innerHTML=Lang.buttons.addToCart);let P=l.querySelector(`#${f}-buy-button`);P&&(P.dataset.variantId=String(p.id),P.disabled=!p.available);let w=l._productData;if(w&&w.images&&l._slider&&w.variants){let L=p.id,x=null;if(p.featured_image&&typeof p.featured_image=="object"&&p.featured_image.variant_ids){let E=p.featured_image.position;if(E!=null){let I=E-1;I>=0&&I<w.images.length&&(l._slider.currentIndex||0)!==I&&(x=I)}}else for(let E of w.variants)if(E.featured_image&&typeof E.featured_image=="object"&&E.featured_image.variant_ids&&E.featured_image.variant_ids.includes(Number(L))){let I=E.featured_image.position;if(I!=null){let T=I-1;if(T>=0&&T<w.images.length&&(l._slider.currentIndex||0)!==T){x=T;break}}}if(x!==null&&l._slider.goToSlide){l._slider.goToSlide(x);return}if(l._slider.updateVariantImage&&w.images&&l._slider.updateVariantImage(p,w.images,w.variants))return;let M=null,R=null;if(p.featured_image&&(typeof p.featured_image=="object"?(M=p.featured_image.src||p.featured_image.url||null,R=p.featured_image.position||null):typeof p.featured_image=="string"&&(M=p.featured_image)),M||(M=(typeof p.image=="string"?p.image:null)||p.imageUrl||p.image&&typeof p.image=="object"&&(p.image.url||p.image.src)||null||p.featuredImage&&typeof p.featuredImage=="object"&&(p.featuredImage.url||p.featuredImage.src)||null),M&&w.images&&l._slider.goToSlide){let E=A=>A?(typeof A=="string"?A:A&&typeof A=="object"&&(A.url||A.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(R!=null){let A=R-1;if(A>=0&&A<w.images.length){l._slider.goToSlide(A);return}}let I=E(M),T=w.images.findIndex(A=>{let H=E(A);return H===I||H.includes(I)||I.includes(H)});if(T!==-1)l._slider.goToSlide(T);else{let A=I.split("/").pop();if(A){let H=w.images.findIndex(F=>E(F).split("/").pop()===A);H!==-1&&l._slider.goToSlide&&l._slider.goToSlide(H)}}}}}function c(l){let f=l.querySelector(".afs-product-modal__close"),p=()=>{l._slider&&typeof l._slider.destroy=="function"&&(l._slider.destroy(),l._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),l.close?l.close():l.style.display="none"};f&&f.addEventListener("click",p),l.addEventListener("cancel",p),l.addEventListener("click",S=>{S.target===l&&p()})}function g(l){if(!l.handle)return null;let f=s.el("button","afs-product-card__quick-view",{"data-product-handle":l.handle,"data-product-id":String(l.id||l.productId||l.gid||""),"aria-label":Lang.buttons.quickView,type:"button"}),p=s.el("span","afs-product-card__quick-view-icon");return p.innerHTML=a.eye,f.appendChild(p),f}function h(l){if(!l)return;let f=`product-modal-${l}`,p=document.getElementById(f);(async()=>{p||(p=await d(l,f),document.body.appendChild(p)),p.showModal?(document.body.style.overflow="hidden",p.showModal()):(document.body.style.overflow="hidden",p.style.display="block");let v=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};p.addEventListener("close",v,{once:!0});let C=new MutationObserver(()=>{p&&!p.open&&!p.hasAttribute("open")&&(v(),C.disconnect())});p&&C.observe(p,{attributes:!0,attributeFilter:["open"]})})().catch(v=>{r.error("Failed to open product modal",{error:v instanceof Error?v.message:String(v),handle:l}),alert(Lang.messages.failedToLoadProductModal)})}typeof window!="undefined"&&(window.AFSQuickView={createQuickViewButton:g,handleQuickViewClick:h,createProductModal:d})})();var Y=class{constructor(i,r={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.magnifierZoom=3;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let n=typeof i=="string"?document.querySelector(i):i;if(!n)throw console.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=n,this.options={thumbnailsPosition:r.thumbnailsPosition||"left",enableKeyboard:r.enableKeyboard!==!1,enableAutoHeight:r.enableAutoHeight!==!1,maxHeight:r.maxHeight||null,animationDuration:r.animationDuration||300,enableMagnifier:r.enableMagnifier!==!1,magnifierZoom:r.magnifierZoom||3,...r},this.magnifierEnabled=this.options.enableMagnifier,this.magnifierZoom=this.options.magnifierZoom,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){console.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){console.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let i=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(i),this.images.length===0){console.error("AFSSlider: No images found");return}let r=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(r),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(n){console.error("AFSSlider: Error building slider structure",n);return}try{this.setupEvents()}catch(n){console.error("AFSSlider: Error setting up events",n)}if(this.magnifierEnabled&&!this.isTouchDevice)try{this.setupPanZoom()}catch(n){console.error("AFSSlider: Error setting up pan-zoom",n)}try{this.goToSlide(0)}catch(n){console.error("AFSSlider: Error showing first slide",n)}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let n=document.createElement("div");n.className="afs-slider__viewport",this.images.forEach(s=>{n.appendChild(s)}),this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let n=document.createElement("button");n.type="button",n.className="afs-slider__prev",n.setAttribute("aria-label","Previous image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__next")){let n=document.createElement("button");n.type="button",n.className="afs-slider__next",n.setAttribute("aria-label","Next image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(n)}this.thumbnails.forEach((n,s)=>{n.addEventListener("click",()=>{this.goToSlide(s)})});let i=this.mainContainer.querySelector(".afs-slider__prev"),r=this.mainContainer.querySelector(".afs-slider__next");i&&i.addEventListener("click",()=>this.prevSlide()),r&&r.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=i=>{var n;if(!this.isInitialized)return;let r=this.container.getBoundingClientRect();if(!(r.width===0||r.height===0))switch(i.key){case"ArrowLeft":i.preventDefault(),this.prevSlide();break;case"ArrowRight":i.preventDefault(),this.nextSlide();break;case"Escape":let s=this.images[this.currentIndex],a=(n=this.mainContainer)==null?void 0:n.querySelector(".afs-slider__viewport");s&&a&&(s.style.transform="scale(1) translate(0, 0)",s.style.transition="transform 0.2s ease-out");break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let i=0,r=0,n=!1,s=this.mainContainer.querySelector(".afs-slider__viewport");s&&(s.addEventListener("touchstart",a=>{i=a.touches[0].clientX,r=a.touches[0].clientY,n=!0},{passive:!0}),s.addEventListener("touchmove",a=>{n&&a.preventDefault()},{passive:!1}),s.addEventListener("touchend",a=>{if(!n)return;n=!1;let d=a.changedTouches[0].clientX,m=a.changedTouches[0].clientY,b=i-d,c=r-m;Math.abs(b)>Math.abs(c)&&Math.abs(b)>50&&(b>0?this.nextSlide():this.prevSlide())},{passive:!0}))}setupPanZoom(){if(!this.mainContainer)return;let i=this.mainContainer.querySelector(".afs-slider__viewport");if(!i)return;i.classList.add("afs-slider__viewport--zoomable");let r=this.magnifierZoom||3;i.addEventListener("mousemove",n=>{let s=this.images[this._currentIndex];if(!s)return;let a=i.getBoundingClientRect(),d=n.clientX-a.left,m=n.clientY-a.top,b=d/a.width,c=m/a.height,g=-b*(s.offsetWidth*r-a.width),h=-c*(s.offsetHeight*r-a.height);s.style.transform=`
        scale(${r})
        translate(${g/r}px, ${h/r}px)
      `}),i.addEventListener("mouseenter",()=>{let n=this.images[this._currentIndex];n&&(n.style.transition="transform 0.05s ease-out")}),i.addEventListener("mouseleave",()=>{let n=this.images[this.currentIndex];n&&(n.style.transform="scale(1) translate(0, 0)",n.style.transition="transform 0.2s ease-out")})}goToSlide(i){if(i<0||i>=this.images.length)return;this._currentIndex=i,this.images.forEach((n,s)=>{s===i?(n.classList.add("afs-slider__image--active"),n.style.display="block"):(n.classList.remove("afs-slider__image--active"),n.style.display="none")});let r=this.images[this._currentIndex];r&&(r.style.transform="scale(1) translate(0, 0)",r.style.transition="transform 0.2s ease-out"),this.thumbnails.forEach((n,s)=>{n.classList.toggle("afs-slider__thumbnail--active",s===i)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:i,total:this.images.length}}))}prevSlide(){let i=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(i)}nextSlide(){let i=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(i)}adjustHeight(){let i=this.images[this._currentIndex];i&&(i.complete?this.setHeight(i):i.addEventListener("load",()=>{this.setHeight(i)},{once:!0}))}setHeight(i){if(!this.mainContainer)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r)return;if(this.options.maxHeight){r.style.height=`${this.options.maxHeight}px`,r.style.minHeight=`${this.options.maxHeight}px`,r.style.maxHeight=`${this.options.maxHeight}px`;return}let n=i.naturalHeight||i.offsetHeight,s=i.naturalWidth||i.offsetWidth,a=this.mainContainer.offsetWidth,d=n/s,m=a*d;r.style.height=`${m}px`,r.style.minHeight=`${m}px`}updateVariantImage(i,r,n){var g;if(!i||!r||!Array.isArray(r)||r.length===0)return!1;let s=i.id;if(n&&Array.isArray(n)){if(i.featured_image&&typeof i.featured_image=="object"&&i.featured_image.variant_ids){let h=i.featured_image.position;if(h!=null){let l=h-1;if(l>=0&&l<this.images.length&&l<r.length)return this._currentIndex!==l&&this.goToSlide(l),!0}}for(let h of n)if(h.featured_image&&typeof h.featured_image=="object"&&h.featured_image.variant_ids&&h.featured_image.variant_ids.includes(Number(s))){let l=h.featured_image.position;if(l!=null){let f=l-1;if(f>=0&&f<this.images.length&&f<r.length)return this._currentIndex!==f&&this.goToSlide(f),!0}}}let a=null,d=null;if(i.featured_image&&(typeof i.featured_image=="object"?(a=i.featured_image.src||i.featured_image.url||null,d=(g=i.featured_image.position)!=null?g:null):typeof i.featured_image=="string"&&(a=i.featured_image)),a||(typeof i.image=="string"?a=i.image:i.image&&typeof i.image=="object"?a=i.image.url||i.image.src||null:i.imageUrl?a=i.imageUrl:i.featuredImage&&typeof i.featuredImage=="object"&&(a=i.featuredImage.url||i.featuredImage.src||null)),!a)return!1;let m=h=>h?(typeof h=="string"?h:(h==null?void 0:h.url)||(h==null?void 0:h.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",b=m(a);if(d!=null){let h=d-1;if(h>=0&&h<this.images.length&&h<r.length)return this._currentIndex!==h&&this.goToSlide(h),!0}let c=r.findIndex(h=>{let l=m(h);return l===b||l.includes(b)||b.includes(l)});if(c===-1){let h=b.split("/").pop();c=r.findIndex(l=>m(l).split("/").pop()===h)}return c!==-1&&c<this.images.length?(this._currentIndex!==c&&this.goToSlide(c),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(i=>{i.style.transform="scale(1) translate(0, 0)",i.style.transition="transform 0.2s ease-out"}),this.isInitialized=!1}};window.AFSSlider=Y;
