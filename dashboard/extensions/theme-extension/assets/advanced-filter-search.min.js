"use strict";var z=class{constructor(r,i={}){this._currentIndex=0;this.images=[];this.thumbnails=[];this.isInitialized=!1;this.magnifierEnabled=!1;this.magnifierZoom=3;this.isTouchDevice=!1;this.mainContainer=null;this.thumbnailContainer=null;this.keyboardHandler=null;let n=typeof r=="string"?document.querySelector(r):r;if(!n)throw console.error("AFSSlider: Container not found"),new Error("AFSSlider: Container not found");this.container=n,this.options={thumbnailsPosition:i.thumbnailsPosition||"left",enableKeyboard:i.enableKeyboard!==!1,enableAutoHeight:i.enableAutoHeight!==!1,maxHeight:i.maxHeight||null,animationDuration:i.animationDuration||300,enableMagnifier:i.enableMagnifier!==!1,magnifierZoom:i.magnifierZoom||3,...i},this.magnifierEnabled=this.options.enableMagnifier,this.magnifierZoom=this.options.magnifierZoom,this.isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}get currentIndex(){return this._currentIndex}init(){if(this.mainContainer=this.container.querySelector(".afs-slider__main"),!this.mainContainer){console.error("AFSSlider: Main container (.afs-slider__main) not found");return}if(this.thumbnailContainer=this.container.querySelector(".afs-slider__thumbnails"),!this.thumbnailContainer){console.error("AFSSlider: Thumbnail container (.afs-slider__thumbnails) not found");return}let r=this.mainContainer.querySelectorAll(".afs-slider__image");if(this.images=Array.from(r),this.images.length===0){console.error("AFSSlider: No images found");return}let i=this.thumbnailContainer.querySelectorAll(".afs-slider__thumbnail");this.thumbnails=Array.from(i),this.container.setAttribute("data-thumbnails-position",this.options.thumbnailsPosition);try{this.buildSlider()}catch(n){console.error("AFSSlider: Error building slider structure",n);return}try{this.setupEvents()}catch(n){console.error("AFSSlider: Error setting up events",n)}if(this.magnifierEnabled&&!this.isTouchDevice)try{this.setupPanZoom()}catch(n){console.error("AFSSlider: Error setting up pan-zoom",n)}try{this.goToSlide(0)}catch(n){console.error("AFSSlider: Error showing first slide",n)}this.isInitialized=!0}buildSlider(){if(!this.mainContainer)return;if(!this.mainContainer.querySelector(".afs-slider__viewport")){let n=document.createElement("div");n.className="afs-slider__viewport",this.images.forEach(s=>{n.appendChild(s)}),this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__prev")){let n=document.createElement("button");n.type="button",n.className="afs-slider__prev",n.setAttribute("aria-label","Previous image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',this.mainContainer.appendChild(n)}if(!this.mainContainer.querySelector(".afs-slider__next")){let n=document.createElement("button");n.type="button",n.className="afs-slider__next",n.setAttribute("aria-label","Next image"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>',this.mainContainer.appendChild(n)}this.thumbnails.forEach((n,s)=>{n.addEventListener("click",()=>{this.goToSlide(s)})});let r=this.mainContainer.querySelector(".afs-slider__prev"),i=this.mainContainer.querySelector(".afs-slider__next");r&&r.addEventListener("click",()=>this.prevSlide()),i&&i.addEventListener("click",()=>this.nextSlide())}setupEvents(){this.options.enableKeyboard&&(this.keyboardHandler=r=>{var n;if(!this.isInitialized)return;let i=this.container.getBoundingClientRect();if(!(i.width===0||i.height===0))switch(r.key){case"ArrowLeft":r.preventDefault(),this.prevSlide();break;case"ArrowRight":r.preventDefault(),this.nextSlide();break;case"Escape":let s=this.images[this.currentIndex],a=(n=this.mainContainer)==null?void 0:n.querySelector(".afs-slider__viewport");s&&a&&(s.style.transform="scale(1) translate(0, 0)",s.style.transition="transform 0.2s ease-out");break}},document.addEventListener("keydown",this.keyboardHandler)),this.setupTouchEvents(),this.options.enableAutoHeight&&(this.adjustHeight(),window.addEventListener("resize",()=>this.adjustHeight()))}setupTouchEvents(){if(!this.mainContainer)return;let r=0,i=0,n=!1,s=this.mainContainer.querySelector(".afs-slider__viewport");s&&(s.addEventListener("touchstart",a=>{r=a.touches[0].clientX,i=a.touches[0].clientY,n=!0},{passive:!0}),s.addEventListener("touchmove",a=>{n&&a.preventDefault()},{passive:!1}),s.addEventListener("touchend",a=>{if(!n)return;n=!1;let l=a.changedTouches[0].clientX,p=a.changedTouches[0].clientY,b=r-l,d=i-p;Math.abs(b)>Math.abs(d)&&Math.abs(b)>50&&(b>0?this.nextSlide():this.prevSlide())},{passive:!0}))}setupPanZoom(){if(!this.mainContainer)return;let r=this.mainContainer.querySelector(".afs-slider__viewport");if(!r)return;r.classList.add("afs-slider__viewport--zoomable");let i=this.magnifierZoom||3;r.addEventListener("mousemove",n=>{let s=this.images[this._currentIndex];if(!s)return;let a=r.getBoundingClientRect(),l=n.clientX-a.left,p=n.clientY-a.top,b=l/a.width,d=p/a.height,c=-b*(s.offsetWidth*i-a.width),m=-d*(s.offsetHeight*i-a.height);s.style.transform=`
        scale(${i})
        translate(${c/i}px, ${m/i}px)
      `}),r.addEventListener("mouseenter",()=>{let n=this.images[this._currentIndex];n&&(n.style.transition="transform 0.05s ease-out")}),r.addEventListener("mouseleave",()=>{let n=this.images[this.currentIndex];n&&(n.style.transform="scale(1) translate(0, 0)",n.style.transition="transform 0.2s ease-out")})}goToSlide(r){if(r<0||r>=this.images.length)return;this._currentIndex=r,this.images.forEach((n,s)=>{s===r?(n.classList.add("afs-slider__image--active"),n.style.display="block"):(n.classList.remove("afs-slider__image--active"),n.style.display="none")});let i=this.images[this._currentIndex];i&&(i.style.transform="scale(1) translate(0, 0)",i.style.transition="transform 0.2s ease-out"),this.thumbnails.forEach((n,s)=>{n.classList.toggle("afs-slider__thumbnail--active",s===r)}),this.options.enableAutoHeight&&this.adjustHeight(),this.container.dispatchEvent(new CustomEvent("afs-slider:slide-change",{detail:{index:r,total:this.images.length}}))}prevSlide(){let r=this._currentIndex>0?this._currentIndex-1:this.images.length-1;this.goToSlide(r)}nextSlide(){let r=this._currentIndex<this.images.length-1?this._currentIndex+1:0;this.goToSlide(r)}adjustHeight(){let r=this.images[this._currentIndex];r&&(r.complete?this.setHeight(r):r.addEventListener("load",()=>{this.setHeight(r)},{once:!0}))}setHeight(r){if(!this.mainContainer)return;let i=this.mainContainer.querySelector(".afs-slider__viewport");if(!i)return;if(this.options.maxHeight){i.style.height=`${this.options.maxHeight}px`,i.style.minHeight=`${this.options.maxHeight}px`,i.style.maxHeight=`${this.options.maxHeight}px`;return}let n=r.naturalHeight||r.offsetHeight,s=r.naturalWidth||r.offsetWidth,a=this.mainContainer.offsetWidth,l=n/s,p=a*l;i.style.height=`${p}px`,i.style.minHeight=`${p}px`}updateVariantImage(r,i,n){var c;if(!r||!i||!Array.isArray(i)||i.length===0)return!1;let s=r.id;if(n&&Array.isArray(n)){if(r.featured_image&&typeof r.featured_image=="object"&&r.featured_image.variant_ids){let m=r.featured_image.position;if(m!=null){let u=m-1;if(u>=0&&u<this.images.length&&u<i.length)return this._currentIndex!==u&&this.goToSlide(u),!0}}for(let m of n)if(m.featured_image&&typeof m.featured_image=="object"&&m.featured_image.variant_ids&&m.featured_image.variant_ids.includes(Number(s))){let u=m.featured_image.position;if(u!=null){let h=u-1;if(h>=0&&h<this.images.length&&h<i.length)return this._currentIndex!==h&&this.goToSlide(h),!0}}}let a=null,l=null;if(r.featured_image&&(typeof r.featured_image=="object"?(a=r.featured_image.src||r.featured_image.url||null,l=(c=r.featured_image.position)!=null?c:null):typeof r.featured_image=="string"&&(a=r.featured_image)),a||(typeof r.image=="string"?a=r.image:r.image&&typeof r.image=="object"?a=r.image.url||r.image.src||null:r.imageUrl?a=r.imageUrl:r.featuredImage&&typeof r.featuredImage=="object"&&(a=r.featuredImage.url||r.featuredImage.src||null)),!a)return!1;let p=m=>m?(typeof m=="string"?m:(m==null?void 0:m.url)||(m==null?void 0:m.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"",b=p(a);if(l!=null){let m=l-1;if(m>=0&&m<this.images.length&&m<i.length)return this._currentIndex!==m&&this.goToSlide(m),!0}let d=i.findIndex(m=>{let u=p(m);return u===b||u.includes(b)||b.includes(u)});if(d===-1){let m=b.split("/").pop();d=i.findIndex(u=>p(u).split("/").pop()===m)}return d!==-1&&d<this.images.length?(this._currentIndex!==d&&this.goToSlide(d),!0):!1}destroy(){this.keyboardHandler&&(document.removeEventListener("keydown",this.keyboardHandler),this.keyboardHandler=null),this.images.forEach(r=>{r.style.transform="scale(1) translate(0, 0)",r.style.transition="transform 0.2s ease-out"}),this.isInitialized=!1}},x=window;function W(){return{State:x.AFS_State||{moneyFormat:null,currency:null},Log:x.AFS_LOG||{error:()=>{},warn:()=>{},info:()=>{},debug:()=>{},log:()=>{},init:()=>{}},QuickAdd:x.QuickAdd||{add:async()=>{},addFromForm:async()=>{},addVariant:async()=>{},showSuccess:()=>{}},$:x.$||{debounce:()=>()=>{},toLowerCase:()=>"",inputDisplayType:()=>"checkbox",isMultiSelect:()=>!1,split:()=>[],id:()=>null,str:()=>"",empty:()=>!0,el:()=>document.createElement("div"),txt:()=>document.createElement("div"),clear:()=>{},frag:()=>document.createDocumentFragment(),optimizeImageUrl:()=>"",buildImageSrcset:()=>"",formatMoney:()=>"",equals:()=>!1,equalsAny:()=>!1,isVendorKey:()=>!1,isProductTypeKey:()=>!1,isTagKey:()=>!1,isCollectionKey:()=>!1,isPriceRangeKey:()=>!1,isBestSelling:()=>!1,isCollectionOptionType:()=>!1,isPriceRangeOptionType:()=>!1},Icons:x.Icons||{rightArrow:"",downArrow:"",close:"",minus:"",plus:"",eye:""},Lang:x.Lang||{buttons:{quickAdd:"",quickAddToCart:"",quickView:"",addToCart:"",buyNow:"",clear:"",clearAll:"",close:"",closeFilters:"",toggleFilters:"",filters:"",previous:"",next:"",apply:""},labels:{sortBy:"",appliedFilters:"",search:"",price:"",collection:"",productUnavailable:"",loading:"",loadingProduct:""},sortOptions:{bestSelling:"",titleAsc:"",titleDesc:"",priceAsc:"",priceDesc:"",createdAsc:"",createdDesc:""},messages:{noProductsFound:"",oneProductFound:"",productsFound:"",showingProducts:"",pageOf:"",addedToCart:"",failedToLoad:"",failedToLoadProducts:"",failedToLoadProduct:"",failedToAddToCart:"",failedToProceedToCheckout:"",failedToLoadProductModal:"",failedToLoadFilters:"",initializationFailed:"",loadFailed:"",unknownError:"",checkConsole:""},placeholders:{searchProducts:"",searchFilter:""}},SpecialValue:x.SpecialValue||{DEFAULT_TITLE:"Default Title"}}}async function X(e,r){let i=W(),{State:n,Log:s,QuickAdd:a,$:l,Icons:p,Lang:b,SpecialValue:d}=i,c=l.el("dialog","afs-product-modal",{id:r});c.innerHTML=`
      <div class="afs-product-modal__container">
        <div class="afs-product-modal__close-container">
          <button class="afs-product-modal__close" type="button">${p.close}</button>
        </div>
        <div class="afs-product-modal__content">
          <div class="afs-product-modal__loading" style="padding: 2rem; text-align: center;">
            ${b.labels.loadingProduct}
          </div>
        </div>
      </div>
    `;let u=`${x.Shopify&&x.Shopify.routes&&x.Shopify.routes.root||"/"}products/${e}.js`;try{let h=await fetch(u);if(!h.ok)throw new Error("Failed to load product");let g=await h.json();if(!g.variants||!Array.isArray(g.variants))throw new Error("Invalid product data structure");let S=g.variants.find(w=>w.available)||g.variants[0],v=S?S.id:null,C=()=>{if(!g.variants||g.variants.length===0)return"";if(g.variants.length===1){let E=g.variants[0].title;if(E&&l.equals(E,d.DEFAULT_TITLE))return""}if(!g.options||g.options.length===0)return"";let w='<div class="afs-product-modal__variant-selector">';return g.options.forEach((D,E)=>{w+='<div class="afs-product-modal__option-group">',w+=`<label class="afs-product-modal__option-label">${D.name}</label>`,w+='<div class="afs-product-modal__option-values">',[...new Set(g.variants.map(I=>E===0?I.option1:E===1?I.option2:I.option3).filter(Boolean))].forEach(I=>{let $=g.variants.find(U=>E===0?U.option1===I:E===1?U.option2===I:U.option3===I),G=$&&$.available,V=$&&$.id===v;w+=`<button 
              class="afs-product-modal__option-value ${V?"afs-product-modal__option-value--selected":""} ${G?"":"afs-product-modal__option-value--unavailable"}"
              data-option-index="${E}"
              data-option-value="${I}"
              data-variant-id="${$?$.id:""}"
              ${G?"":"disabled"}
              type="button"
            >${I}</button>`}),w+="</div></div>"}),w+="</div>",w},T=(()=>{if(!g.images||g.images.length===0)return{thumbnails:"",mainImages:'<div class="afs-slider__main"><div style="padding: 2rem; text-align: center;">No images available</div></div>'};let w='<div class="afs-slider__thumbnails">';g.images.forEach((E,M)=>{let I=M===0?"afs-slider__thumbnail--active":"",$=l.optimizeImageUrl(E,{width:100,height:100,crop:"center",format:"webp",quality:75}),V=[80,100,120].map(U=>`${l.optimizeImageUrl(E,{width:U,height:U,crop:"center",format:"webp",quality:75})} ${U}w`).join(", ");w+=`
            <div class="afs-slider__thumbnail ${I}" data-slide-index="${M}">
              <img 
                src="${$}" 
                srcset="${V}"
                sizes="100px"
                alt="${g.title} - Thumbnail ${M+1}" 
                loading="lazy"
                width="100"
                height="100"
              />
            </div>
          `}),w+="</div>";let D='<div class="afs-slider__main">';return g.images.forEach((E,M)=>{let I=l.optimizeImageUrl(E,{width:800,height:800,format:"webp",quality:85}),G=[400,600,800,1e3,1200].map(V=>`${l.optimizeImageUrl(E,{width:V,height:V,format:"webp",quality:V<=600?80:85})} ${V}w`).join(", ");D+=`
            <img 
              class="afs-slider__image" 
              src="${I}" 
              srcset="${G}"
              sizes="(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 600px"
              alt="${g.title} - Image ${M+1}" 
              loading="${M===0?"eager":"lazy"}"
            />
          `}),D+="</div>",{thumbnails:w,mainImages:D}})(),L=C(),A=w=>l.formatMoney(w,n.moneyFormat||"{{amount}}",n.currency||""),F=g.variants.find(w=>w.id===v)||S,k=A(F.price),j=F.compare_at_price&&F.compare_at_price>F.price?`<span class="afs-product-modal__compare-price">${A(F.compare_at_price)}</span>`:"";c.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${p.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div class="afs-product-modal__layout">
              <div class="afs-product-modal__media">
                <div class="afs-slider" id="${r}-slider">
                  ${T.mainImages}
                  ${T.thumbnails}
                </div>
              </div>
              <div class="afs-product-modal__details">
                <div class="afs-product-modal__header">
                  <div>
                    <span class="afs-product-modal__vendor">${g.vendor||""}</span>
                  </div>
                  <h1 class="afs-product-modal__title">${g.title||""}</h1>
                  <div class="afs-product-modal__price-container">
                    <span class="afs-product-modal__price">${k}</span>
                    ${j}
                  </div>
                </div>
                ${L}
                <div class="afs-product-modal__buttons">
                  <div class="afs-product-modal__add-to-cart">
                    <div class="afs-product-modal__incrementor">
                      <button class="afs-product-modal__decrease" type="button">${p.minus}</button>
                      <span class="afs-product-modal__count" id="${r}-count">1</span>
                      <button class="afs-product-modal__increase" type="button">${p.plus}</button>
                    </div>
                    <button
                      class="afs-product-modal__add-button"
                      id="${r}-add-button"
                      data-variant-id="${v}"
                      ${F.available?"":"disabled"}
                      type="button"
                    >
                      ${b.buttons.addToCart}
                    </button>
                  </div>
                  <button
                    class="afs-product-modal__buy-button"
                    id="${r}-buy-button"
                    data-variant-id="${v}"
                    ${F.available?"":"disabled"}
                    type="button"
                  >
                    ${b.buttons.buyNow}
                  </button>
                </div>
                <div class="afs-product-modal__description">
                  <span class="afs-product-modal__description-text">
                    ${g.description||""}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `,c._productData=g,c._currentVariantId=v||void 0,setTimeout(()=>{let w=c.querySelector(`#${r}-slider`);w&&(c._slider=new z(w,{thumbnailsPosition:"left",enableKeyboard:!0,enableAutoHeight:!1,maxHeight:600,enableMagnifier:!0,magnifierZoom:2}))},100),re(c,r,g,A,i)}catch(h){let g=W(),{Log:S,Icons:v,Lang:C}=g;S.error("Failed to load product for modal",{error:h instanceof Error?h.message:String(h),handle:e}),c.innerHTML=`
        <div class="afs-product-modal__container">
          <div class="afs-product-modal__close-container">
            <button class="afs-product-modal__close" type="button">${v.close}</button>
          </div>
          <div class="afs-product-modal__content">
            <div style="padding: 2rem; text-align: center;">
              <p>${C.messages.failedToLoadProductModal}</p>
            </div>
          </div>
        </div>
      `,ae(c,g)}return c}function re(e,r,i,n,s){let{Log:a,QuickAdd:l,Lang:p}=s,b=e.querySelector(".afs-product-modal__close"),d=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};b&&b.addEventListener("click",v=>{v.preventDefault(),v.stopPropagation(),d()}),e.addEventListener("cancel",v=>{v.preventDefault(),d()}),e.addEventListener("click",v=>{v.target===e&&d()});let c=e.querySelector(".afs-product-modal__decrease"),m=e.querySelector(".afs-product-modal__increase"),u=e.querySelector(`#${r}-count`);c&&u&&c.addEventListener("click",()=>{let v=parseInt(u.textContent||"1",10)||1;v>1&&(u.textContent=String(v-1))}),m&&u&&m.addEventListener("click",()=>{let v=parseInt(u.textContent||"1",10)||1;u.textContent=String(v+1)}),e.querySelectorAll(".afs-product-modal__option-value").forEach(v=>{v.addEventListener("click",()=>{var L;if(v.disabled)return;let C=[];i.options&&i.options.forEach((A,F)=>{let k=e.querySelector(`.afs-product-modal__option-value[data-option-index="${F}"].afs-product-modal__option-value--selected`);k&&(C[F]=k.dataset.optionValue||"")});let _=parseInt(v.dataset.optionIndex||"0",10);C[_]=v.dataset.optionValue||"",e.querySelectorAll(`.afs-product-modal__option-value[data-option-index="${_}"]`).forEach(A=>{A.classList.remove("afs-product-modal__option-value--selected")}),v.classList.add("afs-product-modal__option-value--selected");let T=(L=i.variants)==null?void 0:L.find(A=>i.options?i.options.every((F,k)=>k===0?A.option1===C[k]:k===1?A.option2===C[k]:A.option3===C[k]):!1);T&&ne(e,r,T,n,s)})});let g=e.querySelector(`#${r}-add-button`);g&&u&&g.addEventListener("click",async()=>{if(g.disabled)return;let v=parseInt(u.textContent||"1",10)||1,C=g.dataset.variantId;try{await l.addVariant(parseInt(C||"0",10),v),d()}catch(_){a.error("Failed to add to cart from modal",{error:_ instanceof Error?_.message:String(_)}),alert(p.messages.failedToAddToCart)}});let S=e.querySelector(`#${r}-buy-button`);S&&u&&S.addEventListener("click",async()=>{if(S.disabled)return;let v=parseInt(u.textContent||"1",10)||1,C=S.dataset.variantId;try{let _=x.Shopify&&x.Shopify.routes&&x.Shopify.routes.root||"/";window.location.href=`${_}cart/${C}:${v}?checkout`}catch(_){a.error("Failed to buy now",{error:_ instanceof Error?_.message:String(_)}),alert(p.messages.failedToProceedToCheckout)}})}function ne(e,r,i,n,s){let{Lang:a}=s;e._currentVariantId=i.id;let l=e.querySelector(".afs-product-modal__price-container");if(l){let c=n(i.price),m=i.compare_at_price&&i.compare_at_price>i.price?`<span class="afs-product-modal__compare-price">${n(i.compare_at_price)}</span>`:"";l.innerHTML=`
        <span class="afs-product-modal__price">${c}</span>
        ${m}
      `}let p=e.querySelector(`#${r}-add-button`);p&&(p.dataset.variantId=String(i.id),p.disabled=!i.available,p.innerHTML=a.buttons.addToCart);let b=e.querySelector(`#${r}-buy-button`);b&&(b.dataset.variantId=String(i.id),b.disabled=!i.available);let d=e._productData;if(d&&d.images&&e._slider&&d.variants){let c=i.id,m=null;if(i.featured_image&&typeof i.featured_image=="object"&&i.featured_image.variant_ids){let g=i.featured_image.position;if(g!=null){let S=g-1;S>=0&&S<d.images.length&&(e._slider.currentIndex||0)!==S&&(m=S)}}else for(let g of d.variants)if(g.featured_image&&typeof g.featured_image=="object"&&g.featured_image.variant_ids&&g.featured_image.variant_ids.includes(Number(c))){let S=g.featured_image.position;if(S!=null){let v=S-1;if(v>=0&&v<d.images.length&&(e._slider.currentIndex||0)!==v){m=v;break}}}if(m!==null&&e._slider.goToSlide){e._slider.goToSlide(m);return}if(e._slider.updateVariantImage&&d.images&&e._slider.updateVariantImage(i,d.images,d.variants))return;let u=null,h=null;if(i.featured_image&&(typeof i.featured_image=="object"?(u=i.featured_image.src||i.featured_image.url||null,h=i.featured_image.position||null):typeof i.featured_image=="string"&&(u=i.featured_image)),u||(u=(typeof i.image=="string"?i.image:null)||i.imageUrl||i.image&&typeof i.image=="object"&&(i.image.url||i.image.src)||null||i.featuredImage&&typeof i.featuredImage=="object"&&(i.featuredImage.url||i.featuredImage.src)||null),u&&d.images&&e._slider.goToSlide){let g=C=>C?(typeof C=="string"?C:C&&typeof C=="object"&&(C.url||C.src)||"").replace(/^https?:\/\//,"").replace(/^\/\//,"").split("?")[0].toLowerCase().trim():"";if(h!=null){let C=h-1;if(C>=0&&C<d.images.length){e._slider.goToSlide(C);return}}let S=g(u),v=d.images.findIndex(C=>{let _=g(C);return _===S||_.includes(S)||S.includes(_)});if(v!==-1)e._slider.goToSlide(v);else{let C=S.split("/").pop();if(C){let _=d.images.findIndex(T=>g(T).split("/").pop()===C);_!==-1&&e._slider.goToSlide&&e._slider.goToSlide(_)}}}}}function ae(e,r){let i=e.querySelector(".afs-product-modal__close"),n=()=>{e._slider&&typeof e._slider.destroy=="function"&&(e._slider.destroy(),e._slider=void 0),document.body.style.overflow="",document.body.style.removeProperty("overflow"),e.close?e.close():e.style.display="none"};i&&i.addEventListener("click",n),e.addEventListener("cancel",n),e.addEventListener("click",s=>{s.target===e&&n()})}function Q(e){let r=W(),{$:i,Icons:n,Lang:s}=r;if(!e.handle)return null;let a=i.el("button","afs-product-card__quick-view",{"data-product-handle":e.handle,"data-product-id":String(e.id||e.productId||e.gid||""),"aria-label":s.buttons.quickView,type:"button"}),l=i.el("span","afs-product-card__quick-view-icon");return l.innerHTML=n.eye,a.appendChild(l),a}function Z(e){let r=W(),{Log:i,Lang:n}=r;if(!e)return;let s=`product-modal-${e}`,a=document.getElementById(s);(async()=>{a||(a=await X(e,s),document.body.appendChild(a)),a.showModal?(document.body.style.overflow="hidden",a.showModal()):(document.body.style.overflow="hidden",a.style.display="block");let p=()=>{document.body.style.overflow="",document.body.style.removeProperty("overflow")};a.addEventListener("close",p,{once:!0});let b=new MutationObserver(()=>{a&&!a.open&&!a.hasAttribute("open")&&(p(),b.disconnect())});a&&b.observe(a,{attributes:!0,attributeFilter:["open"]})})().catch(p=>{i.error("Failed to open product modal",{error:p instanceof Error?p.message:String(p),handle:e}),alert(n.messages.failedToLoadProductModal)})}typeof window!="undefined"&&(window.AFSSlider=z);typeof window!="undefined"&&(window.AFSQuickView={createQuickViewButton:Q,handleQuickViewClick:Z,createProductModal:X});var ee=(n=>(n.ALL="__all__",n.CLEAR="__clear__",n.DEFAULT_TITLE="Default Title",n))(ee||{}),q={DEBOUNCE:200,TIMEOUT:1e4,CACHE_TTL:3e5,PAGE_SIZE:24},B={rightArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.39862 4.32752C9.69152 4.03463 10.1664 4.03463 10.4593 4.32752L16.8232 10.6915C17.5067 11.3749 17.5067 12.4829 16.8232 13.1664L10.4593 19.5303C10.1664 19.8232 9.69152 19.8232 9.39863 19.5303C9.10573 19.2374 9.10573 18.7625 9.39863 18.4697L15.7626 12.1057C15.8602 12.0081 15.8602 11.8498 15.7626 11.7521L9.39863 5.38818C9.10573 5.09529 9.10573 4.62041 9.39862 4.32752Z" fill="currentColor"/></svg>',downArrow:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.46938 9.39966C4.76227 9.10677 5.23715 9.10677 5.53004 9.39966L11.894 15.7636C11.9916 15.8613 12.1499 15.8613 12.2476 15.7636L18.6115 9.39966C18.9044 9.10677 19.3793 9.10677 19.6722 9.39966C19.9651 9.69256 19.9651 10.1674 19.6722 10.4603L13.3082 16.8243C12.6248 17.5077 11.5168 17.5077 10.8333 16.8243L4.46938 10.4603C4.17649 10.1674 4.17649 9.69256 4.46938 9.39966Z" fill="currentColor"/></svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 32 32" fill="currentColor"><path d="M16.108 10.044c-3.313 0-6 2.687-6 6s2.687 6 6 6 6-2.686 6-6-2.686-6-6-6zM16.108 20.044c-2.206 0-4.046-1.838-4.046-4.044s1.794-4 4-4c2.206 0 4 1.794 4 4s-1.748 4.044-3.954 4.044zM31.99 15.768c-0.012-0.050-0.006-0.104-0.021-0.153-0.006-0.021-0.020-0.033-0.027-0.051-0.011-0.028-0.008-0.062-0.023-0.089-2.909-6.66-9.177-10.492-15.857-10.492s-13.074 3.826-15.984 10.486c-0.012 0.028-0.010 0.057-0.021 0.089-0.007 0.020-0.021 0.030-0.028 0.049-0.015 0.050-0.009 0.103-0.019 0.154-0.018 0.090-0.035 0.178-0.035 0.269s0.017 0.177 0.035 0.268c0.010 0.050 0.003 0.105 0.019 0.152 0.006 0.023 0.021 0.032 0.028 0.052 0.010 0.027 0.008 0.061 0.021 0.089 2.91 6.658 9.242 10.428 15.922 10.428s13.011-3.762 15.92-10.422c0.015-0.029 0.012-0.058 0.023-0.090 0.007-0.017 0.020-0.030 0.026-0.050 0.015-0.049 0.011-0.102 0.021-0.154 0.018-0.090 0.034-0.177 0.034-0.27 0-0.088-0.017-0.175-0.035-0.266zM16 25.019c-5.665 0-11.242-2.986-13.982-8.99 2.714-5.983 8.365-9.047 14.044-9.047 5.678 0 11.203 3.067 13.918 9.053-2.713 5.982-8.301 8.984-13.981 8.984z"/></svg>',minus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M18 10a1 1 0 01-1 1H3a1 1 0 110-2h14a1 1 0 011 1z"/></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 20 20" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M9 17a1 1 0 102 0v-6h6a1 1 0 100-2h-6V3a1 1 0 10-2 0v6H3a1 1 0 000 2h6v6z"/></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="34px" height="34px" viewBox="0 0 24 24" fill="currentColor"><path d="M19 5L4.99998 19M5.00001 5L19 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'},se=new Set(["shop","shop_domain","keep","cpid"]),P={buttons:{quickAdd:"Quick Add",quickAddToCart:"Quick add to cart",quickView:"Quick view",addToCart:"Add to cart",buyNow:"Buy it now",clear:"Clear",clearAll:"Clear All",close:"\u2715",closeFilters:"Close filters",toggleFilters:"Filters",filters:"Filters",previous:"Previous",next:"Next",apply:"Apply"},labels:{sortBy:"Sort by: ",appliedFilters:"Applied Filters:",search:"Search: ",price:"Price: ",collection:"Collection: ",productUnavailable:"Product unavailable",loading:"Loading...",loadingProduct:"Loading product..."},sortOptions:{bestSelling:"Best Selling",titleAsc:"Title (A-Z)",titleDesc:"Title (Z-A)",priceAsc:"Price (Low to High)",priceDesc:"Price (High to Low)",createdAsc:"Oldest First",createdDesc:"Newest First"},messages:{noProductsFound:"No products found",oneProductFound:"1 product found",productsFound:"products found",showingProducts:"Showing",pageOf:"Page",addedToCart:"Added to cart!",failedToLoad:"Failed to load",failedToLoadProducts:"Failed to load products",failedToLoadProduct:"Failed to load product",failedToAddToCart:"Failed to add product to cart. Please try again.",failedToProceedToCheckout:"Failed to proceed to checkout. Please try again.",failedToLoadProductModal:"Failed to load product. Please try again.",failedToLoadFilters:"Failed to load filters, continuing with empty filters",initializationFailed:"Initialization failed",loadFailed:"Load failed",unknownError:"Unknown error",checkConsole:"Check console for details."},placeholders:{searchProducts:"Search products...",searchFilter:"Search"}},o={debounce:(e,r)=>{let i;return(...n)=>{i!==void 0&&clearTimeout(i),i=setTimeout(()=>e(...n),r)}},toLowerCase:e=>String(e||"").toLowerCase(),inputDisplayType:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.displayType),"radio")?"radio":"checkbox",isMultiSelect:e=>o.equalsAny(o.toLowerCase(e==null?void 0:e.selectionType),"multiple")||o.equalsAny(e==null?void 0:e.selectionType,"MULTIPLE"),split:e=>e?Array.isArray(e)?e.map(r=>String(r).trim()).filter(Boolean):String(e).split(",").map(r=>r.trim()).filter(Boolean):[],id:e=>{if(!e)return null;let r=e.productId||e.id||e.gid;return r&&String(r).split("/").pop()||null},str:e=>String(e||"").trim(),empty:e=>e?Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1:!0,el:(e,r,i={})=>{let n=document.createElement(e);return r&&(n.className=r),Object.entries(i).forEach(([s,a])=>n.setAttribute(s,a)),n},txt:(e,r)=>(e.textContent=r,e),clear:e=>{for(;e.firstChild;){let r=e.firstChild;r&&e.removeChild(r)}},frag:(e,r)=>{let i=document.createDocumentFragment();return e.forEach(n=>i.appendChild(r(n))),i},optimizeImageUrl:(e,r={})=>{if(!e||typeof e!="string")return"";let{width:i=500,height:n=i,quality:s=80,format:a="webp",crop:l=null}=r;if(!/(cdn\.shopify\.com|shopifycdn\.com)/i.test(e))return e;try{let b=new URL(e),d=new URLSearchParams(b.search);return d.delete("width"),d.delete("height"),d.delete("crop"),d.delete("format"),d.delete("quality"),d.set("width",String(i)),d.set("height",String(n)),l&&d.set("crop",l),s!==100&&d.set("quality",String(s)),!b.pathname.toLowerCase().endsWith(".gif")&&a&&d.set("format",a),`${b.origin}${b.pathname}?${d.toString()}`}catch(b){return e}},buildImageSrcset:(e,r=[200,300,500])=>e?r.map(i=>`${o.optimizeImageUrl(e,{width:i,format:"webp",quality:i<=200?75:i<=300?80:85})} ${i}w`).join(", "):"",formatMoney:(e,r,i="")=>{if(isNaN(Number(e)))return"";let n=parseFloat(String(e))/100;if(!r||typeof r!="string")return`${i||""}${n.toFixed(2)}`;let s=n.toFixed(2);return r.includes("{{amount_no_decimals}}")?(s=Math.round(n).toString(),r.replace("{{amount_no_decimals}}",s)):r.includes("{{amount_with_comma_separator}}")?(s=n.toFixed(2).replace(".",","),r.replace("{{amount_with_comma_separator}}",s)):r.includes("{{amount_no_decimals_with_comma_separator}}")?(s=Math.round(n).toString(),r.replace("{{amount_no_decimals_with_comma_separator}}",s)):r.includes("{{amount_with_apostrophe_separator}}")?(s=n.toFixed(2).replace(".","'"),r.replace("{{amount_with_apostrophe_separator}}",s)):r.replace("{{amount}}",s)},equals:(e,r)=>e===r?!0:e==null||r===null||r===void 0?!1:(Array.isArray(e)&&(e=e.join(",")),Array.isArray(r)&&(r=r.join(",")),typeof e=="string"&&typeof r=="string"?e.trim().toLowerCase()===r.trim().toLowerCase():typeof e=="number"&&typeof r=="number"||typeof e=="boolean"&&typeof r=="boolean"?e===r:String(e).trim().toLowerCase()===String(r).trim().toLowerCase()),equalsAny:(e,...r)=>e==null?!1:r.some(i=>o.equals(e,i)),isVendorKey:e=>o.equalsAny(e,"vendor","vendors"),isProductTypeKey:e=>o.equalsAny(e,"productType","productTypes"),isTagKey:e=>o.equalsAny(e,"tag","tags"),isCollectionKey:e=>o.equalsAny(e,"collection","collections"),isPriceRangeKey:e=>o.equalsAny(e,"priceRange","price"),isBestSelling:e=>o.equalsAny(e,"best-selling","bestselling"),isCollectionOptionType:e=>o.equals(e,"Collection"),isPriceRangeOptionType:e=>o.equals(e,"priceRange")},te={buildFilterMetadata:e=>{let r=new Map;return Array.isArray(e)&&e.forEach(i=>{i.handle&&r.set(i.handle,{label:i.label||i.queryKey||i.optionKey||i.handle,queryKey:i.queryKey,optionKey:i.optionKey,optionType:i.optionType})}),r}},t={shop:null,filters:{vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},products:[],collections:[],selectedCollection:{id:null,sortBy:null},pagination:{page:1,limit:q.PAGE_SIZE,total:0,totalPages:0},sort:{field:"best-selling",order:"asc"},loading:!1,availableFilters:[],filterMetadata:new Map,keep:null,fallbackProducts:[],fallbackPagination:{currentPage:1,totalPages:1,totalProducts:0},usingFallback:!1,moneyFormat:null,moneyWithCurrencyFormat:null,currency:null,scrollToProductsOnFilter:!1,priceRangeHandle:null},f={enabled:!0,error:(e,r)=>{f.enabled&&console.error("[AFS]",e,r||"")},warn:(e,r)=>{f.enabled&&console.warn("[AFS]",e,r||"")},info:(e,r)=>{f.enabled&&console.info("[AFS]",e,r||"")},debug:(e,r)=>{f.enabled&&console.debug("[AFS]",e,r||"")},log:(e,...r)=>{f.enabled&&console.log(e,...r)},init:e=>{f.enabled=e!==!1,f.log("%cAdvanced Filter & Search","color: white; background-color: #c21f29; font-size: 16px; font-weight: bold; padding: 4px 8px; border-radius: 4px;")}},R={parse(){let e=new URL(window.location.href),r={},i,n;return e.searchParams.forEach((s,a)=>{if(!se.has(a))if(o.isVendorKey(a))r.vendor=o.split(s);else if(o.isProductTypeKey(a))r.productType=o.split(s);else if(o.isTagKey(a))r.tags=o.split(s);else if(o.isCollectionKey(a))r.collections=o.split(s);else if(o.equals(a,"search"))r.search=s;else if(o.equals(a,"priceMin")){let l=parseFloat(s);!isNaN(l)&&l>=0&&(i=l)}else if(o.equals(a,"priceMax")){let l=parseFloat(s);!isNaN(l)&&l>=0&&(n=l)}else if(o.isPriceRangeKey(a)){let l=s.split("-");if(l.length===2){let p=parseFloat(l[0]),b=parseFloat(l[1]);!isNaN(p)&&p>=0&&(i=p),!isNaN(b)&&b>=0&&(n=b)}}else if(o.equals(a,"page"))r.page=parseInt(s,10)||1;else if(o.equals(a,"limit"))r.limit=parseInt(s,10)||q.PAGE_SIZE;else if(o.equals(a,"sort")){let l=s.toLowerCase().trim();if(o.isBestSelling(l))r.sort={field:"best-selling",order:"asc"};else if(l.includes("-")){let[p,b]=l.split("-"),d=o.equalsAny(b,"ascending")?"asc":(o.equalsAny(b,"descending"),"desc");r.sort={field:p,order:d}}else{let[p,b]=s.split(":");r.sort={field:p,order:o.equalsAny(b,"asc")?"asc":"desc"}}}else r[a]=o.split(s),f.debug("Handle filter parsed directly",{handle:a,value:s})}),(i!==void 0||n!==void 0)&&(r.priceRange={min:i,max:n}),r},update(e,r,i){let n=new URL(window.location.href);if(n.search="",f.debug("Updating URL",{filters:e,pagination:r}),e&&!o.empty(e)&&Object.keys(e).forEach(a=>{let l=e[a];if(!o.empty(l))if(Array.isArray(l)&&l.length>0)n.searchParams.set(a,l.join(",")),f.debug("URL param set",{key:a,value:l.join(",")});else if(o.isPriceRangeKey(a)&&l&&typeof l=="object"&&!Array.isArray(l)){let p=l,b=typeof p.min=="number"&&!isNaN(p.min)?p.min:void 0,d=typeof p.max=="number"&&!isNaN(p.max)?p.max:void 0;if(t.priceRangeHandle){let c=`${b!==void 0?b:""}-${d!==void 0?d:""}`;n.searchParams.set(t.priceRangeHandle,c),f.debug("Price range URL handle param set",{handle:t.priceRangeHandle,value:c})}else b!==void 0&&n.searchParams.set("priceMin",String(b)),d!==void 0&&n.searchParams.set("priceMax",String(d)),f.debug("Price range URL params set",{priceMin:b,priceMax:d})}else o.equals(a,"search")&&typeof l=="string"&&l.trim()&&(n.searchParams.set(a,l.trim()),f.debug("Search URL param set",{key:a,value:l.trim()}))}),r&&r.page>1&&(n.searchParams.set("page",String(r.page)),f.debug("Page URL param set",{page:r.page})),i&&i.field){if(i.field==="best-selling"||i.field==="bestselling")n.searchParams.set("sort","best-selling");else{let a=o.equals(i.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${i.field}-${a}`)}f.debug("Sort URL param set",{field:i.field,order:i.order})}t.keep!==null&&t.keep!==void 0&&(o.equals(t.keep,"__all__")?n.searchParams.set("keep","__all__"):Array.isArray(t.keep)&&t.keep.length>0&&n.searchParams.set("keep",t.keep.join(",")),f.debug("Keep filters URL param set",{keep:t.keep}));let s=n.toString();f.info("URL updated",{newUrl:s,oldUrl:window.location.href}),history.pushState({filters:e,pagination:r,sort:i},"",n)}},O={baseURL:"https://fstaging.digitalcoo.com",cache:new Map,timestamps:new Map,pending:new Map,key(e,r,i){return`${r.page}-${r.limit}-${i.field}-${i.order}-${JSON.stringify(e)}`},get(e){let r=this.timestamps.get(e);return!r||Date.now()-r>q.CACHE_TTL?(this.cache.delete(e),this.timestamps.delete(e),null):this.cache.get(e)||null},set(e,r){this.cache.set(e,r),this.timestamps.set(e,Date.now())},async fetch(e,r=q.TIMEOUT){let i=new AbortController,n=setTimeout(()=>i.abort(),r);try{f.debug("Fetching",{url:e});let s=await fetch(e,{signal:i.signal});if(clearTimeout(n),!s.ok){let l=await s.text().catch(()=>"");throw new Error(`HTTP ${s.status}: ${s.statusText}${l?" - "+l:""}`)}let a=await s.json();return f.debug("Fetch success",{url:e,hasData:!!a}),a}catch(s){throw clearTimeout(n),s instanceof Error&&s.name==="AbortError"?new Error("Request timeout"):(f.error("Fetch failed",{url:e,error:s instanceof Error?s.message:String(s)}),s)}},shouldSendCpid(e){var i;return(i=t.selectedCollection)!=null&&i.id?!Object.keys(e||{}).some(n=>{let s=t.filterMetadata.get(n);return(o.isCollectionOptionType(s==null?void 0:s.optionType)||o.isCollectionKey(n))&&Array.isArray(e[n])&&e[n].length>0?e[n].some(l=>String(l)===String(t.selectedCollection.id)):!1}):!1},async products(e,r,i){var b;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!t.shop)throw new Error("Shop not set");let n=this.key(e,r,i),s=this.get(n);if(s)return f.debug("Cache hit",{key:n}),s;if(this.pending.has(n))return f.debug("Request deduplication",{key:n}),this.pending.get(n);let a=new URLSearchParams;if(a.set("shop",t.shop),this.shouldSendCpid(e)?(a.set("cpid",t.selectedCollection.id),f.debug("cpid sent to products API",{cpid:t.selectedCollection.id,filters:e})):f.debug("cpid not sent to products API",{hasCpid:!!((b=t.selectedCollection)!=null&&b.id),filters:e,reason:"filters present or cpid already in collection filter"}),Object.keys(e).forEach(d=>{let c=e[d];if(!o.empty(c))if(o.isPriceRangeKey(d)&&c&&typeof c=="object"&&!Array.isArray(c)){let m=c,u=typeof m.min=="number"&&!isNaN(m.min)?m.min:void 0,h=typeof m.max=="number"&&!isNaN(m.max)?m.max:void 0;t.priceRangeHandle?a.set(t.priceRangeHandle,`${u!==void 0?u:""}-${h!==void 0?h:""}`):(u!==void 0&&a.set("priceMin",String(u)),h!==void 0&&a.set("priceMax",String(h)))}else d==="search"&&typeof c=="string"&&c.trim()?a.set(d,c.trim()):Array.isArray(c)&&c.length>0?(a.set(d,c.join(",")),f.debug("Filter sent as direct handle param",{handle:d,value:c.join(",")})):typeof c=="string"&&(a.set(d,c),f.debug("Filter sent as direct handle param",{handle:d,value:c}))}),a.set("page",String(r.page)),a.set("limit",String(r.limit)),i.field)if(o.isBestSelling(i.field))a.set("sort","best-selling");else{let d=o.equals(i.order,"asc")?"ascending":"descending";a.set("sort",`${i.field}-${d}`)}t.keep!==null&&t.keep!==void 0&&(o.equals(t.keep,"__all__")?a.set("keep","__all__"):Array.isArray(t.keep)&&t.keep.length>0&&a.set("keep",t.keep.join(",")),f.debug("Keep filters sent to products API",{keep:t.keep}));let l=`${this.baseURL}/storefront/products?${a}`;f.info("Fetching products",{url:l,shop:t.shop,page:r.page});let p=this.fetch(l).then(d=>{var m,u;if(!d.success||!d.data)throw f.error("Invalid products response",{response:d}),new Error(`Invalid products response: ${d.message||P.messages.unknownError}`);let c=d.data;return f.info("Products response",{productsCount:((m=c.products)==null?void 0:m.length)||0,total:((u=c.pagination)==null?void 0:u.total)||0,hasFilters:!!c.filters}),this.set(n,c),this.pending.delete(n),c}).catch(d=>{throw this.pending.delete(n),f.error("Products fetch failed",{error:d instanceof Error?d.message:String(d),url:l}),d});return this.pending.set(n,p),p},async filters(e){var b;if(!this.baseURL)throw new Error('API baseURL not set. Call AFS.init({ apiBaseUrl: "..." })');if(!t.shop)throw new Error("Shop not set");let r=new URLSearchParams;r.set("shop",t.shop),this.shouldSendCpid(e)?(r.set("cpid",t.selectedCollection.id),f.debug("cpid sent to filters API",{cpid:t.selectedCollection.id,filters:e})):f.debug("cpid not sent to filters API",{hasCpid:!!((b=t.selectedCollection)!=null&&b.id),filters:e,reason:"filters present or cpid already in collection filter"});let i={...e},n=null;if(t.keep!==null&&t.keep!==void 0){if(o.equals(t.keep,"__all__"))Object.keys(i).forEach(d=>{delete i[d]}),r.set("keep","__all__"),f.debug("Keep filters: __all__ - excluded all filters from aggregation query");else{if(Array.isArray(t.keep)&&t.keep.length>0)n=t.keep[0],r.set("keep",t.keep.join(",")),f.debug("Keep parameter set (array)",{keep:t.keep.join(","),keepHandle:n});else if(t.keep!==null&&!o.equals(t.keep,"__all__")&&typeof t.keep=="string"){let d=t.keep.trim();d&&(n=d,r.set("keep",n),f.debug("Keep parameter set (string)",{keep:n,keepHandle:n}))}else f.warn("Keep has invalid value, not adding to params",{StateKeep:t.keep});n&&i.hasOwnProperty(n)&&(delete i[n],f.debug("Excluded keep filter from aggregation query",{excludedHandle:n,remainingFilters:Object.keys(i)}))}f.debug("Keep filters sent to filters API",{keep:t.keep,params:r.toString()})}else f.debug("Keep filters not set, skipping keep parameter",{StateKeep:t.keep});Object.keys(i).forEach(d=>{let c=i[d];if(!o.empty(c)){if(Array.isArray(c))r.set(d,c.join(","));else if(d==="search"&&typeof c=="string"&&c.trim())r.set("search",c.trim());else if(d==="priceRange"&&c&&typeof c=="object"&&!Array.isArray(c)){let m=c,u=typeof m.min=="number"&&!isNaN(m.min)?m.min:void 0,h=typeof m.max=="number"&&!isNaN(m.max)?m.max:void 0;t.priceRangeHandle?r.set(t.priceRangeHandle,`${u!==void 0?u:""}-${h!==void 0?h:""}`):(u!==void 0&&r.set("priceMin",String(u)),h!==void 0&&r.set("priceMax",String(h)))}}});let s={};r.forEach((d,c)=>{s[c]=d}),f.debug("All params for filters endpoint",{params:s,hasKeep:r.has("keep"),keepValue:r.get("keep"),StateKeep:t.keep});let a=`${this.baseURL}/storefront/filters?${r}`;f.info("Fetching filters",{url:a,shop:t.shop,hasKeepParam:r.has("keep")});let l=await this.fetch(a);if(!l.success||!l.data)throw f.error("Invalid filters response",{response:l}),new Error(`Invalid filters response: ${l.message||P.messages.unknownError}`);let p=l.data;if(!p||typeof p!="object")throw new Error("Invalid filters response: data is not an object");return p.filters!==void 0&&!Array.isArray(p.filters)&&(f.warn("Filters response contains non-array filters",{filters:p.filters}),p.filters=[]),f.info("Filters response:",{filters:p.filters}),p},setBaseURL(e){this.baseURL=e}},y={container:null,filtersContainer:null,productsContainer:null,productsInfo:null,productsGrid:null,loading:null,sortContainer:null,sortSelect:null,mobileFilterButton:null,mobileFilterClose:null,mobileFilterBackdrop:null,init(e,r,i){if(this.container=document.querySelector(e)||document.querySelector("[data-afs-container]"),!this.container)throw new Error("Container not found");this.container.setAttribute("data-afs-container","true");let n=this.container.querySelector(".afs-main-content")||o.el("div","afs-main-content");n.parentNode||this.container.appendChild(n),this.filtersContainer=document.querySelector(r||"")||o.el("div","afs-filters-container"),!this.filtersContainer.parentNode&&n&&n.appendChild(this.filtersContainer),window.innerWidth<=767&&this.filtersContainer.classList.remove("afs-filters-container--open"),this.mobileFilterClose=o.el("button","afs-mobile-filter-close",{type:"button","data-afs-action":"close-filters","aria-label":P.buttons.closeFilters}),this.mobileFilterClose.innerHTML=P.buttons.close,this.mobileFilterClose.style.display="none",this.mobileFilterClose&&!this.mobileFilterClose.parentNode&&this.filtersContainer.insertBefore(this.mobileFilterClose,this.filtersContainer.firstChild),this.mobileFilterBackdrop=this.container.querySelector(".afs-mobile-filter-backdrop"),this.mobileFilterBackdrop||(this.mobileFilterBackdrop=o.el("div","afs-mobile-filter-backdrop",{"data-afs-action":"close-filters"}),this.mobileFilterBackdrop.style.display="none",n.parentNode?n.parentNode.insertBefore(this.mobileFilterBackdrop,n):this.container.appendChild(this.mobileFilterBackdrop)),this.productsContainer=document.querySelector(i||"")||o.el("div","afs-products-container"),!this.productsContainer.parentNode&&n&&n.appendChild(this.productsContainer),this.productsInfo=o.el("div","afs-products-info"),this.productsContainer&&this.productsContainer.insertBefore(this.productsInfo,this.productsContainer.firstChild),this.mobileFilterButton=o.el("button","afs-mobile-filter-button",{type:"button","data-afs-action":"toggle-filters","aria-label":P.buttons.toggleFilters}),this.mobileFilterButton.innerHTML=`<span class="afs-mobile-filter-button__icon">\u2630</span> <span class="afs-mobile-filter-button__text">${P.buttons.filters}</span>`,this.productsInfo&&this.productsInfo.insertBefore(this.mobileFilterButton,this.productsInfo.firstChild),this.sortContainer=o.el("div","afs-sort-container");let s=o.el("label","afs-sort-label",{for:"afs-sort-label"});s.textContent=P.labels.sortBy,this.sortSelect=o.el("select","afs-sort-select",{"data-afs-sort":"true"}),this.sortSelect.innerHTML=`
        <option value="best-selling">${P.sortOptions.bestSelling}</option>
        <option value="title-ascending">${P.sortOptions.titleAsc}</option>
        <option value="title-descending">${P.sortOptions.titleDesc}</option>
        <option value="price-ascending">${P.sortOptions.priceAsc}</option>
        <option value="price-descending">${P.sortOptions.priceDesc}</option>
        <option value="created-ascending">${P.sortOptions.createdAsc}</option>
        <option value="created-descending">${P.sortOptions.createdDesc}</option>
      `,this.sortContainer.appendChild(s),this.sortContainer.appendChild(this.sortSelect),this.productsInfo&&this.productsInfo.appendChild(this.sortContainer),this.productsGrid=o.el("div","afs-products-grid"),this.productsContainer&&this.productsContainer.appendChild(this.productsGrid)},hideFilters(){this.filtersContainer&&(this.filtersContainer.style.display="none",f.debug("Filters container hidden"))},showFilters(){this.filtersContainer&&(this.filtersContainer.style.display="",window.innerWidth>767?this.filtersContainer.classList.add("afs-filters-container--open"):this.filtersContainer.classList.remove("afs-filters-container--open"),f.debug("Filters container shown"))},toggleMobileFilters(){if(!this.filtersContainer)return;let e=this.filtersContainer.classList.contains("afs-filters-container--open");if(e){this.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="none");let r=document.body.style.top;document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.top="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height"),document.body.style.removeProperty("top"),r&&window.scrollTo(0,parseInt(r||"0",10)*-1)}else{this.filtersContainer.classList.add("afs-filters-container--open"),document.body.classList.add("afs-filters-open"),this.mobileFilterBackdrop&&(this.mobileFilterBackdrop.style.display="block");let r=window.scrollY;document.body.style.position="fixed",document.body.style.top=`-${r}px`,document.body.style.width="100%",document.body.style.overflow="hidden"}f.debug("Mobile filters drawer toggled",{isOpen:!e})},renderFilters(e){if(!this.filtersContainer||!Array.isArray(e))return;this.hideFiltersSkeleton();let r=new Map;this.filtersContainer.querySelectorAll(".afs-filter-group").forEach(s=>{let a=s.getAttribute("data-afs-filter-key");if(a){let l=s.querySelector(".afs-filter-group__search-input");r.set(a,{collapsed:s.getAttribute("data-afs-collapsed")==="true",search:(l==null?void 0:l.value)||""})}}),o.clear(this.filtersContainer);let i=e.filter(s=>s?o.isPriceRangeOptionType(s.optionType)?s.range&&typeof s.range.min=="number"&&typeof s.range.max=="number"&&s.range.max>s.range.min:s.values&&s.values.length>0:!1);if(f.debug("Rendering filters",{total:e.length,valid:i.length,filtersWithSearchable:i.filter(s=>s.searchable).length,filtersWithCollapsed:i.filter(s=>s.collapsed).length}),i.length===0){f.warn("No valid filters to render");return}let n=document.createDocumentFragment();i.forEach(s=>{var T;if(o.isPriceRangeOptionType(s.optionType)){let L=this.createPriceRangeGroup(s,r);L&&n.appendChild(L);return}let a;if(s.optionType||s.optionKey){if(a=s.handle,!a){f.error("Option filter missing handle",{filter:s});return}}else if(a=s.queryKey||s.key,!a){f.warn("Standard filter missing queryKey/key",{filter:s});return}f.debug("Filter group handle determined",{handle:a,filterHandle:s.handle,queryKey:s.queryKey,key:s.key,label:s.label,type:s.optionType,optionType:s.optionType,optionKey:s.optionKey,isOptionFilter:!!(s.optionType||s.optionKey)});let l=o.el("div","afs-filter-group",{"data-afs-filter-type":s.optionType||""});l.setAttribute("data-afs-filter-handle",a);let p=a;l.setAttribute("data-afs-filter-key",p);let b=r.get(p),d=(b==null?void 0:b.collapsed)!==void 0?b.collapsed:s.collapsed===!0||s.collapsed==="true"||s.collapsed===1;l.setAttribute("data-afs-collapsed",d?"true":"false"),f.debug("Filter group created",{handle:a,label:s.label,collapsed:d,searchable:s.searchable,showCount:s.showCount,valuesCount:((T=s.values)==null?void 0:T.length)||0});let c=o.el("div","afs-filter-group__header"),m=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":d?"false":"true",title:s.tooltipContent||`Toggle ${s.label||a} filter`}),u=o.el("span","afs-filter-group__icon");u.innerHTML=d?B.rightArrow||"":B.downArrow||"",m.appendChild(u),m.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),s.label||s.optionType||"")),c.appendChild(m);let h=t.filters[a];if(h&&(Array.isArray(h)?h.length>0:typeof h=="object"&&!Array.isArray(h)?Object.keys(h).length>0:!!h)){let L=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${P.buttons.clear} ${s.label||a} filters`,"data-afs-filter-handle":a});L.textContent=P.buttons.clear,L.title=`${P.buttons.clear} ${s.label||a} filters`,c.appendChild(L)}l.appendChild(c);let S=o.el("div","afs-filter-group__content");if(s.searchable===!0||typeof s.searchable=="string"&&s.searchable.toLowerCase()==="true"){let L=o.el("div","afs-filter-group__search"),A=o.el("input","afs-filter-group__search-input",{type:"text",placeholder:s.searchPlaceholder||"Search...","aria-label":`${P.labels.search}${s.label||a}`,name:`afs-search-${a}`});b!=null&&b.search&&(A.value=b.search),L.appendChild(A),S.appendChild(L),f.debug("Search input added",{handle:a,label:s.label,searchable:s.searchable})}let C=o.el("div","afs-filter-group__items",{"data-afs-filter-handle":a,"data-afs-filter-multiselect":o.isMultiSelect(s)?"1":"0","data-afs-filter-display-type":o.toLowerCase(s.displayType||"CHECKBOX")});C._items=s.values;let _=document.createDocumentFragment();s.values&&s.values.forEach((L,A)=>{let F=this.createFilterItem(a,L,s,A);F&&_.appendChild(F)}),C.appendChild(_),S.appendChild(C),l.appendChild(S),n.appendChild(l)}),n.children.length>0?(this.filtersContainer.appendChild(n),this.showFilters(),f.debug("Filters rendered",{count:n.children.length})):(f.warn("No filter groups created"),this.hideFilters())},createFilterItem(e,r,i,n){let s=o.str(typeof r=="string"?r:r.value||r.key||r.name||"");if(!s||s==="[object Object]")return null;let a=typeof r=="string"?r:r.label||r.value||s;if((o.isCollectionOptionType(i==null?void 0:i.optionType)||o.isCollectionKey(e))&&t.collections&&Array.isArray(t.collections)){let h=t.collections.find(g=>{let S=String(g.id||g.gid||g.collectionId||"");return S&&String(S)===String(s)});if(h)a=h.title||h.label||h.name||a;else return null}let b=(t.filters[e]||[]).includes(s),d=o.inputDisplayType(i),c=(d==="radio"?e:e+"-"+s.replace(/\s+/g,"-").toLowerCase())+"_"+(n+1),m=o.el("label","afs-filter-item",{"data-afs-filter-handle":e,"data-afs-filter-value":s,for:c});b&&m.classList.add("afs-filter-item--active");let u=o.el("input","afs-filter-item__checkbox",{type:d});return u.checked=b,u.setAttribute("data-afs-filter-value",s),u.setAttribute("name",c),u.setAttribute("id",c),m.appendChild(u),m.appendChild(o.txt(o.el("span","afs-filter-item__label"),a)),i!=null&&i.showCount&&typeof r=="object"&&r.count&&m.appendChild(o.txt(o.el("span","afs-filter-item__count"),`(${r.count})`)),m},createPriceRangeGroup(e,r=null){var D;if(!e.range||typeof e.range.min!="number"||typeof e.range.max!="number")return f.warn("Invalid price range filter",{filter:e}),null;let i=e.range.min,n=e.range.max,s=t.filters.priceRange||{min:i,max:n},a=Math.max(i,Math.min(n,s.min||i)),l=Math.max(i,Math.min(n,s.max||n)),p=o.el("div","afs-filter-group",{"data-afs-filter-type":"priceRange","data-afs-filter-key":e.key||"priceRange"}),b=r==null?void 0:r.get(e.key||"priceRange"),d=(D=b==null?void 0:b.collapsed)!=null?D:e.collapsed===!0;p.setAttribute("data-afs-collapsed",d?"true":"false");let c=o.el("div","afs-filter-group__header"),m=o.el("button","afs-filter-group__toggle",{type:"button","aria-expanded":d?"false":"true"}),u=o.el("span","afs-filter-group__icon");if(u.innerHTML=d?B.rightArrow||"":B.downArrow||"",m.appendChild(u),m.appendChild(o.txt(o.el("label","afs-filter-group__label",{for:"afs-filter-group__label"}),e.label||"Price")),c.appendChild(m),t.filters.priceRange&&(t.filters.priceRange.min!==i||t.filters.priceRange.max!==n)){let E=o.el("button","afs-filter-group__clear",{type:"button","aria-label":`${P.buttons.clear} ${e.label} filter`,"data-afs-filter-handle":"priceRange"});E.textContent=P.buttons.clear,E.title=`${P.buttons.clear} ${e.label} filter`,c.appendChild(E)}p.appendChild(c);let g=o.el("div","afs-filter-group__content"),S=o.el("div","afs-price-range-container"),v=o.el("div","afs-price-range-track"),C=o.el("div","afs-price-range-active");v.appendChild(C);let _=o.el("input","afs-price-range-handle afs-price-range-handle--min",{type:"range",min:String(i),max:String(n),value:String(a),step:"1"});_.setAttribute("data-afs-range-type","min");let T=o.el("input","afs-price-range-handle afs-price-range-handle--max",{type:"range",min:String(i),max:String(n),value:String(l),step:"1"});T.setAttribute("data-afs-range-type","max"),v.appendChild(_),v.appendChild(T),S.appendChild(v);let L=o.el("div","afs-price-range-values"),A=o.el("span","afs-price-range-value afs-price-range-value--min"),F=o.el("span","afs-price-range-value afs-price-range-value--max"),k=E=>`$${parseFloat(String(E)).toFixed(0)}`;A.textContent=k(a),F.textContent=k(l),L.appendChild(A),L.appendChild(o.txt(o.el("span","afs-price-range-separator")," - ")),L.appendChild(F),S.appendChild(L);let j=()=>{let E=parseFloat(_.value),M=parseFloat(T.value),I=n-i,$=(E-i)/I*100,G=(n-M)/I*100;C.style.left=`${$}%`,C.style.right=`${G}%`,A.textContent=k(E),F.textContent=k(M)},w=()=>{let E=parseFloat(_.value),M=parseFloat(T.value);E>M&&(_.value=String(M),T.value=String(E)),j()};return _.addEventListener("input",()=>{w(),H.updatePriceRange(parseFloat(_.value),parseFloat(T.value))}),T.addEventListener("input",()=>{w(),H.updatePriceRange(parseFloat(_.value),parseFloat(T.value))}),j(),g.appendChild(S),p.appendChild(g),p},renderProducts(e){if(!this.productsGrid)return;let r=this.productsGrid.querySelectorAll(".afs-skeleton-card");r.length>0&&r.forEach(a=>a.remove());let i=new Map;this.productsGrid.querySelectorAll("[data-afs-product-id]").forEach(a=>{let l=a.getAttribute("data-afs-product-id");l&&i.set(l,a)});let n=new Set(e.map(a=>o.id(a)).filter(a=>a!==null)),s=document.createDocumentFragment();e.forEach(a=>{let l=o.id(a);if(!l)return;let p=i.get(l);if(p){let b=p.querySelector(".afs-product-card__title");b&&b.textContent!==a.title&&(b.textContent=a.title||"");let d=p.querySelector(".afs-product-card__price");if(d){let c=parseFloat(String(a.minPrice||0))*100,m=parseFloat(String(a.maxPrice||0))*100,u=o.formatMoney(c,t.moneyFormat||"{{amount}}",t.currency||""),h=c===m?u:`${P.labels.price}from ${u}`;d.textContent!==h&&(d.textContent=h)}}else{let b=this.createProduct(a);b&&s.appendChild(b)}}),i.forEach((a,l)=>{n.has(l)||a.remove()}),s.children.length>0&&this.productsGrid.appendChild(s)},createProduct(e){var n,s;let r=o.el("div","afs-product-card",{"data-afs-product-id":o.id(e)||""});if(e.imageUrl||e.featuredImage){let a=o.el("div","afs-product-card__image"),l=o.el("img","",{alt:e.title||"",loading:"lazy",decoding:"async",fetchpriority:"low"}),p=((n=e.featuredImage)==null?void 0:n.url)||((s=e.featuredImage)==null?void 0:s.urlFallback)||e.imageUrl||"";if(p){if(e.featuredImage&&(e.featuredImage.urlSmall||e.featuredImage.urlMedium||e.featuredImage.urlLarge)){let u=[];e.featuredImage.urlSmall&&u.push(`${e.featuredImage.urlSmall} 200w`),e.featuredImage.urlMedium&&u.push(`${e.featuredImage.urlMedium} 300w`),e.featuredImage.urlLarge&&u.push(`${e.featuredImage.urlLarge} 500w`),u.length>0&&(l.setAttribute("srcset",u.join(", ")),l.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),l.src=e.featuredImage.url||e.featuredImage.urlFallback||p}else{let u=o.optimizeImageUrl(p,{width:300,format:"webp",quality:80}),h=o.buildImageSrcset(p,[200,300,500]);h&&(l.setAttribute("srcset",h),l.setAttribute("sizes","(max-width: 768px) 200px, (max-width: 1024px) 300px, 500px")),l.src=u||p}l.onerror=function(){var h;let u=((h=e.featuredImage)==null?void 0:h.urlFallback)||p;if(u&&this.src!==u)this.src=u;else if(this.src.includes("_webp.")){let g=p.replace(/_(?:small|medium|large|grande|compact|master|\d+x\d+)_webp\./i,"_300x300.");g!==this.src?this.src=g:this.style.display="none"}else this.style.display="none"}}a.appendChild(l);let b=o.el("button","afs-product-card__quick-add",{"data-product-handle":e.handle||"","data-product-id":o.id(e)||"","aria-label":P.buttons.quickAddToCart,type:"button"}),d=o.el("span","afs-product-card__quick-add-icon");d.innerHTML=B.plus,b.appendChild(d);let c=o.el("span","afs-product-card__quick-add-text");c.textContent=P.buttons.quickAdd,b.appendChild(c),(parseInt(String(e.totalInventory||0),10)<=0||e.variants&&!e.variants.some(u=>u.availableForSale))&&(b.disabled=!0,b.classList.add("afs-product-card__quick-add--disabled"),b.setAttribute("aria-label",P.labels.productUnavailable));let m=Q(e);m&&a.appendChild(m),r.appendChild(a)}let i=o.el("div","afs-product-card__info");if(i){i.appendChild(o.txt(o.el("h3","afs-product-card__title"),e.title||"Untitled")),e.vendor&&i.appendChild(o.txt(o.el("div","afs-product-card__vendor"),e.vendor));let a=parseFloat(String(e.minPrice||0))*100,l=parseFloat(String(e.maxPrice||0))*100,p=o.formatMoney(a,t.moneyFormat||"{{amount}}",t.currency||""),b=a===l?p:`from ${p}`;i.appendChild(o.txt(o.el("div","afs-product-card__price"),b)),r.appendChild(i)}return r},updateFilterState(e,r,i){if(!this.filtersContainer){f.warn("Cannot update filter state: filtersContainer not found");return}let n=b=>String(b).replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"),s=n(r),l=`.afs-filter-item[data-afs-filter-handle="${n(e)}"][data-afs-filter-value="${s}"]`,p=this.filtersContainer.querySelector(l);if(p){let b=p.querySelector(".afs-filter-item__checkbox");b?(b.checked=i,f.debug("Checkbox state updated",{handle:e,value:r,active:i})):f.warn("Checkbox not found in filter item",{handle:e,value:r}),p.classList.toggle("afs-filter-item--active",i)}else f.warn("Filter item not found for state update",{handle:e,value:r,active:i,selector:l})},renderInfo(e,r){if(!this.productsInfo)return;let i=this.sortContainer,n=this.productsInfo.querySelector(".afs-products-info__results");n&&n.remove();let s;if(r===0)s=o.txt(o.el("div","afs-products-info__results"),P.messages.noProductsFound);else if(r===1)s=o.txt(o.el("div","afs-products-info__results"),P.messages.oneProductFound);else{let a=(e.page-1)*e.limit+1,l=Math.min(e.page*e.limit,r);s=o.txt(o.el("div","afs-products-info__results"),`${P.messages.showingProducts} ${a}-${l} of ${r} ${P.messages.productsFound}`)}i&&i.parentNode?this.productsInfo.insertBefore(s,i):(this.productsInfo.appendChild(s),i&&!i.parentNode&&this.productsInfo.appendChild(i))},renderPagination(e){var l;if(!this.productsGrid||!e)return;let r=(l=this.productsGrid.parentNode)==null?void 0:l.querySelector(".afs-pagination");if(r&&r.remove(),e.totalPages<=1)return;let i=o.el("div","afs-pagination"),n=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page-1),"aria-label":`${P.buttons.previous} ${P.messages.pageOf.toLowerCase()}`});n.textContent=P.buttons.previous,n.disabled=e.page<=1,i.appendChild(n);let s=o.el("span","afs-pagination__info");s.textContent=`${P.messages.pageOf} ${e.page} of ${e.totalPages}`,i.appendChild(s);let a=o.el("button","afs-pagination__button",{type:"button","data-afs-page":String(e.page+1),"aria-label":`${P.buttons.next} ${P.messages.pageOf.toLowerCase()}`});a.textContent=P.buttons.next,a.disabled=e.page>=e.totalPages,i.appendChild(a),this.productsContainer&&this.productsContainer.appendChild(i)},renderApplied(e){var p,b;if(!this.container)return;let r=this.container.querySelector(".afs-applied-filters");r&&r.remove();let i=[];if(Object.keys(e).forEach(d=>{let c=e[d];if(o.equals(d,"search")&&c&&typeof c=="string"&&c.trim())i.push({handle:d,label:`${P.labels.search}${c}`,value:c});else if(o.isPriceRangeKey(d)&&c&&typeof c=="object"&&!Array.isArray(c)){let m=c,u=typeof m.min=="number"&&!isNaN(m.min),h=typeof m.max=="number"&&!isNaN(m.max);u&&h?i.push({handle:d,label:`${P.labels.price}$${m.min} - $${m.max}`,value:"__clear__"}):u?i.push({handle:d,label:`${P.labels.price}$${m.min}+`,value:"__clear__"}):h&&i.push({handle:d,label:`${P.labels.price}Up to $${m.max}`,value:"__clear__"})}else Array.isArray(c)&&c.length>0&&c.forEach(m=>{let u=t.filterMetadata.get(d),h=(u==null?void 0:u.label)||d,g=m;if((o.isCollectionOptionType(u==null?void 0:u.optionType)||o.isCollectionKey(d))&&t.collections&&Array.isArray(t.collections)){let v=t.collections.find(C=>{let _=String(C.id||C.gid||C.collectionId||"");return _&&String(_)===String(m)});v&&(g=v.title||v.label||v.name||m)}i.push({handle:d,label:`${h}: ${g}`,value:m})})}),(p=t.selectedCollection)!=null&&p.id&&!Object.keys(e).some(c=>{let m=t.filterMetadata.get(c);return(o.isCollectionOptionType(m==null?void 0:m.optionType)||o.isCollectionKey(c))&&Array.isArray(e[c])&&e[c].includes(String(t.selectedCollection.id))})){let c=(b=t.collections)==null?void 0:b.find(u=>{let h=String(u.id||u.gid||u.collectionId||"");return h&&String(h)===String(t.selectedCollection.id)}),m=(c==null?void 0:c.title)||(c==null?void 0:c.label)||(c==null?void 0:c.name)||"Collection";i.push({handle:"cpid",label:`${P.labels.collection}${m}`,value:String(t.selectedCollection.id)})}if(i.length===0)return;let n=o.el("div","afs-applied-filters"),s=o.el("div","afs-applied-filters__header");s.appendChild(o.txt(o.el("div","afs-applied-filters__label"),P.labels.appliedFilters)),n.appendChild(s);let a=o.el("div","afs-applied-filters__list");i.forEach(d=>{let c=o.el("div","afs-applied-filter-chip");c.appendChild(o.txt(o.el("span","afs-applied-filter-chip__label"),d.label));let m=o.el("button","afs-applied-filter-chip__remove",{"data-afs-filter-key":d.handle,"data-afs-filter-value":d.value,"aria-label":`${P.buttons.clear} filter`,type:"button"});m.innerHTML=B.close,c.appendChild(m),a.appendChild(c)});let l=o.el("button","afs-applied-filters__clear-all",{"data-afs-action":"clear-all",type:"button"});l.textContent=P.buttons.clearAll,a.appendChild(l),n.appendChild(a),this.container.insertBefore(n,this.container.firstChild)},scrollToProducts(){t.scrollToProductsOnFilter!==!1&&(this.productsContainer?(this.productsContainer.scrollIntoView({behavior:"smooth",block:"start"}),f.debug("Scrolled to products section")):this.productsGrid?(this.productsGrid.scrollIntoView({behavior:"smooth",block:"start"}),f.debug("Scrolled to products grid")):this.productsInfo&&(this.productsInfo.scrollIntoView({behavior:"smooth",block:"start"}),f.debug("Scrolled to products info")))},showLoading(){var e;if(this.productsGrid){o.clear(this.productsGrid);let r=((e=t.pagination)==null?void 0:e.limit)||q.PAGE_SIZE||24,i=Math.max(r,24),n=[];for(let s=0;s<i;s++){let a=o.el("div","afs-skeleton-card");a.innerHTML=`
            <div class="afs-skeleton-card__image">&#8203;</div>
            <div class="afs-skeleton-card__info">
              <div class="afs-skeleton-card__title">&#8203;</div>
              <div class="afs-skeleton-card__title" style="width: 60%;">&#8203;</div>
              <div class="afs-skeleton-card__price">&#8203;</div>
            </div>
          `,n.push(a)}n.forEach(s=>this.productsGrid.appendChild(s)),this.loading=n}this.filtersContainer&&this.filtersContainer.style.display!=="none"&&this.showFiltersSkeleton()},showFiltersSkeleton(){if(!this.filtersContainer)return;let e=this.filtersContainer.querySelector(".afs-filters-skeleton");e&&e.remove();let r=o.el("div","afs-filters-skeleton");for(let i=0;i<4;i++){let n=o.el("div","afs-skeleton-filter-group");n.innerHTML=`
          <div class="afs-skeleton-filter-group__header">
            <div class="afs-skeleton-filter-group__title">&#8203;</div>
          </div>
          <div class="afs-skeleton-filter-group__content">
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 70%;">&#8203;</div>
            <div class="afs-skeleton-filter-item" style="width: 85%;">&#8203;</div>
          </div>
        `,r.appendChild(n)}this.filtersContainer.appendChild(r)},hideFiltersSkeleton(){var r;let e=(r=this.filtersContainer)==null?void 0:r.querySelector(".afs-filters-skeleton");e&&e.remove()},hideLoading(){var e;Array.isArray(this.loading)?(this.loading.forEach(r=>{r.parentNode&&r.remove()}),this.loading=null):(e=this.loading)!=null&&e.parentNode&&(this.loading.remove(),this.loading=null),this.hideFiltersSkeleton()},showError(e){if(!this.productsContainer){f.error("Cannot show error: productsContainer not found");return}if(this.hideLoading(),t.fallbackProducts&&t.fallbackProducts.length>0){f.warn("API error occurred, using fallback products from Liquid",{error:e,fallbackCount:t.fallbackProducts.length}),t.products=t.fallbackProducts,t.pagination={page:1,limit:q.PAGE_SIZE,total:t.fallbackProducts.length,totalPages:Math.ceil(t.fallbackProducts.length/q.PAGE_SIZE)},this.renderProducts(t.products),this.renderInfo(t.pagination,t.pagination.total),this.renderPagination(t.pagination);return}let r=this.productsContainer.querySelector(".afs-error-message");r&&r.remove();let i=o.el("div","afs-error-message");i.textContent=e||P.messages.failedToLoad,this.productsGrid?(o.clear(this.productsGrid),this.productsGrid.appendChild(i)):this.productsContainer.appendChild(i),f.error("Error displayed",{message:e})}},K={getPagination(){let r=R.parse().page||t.fallbackPagination.currentPage||1,i=t.fallbackPagination.totalPages||1,n=t.fallbackPagination.totalProducts||t.fallbackProducts.length||0;return{page:r,limit:q.PAGE_SIZE,total:n,totalPages:i}},reloadPage(e,r,i){let n=new URL(window.location.href);if(n.search="",i&&i.field)if(i.field==="best-selling"||i.field==="bestselling")n.searchParams.set("sort","best-selling");else{let s=o.equals(i.order,"asc")?"ascending":"descending";n.searchParams.set("sort",`${i.field}-${s}`)}r&&r.page&&n.searchParams.set("page",String(r.page)),Object.keys(e||{}).forEach(s=>{let a=e[s];if(!o.empty(a))if(Array.isArray(a)&&a.length>0)n.searchParams.set(s,a.join(","));else if(o.isPriceRangeKey(s)&&a&&typeof a=="object"&&!Array.isArray(a)){let l=a,p=typeof l.min=="number"&&!isNaN(l.min)?l.min:void 0,b=typeof l.max=="number"&&!isNaN(l.max)?l.max:void 0;t.priceRangeHandle?n.searchParams.set(t.priceRangeHandle,`${p!==void 0?p:""}-${b!==void 0?b:""}`):(p!==void 0&&n.searchParams.set("priceMin",String(p)),b!==void 0&&n.searchParams.set("priceMax",String(b)))}else o.equals(s,"search")&&typeof a=="string"&&a.trim()&&n.searchParams.set(s,a.trim())}),f.info("Reloading page for fallback mode",{url:n.toString(),sort:i,pagination:r}),window.location.href=n.toString()}},Y=e=>{var i;if(!((i=t.selectedCollection)!=null&&i.id))return;Object.keys(e||{}).some(n=>{let s=e[n];if(o.empty(s)||o.equalsAny(n,"page","limit","sort","size"))return!1;if(o.isPriceRangeKey(n)){if(!s||typeof s!="object"||Array.isArray(s))return!1;let a=s,l=typeof a.min=="number"&&!isNaN(a.min),p=typeof a.max=="number"&&!isNaN(a.max);if(!l&&!p)return!1}return!(o.equals(n,"search")&&(!s||typeof s!="string"||!s.trim()))})&&(t.selectedCollection.id=null,f.debug("Filters present, cleared cpid",{filters:e}))},H={toggle(e,r){var b,d;let i=o.str(r);if(!i||!e){f.warn("Invalid filter toggle",{handle:e,value:r});return}let n=t.filters[e]||[],s=n.includes(i),a=s?n.filter(c=>c!==i):[...n,i],l=t.filterMetadata.get(e);if(((l==null?void 0:l.optionType)==="Collection"||e==="collections")&&((b=t.selectedCollection)!=null&&b.id)){let c=t.selectedCollection.id;s&&String(i)===String(c)?(t.selectedCollection.id=null,f.debug("Collection filter unchecked (was cpid), cleared cpid",{handle:e,value:i,cpid:c})):a.some(m=>String(m)===String(c))||(t.selectedCollection.id=null,f.debug("Collection filter toggled, cpid no longer in values, cleared cpid",{handle:e,value:i,filterValues:a,wasCpid:String(i)===String(c),originalCpid:c}))}if(a.length===0?delete t.filters[e]:t.filters[e]=a,Y(t.filters),t.pagination.page=1,f.debug("Filter toggled",{handle:e,value:i,wasActive:s,isActive:!s,filterValues:a}),R.update(t.filters,t.pagination,t.sort),y.updateFilterState(e,i,!s),y.scrollToProducts(),y.showLoading(),window.innerWidth<=768&&((d=y.filtersContainer)!=null&&d.classList.contains("afs-filters-container--open"))){y.filtersContainer.classList.remove("afs-filters-container--open"),document.body.classList.remove("afs-filters-open"),document.body.style.overflow="",document.body.style.position="",document.body.style.width="",document.body.style.height="",document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("width"),document.body.style.removeProperty("height");let c=document.body.style.top;c&&window.scrollTo(0,parseInt(c||"0",10)*-1)}this.apply()},updatePriceRange(e,r){if(typeof e!="number"||typeof r!="number"||e<0||r<e){f.warn("Invalid price range",{min:e,max:r});return}let i=t.availableFilters.find(n=>o.isPriceRangeOptionType(n.optionType)||o.equals(n.optionKey,"priceRange"));i&&i.range?e===i.range.min&&r===i.range.max?t.filters.priceRange=null:t.filters.priceRange={min:e,max:r}:t.filters.priceRange={min:e,max:r},Y(t.filters),t.pagination.page=1,f.debug("Price range updated",{min:e,max:r,priceRange:t.filters.priceRange}),R.update(t.filters,t.pagination,t.sort),y.scrollToProducts(),y.showLoading(),this.apply()},applyProductsOnly:o.debounce(async()=>{var e;if(f.info("applyProductsOnly called",{filters:t.filters,pagination:t.pagination,sort:t.sort,usingFallback:t.usingFallback}),t.usingFallback){f.info("In fallback mode, reloading page with new parameters"),K.reloadPage(t.filters,t.pagination,t.sort);return}y.scrollToProducts(),y.showLoading();try{f.info("Fetching products...",{url:`${O.baseURL}/storefront/products`});let r=await O.products(t.filters,t.pagination,t.sort);f.info("Products fetched successfully",{count:((e=r.products)==null?void 0:e.length)||0}),t.products=r.products||[],t.pagination=r.pagination||t.pagination,t.usingFallback=!1,y.showFilters(),y.renderProducts(t.products),y.renderInfo(t.pagination,t.pagination.total||0),y.renderPagination(t.pagination),y.renderApplied(t.filters),y.hideLoading()}catch(r){if(y.hideLoading(),f.error("Failed to load products",{error:r instanceof Error?r.message:String(r)}),t.fallbackProducts&&t.fallbackProducts.length>0){if(f.warn("Products API failed, using fallback products from Liquid",{error:r instanceof Error?r.message:String(r),fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=K.getPagination(),t.availableFilters=[],y.hideFilters(),y.sortSelect)if(o.isBestSelling(t.sort.field))y.sortSelect.value="best-selling";else{let i=o.equals(t.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${t.sort.field}-${i}`}y.renderProducts(t.products),y.renderInfo(t.pagination,t.pagination.total),y.renderPagination(t.pagination),y.renderApplied(t.filters)}else y.showError(`${P.messages.failedToLoadProducts}: ${r instanceof Error?r.message:P.messages.unknownError}`)}},q.DEBOUNCE),apply:o.debounce(async()=>{var e;y.scrollToProducts(),y.showLoading();try{let r=await O.products(t.filters,t.pagination,t.sort);t.products=r.products||[],t.pagination=r.pagination||t.pagination;try{let i=await O.filters(t.filters);if(Array.isArray(i.filters)){t.availableFilters=i.filters,t.filterMetadata=te.buildFilterMetadata(t.availableFilters);let n=t.availableFilters.find(s=>o.isPriceRangeOptionType(s.optionType));if(t.priceRangeHandle=(n==null?void 0:n.handle)||t.priceRangeHandle,(e=t.selectedCollection)!=null&&e.id){let s=t.availableFilters.find(a=>a.optionType==="Collection"||o.isCollectionKey(a.queryKey)||o.isCollectionKey(a.handle));if(s){let a=s.handle||s.queryKey||"collections",l=t.filters[a]||[];l.includes(String(t.selectedCollection.id))||(t.filters[a]=[...l,String(t.selectedCollection.id)],f.debug("Converted cpid to collection filter",{cpid:t.selectedCollection.id,handle:a}))}}y.renderFilters(t.availableFilters)}}catch(i){f.warn("Failed to fetch updated filters",{error:i instanceof Error?i.message:String(i)})}y.renderProducts(t.products),y.renderInfo(t.pagination,t.pagination.total||0),y.renderPagination(t.pagination),y.renderApplied(t.filters),y.hideLoading()}catch(r){if(y.hideLoading(),f.error("Failed to apply filters",{error:r instanceof Error?r.message:String(r)}),t.fallbackProducts&&t.fallbackProducts.length>0){if(f.warn("Filters API failed, using fallback products from Liquid",{error:r instanceof Error?r.message:String(r),fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=K.getPagination(),t.availableFilters=[],y.hideFilters(),y.sortSelect)if(o.isBestSelling(t.sort.field))y.sortSelect.value="best-selling";else{let i=o.equals(t.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${t.sort.field}-${i}`}y.renderProducts(t.products),y.renderInfo(t.pagination,t.pagination.total),y.renderPagination(t.pagination),y.renderApplied(t.filters)}else y.showError(`${P.messages.failedToLoadProducts}: ${r instanceof Error?r.message:P.messages.unknownError}`)}},q.DEBOUNCE)},ie={async add(e,r){try{let i=`/products/${e}.json`,n=await fetch(i);if(!n.ok)throw new Error(P.messages.failedToLoadProduct);let a=(await n.json()).product;if(!a||!a.variants||a.variants.length===0)throw new Error("Product has no variants");let l=a.variants.find(p=>p.available)||a.variants[0];await this.addVariant(Number(l.id),1)}catch(i){f.error("Quick add failed",{error:i instanceof Error?i.message:String(i),handle:e}),alert("Failed to add product to cart. Please try again.")}},async addFromForm(e,r){var i,n;try{let s=new FormData(e),a=s.get("id"),l=parseInt(((i=s.get("quantity"))==null?void 0:i.toString())||"1",10);if(a)await this.addVariant(Number(a),l);else{let p=[];for(let h=1;h<=3;h++){let g=s.get(`option${h}`);g&&p.push(g.toString())}let b=`/products/${r}.json`,u=(n=(await(await fetch(b)).json()).product.variants)==null?void 0:n.find(h=>h.options?h.options.length===p.length&&h.options.every((g,S)=>g===p[S]):!1);if(u)await this.addVariant(Number(u.id),l);else throw new Error("Variant not found")}}catch(s){f.error("Add from form failed",{error:s instanceof Error?s.message:String(s)}),alert("Failed to add product to cart. Please try again.")}},async addVariant(e,r){try{let i=await fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,quantity:r})});if(!i.ok){let n=await i.json();throw new Error(n.description||P.messages.failedToAddToCart)}await i.json(),document.dispatchEvent(new CustomEvent("cart:updated")),this.showSuccess()}catch(i){throw f.error("Add variant failed",{error:i instanceof Error?i.message:String(i),variantId:e}),i}},showSuccess(){let e=document.querySelector(".afs-quick-add-success");e||(e=o.el("div","afs-quick-add-success"),document.body.appendChild(e)),e.textContent=P.messages.addedToCart,e.classList.add("afs-quick-add-success--show"),setTimeout(()=>{e.classList.remove("afs-quick-add-success--show")},3e3)}},oe={attach(){if(!y.container)return;y.container.addEventListener("click",i=>{var b,d,c,m,u,h;let n=i.target,s=(b=n.closest("[data-afs-action]"))==null?void 0:b.dataset.afsAction,a=n.closest(".afs-filter-item"),l=n instanceof HTMLInputElement&&(n.type==="checkbox"||n.type==="radio")?n:a==null?void 0:a.querySelector(".afs-filter-item__checkbox"),p=n.closest(".afs-pagination__button");if(s==="clear-all")t.filters={vendor:[],productType:[],tags:[],collections:[],search:"",priceRange:null},(d=t.selectedCollection)!=null&&d.id&&(t.selectedCollection.id=null,f.debug("Clear All: cleared cpid")),t.pagination.page=1,R.update(t.filters,t.pagination,t.sort),y.scrollToProducts(),y.showLoading(),H.apply();else if(s==="toggle-filters"||s==="close-filters")y.toggleMobileFilters();else if(n.closest(".afs-applied-filter-chip__remove")){let g=n.closest(".afs-applied-filter-chip"),S=g==null?void 0:g.querySelector(".afs-applied-filter-chip__remove"),v=S==null?void 0:S.getAttribute("data-afs-filter-key"),C=S==null?void 0:S.getAttribute("data-afs-filter-value");if(!v)return;if(o.equals(v,"cpid")){(c=t.selectedCollection)!=null&&c.id&&(t.selectedCollection.id=null,f.debug("cpid removed, cleared selectedCollection")),R.update(t.filters,t.pagination,t.sort),y.scrollToProducts(),y.showLoading(),H.apply();return}if(o.equals(v,"search")){t.filters.search="",t.pagination.page=1,R.update(t.filters,t.pagination,t.sort),y.scrollToProducts(),y.showLoading(),H.apply();return}if(o.isPriceRangeKey(v)){t.filters.priceRange=null,t.pagination.page=1,R.update(t.filters,t.pagination,t.sort),y.scrollToProducts(),y.showLoading(),H.apply();return}C&&H.toggle(v,C)}else if(l&&a){i.preventDefault(),i.stopPropagation();let g=a.getAttribute("data-afs-filter-handle")||((m=a.parentElement)==null?void 0:m.getAttribute("data-afs-filter-handle")),S=a.getAttribute("data-afs-filter-value"),v=a.getAttribute("data-afs-filter-multiselect")||((u=a.parentElement)==null?void 0:u.getAttribute("data-afs-filter-multiselect"));if(!g||!S){f.warn("Invalid filter item clicked",{handle:g,value:S});return}f.debug("Filter toggle",{handle:g,value:S,currentChecked:l.checked}),(v==="0"||v==="false")&&(t.filters[g]=[]),H.toggle(g,S)}else if(p&&!p.disabled){let g=parseInt(p.getAttribute("data-afs-page")||"0",10);if(g&&g>0){if(t.usingFallback){let v=R.parse().page||t.pagination.page||1;t.pagination.page=g}else t.pagination.page=g;R.update(t.filters,t.pagination,t.sort),y.scrollToProducts(),y.showLoading(),H.applyProductsOnly()}}else if(n.closest(".afs-filter-group__clear")){i.preventDefault(),i.stopPropagation();let g=n.closest(".afs-filter-group__clear");if(!g)return;let S=g.getAttribute("data-afs-filter-handle");if(!S)return;let v=t.filterMetadata.get(S),C=o.isCollectionOptionType(v==null?void 0:v.optionType)||o.isCollectionKey(S);if(t.filters[S]){if(C&&((h=t.selectedCollection)!=null&&h.id)){let _=t.filters[S],T=t.selectedCollection.id;Array.isArray(_)&&_.some(A=>String(A)===String(T))&&(t.selectedCollection.id=null,f.debug("Collection filter cleared (contained cpid), cleared cpid",{handle:S,cpid:T}))}delete t.filters[S],f.debug("Filter cleared",{handle:S,isCollectionFilter:C}),R.update(t.filters,t.pagination,t.sort),y.scrollToProducts(),y.showLoading(),H.apply()}}else if(n.closest(".afs-filter-group__toggle")){i.preventDefault(),i.stopPropagation();let g=n.closest(".afs-filter-group");if(!g)return;let v=!(g.getAttribute("data-afs-collapsed")==="true");g.setAttribute("data-afs-collapsed",v?"true":"false");let C=g.querySelector(".afs-filter-group__toggle");C&&C.setAttribute("aria-expanded",v?"false":"true");let _=g.querySelector(".afs-filter-group__icon");_&&(_.innerHTML=v?B.rightArrow||"":B.downArrow||""),f.debug("Filter group toggled",{collapsed:v})}else if(n.closest(".afs-product-card__quick-add")){i.preventDefault(),i.stopPropagation();let g=n.closest(".afs-product-card__quick-add");if(!g||g.disabled)return;let S=g.getAttribute("data-product-handle"),v=g.getAttribute("data-product-id");S&&ie.add(S,v)}else if(n.closest(".afs-product-card__quick-view")){i.preventDefault(),i.stopPropagation();let g=n.closest(".afs-product-card__quick-view");if(!g)return;let S=g.getAttribute("data-product-handle");S&&Z(S)}}),y.container.addEventListener("input",i=>{var s;let n=i.target;if(n.classList.contains("afs-filter-group__search-input")){let l=n.value.toLowerCase(),p=(s=n.closest(".afs-filter-group"))==null?void 0:s.querySelector(".afs-filter-group__items");p!=null&&p._items&&p.querySelectorAll(".afs-filter-item").forEach((b,d)=>{var m;let c=(m=p._items)==null?void 0:m[d];if(c){let u=o.str(typeof c=="string"?c:c.label||c.value||"").toLowerCase();b.style.display=!l||u.includes(l)?"":"none"}})}});let e=i=>{let n=i.value;if(!n)return;f.info("Sort dropdown changed",{sortValue:n,currentSort:t.sort});let s;if(n==="best-selling"||n==="bestselling")s={field:"best-selling",order:"asc"};else if(n.includes("-")){let[a,l]=n.split("-");s={field:a,order:l==="ascending"?"asc":"desc"}}else{let[a,l]=n.split(":");s={field:a,order:l||"desc"}}t.sort=s,t.pagination.page=1,R.update(t.filters,t.pagination,t.sort),f.info("Calling applyProductsOnly after sort change",{sort:t.sort}),y.scrollToProducts(),y.showLoading(),H.applyProductsOnly()},r=null;y.container.addEventListener("focus",i=>{let n=i.target;n.classList.contains("afs-sort-select")&&(r=n.value)},!0),y.container.addEventListener("change",i=>{let n=i.target;if(n.classList.contains("afs-sort-select")){let s=n;e(s),r=s.value}}),y.container.addEventListener("blur",i=>{let n=i.target;if(n.classList.contains("afs-sort-select")){let s=n,a=s.value;a&&a!==r&&setTimeout(()=>{let l;if(o.isBestSelling(t.sort.field))l="best-selling";else{let p=o.equals(t.sort.order,"asc")?"ascending":"descending";l=`${t.sort.field}-${p}`}a!==l&&e(s)},50),r=a}},!0),window.addEventListener("popstate",()=>{let i=R.parse(),n=JSON.stringify(t.filters),s=t.pagination.page,a=JSON.stringify(t.sort);i.keep!==void 0&&(i.keep==="__all__"||typeof i.keep=="string"&&o.equals(i.keep,"__all__")?t.keep="__all__":Array.isArray(i.keep)&&i.keep.length>0?t.keep=i.keep:t.keep=null),t.filters={vendor:i.vendor||[],productType:i.productType||[],tags:i.tags||[],collections:i.collections||[],search:i.search||"",priceRange:i.priceRange||null},Object.keys(i).forEach(u=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","keep"].includes(u)){let h=i[u];Array.isArray(h)?t.filters[u]=h:typeof h=="string"&&(t.filters[u]=[h])}});let l=t.priceRangeHandle?t.filters[t.priceRangeHandle]:null;if(t.priceRangeHandle&&Array.isArray(l)&&l.length>0){let h=String(l[0]||"").split("-");if(h.length===2){let g=h[0].trim()?parseFloat(h[0]):void 0,S=h[1].trim()?parseFloat(h[1]):void 0,v=typeof g=="number"&&!isNaN(g)&&g>=0,C=typeof S=="number"&&!isNaN(S)&&S>=0;(v||C)&&(t.filters.priceRange={min:v?g:void 0,max:C?S:void 0},delete t.filters[t.priceRangeHandle])}}let p=i.page||t.pagination.page;if(p!==s&&(t.pagination.page=p),i.sort){let u=typeof i.sort=="object"?i.sort.field:i.sort;if(typeof u=="string"){let h=u.toLowerCase().trim();if(h==="best-selling"||h==="bestselling")t.sort={field:"best-selling",order:"asc"};else if(h.includes("-")){let[g,S]=h.split("-"),v=o.equalsAny(S,"ascending")?"asc":(o.equalsAny(S,"descending"),"desc");t.sort={field:g,order:v}}else{let[g,S]=u.split(":");t.sort={field:g,order:S||"desc"}}}else typeof i.sort=="object"&&i.sort.field&&(t.sort={field:i.sort.field,order:i.sort.order||"desc"})}else t.sort={field:"best-selling",order:"asc"};let b=JSON.stringify(t.filters),d=JSON.stringify(t.sort);!(n!==b)&&(d!==a||p!==s)?H.applyProductsOnly():H.apply()})}},J={init(e={}){var r,i,n,s;try{if(f.init(e.enableLogging!==void 0?e.enableLogging:e.debug),f.info("Initializing AFS",e),e.apiBaseUrl&&(O.setBaseURL(e.apiBaseUrl),f.info("API base URL set",{url:O.baseURL})),!e.shop)throw new Error("Shop parameter is required in config");t.shop=e.shop,t.collections=e.collections||[],t.selectedCollection={id:(i=(r=e.selectedCollection)==null?void 0:r.id)!=null?i:null,sortBy:(s=(n=e.selectedCollection)==null?void 0:n.sortBy)!=null?s:null},t.scrollToProductsOnFilter=e.scrollToProductsOnFilter!==!1,e.moneyFormat&&(t.moneyFormat=e.moneyFormat),e.moneyWithCurrencyFormat&&(t.moneyWithCurrencyFormat=e.moneyWithCurrencyFormat),e.currency&&(t.currency=e.currency),e.fallbackProducts&&Array.isArray(e.fallbackProducts)&&e.fallbackProducts.length>0&&(t.fallbackProducts=e.fallbackProducts,f.info("Fallback products loaded from Liquid",{count:t.fallbackProducts.length})),e.fallbackPagination&&(t.fallbackPagination=e.fallbackPagination,f.info("Fallback pagination loaded from Liquid",{currentPage:t.fallbackPagination.currentPage,totalPages:t.fallbackPagination.totalPages,totalProducts:t.fallbackPagination.totalProducts})),e.keep!==void 0&&(o.equalsAny(e.keep,"__all__","__ALL__")?t.keep="__all__":Array.isArray(e.keep)&&e.keep.length>0?t.keep=e.keep:typeof e.keep=="string"&&e.keep.trim()?t.keep=o.split(e.keep):t.keep=null,f.info("Keep filters set from config",{keep:t.keep})),e.priceRangeHandle!==void 0&&(t.priceRangeHandle=e.priceRangeHandle),f.info("Shop set",{shop:t.shop}),f.info("Collections set",{collections:t.collections});let a=e.container||e.containerSelector||"[data-afs-container]",l=e.filtersContainer||e.filtersSelector,p=e.productsContainer||e.productsSelector;y.init(a,l,p),f.info("DOM initialized"),y.showLoading(),oe.attach(),f.info("Events attached"),this.load()}catch(a){throw f.error("Initialization failed",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,config:e}),y.container&&y.showError(`Initialization failed: ${a instanceof Error?a.message:String(a)}`),a}},async load(){var e,r,i,n,s;y.showLoading();try{let a=R.parse();f.debug("Parsed URL params on load",{urlParams:a}),t.filters={vendor:a.vendor||[],productType:a.productType||[],tags:a.tags||[],collections:a.collections||[],search:a.search||"",priceRange:a.priceRange||null},Object.keys(a).forEach(u=>{if(!["vendor","productType","tags","collections","search","priceRange","page","limit","sort","keep","cpid"].includes(u)){let h=a[u];Array.isArray(h)?t.filters[u]=h:typeof h=="string"&&(t.filters[u]=[h])}}),Y(t.filters),f.info("Loading filters...",{shop:t.shop,filters:t.filters});let l;try{l=await O.filters(t.filters),f.info("Filters loaded",{filtersCount:((e=l.filters)==null?void 0:e.length)||0})}catch(u){f.warn("Failed to load filters, continuing with empty filters",{error:u instanceof Error?u.message:String(u)}),l={filters:[]}}Array.isArray(l.filters)||(f.error("Invalid filters response: filters is not an array",{filters:l.filters}),l.filters=[]),t.availableFilters=l.filters||[],t.filterMetadata=te.buildFilterMetadata(t.availableFilters);let p=t.availableFilters.find(u=>o.isPriceRangeOptionType(u.optionType));t.priceRangeHandle=(p==null?void 0:p.handle)||t.priceRangeHandle||null;let b=t.priceRangeHandle?t.filters[t.priceRangeHandle]:null;if(t.priceRangeHandle&&Array.isArray(b)&&b.length>0){let h=String(b[0]||"").split("-");if(h.length===2){let g=h[0].trim()?parseFloat(h[0]):void 0,S=h[1].trim()?parseFloat(h[1]):void 0,v=typeof g=="number"&&!isNaN(g)&&g>=0,C=typeof S=="number"&&!isNaN(S)&&S>=0;(v||C)&&(t.filters.priceRange={min:v?g:void 0,max:C?S:void 0},delete t.filters[t.priceRangeHandle])}}if((r=t.selectedCollection)!=null&&r.id){let u=t.availableFilters.find(h=>h.optionType==="Collection"||o.isCollectionKey(h.queryKey)||o.isCollectionKey(h.handle));if(u){let h=u.handle||u.queryKey||"collections";(t.filters[h]||[]).includes(String(t.selectedCollection.id))||(t.filters[h]||(t.filters[h]=[]),t.filters[h].push(String(t.selectedCollection.id)),f.debug("Converted cpid to collection filter",{cpid:t.selectedCollection.id,handle:h}))}}if(a.keep!==void 0?(a.keep==="__all__"||typeof a.keep=="string"&&o.equals(a.keep,"__all__")?t.keep="__all__":Array.isArray(a.keep)&&a.keep.length>0?t.keep=a.keep:t.keep=null,f.debug("Keep filters set from URL",{keep:t.keep})):t.keep=null,f.info("Filters set from URL",{filters:t.filters}),a.page?t.pagination.page=a.page:t.fallbackPagination&&t.fallbackPagination.currentPage&&(t.pagination.page=t.fallbackPagination.currentPage),a.sort){let u=typeof a.sort=="object"?a.sort.field:a.sort;if(typeof u=="string"){let h=u.toLowerCase().trim();if(h==="best-selling"||h==="bestselling")t.sort={field:"best-selling",order:"asc"};else if(h.includes("-")){let[g,S]=h.split("-"),v=o.equalsAny(S,"ascending")?"asc":(o.equalsAny(S,"descending"),"desc");t.sort={field:g,order:v}}else{let[g,S]=u.split(":");t.sort={field:g,order:S||"desc"}}}else typeof a.sort=="object"&&a.sort.field&&(t.sort={field:a.sort.field,order:a.sort.order||"desc"})}else t.sort={field:"best-selling",order:"asc"};y.renderFilters(t.availableFilters),f.info("Filters rendered",{count:t.availableFilters.length}),f.info("Loading products...",{filters:t.filters,pagination:t.pagination});let d=await O.products(t.filters,t.pagination,t.sort);f.info("Products loaded",{count:((i=d.products)==null?void 0:i.length)||0,total:((n=d.pagination)==null?void 0:n.total)||0});let c=d.products&&Array.isArray(d.products)&&d.products.length>0,m=t.availableFilters&&Array.isArray(t.availableFilters)&&t.availableFilters.length>0;if(!c&&t.fallbackProducts&&t.fallbackProducts.length>0?(f.warn("API returned no products, using fallback products from Liquid",{apiProductsCount:((s=d.products)==null?void 0:s.length)||0,fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=K.getPagination(),t.availableFilters=[],y.hideFilters()):(t.usingFallback=!1,t.products=d.products||[],t.pagination=d.pagination||t.pagination,y.showFilters()),y.renderProducts(t.products),y.renderInfo(t.pagination,t.pagination.total||0),y.renderPagination(t.pagination),y.renderApplied(t.filters),y.sortSelect){if(o.isBestSelling(t.sort.field))y.sortSelect.value="best-selling";else{let u=o.equals(t.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${t.sort.field}-${u}`}f.debug("Sort select value updated programmatically",{value:y.sortSelect.value,sort:t.sort})}y.hideLoading(),t.products.length===0&&!m&&(!t.fallbackProducts||t.fallbackProducts.length===0)&&y.showError("No products or filters found. Please check your configuration.")}catch(a){if(y.hideLoading(),f.error("Load failed",{error:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0,shop:t.shop,apiBaseURL:O.baseURL}),t.fallbackProducts&&t.fallbackProducts.length>0){if(f.warn("Initial load failed, using fallback products from Liquid",{error:a instanceof Error?a.message:String(a),fallbackCount:t.fallbackProducts.length}),t.usingFallback=!0,t.products=t.fallbackProducts,t.pagination=K.getPagination(),t.availableFilters=[],y.hideFilters(),y.sortSelect)if(o.isBestSelling(t.sort.field))y.sortSelect.value="best-selling";else{let l=o.equals(t.sort.order,"asc")?"ascending":"descending";y.sortSelect.value=`${t.sort.field}-${l}`}y.renderProducts(t.products),y.renderInfo(t.pagination,t.pagination.total),y.renderPagination(t.pagination),y.renderApplied(t.filters)}else y.showError(`${P.messages.failedToLoad}: ${a instanceof Error?a.message:P.messages.unknownError}. ${P.messages.checkConsole}`)}},Logger:f},N=window;N.DOM=y;N.AFS_State=t;N.AFS_API=O;N.AFS_LOG=f;N.QuickAdd=ie;N.$=o;N.Icons=B;N.Lang=P;N.SpecialValue=ee;typeof window!="undefined"?N.AFS=J:typeof global!="undefined"&&(global.AFS=J);
