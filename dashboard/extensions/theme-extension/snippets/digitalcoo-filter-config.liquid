{% assign page_size = block.settings.page_size | default: 24 %}
{% assign liquid_current_page = 1 %}
{% assign liquid_total_pages = 1 %}
{% assign liquid_total_products = 0 %}

<script type="application/json" id="digitalcoo-filter-config">
{
  "config": {
    "shop": {{ shop.permanent_domain | json }},
    "containerSelector": "#afs-container-{{ block.id }}",
    "pageSize": {{ page_size | json }},
    "debug": {{ block.settings.enable_logging | default: false | json }},
    "collections": [
      {% for c in collections %}
        {
          "id": {{ c.id | json }},
          "title": {{ c.title | json }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ],
    "selectedCollection": {
      "id": {{ collection.id | json }},
      "sortBy": {{ collection.default_sort_by | json }}
    },
    "fallbackProducts": [
        {% if collection.products and collection.products.size > 0 %}
          {% paginate collection.products by page_size %}
            {%- assign liquid_current_page = paginate.current_page -%}
            {%- assign liquid_total_pages = paginate.pages -%}
            {%- assign liquid_total_products = paginate.items -%}
            {% for product in collection.products %}
              {
                "id": {{ product.id | json }},
                "gid": {{ product.id | json }},
                "title": {{ product.title | json }},
                "vendor": {{ product.vendor | json }},
                "handle": {{ product.handle | json }},
                "url": {{ product.url | json }},
                "imageUrl": {% if product.featured_image %}{{ product.featured_image | image_url: width: 300, format: 'webp', quality: 80 | json }}{% else %}''{% endif %},
                "featuredImage": {% if product.featured_image %}{
                  "url": {{ product.featured_image | image_url: width: 300, format: 'webp', quality: 80 | json }},
                  "urlFallback": {{ product.featured_image | image_url: width: 300 | json }},
                  "alt": {{ product.featured_image.alt | json }}
                }{% else %}null{% endif %},
                "variants": [
                  {% for variant in product.variants %}
                    {
                      "id": {{ variant.id | json }},
                      "title": {{ variant.title | json }},
                      "price": {{ variant.price | divided_by: 100.0 | json }},
                      "compareAtPrice": {% if variant.compare_at_price %}{{ variant.compare_at_price | divided_by: 100.0 | json }}{% else %}null{% endif %},
                      "sku": {{ variant.sku | json }},
                      "availableForSale": {{ variant.available | json }},
                      "sellableOnlineQuantity": {{ variant.inventory_quantity | json }},
                      "selectedOptions": [
                        {% for option in product.options_with_values %}
                          {
                            "name": {{ option.name | json }},
                            "value": {{ variant.options[forloop.index0] | json }}
                          }{% unless forloop.last %},{% endunless %}
                        {% endfor %}
                      ]
                    }{% unless forloop.last %},{% endunless %}
                  {% endfor %}
                ],
                "minPrice": {{ product.price_min | divided_by: 100.0 | json }},
                "maxPrice": {{ product.price_max | divided_by: 100.0 | json }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          {% endpaginate %}
        {% endif %}
      ],
    "fallbackPagination": {
      "currentPage": {{ liquid_current_page | json }},
      "totalPages": {{ liquid_total_pages | json }},
      "totalProducts": {{ liquid_total_products | json }}
    },
    "moneyFormat": {{ shop.money_format | json }},
    "moneyWithCurrencyFormat": {{ shop.money_with_currency_format | json }},
    "currency": {{ cart.currency.iso_code | default: shop.currency | json }},
    "searchTerms": {% if template.name == 'search' and search.terms %} {{ search.terms | json }}{% else %}null{% endif %},
    "isSearchTemplate": {% if template.name == 'search' %}true{% else %}false{% endif %},
    "template": {{ template.name | json }}
  }
}
</script>