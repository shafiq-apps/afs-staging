/**
 * Advanced Filter Search - Responsive Design Styles
 * All media queries for mobile, tablet, desktop, and large desktop
 * Includes mobile filter controls
 */

@use 'variables' as *;
@use 'components' as *;

[data-block-handle="digitalcoo-filter"] {
    width: 100% !important;
    min-width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
}

/* ============================================================================
   Viewport and Screen Shrinking Prevention
   ============================================================================ */
@media (max-width: $breakpoint-mobile) {

    body.afs-filters-open {
        overflow: hidden !important;
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
        max-width: 100vw !important;
    }

    .afs-cart-toast {
        top: 10px;
        right: 10px;
        left: 10px;
        min-width: auto;
        max-width: none;
        transform: translateY(-100px);

        &--show {
            transform: translateY(0);
        }
    }
}

/* ============================================================================
   MOBILE (up to 767px)
   ============================================================================ */
@media (max-width: $breakpoint-mobile) {
    [data-afs-container] {
        padding: $spacing-md;
        gap: $spacing-lg;
        width: 100%;
        max-width: 100vw;
        min-width: 0;
        overflow-x: hidden;
        box-sizing: border-box;

        .afs-main-content {
            flex-direction: column;
            gap: $spacing-lg;
            width: 100%;
            min-width: 0;
            max-width: 100%;
        }

        .afs-mobile-filter-button {
            display: flex;
            width: 100%;
            justify-content: center;
            margin-bottom: $spacing-lg;
            min-height: 48px;
            padding: 14px $spacing-xl;
            font-size: $font-size-lg;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .afs-filters-container {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 85%;
            max-width: 400px;
            height: 100vh;
            max-height: 100vh;
            background: var(--afs-bg-color);
            z-index: $z-index-modal;
            overflow-y: auto;
            overflow-x: hidden;
            flex-direction: column;
            flex: none;
            margin: 0;
            padding: $spacing-lg;
            padding-top: calc(60px + env(safe-area-inset-top));
            padding-bottom: calc(100px + env(safe-area-inset-bottom));
            padding-left: calc($spacing-lg + env(safe-area-inset-left));
            padding-right: calc($spacing-lg + env(safe-area-inset-right));
            box-sizing: border-box;
            touch-action: pan-y;
            transform: translateX(-100%);
            transition: transform $transition-slow cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 4px 0 20px var(--afs-shadow-color-strong);
            -webkit-overflow-scrolling: touch;
            border-radius: 0;

            &--open {
                display: flex !important;
                flex-direction: column;
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                bottom: 0 !important;
                width: 85% !important;
                max-width: 400px !important;
                height: 100vh !important;
                max-height: 100vh !important;
                z-index: $z-index-modal !important;
                transform: translateX(0) !important;
                padding: $spacing-xl;
                padding-top: calc(70px + env(safe-area-inset-top));
                padding-bottom: calc(110px + env(safe-area-inset-bottom));
                padding-left: calc($spacing-xl + env(safe-area-inset-left));
                padding-right: calc($spacing-xl + env(safe-area-inset-right));

                .afs-mobile-filter-close {
                    display: flex !important;
                }

                .afs-mobile-filter-apply {
                    display: block !important;
                }
            }
        }

        .afs-mobile-filter-backdrop {
            display: none !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--afs-overlay-color-strong);
            z-index: $z-index-modal-backdrop;
            opacity: 0;
            transition: opacity $transition-slow cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(2px);

            &[style*="block"] {
                display: block !important;
                opacity: 1;
                pointer-events: auto;
            }
        }

        .afs-filter-group {
            margin-bottom: 24px;
            padding-bottom: $spacing-lg;

            &__label {
                font-size: $font-size-lg;
                margin-bottom: $spacing-md;
            }

            &__toggle {
                min-height: 44px;
                padding: $spacing-sm 0;
                touch-action: manipulation;
            }

            &__items {
                max-height: 200px;
                gap: $spacing-md;
            }

            &__search-input {
                font-size: $font-size-base;
                padding: 12px $spacing-md;
                min-height: 44px;
            }
        }

        .afs-filter-item {
            min-height: 44px;
            padding: $spacing-sm 0;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;

            &__checkbox {
                width: 20px;
                height: 20px;
                min-width: 20px;
                min-height: 20px;
            }
        }

        .afs-applied-filters {
            padding: $spacing-md 0;
            margin-bottom: $spacing-md;

            &-chip {
                font-size: $font-size-base;
                padding: 10px $spacing-md;
                min-height: 36px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;

                &__remove {
                    width: 20px;
                    height: 20px;
                    min-width: 20px;
                    min-height: 20px;
                }
            }
        }

        .afs-products-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: $spacing-md;
            width: 100%;
            max-width: 100%;
            min-width: 0;
            overflow-x: hidden;
        }

        .afs-product-card {
            padding: $spacing-md;
            min-width: 0;

            &__image {
                margin-bottom: $spacing-md;
            }

            &__title {
                font-size: $font-size-base;
                margin-bottom: $spacing-xs;
                line-height: 1.4;
            }

            &__vendor {
                font-size: $font-size-sm;
                margin-bottom: $spacing-xs;
            }

            &__price {
                font-size: $font-size-base;
                font-weight: $font-weight-semibold;
            }
        }

        .afs-products-info {
            flex-direction: column;
            align-items: flex-start;
            gap: $spacing-md;

            &__results {
                display: none; // Hide on mobile, shown in sticky button instead
            }
        }

        .afs-mobile-results-button {
            display: block;
        }

        .afs-products-container {
            flex: 1;
            min-width: 0;
            max-width: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        .afs-sort-container {
            width: 100%;
            margin-left: 0;
            justify-content: space-between;
            gap: $spacing-md;
        }

        .afs-sort-label {
            font-size: $font-size-base;
            font-weight: $font-weight-medium;
        }

        .afs-sort-select {
            flex: 1;
            max-width: 200px;
            font-size: $font-size-base;
            padding: 12px $spacing-md;
            min-height: 44px;
            touch-action: manipulation;
        }
    }

    body.afs-filters-open {
        overflow: hidden !important;
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
        max-width: 100vw !important;

        .afs-mobile-results-button {
            display: none !important;
        }
    }
}

/* ============================================================================
   TABLET (768px to 1023px)
   ============================================================================ */
@media (min-width: $breakpoint-tablet) and (max-width: $breakpoint-tablet-max) {
    [data-afs-container] {
        padding: $spacing-lg 0px;

        .afs-main-content {
            gap: 20px;
        }

        .afs-mobile-filter-button,
        .afs-mobile-filter-close,
        .afs-mobile-filter-apply,
        .afs-mobile-results-button {
            display: none !important;
        }

        .afs-filters-container {
            display: block !important;
            flex: 0 0 240px;
            min-width: 240px;
            position: relative;
            top: auto;
            left: auto;
            right: auto;
            bottom: auto;
            background: transparent;
            z-index: auto;
            overflow: visible;
            padding: 0;

            &--open {
                display: block !important;
            }
        }

        // Top bar layout on tablet
        &[data-afs-layout="top"] {
            .afs-filters-container {
                flex: none;
                min-width: 0;
                width: 100%;
                display: flex !important; // Override --open display: block
                flex-direction: row;
                flex-wrap: wrap;
                gap: $spacing-md;
                overflow-x: visible !important; // Remove horizontal scrollbar
                overflow-y: visible !important;
                padding-bottom: $spacing-md;
                position: relative !important; // Override fixed positioning
                top: auto !important;
                left: auto !important;
                bottom: auto !important;
                width: 100% !important;
                max-width: 100% !important;
                height: auto !important;
                max-height: none !important;
                transform: none !important;
                background: transparent !important;
                z-index: 100 !important; // Ensure filters are above products
                box-shadow: none !important;
                padding: 0 0 $spacing-md 0 !important;
            }

            .afs-filters-container--open {
                display: flex !important; // Keep flex layout even when open
                overflow-x: visible !important; // Remove scrollbar
            }
        }

        .afs-products-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: $spacing-lg;
        }

        .afs-product-card {
            &__image {
                padding-top: 100%;
            }

            &__title {
                font-size: $font-size-md;
            }

            &__price {
                font-size: $font-size-md;
            }
        }
    }

    .afs-product-modal {
        width: 70%;
        max-width: 800px;

        &__layout {
            flex-direction: row;
        }

        &__media {
            min-width: 300px;
            max-width: 50%;
            height: 600px;
            max-height: 600px;
            min-height: 600px;
        }

        &__image-grid shopify-media img {
            max-height: 400px;
        }

        &__images {
            gap: 0.5rem;
        }

        &__image {
            flex: 0 0 70px;
            width: 70px;
            height: 70px;
        }

        &__title {
            font-size: 20px;
        }

        &__price-container {
            font-size: 18px;
        }
    }
}

/* ============================================================================
   DESKTOP (1024px to 1439px)
   ============================================================================ */
@media (min-width: $breakpoint-desktop) {
    [data-afs-container] {
        padding: $spacing-xl 0px;

        .afs-main-content {
            gap: $spacing-xxl;
        }

        .afs-mobile-filter-button,
        .afs-mobile-filter-close,
        .afs-mobile-filter-apply,
        .afs-mobile-results-button {
            display: none !important;
        }

        .afs-filters-container {
            display: block !important;
            flex: 0 0 280px;
            min-width: 280px;
            position: relative;
            top: auto;
            left: auto;
            right: auto;
            bottom: auto;
            background: transparent;
            z-index: auto;
            overflow: visible;
            padding: 0;

            &--open {
                display: block !important;
            }
        }

        // Top bar layout on desktop
        &[data-afs-layout="top"] {
            .afs-filters-container {
                flex: none;
                min-width: 0;
                width: 100%;
                display: flex !important; // Override --open display: block
                flex-direction: row;
                flex-wrap: wrap;
                gap: $spacing-md;
                overflow-x: visible !important; // Remove horizontal scrollbar
                overflow-y: visible !important;
                padding-bottom: $spacing-md;
                position: relative !important; // Override fixed positioning
                top: auto !important;
                left: auto !important;
                bottom: auto !important;
                width: 100% !important;
                max-width: 100% !important;
                height: auto !important;
                max-height: none !important;
                transform: none !important;
                background: transparent !important;
                z-index: 100 !important; // Ensure filters are above products
                box-shadow: none !important;
                padding: 0 0 $spacing-md 0 !important;
            }

            .afs-filters-container--open {
                display: flex !important; // Keep flex layout even when open
                overflow-x: visible !important; // Remove scrollbar
            }
        }

        .afs-products-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: $spacing-xl;
        }

        .afs-product-card {
            &__image {
                padding-top: 100%;
            }
        }
    }

    .afs-product-modal {
        width: 90%;
        max-width: 1200px;

        &__layout {
            flex-direction: row;
        }

        &__media {
            min-width: 400px;
            max-width: 50%;
            height: 600px;
            max-height: 600px;
            min-height: 600px;
        }

        &__image-grid shopify-media img {
            max-height: 500px;
        }

        &__title {
            font-size: 24px;
        }

        &__price-container {
            font-size: 20px;
        }
    }
}

/* ============================================================================
   LARGE DESKTOP (1440px and above)
   ============================================================================ */
@media (min-width: $breakpoint-large-desktop) {
    [data-afs-container] {
        max-width: 1600px;

        .afs-products-grid {
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        }
    }

    .afs-product-modal {
        max-width: 1400px;
    }
}

/* ============================================================================
   PRINT STYLES
   ============================================================================ */

@media print {
    [data-afs-container] {
        .afs-filters-container {
            display: none;
        }

        .afs-products-container {
            grid-template-columns: repeat(3, 1fr);
        }
    }
}

/* Pan-zoom magnifier - no overlay, transforms image directly */
@media (hover: none) and (pointer: coarse) {
    .afs-slider__viewport {
        cursor: default;

        &--zoomable {
            cursor: default !important;
        }
    }
}